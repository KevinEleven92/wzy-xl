<?php
 namespace app\mp\logic; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs as IndexDefs; use app\mp\service\Subjects; use app\Defs; use app\index\logic\Subject as SubjectLogic; class Aio extends Base { public function login($uid, $computerName, $ver) { goto eNFfp; eNFfp: $accessToken = generateUniqid(); goto mxHGN; uAn6h: goto wv5fB; goto yk_9x; aNjq_: Db::table("\x61\151\157")->insert(["\165\151\x64" => $uid, "\143\x6f\x6d\160\165\x74\145\x72\137\x6e\x61\155\145" => $computerName, "\x6c\x6f\147\151\x6e\137\x74\151\x6d\x65" => Db::raw("\x6e\x6f\167\50\x29"), "\154\x6f\147\151\156\x5f\151\160" => request()->ip(), "\153\145\145\160\x61\x6c\151\x76\145\x5f\x74\x69\155\145" => Db::raw("\156\x6f\167\x28\x29"), "\166\145\162" => $ver, "\141\x63\143\x65\x73\163\137\x74\157\153\145\156" => $accessToken]); goto gXt1_; xqyUB: if (!$aio) { goto Ynr6q; } goto zCTxN; yk_9x: Ynr6q: goto aNjq_; xsUAw: return $accessToken; goto Byr4n; mxHGN: $aio = Db::table("\x61\151\x6f")->where(["\165\151\144" => $uid])->find(); goto xqyUB; zCTxN: Db::table("\141\151\157")->where(["\x75\151\x64" => $uid])->update(["\143\157\155\160\x75\x74\x65\162\x5f\x6e\141\155\x65" => $computerName, "\154\x6f\147\x69\x6e\137\164\151\155\145" => Db::raw("\x6e\x6f\x77\x28\x29"), "\x6c\157\147\x69\156\x5f\x69\x70" => request()->ip(), "\153\x65\145\160\141\x6c\151\x76\x65\x5f\x74\151\155\145" => Db::raw("\156\x6f\x77\x28\x29"), "\x76\x65\x72" => $ver, "\141\143\143\145\x73\x73\x5f\x74\x6f\153\x65\156" => $accessToken]); goto uAn6h; gXt1_: wv5fB: goto xsUAw; Byr4n: } public function keepAlive($uid) { Db::table("\x61\151\157")->where(["\165\151\144" => $uid])->update(["\x6b\145\145\160\x61\x6c\151\166\x65\137\164\151\x6d\145" => Db::raw("\156\x6f\167\x28\51")]); } public function loadIndexSubjects() { goto ITKAH; Y8MFR: $rows = Subjects::I()->getList($map, 1, 1000); goto l5bDh; tOkGS: $populars = []; goto Rz5IZ; O33qs: foreach ($populars as &$popular) { $popular["\151\x6d\141\147\x65\x5f\165\x72\154"] = generateThumbnailUrl($popular["\x69\x6d\x61\x67\x65\137\x75\162\x6c"], 300); ZcrjU: } goto I9meq; yW3zS: return [$banners, $populars, $featureds]; goto XvXvk; ayprD: foreach ($rows as &$row) { goto gGGRq; gGGRq: $row["\160\141\162\164\x69\143\x69\x70\141\156\164\x73"] = $row["\x70\141\162\164\151\x63\151\x70\x61\156\164\163\137\163\x68\157\x77"]; goto e0TwE; uOU52: $row["\142\141\x6e\156\x65\x72\x5f\151\155\x67"] = $row["\151\155\x61\x67\x65\137\x75\x72\154"]; goto EaEwW; ZBvHX: JhK55: goto pD7pn; fTKlQ: if (!(false !== strpos($row["\154\x61\142\145\x6c"], "\160\157\x70\165\x6c\141\162"))) { goto JhK55; } goto jZBXP; WFbO6: m9l5q: goto TUXuP; q8i9y: $featureds[] = $row; goto pc7f8; LB3aq: $banners[] = $row; goto H5v2T; pD7pn: if (!(false !== strpos($row["\154\x61\x62\x65\154"], "\146\145\x61\164\165\162\x65\144"))) { goto hzXZE; } goto q8i9y; e0TwE: if (!empty($row["\x62\x61\156\156\145\x72\x5f\x69\x6d\x67"])) { goto PrJyL; } goto uOU52; EaEwW: PrJyL: goto Np2Zy; Np2Zy: if (!(false !== strpos($row["\154\141\x62\145\x6c"], "\x62\x61\156\156\x65\x72"))) { goto w2Deh; } goto LB3aq; H5v2T: w2Deh: goto fTKlQ; jZBXP: $populars[] = $row; goto ZBvHX; pc7f8: hzXZE: goto WFbO6; TUXuP: } goto rAshT; iOPG0: ObJdT: goto yW3zS; ITKAH: $map = ["\144\x65\154\x65\164\145\137\146\154\141\147" => 0]; goto IenSl; Zg2lx: foreach ($featureds as &$featured) { goto eWPf8; NdoIX: $featured["\143\141\164\145\147\x6f\x72\171\137\156\141\x6d\x65\163"] = $categoryNames; goto vUW0i; yCPjO: Y_Rm2: goto hiOuT; eWPf8: $categoryNames = Db::table("\163\x75\142\152\145\143\x74\x5f\143\141\x74\145\147\157\x72\171\137\162\145\154\141\x74\x65")->alias("\123\103\x52")->join("\143\141\164\x65\147\x6f\x72\151\x65\x73\40\x43", "\x53\103\x52\56\143\141\x74\x65\x67\x6f\x72\171\x5f\151\144\75\103\x2e\151\144\40\141\156\x64\x20\123\x43\x52\56\x73\165\142\x6a\145\x63\164\137\151\144\75" . $featured["\x69\144"])->column("\103\56\x6e\141\155\145"); goto NdoIX; vUW0i: $featured["\x69\x6d\x61\147\145\137\x75\x72\154"] = generateThumbnailUrl($featured["\151\155\x61\x67\145\x5f\165\162\x6c"], 300); goto yCPjO; hiOuT: } goto iOPG0; l5bDh: $banners = []; goto tOkGS; I9meq: nANji: goto Zg2lx; IenSl: $map["\146\151\x65\x6c\144"] = "\x69\144\54\x6e\x61\155\145\54\163\165\x62\164\151\164\154\145\x2c\143\x75\162\162\x65\156\x74\137\160\x72\x69\x63\145\54\x69\164\x65\x6d\x73\x2c\160\141\162\164\x69\x63\151\160\141\x6e\164\x73\137\163\150\157\x77\54\x6c\141\142\145\154\x2c\151\x6d\x61\147\145\x5f\x75\162\x6c\54\x62\x61\156\x6e\145\x72\x5f\x69\155\x67"; goto Y8MFR; rAshT: uYqIN: goto O33qs; Rz5IZ: $featureds = []; goto ayprD; XvXvk: } public function genOrder($aio_id, $subject_id) { goto unHo6; XyfgU: $order["\161\165\145\163\164\151\x6f\x6e\x5f\146\157\x72\x6d"] = $subject["\x71\x75\145\x73\164\x69\x6f\156\137\x66\x6f\x72\155"]; goto oV4Mr; noix0: $order["\157\x72\144\x65\162\x5f\x6e\x6f"] = generateSequenceNo(rand(1, 999), Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\123"); goto X_uY3; ICquV: $order["\x6f\x72\144\x65\x72\137\141\155\157\x75\156\x74"] = 0; goto d75jZ; Y2wk1: wexception("\346\227\xa0\xe6\xb3\x95\346\x89\276\345\210\xb0\xe8\xaf\xa5\351\207\217\xe8\xa1\250"); goto Bvmga; UTmTo: kWlBy: goto MYAT7; i0ldI: YurjG: goto WrmWo; Kp_ov: Db::table("\163\x75\x62\x6a\145\143\164")->where(["\x69\x64" => $subject_id])->setInc("\160\141\162\164\x69\x63\151\160\x61\156\164\163\x5f\163\150\x6f\167"); goto ZgxW6; p0w2K: if (!(empty($subject["\143\x75\163\164\x6f\155\x5f\164\x65\x73\164"]) && $subject["\x69\x74\x65\155\x73"] == 0)) { goto kWlBy; } goto YmbYo; WrmWo: Db::table("\x73\165\142\x6a\x65\143\164")->where(["\151\x64" => $subject_id])->setInc("\160\x61\x72\x74\x69\143\x69\160\141\x6e\x74\x73"); goto Kp_ov; d75jZ: $order["\x69\x74\145\x6d\137\166\145\x72\163\x69\157\156"] = $subject["\x69\x74\x65\155\137\x76\145\x72\163\151\x6f\x6e"]; goto XyfgU; Bvmga: Tp7Sa: goto p0w2K; w4fXn: if (!empty($res)) { goto YurjG; } goto bCkDQ; TG2Qk: $order["\163\165\x62\x6a\x65\x63\x74\x5f\151\144"] = $subject_id; goto oDVZq; EslFP: $order["\151\x74\145\x6d\x73"] = ''; goto ICquV; ZgxW6: Db::table("\163\165\x62\152\x65\x63\x74")->where(["\x69\x64" => $subject_id])->setInc("\164\157\164\141\x6c\137\141\155\157\x75\156\164", $order["\157\162\144\145\162\x5f\141\x6d\157\x75\156\x74"]); goto cmODK; bCkDQ: wexception("\xe6\225\xb0\346\215\xae\xe5\xba\223\346\x96\260\xe5\xa2\x9e\xe8\xae\xa2\345\215\225\xe5\xbc\x82\345\xb8\270"); goto i0ldI; YmbYo: wexception("\xe6\265\x8b\350\257\x84\351\x87\x8f\xe8\xa1\xa8\345\x8c\205\xe5\220\253\347\232\x84\351\242\x98\347\233\256\344\xb8\xba\xe7\xa9\xba"); goto UTmTo; oDVZq: $order["\164\x6f\x74\x61\154\137\x69\164\145\155\x73"] = $subject["\x69\x74\145\x6d\163"]; goto EslFP; X_uY3: $order["\x61\x69\x6f\x5f\151\x64"] = $aio_id; goto TG2Qk; MYAT7: $order = []; goto noix0; cmODK: return $order["\x6f\162\144\x65\x72\x5f\156\157"]; goto taMGZ; vb2QX: if ($subject) { goto Tp7Sa; } goto Y2wk1; unHo6: $subject = Subjects::I()->getSubjectById($subject_id); goto vb2QX; oV4Mr: $res = Db::table("\x61\x69\x6f\137\x6f\162\x64\x65\162")->insert($order); goto w4fXn; taMGZ: } public function regenOrder($order_no) { goto PFLfZ; bG5Cj: if (!empty($order)) { goto sWFNI; } goto ACZx2; DnL7U: sWFNI: goto z0uRV; VV2dW: $order["\162\145\163\165\154\x74"] = null; goto PkNVO; gop3h: wexception("\xe6\xb5\x8b\350\257\204\344\xb8\215\345\xad\x98\345\x9c\250"); goto BOsXs; z0uRV: $subject = Subjects::I()->getSubjectById($order["\163\165\x62\152\x65\x63\164\x5f\151\x64"]); goto LUt0w; PFLfZ: $order = Db::table("\141\151\x6f\137\x6f\162\x64\145\162")->where(["\x6f\x72\144\x65\162\x5f\156\x6f" => $order_no])->field(true)->find(); goto bG5Cj; QUaPM: $order["\161\165\x65\163\x74\x69\x6f\156\137\x66\x6f\x72\x6d"] = $subject["\161\x75\145\163\x74\x69\157\156\x5f\146\157\162\x6d"]; goto aVabM; PkNVO: $order["\x66\151\x6e\151\163\x68\x65\x64"] = 0; goto QUaPM; K9Brz: $order["\164\x65\163\x74\x5f\x69\x74\x65\155\x73"] = 0; goto kY2Z_; BOsXs: jtOR1: goto n_lBg; n_lBg: $order = []; goto W0Wap; l9gMT: $order["\x69\164\145\x6d\x73"] = ''; goto VV2dW; LUt0w: if (!empty($subject)) { goto jtOR1; } goto gop3h; ACZx2: wexception("\xe6\265\213\xe8\xaf\x84\xe8\256\242\xe5\215\x95\xe4\xb8\x8d\xe5\xad\x98\345\234\250"); goto DnL7U; W0Wap: $order["\164\x6f\164\x61\x6c\137\151\x74\x65\155\163"] = $subject["\151\x74\x65\155\163"]; goto K9Brz; x13yo: $order["\151\164\x65\155\x5f\166\145\x72\x73\x69\x6f\x6e"] = $subject["\x69\x74\x65\155\x5f\166\x65\x72\x73\151\x6f\156"]; goto lKgWV; aVabM: $order["\x71\165\x65\x73\164\151\157\156\x5f\141\156\163\x77\x65\x72"] = ''; goto x13yo; lKgWV: Db::table("\141\151\157\x5f\x6f\162\144\145\x72")->where("\157\x72\x64\x65\x72\137\x6e\x6f", $order_no)->update($order); goto jGyNY; kY2Z_: $order["\x63\165\162\162\137\151\x74\x65\155"] = 0; goto l9gMT; jGyNY: } }
