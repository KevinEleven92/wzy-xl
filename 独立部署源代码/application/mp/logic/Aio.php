<?php
 namespace app\mp\logic; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs as IndexDefs; use app\mp\service\Subjects; use app\Defs; use app\index\logic\Subject as SubjectLogic; class Aio extends Base { public function login($uid, $computerName, $ver) { goto xinxO; xinxO: $accessToken = generateUniqid(); goto zM8Ol; b__af: ff0AI: goto rrca6; UHtZp: if (!$aio) { goto ff0AI; } goto mdX1g; mdX1g: Db::table("\141\x69\157")->where(["\165\x69\x64" => $uid])->update(["\x63\157\x6d\x70\x75\x74\x65\x72\x5f\156\141\155\145" => $computerName, "\154\157\147\151\156\x5f\164\x69\155\x65" => Db::raw("\x6e\157\167\x28\x29"), "\x6c\x6f\x67\x69\x6e\x5f\x69\160" => request()->ip(), "\x6b\x65\x65\160\141\x6c\x69\x76\145\137\164\x69\x6d\x65" => Db::raw("\x6e\x6f\167\x28\51"), "\166\x65\162" => $ver, "\141\143\x63\x65\163\x73\x5f\164\x6f\153\x65\156" => $accessToken]); goto IpIOr; IpIOr: goto I75eR; goto b__af; dxKX0: I75eR: goto KB1SB; rrca6: Db::table("\141\x69\157")->insert(["\x75\151\144" => $uid, "\x63\x6f\155\x70\x75\164\145\x72\x5f\x6e\x61\155\x65" => $computerName, "\x6c\157\x67\x69\156\x5f\x74\x69\x6d\145" => Db::raw("\156\157\x77\50\x29"), "\154\157\x67\x69\156\137\x69\160" => request()->ip(), "\153\145\x65\160\x61\x6c\151\166\x65\137\164\x69\155\145" => Db::raw("\156\x6f\167\x28\51"), "\166\x65\x72" => $ver, "\141\x63\143\x65\163\x73\x5f\164\157\x6b\145\156" => $accessToken]); goto dxKX0; KB1SB: return $accessToken; goto i1kNY; zM8Ol: $aio = Db::table("\x61\x69\x6f")->where(["\x75\x69\144" => $uid])->find(); goto UHtZp; i1kNY: } public function keepAlive($uid) { Db::table("\x61\151\x6f")->where(["\x75\x69\144" => $uid])->update(["\153\145\145\160\x61\x6c\x69\x76\145\137\x74\x69\x6d\145" => Db::raw("\x6e\x6f\x77\50\x29")]); } public function loadIndexSubjects() { goto aXiwn; bHat1: $rows = Subjects::I()->getList($map, 1, 1000); goto OcYvy; NGz0Y: foreach ($populars as &$popular) { $popular["\x69\x6d\141\x67\x65\137\165\162\x6c"] = generateThumbnailUrl($popular["\151\155\141\147\x65\x5f\165\162\154"], 300); Gn6Qt: } goto XH5qv; rAh2j: $populars = []; goto OGc3x; zp5sP: foreach ($featureds as &$featured) { goto fWOm6; d8jAD: $featured["\143\x61\164\x65\x67\x6f\x72\171\x5f\156\141\x6d\x65\x73"] = $categoryNames; goto JTJ7t; JTJ7t: $featured["\151\x6d\x61\147\x65\x5f\x75\162\x6c"] = generateThumbnailUrl($featured["\151\x6d\x61\x67\x65\137\x75\x72\x6c"], 300); goto t7_uN; fWOm6: $categoryNames = Db::table("\x73\165\142\152\x65\143\164\137\143\141\164\145\147\157\162\x79\x5f\162\x65\x6c\141\164\x65")->alias("\x53\103\122")->join("\143\x61\164\145\147\157\162\151\145\x73\x20\x43", "\x53\103\122\x2e\x63\141\x74\145\147\157\162\171\137\x69\x64\75\103\56\151\144\40\141\x6e\x64\40\x53\103\122\56\163\x75\x62\152\145\x63\x74\137\x69\144\x3d" . $featured["\151\144"])->column("\x43\56\x6e\141\x6d\x65"); goto d8jAD; t7_uN: O23PT: goto mamPU; mamPU: } goto y5Z45; OGc3x: $featureds = []; goto dyYfW; LRimZ: b3bKF: goto NGz0Y; aXiwn: $map = ["\144\x65\x6c\x65\x74\145\x5f\146\154\x61\x67" => 0]; goto KxBUA; OcYvy: $banners = []; goto rAh2j; dyYfW: foreach ($rows as &$row) { goto wtuh6; kLUZ3: UYHl9: goto TQ2Xw; O1BRp: SJdfi: goto BncYg; BncYg: if (!(false !== strpos($row["\154\x61\x62\x65\x6c"], "\x70\157\160\x75\x6c\141\162"))) { goto UYHl9; } goto UTHY3; rcOSN: $featureds[] = $row; goto NwqO2; wtuh6: $row["\x70\x61\x72\164\x69\x63\151\x70\x61\156\x74\163"] = $row["\160\141\x72\164\x69\x63\x69\160\x61\156\x74\x73\x5f\163\x68\157\x77"]; goto sp858; sp858: if (!empty($row["\x62\x61\156\156\145\162\137\x69\155\x67"])) { goto Pn0HY; } goto sGTBY; UTHY3: $populars[] = $row; goto kLUZ3; C87zh: $banners[] = $row; goto O1BRp; ouy_3: TG44J: goto G0_R2; TQ2Xw: if (!(false !== strpos($row["\x6c\141\x62\145\154"], "\146\x65\x61\164\165\x72\145\x64"))) { goto VYqlK; } goto rcOSN; sGTBY: $row["\x62\141\156\x6e\x65\162\x5f\151\155\x67"] = $row["\x69\155\x61\x67\145\x5f\x75\162\x6c"]; goto tPzdZ; TmX5C: if (!(false !== strpos($row["\154\141\142\x65\x6c"], "\142\x61\156\156\x65\x72"))) { goto SJdfi; } goto C87zh; tPzdZ: Pn0HY: goto TmX5C; NwqO2: VYqlK: goto ouy_3; G0_R2: } goto LRimZ; y5Z45: OhXEG: goto kaLrt; KxBUA: $map["\x66\x69\145\154\x64"] = "\151\x64\x2c\x6e\141\155\145\x2c\x73\165\142\164\151\x74\x6c\145\54\143\165\162\162\145\156\164\x5f\x70\x72\151\x63\x65\54\151\164\x65\155\163\x2c\x70\141\x72\x74\151\143\151\x70\x61\x6e\x74\x73\137\x73\150\x6f\x77\x2c\154\141\142\145\x6c\54\x69\155\141\147\145\x5f\x75\162\154\x2c\142\x61\x6e\x6e\x65\162\137\x69\x6d\147"; goto bHat1; kaLrt: return [$banners, $populars, $featureds]; goto RkCGP; XH5qv: pEOQb: goto zp5sP; RkCGP: } public function genOrder($aio_id, $subject_id) { goto roFTo; Qux36: if (!empty($res)) { goto x6ozL; } goto wkJ7G; nIlyo: $order["\163\x75\x62\x6a\x65\143\x74\137\x69\144"] = $subject_id; goto ujcxf; QmlHi: if ($subject) { goto HyG5o; } goto FSNR2; wkJ7G: wexception("\346\225\260\346\215\256\345\272\223\346\x96\xb0\xe5\xa2\x9e\xe8\xae\242\345\215\225\345\xbc\x82\345\xb8\270"); goto hPnKQ; RCFFj: if (!(empty($subject["\143\x75\x73\x74\157\x6d\137\x74\x65\x73\164"]) && $subject["\x69\x74\145\x6d\x73"] == 0)) { goto dMCSx; } goto J352Y; YktWv: $order["\x69\164\x65\x6d\137\x76\145\x72\x73\151\x6f\x6e"] = $subject["\151\x74\145\155\137\x76\x65\162\x73\x69\x6f\x6e"]; goto yweZM; MTeaJ: Db::table("\x73\x75\x62\152\x65\143\x74")->where(["\151\144" => $subject_id])->setInc("\x70\x61\162\x74\151\x63\151\x70\x61\156\x74\x73\137\163\x68\x6f\x77"); goto O8WGO; J352Y: wexception("\346\xb5\213\350\xaf\x84\xe9\x87\217\xe8\241\xa8\xe5\214\x85\345\220\253\347\x9a\x84\351\242\230\xe7\233\xae\xe4\xb8\272\xe7\xa9\272"); goto XIhjr; i0qi2: $order["\x6f\x72\144\x65\x72\137\x61\155\x6f\x75\156\x74"] = 0; goto YktWv; XIhjr: dMCSx: goto SgKAQ; roFTo: $subject = Subjects::I()->getSubjectById($subject_id); goto QmlHi; vqDTV: $order["\x6f\162\x64\145\162\x5f\156\157"] = generateSequenceNo(rand(1, 999), Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\123"); goto Cj7Pv; FSNR2: wexception("\346\227\240\xe6\xb3\225\xe6\211\276\xe5\x88\xb0\xe8\xaf\xa5\351\207\x8f\xe8\241\250"); goto H6wUE; Cj7Pv: $order["\141\151\157\137\151\x64"] = $aio_id; goto nIlyo; H6wUE: HyG5o: goto RCFFj; xRDM8: $order["\151\164\x65\155\163"] = ''; goto i0qi2; yweZM: $order["\x71\165\x65\x73\x74\x69\157\x6e\x5f\146\x6f\x72\x6d"] = $subject["\x71\165\x65\163\164\x69\x6f\x6e\137\x66\x6f\162\x6d"]; goto iYBuO; SgKAQ: $order = []; goto vqDTV; iYBuO: $res = Db::table("\141\151\x6f\x5f\x6f\x72\144\x65\x72")->insert($order); goto Qux36; ujcxf: $order["\x74\157\164\141\154\137\151\x74\145\155\x73"] = $subject["\x69\x74\x65\x6d\163"]; goto xRDM8; O8WGO: Db::table("\x73\165\142\x6a\145\x63\164")->where(["\x69\144" => $subject_id])->setInc("\164\x6f\x74\x61\154\x5f\141\x6d\157\165\156\x74", $order["\x6f\162\144\x65\x72\137\141\155\x6f\165\x6e\x74"]); goto q9Owz; kaKUE: Db::table("\163\x75\142\152\x65\143\164")->where(["\151\x64" => $subject_id])->setInc("\x70\x61\162\164\151\x63\151\x70\141\x6e\164\163"); goto MTeaJ; q9Owz: return $order["\x6f\x72\144\145\162\x5f\x6e\x6f"]; goto dSMM5; hPnKQ: x6ozL: goto kaKUE; dSMM5: } public function regenOrder($order_no) { goto rFKZG; AwgKS: $subject = Subjects::I()->getSubjectById($order["\x73\x75\142\152\x65\x63\164\x5f\x69\144"]); goto osOCd; xzPOU: $order["\151\x74\x65\x6d\x5f\x76\145\x72\163\x69\x6f\x6e"] = $subject["\x69\x74\145\x6d\137\166\x65\162\163\151\x6f\x6e"]; goto TJJik; IyDCA: $order["\x74\145\x73\x74\x5f\151\164\x65\x6d\x73"] = 0; goto Qu0kW; k9mpq: $order = []; goto EQZW6; Qu0kW: $order["\x63\165\x72\x72\x5f\151\164\145\x6d"] = 0; goto O1NVZ; TJJik: Db::table("\141\x69\157\x5f\x6f\162\144\x65\162")->where("\157\x72\x64\x65\x72\x5f\x6e\157", $order_no)->update($order); goto RWXL6; rFKZG: $order = Db::table("\141\151\157\137\157\x72\x64\x65\x72")->where(["\x6f\162\144\x65\162\x5f\x6e\157" => $order_no])->field(true)->find(); goto Kdbpp; MATZO: $order["\161\165\145\x73\x74\151\x6f\156\x5f\x66\x6f\x72\155"] = $subject["\161\x75\x65\163\x74\151\x6f\156\137\146\x6f\162\x6d"]; goto lNtz9; lNtz9: $order["\x71\165\145\163\164\x69\x6f\156\137\x61\156\x73\167\145\162"] = ''; goto xzPOU; YJ4jr: $order["\146\x69\x6e\x69\x73\x68\145\x64"] = 0; goto MATZO; FBZQx: tuvrC: goto k9mpq; osOCd: if (!empty($subject)) { goto tuvrC; } goto exMLp; Kdbpp: if (!empty($order)) { goto kEjCT; } goto nILhK; P5bbH: kEjCT: goto AwgKS; EQZW6: $order["\164\157\x74\x61\x6c\137\x69\x74\x65\x6d\x73"] = $subject["\x69\x74\x65\x6d\x73"]; goto IyDCA; exMLp: wexception("\346\xb5\x8b\350\257\204\344\270\215\xe5\255\230\345\x9c\250"); goto FBZQx; nILhK: wexception("\xe6\xb5\213\350\xaf\204\xe8\256\242\xe5\215\x95\xe4\xb8\x8d\345\255\x98\345\x9c\xa8"); goto P5bbH; uUQEi: $order["\x72\145\163\x75\x6c\164"] = null; goto YJ4jr; O1NVZ: $order["\151\164\x65\x6d\x73"] = ''; goto uUQEi; RWXL6: } }
