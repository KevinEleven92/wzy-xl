<?php
 namespace app\mp\logic; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs as IndexDefs; use app\mp\service\Subjects; use app\Defs; use app\index\logic\Subject as SubjectLogic; class Aio extends Base { public function login($uid, $computerName, $ver) { goto Tuyb0; eCgrF: Db::table("\141\151\x6f")->where(["\165\151\x64" => $uid])->update(["\x63\157\x6d\160\x75\164\145\x72\x5f\156\x61\x6d\x65" => $computerName, "\x6c\x6f\x67\151\156\x5f\x74\x69\x6d\145" => Db::raw("\156\x6f\x77\50\x29"), "\x6c\x6f\x67\x69\156\137\151\160" => request()->ip(), "\153\145\x65\x70\141\154\x69\166\x65\x5f\164\x69\x6d\x65" => Db::raw("\x6e\157\x77\x28\51"), "\x76\x65\x72" => $ver, "\141\x63\143\145\163\x73\x5f\164\x6f\153\145\x6e" => $accessToken]); goto BQO49; gdq04: $aio = Db::table("\x61\x69\x6f")->where(["\x75\151\x64" => $uid])->find(); goto ISGlb; BQO49: goto YOyVa; goto JUgTs; ISGlb: if (!$aio) { goto EDC0U; } goto eCgrF; ei1W_: YOyVa: goto S9Avp; S9Avp: return $accessToken; goto PT0Lf; JIvUi: Db::table("\x61\x69\x6f")->insert(["\x75\151\144" => $uid, "\143\x6f\x6d\x70\x75\x74\145\162\x5f\x6e\141\155\145" => $computerName, "\154\x6f\147\x69\156\x5f\x74\x69\155\145" => Db::raw("\156\x6f\x77\50\51"), "\154\x6f\x67\x69\x6e\x5f\x69\x70" => request()->ip(), "\x6b\x65\145\160\141\x6c\151\166\x65\137\x74\x69\155\145" => Db::raw("\156\x6f\x77\50\51"), "\166\145\x72" => $ver, "\141\x63\143\x65\163\163\x5f\x74\x6f\153\x65\x6e" => $accessToken]); goto ei1W_; JUgTs: EDC0U: goto JIvUi; Tuyb0: $accessToken = generateUniqid(); goto gdq04; PT0Lf: } public function keepAlive($uid) { Db::table("\141\151\x6f")->where(["\x75\x69\144" => $uid])->update(["\153\x65\x65\160\141\154\x69\166\145\x5f\164\151\x6d\145" => Db::raw("\x6e\x6f\x77\50\51")]); } public function loadIndexSubjects() { goto ubui6; ubui6: $map = ["\144\x65\x6c\145\x74\x65\137\x66\154\141\x67" => 0]; goto kVMce; kVMce: $map["\x66\x69\145\x6c\144"] = "\151\x64\54\x6e\x61\x6d\x65\x2c\163\x75\x62\164\x69\164\154\145\54\x63\165\x72\162\145\156\x74\x5f\x70\162\151\x63\145\x2c\151\x74\145\x6d\163\x2c\160\x61\162\164\x69\143\x69\160\x61\x6e\x74\163\x5f\x73\x68\x6f\167\x2c\154\141\142\x65\x6c\54\x69\x6d\x61\x67\145\137\165\x72\154\x2c\142\141\156\156\x65\162\137\x69\155\147"; goto Nb9io; NTx1q: $populars = []; goto B6wYy; H7p3O: $banners = []; goto NTx1q; niWxi: return [$banners, $populars, $featureds]; goto arjqZ; vw3mO: Ol7hC: goto niWxi; qiS1r: foreach ($rows as &$row) { goto wTdZF; ZXc15: if (!(false !== strpos($row["\x6c\x61\x62\x65\154"], "\160\x6f\160\165\x6c\141\x72"))) { goto sa1io; } goto G7kQW; G7kQW: $populars[] = $row; goto qUv19; uoAMP: if (!(false !== strpos($row["\154\x61\x62\x65\154"], "\x62\x61\x6e\156\x65\162"))) { goto KWDvd; } goto dXZER; qUv19: sa1io: goto RCZ13; avk0T: KWDvd: goto ZXc15; a7KiT: $featureds[] = $row; goto cP3fL; lTee_: if (!empty($row["\142\141\x6e\x6e\145\x72\137\151\x6d\x67"])) { goto FmXQL; } goto p1e31; wZC2r: hJ8Np: goto epdpx; RCZ13: if (!(false !== strpos($row["\154\141\x62\145\154"], "\146\x65\x61\x74\165\162\x65\144"))) { goto TYnkN; } goto a7KiT; p1e31: $row["\142\x61\x6e\156\x65\162\x5f\x69\x6d\147"] = $row["\151\x6d\x61\147\x65\137\165\162\154"]; goto rdbaT; cP3fL: TYnkN: goto wZC2r; rdbaT: FmXQL: goto uoAMP; wTdZF: $row["\160\141\x72\x74\151\x63\x69\160\141\x6e\164\163"] = $row["\x70\x61\x72\164\x69\x63\151\160\x61\156\164\x73\137\x73\x68\x6f\167"]; goto lTee_; dXZER: $banners[] = $row; goto avk0T; epdpx: } goto FWpwA; B6wYy: $featureds = []; goto qiS1r; C3Q9F: foreach ($populars as &$popular) { $popular["\x69\155\x61\x67\x65\x5f\x75\162\x6c"] = generateThumbnailUrl($popular["\151\155\141\147\x65\x5f\x75\162\154"], 300); HUSm2: } goto lrGjF; Nb9io: $rows = Subjects::I()->getList($map, 1, 1000); goto H7p3O; Wf4wF: foreach ($featureds as &$featured) { goto UQbBk; juDfG: kDMWL: goto UZxy3; jxKAx: $featured["\x63\x61\x74\x65\147\157\x72\171\x5f\x6e\141\x6d\x65\x73"] = $categoryNames; goto tn7FP; UQbBk: $categoryNames = Db::table("\163\x75\142\152\145\x63\164\x5f\x63\141\x74\x65\147\157\162\171\x5f\162\x65\154\141\x74\x65")->alias("\x53\x43\122")->join("\x63\141\x74\x65\x67\157\x72\151\x65\x73\40\103", "\x53\103\x52\x2e\143\x61\x74\145\x67\x6f\x72\171\137\151\144\75\103\x2e\x69\144\x20\141\x6e\144\x20\123\103\x52\x2e\x73\x75\142\x6a\x65\x63\164\x5f\151\x64\75" . $featured["\x69\x64"])->column("\x43\56\x6e\x61\155\145"); goto jxKAx; tn7FP: $featured["\x69\x6d\141\147\x65\137\165\x72\154"] = generateThumbnailUrl($featured["\x69\x6d\141\147\145\x5f\165\x72\x6c"], 300); goto juDfG; UZxy3: } goto vw3mO; FWpwA: w_inD: goto C3Q9F; lrGjF: C2yOI: goto Wf4wF; arjqZ: } public function genOrder($aio_id, $subject_id) { goto PSjyT; sp8US: $order["\x73\165\x62\x6a\145\143\x74\137\x69\144"] = $subject_id; goto F1bjT; MIKkK: if ($subject) { goto YIupx; } goto RK2gS; yNwxG: $order["\x71\165\145\163\164\151\157\x6e\x5f\x66\x6f\162\155"] = $subject["\161\165\145\163\164\x69\x6f\x6e\137\x66\157\x72\x6d"]; goto oo18E; ufERd: Db::table("\x73\165\142\152\x65\x63\x74")->where(["\x69\144" => $subject_id])->setInc("\160\x61\162\164\x69\143\151\160\x61\x6e\x74\163"); goto wQ5QR; nJ9K9: $order["\151\164\145\x6d\163"] = ''; goto Axmlx; c6r0f: wexception("\xe6\265\213\350\xaf\x84\xe9\207\x8f\350\xa1\250\345\x8c\205\345\x90\xab\xe7\x9a\x84\351\xa2\230\347\x9b\xae\xe4\xb8\272\xe7\xa9\xba"); goto isZxa; lse5y: Db::table("\163\x75\x62\x6a\x65\x63\x74")->where(["\x69\x64" => $subject_id])->setInc("\164\x6f\x74\141\x6c\x5f\141\x6d\157\x75\156\x74", $order["\x6f\x72\x64\145\162\x5f\141\x6d\157\x75\x6e\164"]); goto NsxcV; RK2gS: wexception("\346\227\240\xe6\263\x95\xe6\211\276\xe5\210\260\350\257\xa5\351\207\x8f\xe8\xa1\xa8"); goto rG1_a; QdbQb: if (!empty($res)) { goto A2A07; } goto HfKzn; rG1_a: YIupx: goto SyeCX; O79kR: $order["\151\x74\x65\x6d\x5f\166\145\x72\163\151\x6f\156"] = $subject["\151\164\x65\x6d\137\166\x65\162\163\151\157\x6e"]; goto yNwxG; BD3Tu: A2A07: goto ufERd; SyeCX: if (!(empty($subject["\x63\x75\163\164\157\x6d\137\164\x65\x73\x74"]) && $subject["\x69\x74\145\x6d\163"] == 0)) { goto CtfYj; } goto c6r0f; D5QPl: $order["\x6f\162\144\x65\162\137\x6e\x6f"] = generateSequenceNo(rand(1, 999), Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\x53"); goto aV3cf; PSjyT: $subject = Subjects::I()->getSubjectById($subject_id); goto MIKkK; UEm8B: $order = []; goto D5QPl; isZxa: CtfYj: goto UEm8B; aV3cf: $order["\x61\151\x6f\137\x69\144"] = $aio_id; goto sp8US; wQ5QR: Db::table("\x73\165\142\152\x65\143\164")->where(["\x69\144" => $subject_id])->setInc("\x70\x61\x72\164\151\x63\x69\x70\141\156\164\x73\137\x73\150\x6f\167"); goto lse5y; Axmlx: $order["\x6f\x72\144\145\162\137\141\155\157\165\x6e\x74"] = 0; goto O79kR; HfKzn: wexception("\xe6\225\260\xe6\x8d\xae\345\xba\223\346\226\xb0\345\242\x9e\xe8\xae\xa2\xe5\x8d\225\xe5\274\202\xe5\270\xb8"); goto BD3Tu; F1bjT: $order["\x74\157\164\141\x6c\137\151\164\x65\155\163"] = $subject["\151\164\145\155\163"]; goto nJ9K9; NsxcV: return $order["\157\162\x64\145\x72\137\x6e\157"]; goto E7jD6; oo18E: $res = Db::table("\x61\x69\157\137\x6f\162\144\145\162")->insert($order); goto QdbQb; E7jD6: } public function regenOrder($order_no) { goto Qg8AZ; BAL4D: if (!empty($subject)) { goto Ez0ev; } goto nVc4f; igGcR: y_b8a: goto XtodM; gDyZH: $order["\161\165\145\163\x74\x69\157\156\x5f\141\x6e\163\167\145\162"] = ''; goto P6WAO; cf4GT: if (!empty($order)) { goto y_b8a; } goto Xi_Us; R4ySG: $order["\x69\164\145\155\x73"] = ''; goto v5yKQ; Xi_Us: wexception("\346\xb5\213\350\xaf\204\xe8\256\xa2\xe5\215\225\xe4\270\x8d\345\xad\x98\xe5\x9c\xa8"); goto igGcR; gku15: $order["\x74\145\163\164\137\x69\164\145\155\163"] = 0; goto YlZa2; P6WAO: $order["\x69\164\145\x6d\137\x76\145\x72\163\x69\157\x6e"] = $subject["\151\x74\145\155\x5f\x76\x65\162\163\151\157\x6e"]; goto w50tI; w50tI: Db::table("\141\151\157\137\157\x72\x64\x65\x72")->where("\157\x72\x64\x65\162\137\x6e\x6f", $order_no)->update($order); goto R24Ae; ImjcT: $order = []; goto upX9G; VISdk: Ez0ev: goto ImjcT; HMaae: $order["\161\x75\145\163\x74\x69\x6f\156\x5f\146\157\162\155"] = $subject["\161\165\x65\163\164\151\x6f\156\x5f\146\157\x72\155"]; goto gDyZH; v5yKQ: $order["\x72\x65\163\x75\x6c\x74"] = null; goto S9nTN; upX9G: $order["\164\157\x74\141\154\x5f\151\164\145\x6d\163"] = $subject["\x69\164\x65\155\x73"]; goto gku15; S9nTN: $order["\146\x69\x6e\151\x73\x68\145\x64"] = 0; goto HMaae; YlZa2: $order["\x63\x75\x72\162\x5f\151\164\145\155"] = 0; goto R4ySG; nVc4f: wexception("\xe6\265\x8b\350\257\x84\xe4\270\x8d\xe5\xad\230\xe5\234\xa8"); goto VISdk; Qg8AZ: $order = Db::table("\x61\151\x6f\x5f\157\162\144\x65\x72")->where(["\x6f\162\x64\x65\162\x5f\x6e\x6f" => $order_no])->field(true)->find(); goto cf4GT; XtodM: $subject = Subjects::I()->getSubjectById($order["\163\165\x62\x6a\x65\143\x74\x5f\151\x64"]); goto BAL4D; R24Ae: } }
