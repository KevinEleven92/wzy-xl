<?php
 namespace app\mp\service; use app\Defs; use app\index\model\Customer; use think\Db; use think\Cookie; class Users extends Bases { public function getUserById($id) { goto EioYy; KbCw4: if (!empty($user)) { goto RjhYt; } goto tR0Sq; jSkHz: return $user; goto cXXBL; EioYy: $user = Db::table("\x63\x75\163\164\157\155\145\x72")->where(["\151\x64" => $id])->field(true)->find(); goto KbCw4; oMAZS: RjhYt: goto jSkHz; tR0Sq: $user = ["\x6e\151\x63\x6b\x6e\x61\x6d\145" => '', "\150\145\x61\x64\x69\155\x67\x5f\x75\x72\x6c" => '', "\x72\x65\x61\154\137\x6e\141\x6d\x65" => '', "\141\147\x65" => '', "\x6f\x72\x67\141\156\x69\172\141\x74\151\x6f\156\137\151\144" => 0, "\x70\x72\x6f\146\145\x73\163\x69\x6f\x6e" => '', "\143\x6f\x6d\160\x61\156\x79" => '', "\x6a\157\x62" => '', "\167\x6f\162\153\x5f\141\147\x65" => '', "\144\151\x73\x65\x61\163\x65" => '', "\x69\144\x63\x61\x72\x64" => '', "\163\x65\170" => 1, "\x63\150\141\x6e\x6e\x65\154\137\x69\x64" => Defs::CHANNEL_WX]; goto oMAZS; cXXBL: } public function getUserByOpenid($openid) { goto TLONL; wX3Ji: return $this->getUserById($uid); goto C2KE8; TLONL: $uid = Db::table("\143\165\163\164\x6f\155\145\x72")->where(["\157\x70\x65\156\151\144" => $openid])->value("\x69\144"); goto yAa2V; L9w76: dsv07: goto wX3Ji; QODW6: return []; goto L9w76; yAa2V: if (!empty($uid)) { goto dsv07; } goto QODW6; C2KE8: } public function setLoginSession($user) { session("\x75\x73\x65\162", ["\151\x64" => $user["\151\144"], "\157\x70\x65\x6e\151\x64" => $user["\x6f\x70\145\x6e\x69\x64"], "\156\151\143\153\x6e\x61\155\x65" => $user["\156\x69\143\x6b\156\141\155\145"], "\x68\x65\x61\x64\151\155\147\x5f\x75\x72\x6c" => $user["\x68\x65\x61\144\151\155\x67\137\165\162\x6c"]]); } public function saveUserFromWx($wx_user) { goto HHUGP; ujtex: if (!$user) { goto TWITd; } goto wA2Fi; wA2Fi: Db::table("\143\165\x73\x74\x6f\x6d\x65\162")->where("\157\x70\x65\156\x69\144", $wx_user["\157\x70\x65\x6e\151\x64"])->update(["\x6e\x69\143\153\156\141\155\145" => $wx_user["\x6e\151\143\153\x6e\x61\155\x65"], "\150\x65\x61\144\151\x6d\147\x5f\x75\162\x6c" => $wx_user["\x68\x65\x61\144\x69\155\x67\165\162\154"], "\143\x69\164\x79" => $wx_user["\x63\x69\x74\171"], "\160\x72\157\166\151\156\x63\145" => $wx_user["\160\162\x6f\x76\151\156\x63\145"], "\x63\157\165\156\164\x72\171" => $wx_user["\143\x6f\x75\x6e\164\x72\171"], "\163\145\170" => $wx_user["\x73\x65\170"], "\x6c\141\x74\x65\x73\164\137\154\x6f\147\151\x6e\137\164\x69\x6d\145" => Db::raw("\156\x6f\167\50\x29")]); goto cOzhY; K3msm: $user = $this->getUserByOpenid($wx_user["\157\x70\145\156\151\x64"]); goto ujtex; czN4c: exception("\350\216\xb7\345\217\226\345\xbe\256\xe4\xbf\241\346\216\x88\346\x9d\x83\347\x94\xa8\346\210\267\xe4\277\xa1\346\201\257\345\xa4\xb1\xe8\xb4\xa5"); goto U0ZuZ; U0ZuZ: eAn6x: goto K3msm; HHUGP: if (!empty($wx_user["\157\160\145\156\x69\x64"])) { goto eAn6x; } goto czN4c; cOzhY: return $user; goto OfG3d; n900_: $data = ["\157\x70\145\x6e\x69\x64" => $wx_user["\157\160\x65\156\x69\x64"], "\156\x69\x63\x6b\156\x61\x6d\145" => $wx_user["\x6e\151\x63\x6b\156\141\x6d\x65"], "\150\x65\x61\x64\x69\x6d\x67\x5f\165\x72\x6c" => $wx_user["\150\145\x61\x64\151\155\x67\x75\162\154"], "\143\x69\164\x79" => $wx_user["\143\151\x74\171"], "\160\x72\x6f\x76\x69\156\x63\145" => $wx_user["\x70\x72\x6f\166\151\156\143\x65"], "\143\x6f\x75\156\x74\x72\171" => $wx_user["\x63\157\165\x6e\164\x72\x79"], "\163\145\170" => $wx_user["\163\145\x78"], "\x72\145\147\151\163\x74\x65\162\137\164\151\155\x65" => Db::raw("\156\x6f\x77\50\51"), "\x6c\141\x74\145\x73\164\x5f\154\157\147\151\156\137\x74\x69\155\x65" => Db::raw("\x6e\x6f\x77\50\51")]; goto WVfNs; WVfNs: $data["\x69\x64"] = Db::table("\x63\165\163\164\x6f\x6d\x65\x72")->insertGetId($data); goto I_cpq; V9t6B: mK6Og: goto Jror3; I_cpq: if (!empty($data["\151\x64"])) { goto mK6Og; } goto jyZFN; OfG3d: TWITd: goto n900_; Jror3: return $data; goto TwAnp; jyZFN: exception("\345\x88\x9b\345\273\xba\xe7\x94\xa8\346\x88\267\xe5\244\261\xe8\xb4\xa5\357\xbc\x9a" . $data["\157\x70\x65\156\x69\144"]); goto V9t6B; TwAnp: } }
