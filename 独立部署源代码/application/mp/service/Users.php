<?php
 namespace app\mp\service; use app\Defs; use app\index\model\Customer; use think\Db; use think\Cookie; class Users extends Bases { public function getUserById($id) { goto gQuPT; gQuPT: $user = Db::table("\x63\165\x73\164\157\155\145\x72")->where(["\x69\x64" => $id])->field(true)->find(); goto DCSEN; xdlbR: return $user; goto EkGv3; Gv1JA: QZYry: goto xdlbR; KSFIQ: $user = ["\156\x69\x63\x6b\156\141\x6d\x65" => '', "\150\x65\x61\144\x69\x6d\147\x5f\x75\x72\x6c" => '', "\162\145\x61\154\137\156\141\155\x65" => '', "\141\x67\145" => '', "\x6f\x72\147\x61\x6e\151\x7a\x61\x74\151\x6f\156\x5f\151\x64" => 0, "\160\162\157\146\x65\x73\x73\151\x6f\156" => '', "\x63\x6f\155\160\x61\156\171" => '', "\x6a\x6f\x62" => '', "\167\157\162\153\137\141\x67\145" => '', "\x64\x69\163\x65\141\163\x65" => '', "\151\144\x63\x61\x72\x64" => '', "\x73\x65\x78" => 1, "\x63\x68\141\156\x6e\x65\x6c\137\x69\144" => Defs::CHANNEL_WX]; goto Gv1JA; DCSEN: if (!empty($user)) { goto QZYry; } goto KSFIQ; EkGv3: } public function getUserByOpenid($openid) { goto abInt; w9Ui2: return []; goto mSuvJ; mSuvJ: QhEY7: goto RKBAX; RkIfc: if (!empty($uid)) { goto QhEY7; } goto w9Ui2; abInt: $uid = Db::table("\143\165\x73\164\x6f\155\x65\x72")->where(["\x6f\160\x65\156\x69\x64" => $openid])->value("\x69\144"); goto RkIfc; RKBAX: return $this->getUserById($uid); goto rVmNY; rVmNY: } public function setLoginSession($user) { session("\165\163\x65\x72", ["\x69\144" => $user["\x69\x64"], "\157\160\145\156\151\144" => $user["\157\160\145\156\x69\x64"], "\156\151\143\x6b\156\x61\155\145" => $user["\156\151\143\153\156\x61\155\x65"], "\150\x65\141\x64\x69\x6d\x67\137\165\162\154" => $user["\150\x65\x61\x64\x69\x6d\x67\137\x75\x72\x6c"]]); } public function saveUserFromWx($wx_user) { goto mrJJ2; ZlCjd: $data["\x69\144"] = Db::table("\x63\165\x73\x74\x6f\155\145\x72")->insertGetId($data); goto JWVSi; M_JBG: $data = ["\x6f\160\145\x6e\151\x64" => $wx_user["\157\160\145\x6e\151\x64"], "\156\x69\143\x6b\156\141\155\145" => $wx_user["\156\x69\x63\153\156\x61\155\145"], "\150\x65\x61\x64\151\x6d\x67\137\165\x72\154" => $wx_user["\x68\145\141\x64\151\x6d\147\165\162\154"], "\143\x69\x74\x79" => $wx_user["\143\x69\x74\x79"], "\x70\x72\157\x76\x69\x6e\x63\145" => $wx_user["\x70\x72\157\166\x69\x6e\x63\x65"], "\143\157\165\x6e\164\x72\x79" => $wx_user["\x63\x6f\x75\156\x74\162\171"], "\163\145\170" => $wx_user["\163\x65\170"], "\x72\145\147\151\x73\x74\x65\162\137\x74\x69\155\145" => Db::raw("\x6e\157\167\x28\x29"), "\x6c\141\x74\145\x73\164\137\154\157\x67\151\x6e\x5f\164\151\x6d\145" => Db::raw("\156\157\x77\50\x29")]; goto ZlCjd; Km1IK: return $data; goto w0ygR; bp8rX: Db::table("\143\165\163\x74\157\155\x65\162")->where("\157\160\x65\156\151\144", $wx_user["\157\160\x65\156\x69\x64"])->update(["\x6e\151\143\153\x6e\x61\155\x65" => $wx_user["\x6e\151\x63\x6b\156\x61\x6d\145"], "\150\145\141\x64\151\155\x67\x5f\165\x72\154" => $wx_user["\x68\145\x61\x64\x69\x6d\x67\x75\162\x6c"], "\x63\x69\164\x79" => $wx_user["\143\151\x74\171"], "\x70\x72\157\x76\151\x6e\x63\145" => $wx_user["\x70\x72\x6f\166\x69\x6e\x63\145"], "\x63\157\x75\x6e\164\x72\x79" => $wx_user["\143\157\165\x6e\x74\x72\x79"], "\x73\145\170" => $wx_user["\163\x65\170"], "\154\x61\164\x65\x73\164\x5f\154\x6f\x67\151\156\137\164\151\x6d\x65" => Db::raw("\x6e\x6f\x77\50\51")]); goto ZjSBq; mrJJ2: if (!empty($wx_user["\157\x70\145\156\151\x64"])) { goto b6Y1c; } goto SUVFJ; ZjSBq: return $user; goto llyzH; llyzH: z0jYw: goto M_JBG; wDBaH: exception("\xe5\x88\233\345\xbb\xba\347\224\250\xe6\x88\xb7\xe5\xa4\261\xe8\264\xa5\357\xbc\232" . $data["\x6f\x70\145\x6e\x69\x64"]); goto QPjHx; YiUwl: if (!$user) { goto z0jYw; } goto bp8rX; fpKtW: $user = $this->getUserByOpenid($wx_user["\157\160\x65\156\151\144"]); goto YiUwl; ZcGcw: b6Y1c: goto fpKtW; JWVSi: if (!empty($data["\x69\x64"])) { goto sKcO5; } goto wDBaH; QPjHx: sKcO5: goto Km1IK; SUVFJ: exception("\xe8\216\267\345\x8f\226\xe5\276\xae\344\277\241\346\216\x88\xe6\235\x83\xe7\x94\250\346\210\267\xe4\277\241\xe6\x81\xaf\xe5\xa4\261\350\xb4\245"); goto ZcGcw; w0ygR: } }
