<?php
 namespace app\mp\service; use app\Defs; use app\index\model\Customer; use think\Db; use think\Cookie; class Users extends Bases { public function getUserById($id) { goto IEvNG; aosPL: if (!empty($user)) { goto ZFK2J; } goto xgN_V; VuIy3: return $user; goto NzY1r; PglQZ: ZFK2J: goto VuIy3; IEvNG: $user = Db::table("\x63\x75\163\164\157\x6d\x65\162")->where(["\x69\x64" => $id])->field(true)->find(); goto aosPL; xgN_V: $user = ["\x6e\x69\x63\x6b\x6e\x61\x6d\145" => '', "\x68\x65\x61\144\151\x6d\147\137\165\162\154" => '', "\x72\145\x61\154\x5f\156\x61\155\x65" => '', "\141\147\145" => '', "\x6f\x72\x67\141\x6e\x69\x7a\x61\x74\151\x6f\x6e\x5f\x69\x64" => 0, "\160\162\x6f\146\x65\163\163\x69\157\156" => '', "\143\157\x6d\x70\x61\156\x79" => '', "\152\x6f\142" => '', "\167\157\x72\153\x5f\x61\x67\145" => '', "\x64\151\x73\x65\141\163\145" => '', "\x69\x64\143\x61\x72\x64" => '', "\163\x65\x78" => 1, "\x63\x68\141\x6e\x6e\145\154\x5f\151\144" => Defs::CHANNEL_WX]; goto PglQZ; NzY1r: } public function getUserByOpenid($openid) { goto e3wBK; UreIJ: return []; goto OM7df; e3wBK: $uid = Db::table("\x63\165\x73\164\x6f\x6d\x65\162")->where(["\x6f\x70\x65\156\x69\x64" => $openid])->value("\x69\x64"); goto Am5ME; Am5ME: if (!empty($uid)) { goto teTvc; } goto UreIJ; TAZdt: return $this->getUserById($uid); goto Xa0d2; OM7df: teTvc: goto TAZdt; Xa0d2: } public function setLoginSession($user) { session("\165\163\x65\162", ["\151\144" => $user["\x69\x64"], "\157\160\145\156\x69\x64" => $user["\x6f\160\145\x6e\x69\x64"], "\x6e\x69\x63\x6b\156\x61\155\x65" => $user["\156\x69\x63\153\x6e\x61\155\145"], "\150\145\141\144\x69\x6d\x67\x5f\165\x72\x6c" => $user["\x68\145\141\144\x69\155\147\x5f\x75\x72\x6c"]]); } public function saveUserFromWx($wx_user) { goto SY_dA; WDkgw: $data = ["\157\160\x65\x6e\x69\x64" => $wx_user["\157\160\x65\x6e\151\x64"], "\x6e\x69\x63\x6b\x6e\x61\x6d\145" => $wx_user["\x6e\x69\143\x6b\x6e\141\x6d\x65"], "\x68\145\x61\x64\151\155\147\137\x75\162\154" => $wx_user["\150\145\141\x64\x69\155\x67\x75\162\x6c"], "\143\x69\164\x79" => $wx_user["\x63\151\164\x79"], "\x70\162\157\x76\x69\156\143\x65" => $wx_user["\x70\162\157\166\x69\156\x63\x65"], "\x63\x6f\165\156\164\x72\171" => $wx_user["\x63\x6f\165\156\164\162\171"], "\x73\145\170" => $wx_user["\163\145\170"], "\x72\x65\147\151\x73\164\145\162\x5f\x74\151\155\145" => Db::raw("\156\x6f\x77\x28\x29"), "\154\141\x74\145\163\x74\x5f\x6c\157\x67\151\x6e\137\x74\x69\x6d\145" => Db::raw("\156\157\167\50\x29")]; goto aaHTY; wBISU: IpbY7: goto WDkgw; sGEIa: return $data; goto jB7ea; aaHTY: $data["\151\x64"] = Db::table("\143\x75\x73\x74\157\x6d\145\x72")->insertGetId($data); goto PoScC; SY_dA: if (!empty($wx_user["\x6f\x70\145\x6e\151\x64"])) { goto uokPZ; } goto OaMwu; RrnDe: exception("\xe5\210\233\xe5\xbb\xba\347\x94\250\xe6\210\xb7\xe5\244\261\350\xb4\xa5\xef\xbc\232" . $data["\x6f\160\145\x6e\x69\144"]); goto sBcfs; tMFF9: uokPZ: goto oGvWV; EhxWI: return $user; goto wBISU; PoScC: if (!empty($data["\x69\144"])) { goto oUSEP; } goto RrnDe; qbsXU: Db::table("\x63\x75\163\x74\157\155\x65\162")->where("\x6f\160\x65\x6e\x69\x64", $wx_user["\157\x70\145\156\151\144"])->update(["\156\x69\143\x6b\x6e\141\x6d\145" => $wx_user["\x6e\x69\x63\x6b\x6e\141\x6d\145"], "\150\145\x61\x64\151\x6d\147\x5f\x75\x72\154" => $wx_user["\150\x65\x61\144\x69\155\x67\x75\x72\154"], "\x63\151\164\x79" => $wx_user["\x63\x69\x74\171"], "\160\162\157\166\x69\x6e\x63\145" => $wx_user["\x70\162\x6f\166\x69\x6e\x63\x65"], "\143\157\x75\x6e\164\162\x79" => $wx_user["\x63\x6f\165\x6e\x74\162\x79"], "\x73\145\170" => $wx_user["\x73\x65\170"], "\154\x61\x74\145\163\164\x5f\154\157\x67\x69\x6e\137\x74\x69\155\145" => Db::raw("\x6e\157\167\x28\x29")]); goto EhxWI; oGvWV: $user = $this->getUserByOpenid($wx_user["\157\160\x65\156\x69\144"]); goto RmXpb; OaMwu: exception("\350\216\xb7\345\x8f\226\xe5\276\xae\344\xbf\xa1\xe6\216\x88\346\x9d\x83\347\224\xa8\xe6\x88\267\344\277\241\346\x81\xaf\xe5\244\xb1\xe8\xb4\xa5"); goto tMFF9; RmXpb: if (!$user) { goto IpbY7; } goto qbsXU; sBcfs: oUSEP: goto sGEIa; jB7ea: } }
