<?php
 namespace app\mp\service; use app\Defs; use think\Db; use think\Log; use app\index\logic\Defs as IndexDefs; use app\index\logic\Subject as SubjectLogic; use app\mp\service\RequestContext; use app\common\service\Redis as RedisService; class Subjects extends Bases { public function getList($map = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $paging = false) { goto XoTA2; qvkrC: dK62g: goto oJOmX; U2tuw: qaYNa: goto yZLEk; p8rWa: goto C_tf1; goto ycgng; ie36T: $records = Db::table("\x73\165\x62\152\145\x63\164")->field($field)->where($where)->page($page, $rows)->order($order)->select(); goto vtZdI; BARh9: if (!$paging) { goto mg2MV; } goto GJz_F; STYBX: $where["\154\x61\142\x65\154"] = ["\x6c\151\153\x65", "\45{$search["\154\141\x62\x65\154"]}\x25"]; goto X3r3v; ywTIx: return []; goto t21HD; X3r3v: WFFLl: goto oAS3o; Ez_Od: XEUHt: goto lFiM3; txxr2: $field = isset($map["\146\151\x65\x6c\x64"]) ? $map["\146\151\x65\154\144"] : "\x2a"; goto un3lN; GJz_F: return ["\164\x6f\164\x61\154" => 0, "\x72\x6f\167\x73" => []]; goto p8rWa; SEOsG: if (!empty($subjectIds)) { goto VP1yZ; } goto BARh9; liJiK: if (emptyInArray($search, "\x74\x79\160\145")) { goto qaYNa; } goto bT9gX; t21HD: C_tf1: goto o2iZj; ckToW: $where["\x64\x65\154\x65\x74\145\137\x66\x6c\x61\147"] = 0; goto fVGn5; gSHu6: if (emptyInArray($search, "\156\141\x6d\x65")) { goto dK62g; } goto SUQpX; QhDNx: y6BtZ: goto gSHu6; rxrC1: $subjectIds = Db::table("\163\x75\142\152\x65\143\x74\x5f\143\x61\164\145\147\x6f\x72\171\137\162\145\x6c\141\x74\x65")->where(["\x63\x61\x74\145\147\x6f\x72\171\x5f\x69\x64" => $search["\x63\141\164\145\x67\x6f\x72\x79\137\x69\x64"]])->column("\163\165\142\152\145\x63\164\137\x69\144"); goto SEOsG; CTwZ3: return ["\164\157\x74\x61\x6c" => $total, "\162\157\167\x73" => $records]; goto BfySQ; un3lN: if (!($search =& $map["\x73\145\x61\162\x63\150"])) { goto mLp8F; } goto liJiK; oAS3o: mLp8F: goto ckToW; SUQpX: $where["\x6e\141\x6d\x65"] = ["\x6c\x69\153\x65", "\x25{$search["\x6e\x61\155\145"]}\x25"]; goto qvkrC; XoTA2: $where = isset($map["\167\x68\x65\x72\145"]) ? $map["\x77\150\145\162\x65"] : []; goto txxr2; LX3p1: iSBGq: goto QaseU; huHou: $where["\151\144"] = ["\x69\156", $subjectIds]; goto QhDNx; fVGn5: $where["\x73\164\141\164\x75\x73"] = ["\151\x6e", [IndexDefs::ENTITY_PUBLISH_STATUS]]; goto z_kpL; ycgng: mg2MV: goto ywTIx; fDfcY: $total = Db::table("\163\165\x62\152\x65\143\164")->where($where)->count(); goto CTwZ3; bT9gX: $where["\164\x79\160\145"] = $search["\164\171\x70\145"]; goto U2tuw; lFiM3: return $records; goto LX3p1; BfySQ: goto iSBGq; goto Ez_Od; o2iZj: VP1yZ: goto huHou; yZLEk: if (emptyInArray($search, "\143\x61\x74\x65\x67\157\x72\x79\x5f\151\x64")) { goto y6BtZ; } goto rxrC1; z_kpL: $order = empty($map["\157\162\144\x65\162"]) ? "\x73\157\x72\x74\40\141\163\x63\54\151\144\40\x64\145\x73\x63" : $map["\x6f\x72\144\145\x72"]; goto ie36T; vtZdI: if (empty($paging)) { goto XEUHt; } goto fDfcY; oJOmX: if (emptyInArray($search, "\x6c\141\x62\145\154")) { goto WFFLl; } goto STYBX; QaseU: } public function getSubjectById($id) { goto vs1HL; veUpi: G0thg: goto HBqei; MI72H: return null; goto veUpi; vs1HL: if (!empty($id)) { goto G0thg; } goto MI72H; HBqei: return Db::table("\163\165\x62\152\x65\143\x74")->where(["\x69\x64" => $id])->field(true)->find(); goto vGBXG; vGBXG: } public function collect($uid, $subject_id, $type) { goto ykiuL; Ntaz0: if ($this->isCollected($uid, $subject_id)) { goto y4PKV; } goto Bvqc8; lGEBO: y4PKV: goto B8F92; Bvqc8: Db::table("\x73\165\142\x6a\145\143\x74\137\143\157\154\x6c\145\x63\164")->insert(["\x63\165\163\x74\x6f\x6d\x65\162\137\151\x64" => $uid, "\x73\x75\142\152\145\143\164\x5f\x69\x64" => $subject_id]); goto lGEBO; xs6oR: return; goto oVnt_; oVnt_: T58X0: goto Ntaz0; ykiuL: if (!($type == 0)) { goto T58X0; } goto Xg8OX; Xg8OX: Db::table("\x73\x75\x62\152\x65\143\x74\x5f\x63\157\154\154\145\x63\x74")->where(["\143\165\163\164\157\x6d\x65\x72\137\151\x64" => $uid, "\163\x75\142\x6a\x65\x63\x74\137\x69\x64" => $subject_id])->delete(); goto xs6oR; B8F92: } public function isCollected($uid, $subject_id) { return (bool) Db::table("\x73\165\x62\152\x65\x63\x74\137\x63\157\x6c\x6c\145\143\x74")->where(["\x63\165\163\164\157\x6d\145\162\137\151\144" => $uid, "\x73\x75\142\152\x65\143\164\137\151\144" => $subject_id])->value("\151\144"); } public function getCategories() { return Db::table("\143\x61\164\x65\147\x6f\162\151\x65\x73")->order("\x69\144\40\141\x73\x63")->column("\151\144\x2c\x6e\141\x6d\145\54\163\164\x61\x74\x75\163\x2c\151\155\x67\137\165\x72\154"); } public function getUnFinishTest($uid, $subject_id, $cb_order_id = 0, $survey_order_id = 0) { goto EuaBO; ZkLuK: goto jvmhH; goto jwjlB; gCCiW: return null; goto ZkLuK; MFu_z: return $order; goto jn8Qr; EuaBO: $where = ["\x63\x75\x73\x74\157\155\145\162\137\x69\144" => $uid, "\x73\165\x62\152\145\143\x74\x5f\151\x64" => $subject_id, "\x70\x61\171\x5f\x73\x74\141\x74\165\x73" => Defs::PAY_SUCCESS, "\143\x62\x5f\x6f\162\x64\x65\162\137\151\144" => $cb_order_id, "\163\165\x72\x76\145\171\137\157\x72\144\x65\x72\x5f\x69\144" => $survey_order_id]; goto RixSI; Ih5aF: if ($order && !$order["\x66\151\156\151\x73\150\x65\x64"]) { goto LqCSh; } goto gCCiW; jn8Qr: jvmhH: goto V08z4; RixSI: $order = Db::table("\163\165\x62\152\x65\143\x74\137\157\162\x64\x65\162")->where($where)->order("\157\x72\144\x65\x72\x5f\164\151\155\x65\x20\x64\145\163\x63")->find(); goto Ih5aF; jwjlB: LqCSh: goto MFu_z; V08z4: } public function getOrderByNo($order_no, $order_type = "\x48\65") { goto A9axF; Eiimk: xR5gt: goto XcEnu; z91Ai: $row["\162\x65\x70\x6f\162\164\x5f\154\151\x73\164"] = []; goto MMgGK; wOO0R: OWxTf: goto ZXw3T; dMXYg: $row["\162\145\160\157\162\x74\x5f\154\x69\x73\164"] = []; goto Eiimk; XcEnu: goto auJih; goto ROBlB; zNJ1J: hOOMN: goto K1h1c; xZYBU: return null; goto zNJ1J; K1h1c: $table = Defs::DB_TABLE_DEFS[$order_type]["\x6f\x72\144\x65\x72"]; goto Xy22a; rBFHk: lH4yS: goto iFcrZ; A9axF: if (!empty($order_no)) { goto hOOMN; } goto xZYBU; Xy22a: $row = Db::table($table)->where(["\x6f\x72\144\x65\x72\137\x6e\x6f" => $order_no])->field(true)->find(); goto vSnfx; ROBlB: CpLGg: goto ESyMx; ko4ds: return $row; goto zySOj; vSnfx: if ($row && !empty($row["\162\x65\163\x75\154\164"])) { goto CpLGg; } goto nmPXl; MMgGK: goto OWxTf; goto rBFHk; ZXw3T: auJih: goto ko4ds; ESyMx: $result = json_decode($row["\162\145\x73\165\154\164"], true); goto byX6S; kXGNE: Log::error("\146\x61\x69\154\x65\144\x20\164\157\40\144\145\x63\x6f\144\145\x20\x72\x65\x73\165\x6c\x74\40\146\x6f\162\40\163\x75\142\x6a\x65\x63\x74\40\x6f\162\x64\145\162\72\40{$order_no}"); goto z91Ai; byX6S: if ($result && isset($result["\x72\x65\160\x6f\162\x74\114\x69\x73\x74"])) { goto lH4yS; } goto kXGNE; iFcrZ: $row["\162\x65\x70\x6f\x72\164\x5f\154\x69\x73\x74"] = $result["\162\x65\160\x6f\x72\164\114\151\163\164"]; goto wOO0R; nmPXl: if (!$row) { goto xR5gt; } goto dMXYg; zySOj: } public function getOrderById($id) { goto rmCJI; ytuQI: $row["\162\x65\160\157\162\164\137\154\x69\163\x74"] = []; goto NAR2H; rQIXJ: if ($result && isset($result["\162\x65\160\157\x72\x74\x4c\151\163\x74"])) { goto wdRLG; } goto X0NDV; cSc22: return null; goto OhIv_; lG_02: $row = Db::table("\x73\165\x62\x6a\x65\143\164\137\x6f\x72\144\x65\162")->where(["\x69\x64" => $id])->field(true)->find(); goto JZRei; BVINO: $result = json_decode($row["\x72\145\x73\x75\154\164"], true); goto rQIXJ; rmCJI: if (!empty($id)) { goto DMg6r; } goto cSc22; X0NDV: Log::error("\x66\141\151\x6c\145\x64\40\x74\x6f\x20\x64\145\x63\x6f\x64\x65\40\162\145\163\x75\154\x74\40\x66\x6f\162\x20\x73\x75\x62\152\145\143\x74\x20\x69\144\72\40{$id}"); goto ytuQI; NAR2H: goto nY9sl; goto sm_ZN; sm_ZN: wdRLG: goto bnMuJ; bnMuJ: $row["\x72\x65\x70\157\162\164\137\x6c\151\x73\x74"] = $result["\162\x65\x70\157\x72\164\114\151\163\x74"]; goto wKXYE; oKF8a: vxSFk: goto A35us; A35us: return $row; goto qRJGR; wKXYE: nY9sl: goto oKF8a; JZRei: if (!($row && !empty($row["\x72\145\x73\165\154\x74"]))) { goto vxSFk; } goto BVINO; OhIv_: DMg6r: goto lG_02; qRJGR: } public function generateOrder($uid, $subject_id, $channel = Defs::CHANNEL_WX, $cb_order_id = 0, $survey_order_id = 0) { goto JSFTR; bJ7Fr: $order["\143\150\141\156\x6e\x65\x6c\137\151\144"] = intval($channel); goto nyrT5; Fw00S: OTM30: goto HcaYw; h3aU8: $subject = $this->getSubjectById($subject_id); goto MxQo9; B_ZLG: return $order; goto nbuIN; dKleM: lLzwt: goto Txpdy; x3jaZ: $order = []; goto H2KrU; fnaKO: $order["\163\x75\142\152\x65\143\164\137\151\144"] = $subject_id; goto bJ7Fr; ao8bj: if (!$survey_order_id) { goto VVE92; } goto mpFnZ; Txpdy: Db::table("\x73\165\x62\152\145\143\164")->where(["\x69\x64" => $subject_id])->setInc("\160\141\x72\x74\x69\x63\151\160\x61\x6e\x74\x73"); goto OWkCv; JSFTR: if (!(empty($uid) || empty($subject_id))) { goto VOjNm; } goto QX5CZ; nyrT5: $order["\x63\142\x5f\x6f\162\x64\145\x72\137\x69\x64"] = intval($cb_order_id); goto aQ1KD; jUBcE: Db::table("\163\x75\x62\152\145\143\x74")->where(["\151\144" => $subject_id])->setInc("\164\157\164\141\154\x5f\x61\155\157\x75\156\x74", $order["\x6f\x72\144\145\x72\137\x61\x6d\157\x75\156\164"]); goto MAi0z; ZN7xY: if (!empty($res)) { goto lLzwt; } goto NLO4Q; pTT19: $orderAmount = $subject["\143\165\x72\162\x65\x6e\x74\137\x70\x72\151\x63\x65"]; goto ao8bj; Tl4FZ: l7kG5: goto pTT19; OWkCv: Db::table("\x73\165\142\152\145\x63\164")->where(["\151\144" => $subject_id])->setInc("\160\x61\162\x74\x69\x63\x69\160\141\x6e\164\x73\137\163\x68\x6f\x77"); goto jUBcE; MD1Mq: exception("\346\x99\xae\xe6\237\245\xe6\265\x8b\xe8\257\225\xe8\xae\242\345\215\x95\344\xb8\215\xe5\255\230\345\234\250"); goto VWm3n; mWp5H: Db::table("\x63\x75\163\164\157\x6d\145\x72")->where(["\151\x64" => $uid])->setInc("\164\x6f\x74\x61\154\137\164\x65\163\x74\137\x61\155\157\165\x6e\164", $order["\x6f\162\144\145\162\137\141\x6d\157\165\156\164"]); goto GKet2; NLO4Q: exception("\346\x95\260\xe6\215\256\xe5\xba\x93\xe6\226\xb0\xe5\xa2\236\xe8\256\242\xe5\x8d\x95\xe5\274\202\345\xb8\xb8"); goto dKleM; MAi0z: Db::table("\143\165\x73\164\157\x6d\x65\x72")->where(["\151\x64" => $uid])->setInc("\x74\157\164\141\154\x5f\x74\145\x73\164\137\x71\165\141\x6e\164\x69\164\x79"); goto mWp5H; VWm3n: PuK1D: goto O929_; l71pV: $order["\x63\165\x73\x74\x6f\155\145\x72\x5f\151\x64"] = $uid; goto fnaKO; GKet2: Db::table("\x63\x75\163\x74\x6f\155\145\162")->where(["\x69\x64" => $uid])->setField("\x6c\141\x74\x65\163\164\x5f\x74\145\x73\x74\x5f\164\151\x6d\x65", Db::raw("\156\157\167\50\51")); goto B_ZLG; ifcN2: $order["\x71\x75\145\163\164\x69\x6f\x6e\x5f\x66\x6f\162\155"] = $subject["\161\165\x65\x73\x74\151\x6f\156\x5f\146\x6f\162\x6d"]; goto CVqXE; a00yh: if (!empty($survey)) { goto PuK1D; } goto MD1Mq; o0cU_: $order["\x70\x61\171\137\163\164\141\x74\x75\x73"] = $order["\157\162\x64\145\162\137\141\155\x6f\165\x6e\164"] > 0 ? Defs::PAY_WAIT : Defs::PAY_SUCCESS; goto vgMH2; O929_: if (!intval($survey["\x63\x66\147\x5f\146\162\145\145"])) { goto DQiQw; } goto LNalc; YhRJM: VVE92: goto x3jaZ; hjmel: $order["\157\162\x64\x65\x72\137\x61\155\157\x75\156\164"] = $orderAmount; goto o0cU_; XtQSU: DQiQw: goto YhRJM; aQ1KD: $order["\163\x75\162\x76\x65\x79\x5f\x6f\162\x64\x65\162\137\x69\x64"] = intval($survey_order_id); goto uMY1Z; LNalc: $orderAmount = 0; goto XtQSU; uMY1Z: $order["\164\x6f\x74\141\x6c\x5f\x69\164\145\155\x73"] = $subject["\151\164\x65\x6d\163"]; goto I0lH8; MxQo9: if (!empty($subject)) { goto OTM30; } goto ibkJO; RMD1O: VOjNm: goto h3aU8; vgMH2: $order["\x69\164\x65\x6d\137\166\x65\162\x73\x69\x6f\156"] = $subject["\x69\164\145\x6d\137\x76\145\x72\163\151\157\156"]; goto ifcN2; mpFnZ: $survey = Db::table("\163\x75\x72\x76\145\171\x5f\x6f\162\x64\x65\x72")->alias("\117")->join("\x73\165\162\166\x65\x79\x20\123", "\117\56\x73\165\162\166\145\171\x5f\x69\144\75\123\56\151\144")->where("\117\x2e\x69\144", $survey_order_id)->field("\123\x2e\x2a")->find(); goto a00yh; ibkJO: exception("\346\xb5\x8b\350\257\204\xe4\270\215\345\255\x98\xe5\x9c\250"); goto Fw00S; QX5CZ: exception("\345\x8f\202\346\225\260\xe9\x94\231\xe8\xaf\xaf"); goto RMD1O; HcaYw: if (!(empty($subject["\x63\165\163\164\x6f\x6d\137\164\x65\163\164"]) && $subject["\x69\x74\x65\x6d\x73"] == 0)) { goto l7kG5; } goto gdX13; CVqXE: $res = Db::table("\163\x75\x62\x6a\x65\x63\164\x5f\x6f\x72\144\145\x72")->insert($order); goto ZN7xY; H2KrU: $order["\x6f\162\144\x65\162\137\x6e\x6f"] = generateSequenceNo($uid, Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\x53"); goto l71pV; gdX13: exception("\346\xb5\213\350\257\x84\351\207\217\350\241\xa8\345\x8c\205\xe5\x90\xab\347\232\x84\351\xa2\x98\xe7\x9b\256\344\270\xba\347\xa9\272"); goto Tl4FZ; I0lH8: $order["\151\x74\x65\x6d\163"] = ''; goto hjmel; nbuIN: } public function regenerateOrder($order_no) { goto wso8S; O2dUb: exception("\xe6\227\240\346\263\225\xe6\211\xbe\345\210\260\xe8\257\xa5\xe8\256\xa2\345\x8d\225"); goto i4U8E; lfT6d: $order["\x69\x74\145\x6d\x73"] = ''; goto VoSBT; CIi4w: $subject_id = $order["\x73\x75\x62\x6a\145\x63\164\137\x69\144"]; goto WjhVC; OL7vH: $order["\x66\151\x6e\151\x73\150\145\144"] = 0; goto NtWNG; jB0NX: $order["\x74\x6f\x74\x61\x6c\x5f\151\164\145\x6d\163"] = $subject["\x69\164\145\155\x73"]; goto WnwsH; KElfJ: $order["\x63\x75\x72\x72\137\x69\x74\x65\155"] = 0; goto lfT6d; VoSBT: $order["\162\145\x73\x75\154\x74"] = null; goto OL7vH; evB40: $order["\161\165\x65\163\164\151\x6f\x6e\137\x61\x6e\x73\167\145\x72"] = ''; goto CvaaE; WjhVC: $subject = $this->getSubjectById($subject_id); goto UODvR; wnnvG: GCDb6: goto E0Vgv; VEy2S: exception("\346\xb5\x8b\xe8\xaf\x84\344\270\x8d\345\xad\x98\345\234\250"); goto wnnvG; UODvR: if (!empty($subject)) { goto GCDb6; } goto VEy2S; WnwsH: $order["\164\145\x73\x74\x5f\151\164\145\155\x73"] = 0; goto KElfJ; NtWNG: $order["\x71\x75\x65\x73\x74\151\157\156\x5f\146\157\162\x6d"] = $subject["\x71\165\x65\x73\x74\151\157\x6e\x5f\146\157\x72\155"]; goto evB40; zprm1: if ($order) { goto jzduO; } goto O2dUb; CvaaE: $order["\x69\x74\145\155\x5f\166\145\x72\x73\151\x6f\x6e"] = $subject["\151\x74\145\x6d\x5f\166\x65\162\163\x69\x6f\x6e"]; goto Bh2Hp; i4U8E: jzduO: goto CIi4w; E0Vgv: $order = []; goto jB0NX; Bh2Hp: Db::table("\x73\165\x62\152\145\143\x74\137\157\x72\x64\x65\162")->where("\157\162\x64\x65\162\137\156\x6f", $order_no)->update($order); goto yz7jq; wso8S: $order = $this->getOrderByNo($order_no); goto zprm1; yz7jq: } public function refreshOrderNo($customerId, $orderNo) { goto eElJ0; XVg69: return $orderNoNew; goto DA1en; eElJ0: $infos = Db::table("\163\x75\x62\x6a\x65\143\164\x5f\x6f\162\x64\x65\x72")->where(["\x63\x75\163\x74\x6f\155\145\x72\x5f\151\144" => $customerId, "\157\162\x64\x65\162\x5f\x6e\x6f" => $orderNo])->find(); goto NJj4G; NJj4G: if ($infos) { goto G5xs3; } goto hoeUq; KiQqH: G5xs3: goto rsyk4; Ve0Ue: Db::table("\x73\x75\x62\x6a\145\143\164\x5f\157\162\x64\x65\x72")->where(["\x63\165\163\164\x6f\x6d\x65\x72\x5f\x69\144" => $customerId, "\x6f\x72\144\x65\162\137\156\157" => $orderNo])->setField("\157\162\144\145\x72\x5f\156\157", $orderNoNew); goto XVg69; rsyk4: $orderNoNew = generateSequenceNo($customerId, Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\123"); goto Ve0Ue; hoeUq: return false; goto KiQqH; DA1en: } public function refreshOrderNoById($customerId, $id) { goto rmmtY; Cpp5i: if ($infos) { goto mincc; } goto Su7gB; nB0H9: $orderNoNew = generateSequenceNo($customerId, Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\x53"); goto IVQ3l; AX7pJ: mincc: goto nB0H9; IVQ3l: Db::table("\163\x75\142\x6a\145\x63\x74\137\x6f\x72\144\x65\162")->where(["\151\144" => $id])->setField("\x6f\x72\x64\x65\x72\x5f\x6e\x6f", $orderNoNew); goto x_dY2; x_dY2: return $orderNoNew; goto GJRv4; Su7gB: return false; goto AX7pJ; rmmtY: $infos = Db::table("\163\165\142\152\x65\143\x74\x5f\x6f\x72\144\145\x72")->where(["\151\x64" => $id])->find(); goto Cpp5i; GJRv4: } public function paySuccessOrder($order_no) { goto U0vNg; EMCcV: s5eh0: goto tCSNz; vu2DU: if (!empty($order)) { goto s5eh0; } goto bcgj2; tCSNz: Db::table("\163\x75\x62\x6a\145\x63\x74\x5f\x6f\162\x64\x65\162")->where(["\x6f\162\144\145\162\137\156\x6f" => $order_no])->update(["\x6e\x6f\x74\151\x66\171\137\164\x69\x6d\145" => date("\131\55\155\x2d\x64\x20\x48\72\x69\x3a\163"), "\160\x61\171\x5f\163\164\x61\x74\x75\x73" => Defs::PAY_SUCCESS]); goto vJeL3; U0vNg: $order = $this->getOrderByNo($order_no); goto vu2DU; bcgj2: exception("\350\xae\xa2\xe5\x8d\225\344\xb8\x8d\xe5\255\x98\xe5\234\xa8\357\274\232" . $order_no); goto EMCcV; vJeL3: } public function getSubjectItems($subject_id) { goto Cik5s; J5OzV: if (!empty($rows)) { goto vKg3W; } goto RrCTI; Cik5s: $rows = Db::table("\x73\x75\x62\x6a\145\143\x74\137\x69\164\x65\x6d")->where(["\163\x75\x62\152\x65\x63\x74\x5f\151\144" => $subject_id])->field(true)->order("\163\x6f\x72\x74\40\141\163\143\54\40\x69\x64\40\141\163\x63")->select(); goto J5OzV; MdZf_: return $items; goto dMUer; l9QY0: uP562: goto MdZf_; q0sHv: $items = []; goto Xr3wB; RrCTI: return []; goto oJtKh; oJtKh: vKg3W: goto q0sHv; Xr3wB: foreach ($rows as $k => $v) { goto O6gzt; O3wKN: $items[$v["\x69\x64"]] = $v; goto pETwX; tE67e: $v["\157\x70\164\151\x6f\x6e\137" . $i] = nl2br($v["\x6f\x70\164\x69\157\156\137" . $i]); goto hal1G; lndJ0: goto RDRhu; goto OlM9K; NNgRP: $prevId = $rows[$k - 1]["\x69\x64"]; goto ww6bu; zcNI1: $v["\160\x72\145\166\x5f\151\144"] = intval($prevId); goto R9WbW; i8nE1: $i = 1; goto O75EU; OlM9K: d2Ee0: goto O3wKN; mRMiH: $nextId = 0; goto U7xXb; O6gzt: $prevId = 0; goto rgLXt; R9WbW: $v["\156\x65\x78\x74\137\x69\x64"] = intval($nextId); goto wSM0k; mKsQQ: if (!($i <= 12)) { goto d2Ee0; } goto K2H0L; wSM0k: $v["\151\164\x65\155"] = nl2br($v["\151\x74\145\155"]); goto i8nE1; pETwX: Lxl5s: goto n1B8H; K2H0L: if (empty($v["\x6f\x70\x74\151\x6f\x6e\137" . $i])) { goto C4Jno; } goto tE67e; NXAY2: eIkP9: goto zcNI1; PxtD9: $nextId = $rows[$k + 1]["\151\144"]; goto NXAY2; hal1G: C4Jno: goto lbAuh; lbAuh: $i++; goto lndJ0; ww6bu: LJDqw: goto mRMiH; O75EU: RDRhu: goto mKsQQ; rgLXt: if (!($k > 0)) { goto LJDqw; } goto NNgRP; U7xXb: if (!($k < count($rows) - 1)) { goto eIkP9; } goto PxtD9; n1B8H: } goto l9QY0; dMUer: } public function getSubjectItem($item_id) { goto ZD_90; BxWsl: aE_V2: goto DpTK2; MhiIx: $targetKey = array_search($item_id, $itemIds); goto Ew4Jq; ZD_90: $row = Db::table("\x73\x75\142\152\x65\x63\x74\137\151\164\145\x6d")->where(["\x69\x64" => $item_id])->field(true)->find(); goto wYlZ4; mJE_y: return $row; goto RDUW5; zHBTO: $itemIds = Db::table("\x73\x75\142\152\145\x63\x74\x5f\151\x74\145\x6d")->where(["\163\165\142\152\x65\143\x74\x5f\151\x64" => $row["\163\165\142\x6a\145\x63\164\x5f\151\144"]])->order("\x73\157\x72\x74\x20\141\163\143\x2c\x20\x69\x64\x20\141\163\x63")->column("\x69\144"); goto SfKyh; I2THF: if (!($targetKey > 0)) { goto n1fUy; } goto etp16; etp16: $row["\160\162\145\166\137\151\x64"] = $itemIds[$targetKey - 1]; goto WPq4t; wYlZ4: if (!$row) { goto suD5T; } goto zHBTO; WPq4t: n1fUy: goto n420T; UQViH: $row["\x6e\145\x78\164\x5f\151\x64"] = 0; goto MhiIx; DpTK2: suD5T: goto mJE_y; FBrvQ: $row["\156\x65\x78\164\137\x69\x64"] = $itemIds[$targetKey + 1]; goto FI1PN; SfKyh: $row["\x70\162\145\166\x5f\x69\x64"] = 0; goto UQViH; FI1PN: RkRno: goto BxWsl; Ew4Jq: if (!($targetKey !== false)) { goto aE_V2; } goto I2THF; n420T: if (!($targetKey < count($itemIds) - 1)) { goto RkRno; } goto FBrvQ; RDUW5: } public function answerItem($order_no, $item_id, $item_type, $item_option, $order_type = "\110\65") { goto e9iYG; YHwnp: exception("\xe8\257\204\xe6\265\x8b\351\207\x8f\xe8\241\250\344\270\215\345\xad\x98\xe5\x9c\250\357\xbc\232" . $order_no); goto YiIai; lxfP6: $orderTable = Defs::DB_TABLE_DEFS[$order_type]["\157\162\144\x65\x72"]; goto dvYck; m0DH6: $update["\x77\141\x72\156\151\x6e\147\137\154\x65\x76\x65\x6c"] = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto v3cP2; Vhb3R: $order = $this->getOrderByNo($order_no, $order_type); goto wP5pn; v3cP2: array_walk($result, function ($item) use(&$update) { goto Bi_jj; Q8WwJ: if (!($item["\x77\x61\162\x6e\x69\156\147\x5f\x6c\145\166\x65\x6c"] > $update["\x77\x61\x72\156\151\156\147\x5f\x6c\x65\x76\145\154"])) { goto DdMHa; } goto d78sD; Bi_jj: if (isset($item["\167\141\x72\x6e\x69\156\x67\137\x6c\x65\x76\x65\x6c"])) { goto Z0Lwj; } goto wk1Zy; LT6RR: Z0Lwj: goto Q8WwJ; wk1Zy: return; goto LT6RR; d78sD: $update["\167\141\162\156\x69\156\x67\137\154\145\x76\x65\154"] = $item["\x77\x61\x72\x6e\151\x6e\x67\x5f\154\145\x76\x65\x6c"]; goto a27rD; a27rD: DdMHa: goto yLaQO; yLaQO: }); goto T2jRe; PW0z_: exception("\350\257\204\346\xb5\213\351\xa2\x98\347\x9b\xae\344\xb8\215\345\xad\230\xe5\234\xa8\xef\274\232" . $item_id); goto QUERc; ac5q_: if ($item_type == Defs::QUESTION_TEXT) { goto iZ9lR; } goto E_QwM; ztC44: iZ9lR: goto MNKqo; QUERc: MZ0qy: goto DtYTn; cEPr5: exception("\xe6\265\x8b\350\xaf\204\xe9\xa1\xb9\347\233\xae\347\x89\x88\346\234\254\345\x8f\x91\xe7\x94\x9f\344\272\206\xe5\217\230\346\233\xb4\xef\xbc\x8c\xe9\x9c\200\350\xa6\201\xe9\x87\x8d\346\x96\260\xe6\xb5\213\xe8\xaf\x84", -1); goto Zd2ZP; Xy4oM: $update["\151\164\145\155\163"] = join("\x2c", $answer); goto GPhV7; qybdv: $result = SubjectLogic::I()->generateTestResult($order["\163\165\x62\x6a\145\x63\164\x5f\151\144"], $this->parseOrderItems($update["\151\x74\145\155\x73"])); goto m0DH6; Ho0g5: if (!empty($item_option)) { goto VrPm6; } goto L0Vt6; p3p2J: $update["\x63\x75\162\x72\137\x69\164\x65\x6d"] = $item_id; goto mGijy; YiIai: fKgnT: goto EGcz0; lh2B0: $item_option = join("\55", $item_option); goto a4ieT; bzwGI: $update["\x66\x69\x6e\151\163\x68\145\144"] = 1; goto DUBa_; g3bl3: Z8Zxj: goto K5Jkr; d8SVd: if ($order["\164\x65\x73\x74\137\x69\164\145\155\163"] == "\x30") { goto elHZX; } goto ix9MW; i4sBN: if (empty($order["\x63\142\137\x6f\x72\144\145\162\137\x69\x64"])) { goto Z8Zxj; } goto UUjq8; Bsk2g: goto jTZDY; goto vM8uW; R_cx8: jTZDY: goto ac5q_; PECRI: goto Q5L5r; goto ztC44; E_QwM: if (!($item_type == Defs::QUESTION_CHECKBOX)) { goto eb70Z; } goto Ho0g5; SxsGG: $order["\164\x65\x73\x74\x5f\141\x6c\154\157\x77\137\x76\x69\x65\x77\x5f\x72\145\160\x6f\162\164"] = $subject["\x74\145\x73\x74\137\141\x6c\x6c\157\167\x5f\x76\151\x65\x77\x5f\x72\x65\x70\157\162\164"]; goto AgeXu; RaVrS: exception("\350\257\x84\xe6\xb5\213\350\xae\xa2\345\215\x95\344\270\x8d\345\xad\230\xe5\x9c\xa8\xef\xbc\x9a" . $order_no); goto v3uBS; mGijy: $answer = []; goto d8SVd; MNKqo: $item_option = htmlspecialchars_decode($item_option); goto NbToc; XpgYb: exception("\347\274\272\345\xb0\x91\xe5\217\202\346\x95\xb0"); goto xWcy2; L0Vt6: $item_option = []; goto b47_O; GW_PU: $item = $this->getSubjectItem($item_id); goto oseOs; NbToc: $item_option = str_replace("\x2c", "\x3b", $item_option); goto wGvRg; a4ieT: eb70Z: goto PECRI; L7KeU: $update["\x74\x65\x73\x74\x5f\x69\164\145\x6d\x73"] = count($answer) + 1; goto Bsk2g; cOFem: if (!empty($subject)) { goto fKgnT; } goto YHwnp; b783d: $subject = $this->getSubjectById($order["\163\165\142\x6a\x65\143\164\x5f\151\x64"]); goto cOFem; DUBa_: $update["\146\x69\156\151\163\x68\137\164\x69\x6d\x65"] = date("\x59\55\x6d\x2d\x64\40\x48\72\x69\x3a\163"); goto qybdv; dvYck: Db::table($orderTable)->where(["\x6f\162\144\x65\162\x5f\156\x6f" => $order_no])->update($update); goto SxsGG; K5Jkr: if (empty($order["\163\x75\x72\166\x65\171\137\157\162\144\145\x72\x5f\x69\144"])) { goto rfk08; } goto EOLb5; iZs6Y: $update["\x74\x65\x73\x74\x5f\151\164\x65\x6d\163"] = 1; goto R_cx8; Aqr61: dmOCa: goto b783d; wx5OW: if (!$order["\x66\151\156\151\163\150\x65\144"]) { goto dmOCa; } goto P6pJh; DtYTn: $update = []; goto p3p2J; EGcz0: if (!($order["\x69\x74\145\155\x5f\166\x65\x72\x73\151\x6f\156"] != $subject["\x69\x74\145\x6d\137\166\x65\x72\163\151\x6f\156"])) { goto ol4hY; } goto cEPr5; GPhV7: if (!empty($item["\x6e\145\x78\164\137\x69\x64"])) { goto SAsGy; } goto bzwGI; vM8uW: elHZX: goto iZs6Y; AgeXu: return array_merge($order, $update); goto sxkZU; bNUmf: Q5L5r: goto nkBaG; e9iYG: if (!(empty($order_no) || empty($item_id) || empty($item_type))) { goto sRLcX; } goto XpgYb; nkBaG: $answer[$item_id] = $item_id . "\x26" . $item_type . "\x26" . $item_option; goto Xy4oM; EOLb5: $this->updateSurveyOrderStatus($order["\163\165\x72\166\145\x79\x5f\157\162\x64\145\x72\137\151\144"], $order["\x73\x75\142\152\145\143\164\137\x69\144"]); goto sEtR2; P6pJh: exception("\346\265\213\xe8\257\204\345\xb7\262\345\xae\214\346\x88\220"); goto Aqr61; UUjq8: $this->updateCombinationOrderStatus($order["\143\142\137\157\162\144\145\162\137\151\x64"], $order["\x73\x75\142\x6a\x65\143\x74\x5f\151\144"]); goto g3bl3; v3uBS: EwS8l: goto wx5OW; T2jRe: $update["\x72\145\x73\x75\154\164"] = json_encode(["\x72\x65\x70\x6f\x72\x74\114\151\163\x74" => $result], JSON_UNESCAPED_UNICODE); goto i4sBN; oseOs: if (!empty($item)) { goto MZ0qy; } goto PW0z_; b47_O: VrPm6: goto lh2B0; t8oS2: nwLDb: goto L7KeU; Zd2ZP: ol4hY: goto GW_PU; wP5pn: if (!empty($order)) { goto EwS8l; } goto RaVrS; sEtR2: rfk08: goto kA6uF; kA6uF: SAsGy: goto lxfP6; ix9MW: $itemExists = explode("\54", $order["\151\x74\x65\x6d\x73"]); goto IgocC; UAwiX: $item_option = htmlspecialchars($item_option); goto bNUmf; xWcy2: sRLcX: goto Vhb3R; IgocC: foreach ($itemExists as $itemExist) { goto AFnwp; AFnwp: $itemIdExist = explode("\x26", $itemExist)[0]; goto mrwqE; NDKoo: xROy9: goto cGozz; mrwqE: if (!($itemIdExist == $item_id)) { goto FtOvc; } goto s_6VW; HnS4x: FtOvc: goto JSoqv; JSoqv: $answer[$itemIdExist] = $itemExist; goto NDKoo; s_6VW: goto nwLDb; goto HnS4x; cGozz: } goto t8oS2; wGvRg: $item_option = str_replace("\x26", "\40", $item_option); goto UAwiX; sxkZU: } public function answerCustomItem($order_no, $custom_data, $order_type = "\x48\x35") { goto wyN2L; RxT34: exception("\xe6\x97\240\346\263\x95\xe6\x89\276\xe5\x88\260\xe5\256\x9a\xe5\210\xb6\xe5\x8c\226\346\265\213\350\xaf\204\xe7\xad\224\351\242\230"); goto d3_Qo; FzYHZ: exception("\xe6\265\x8b\xe8\257\204\xe5\267\xb2\345\xae\x8c\346\210\x90"); goto ARZzq; VzdxG: exception("\xe8\257\x84\346\xb5\x8b\350\xae\xa2\345\x8d\x95\xe4\xb8\x8d\xe5\xad\230\345\234\250\357\xbc\232" . $order_no); goto SE1xi; ARZzq: ytRpd: goto iJI6c; yw84R: return [$order, $nextData]; goto i0isO; OUYBQ: try { $nextData = call_user_func([new $class(), $method], $order_no, $order_type, $custom_data); } catch (\Exception $e) { exception("\345\xae\x9a\345\210\xb6\345\x9b\x9e\347\xad\x94\345\274\x82\345\xb8\xb8\357\274\x8c\x6d\x73\147\72\40" . $e->getMessage()); } goto vNtLI; wyN2L: $order = $this->getOrderByNo($order_no, $order_type); goto Y5rRs; JCIzQ: FD6U2: goto wckVB; UEI3V: $order = $this->getOrderByNo($order_no, $order_type); goto WWiqr; IOqwd: exception("\344\xb8\xaa\xe6\200\247\xe5\214\x96\346\xb5\213\xe8\xaf\204\xe8\xb5\x84\346\226\x99\347\274\272\345\244\xb1\xef\xbc\x9a" . $order_no); goto yqd6S; LO62c: if (!empty($subject)) { goto DwfnV; } goto IHc4s; HqQ1P: $this->updateCombinationOrderStatus($order["\x63\x62\137\x6f\x72\144\x65\x72\x5f\151\144"], $order["\163\165\142\152\145\x63\164\137\151\144"]); goto PCkZx; aCtQq: if (empty($order["\163\165\162\x76\145\171\x5f\x6f\162\144\145\x72\x5f\151\x64"])) { goto GXMlu; } goto jhNts; yPuuC: GXMlu: goto H62Es; hU2rj: if (empty($order["\143\142\x5f\x6f\162\144\x65\162\x5f\x69\x64"])) { goto nKNDO; } goto HqQ1P; IHc4s: exception("\xe8\xaf\x84\xe6\xb5\213\xe9\207\217\350\xa1\xa8\xe4\270\215\345\255\x98\345\234\250\357\xbc\232" . $order_no); goto f1h7_; d3_Qo: NCUXG: goto n9BMv; prsln: $update = []; goto R17XA; SE1xi: PxZcP: goto LkuPs; wckVB: if (!empty($subject["\143\165\x73\164\157\x6d\x5f\141\156\x73\x77\145\162"])) { goto NCUXG; } goto RxT34; BIymi: exception("\xe6\265\x8b\350\xaf\204\351\241\xb9\347\x9b\xae\347\211\x88\xe6\234\254\xe5\x8f\x91\xe7\x94\x9f\xe4\272\206\345\x8f\x98\xe6\x9b\xb4\357\274\x8c\351\x9c\x80\350\xa6\x81\xe9\207\x8d\346\x96\260\346\xb5\213\350\257\204", -1); goto JCIzQ; vNtLI: if (!empty($nextData)) { goto fzFjL; } goto prsln; IcWGd: fzFjL: goto UEI3V; n9BMv: if (SubjectLogic::I()->checkReportAlgo($subject)) { goto ywOva; } goto IOqwd; Y5rRs: if (!empty($order)) { goto PxZcP; } goto VzdxG; WWiqr: $order["\x74\145\x73\164\x5f\x61\x6c\154\157\x77\x5f\x76\151\145\x77\137\162\x65\x70\x6f\162\164"] = $subject["\164\x65\x73\164\x5f\141\154\154\157\167\137\166\x69\145\x77\x5f\162\145\160\x6f\162\164"]; goto yw84R; f1h7_: DwfnV: goto XGZ9Y; PCkZx: nKNDO: goto aCtQq; tHRvn: list($class, $method) = explode("\x3a", $subject["\143\x75\x73\x74\157\x6d\x5f\141\156\163\167\x65\x72"]); goto OUYBQ; LkuPs: if (!$order["\146\151\156\x69\163\150\145\x64"]) { goto ytRpd; } goto FzYHZ; yqd6S: ywOva: goto tHRvn; iJI6c: $subject = $this->getSubjectById($order["\163\165\x62\x6a\x65\143\164\137\x69\144"]); goto LO62c; H62Es: $orderTable = Defs::DB_TABLE_DEFS[$order_type]["\x6f\x72\144\x65\162"]; goto VdIWs; jhNts: $this->updateSurveyOrderStatus($order["\x73\x75\x72\x76\x65\x79\137\x6f\x72\x64\x65\162\137\x69\x64"], $order["\163\165\142\152\x65\143\x74\137\x69\144"]); goto yPuuC; ZMtWg: $update["\146\151\156\151\163\150\x5f\x74\151\x6d\x65"] = date("\131\x2d\155\x2d\144\40\110\x3a\x69\72\163"); goto hU2rj; VdIWs: Db::table($orderTable)->where(["\157\162\x64\x65\162\x5f\156\157" => $order_no])->update($update); goto IcWGd; R17XA: $update["\x66\x69\156\x69\x73\150\x65\x64"] = 1; goto ZMtWg; XGZ9Y: if (!($order["\151\164\x65\155\x5f\166\x65\162\x73\151\x6f\156"] != $subject["\151\164\145\x6d\x5f\x76\145\x72\163\x69\157\156"])) { goto FD6U2; } goto BIymi; i0isO: } public function getSubjectStandards($subject_id) { $rows = Db::table("\163\165\142\x6a\x65\x63\164\137\x73\x74\x61\x6e\144\x61\x72\x64")->where(["\163\165\x62\x6a\145\x63\164\x5f\151\144" => $subject_id])->field(true)->order("\163\x6f\x72\164\x20\141\x73\143\54\x20\151\144\x20\x61\x73\x63")->select(); return $rows; } public function getStandardLatitude($subject_id) { goto gNTmn; SIQJn: return $rows; goto ag6f3; he03e: $rows = []; goto UTTAw; lc7az: if (!empty($rows)) { goto ftLPq; } goto he03e; UTTAw: ftLPq: goto SIQJn; gNTmn: $rows = Db::table("\x73\x75\x62\152\145\143\x74\x5f\x73\164\141\156\144\x61\162\144\x5f\154\141\x74\x69\x74\165\144\145")->where(["\x73\165\142\x6a\145\x63\164\137\x69\144" => $subject_id])->field(true)->order("\x69\144\40\141\163\143")->select(); goto lc7az; ag6f3: } public function parseOrderItems($items) { goto k7ISB; KUDmA: nngq2: goto L4pfp; MGw4C: return []; goto KUDmA; c5N9K: if (!empty($items)) { goto nngq2; } goto MGw4C; PApsx: SCe2K: goto KfasX; KfasX: return $parsed; goto mqSMS; LG7KH: foreach ($items as $k => $v) { goto tTrse; bGQc0: if (!(empty($sections[0]) || empty($sections[1]) || empty($sections[2]))) { goto Wo2sd; } goto VU741; Ctbj0: if (!(count($sections) != 3)) { goto qSnGH; } goto JsD1G; Vm3Co: goto TZTBz; goto YSOw0; OVhP0: if ($itemType == Defs::QUESTION_CHECKBOX) { goto iRpmk; } goto taT04; AxAGX: TZTBz: goto f02F3; YSOw0: AK0xJ: goto pM2hn; r8IVL: bx2P5: goto pWk6J; Vn_AR: $itemId = $sections[0]; goto o7h5W; GBtUK: goto WM6PQ; goto XOj1j; qvPJA: $parsed[$itemId] = ["\164\171\x70\145" => $itemType, "\166\141\154\x75\145" => explode("\55", $optionValue)]; goto Vm3Co; JsD1G: goto bx2P5; goto fkhjX; o7h5W: $itemType = $sections[1]; goto L1dwM; L1dwM: $optionValue = $sections[2]; goto OVhP0; VU741: goto bx2P5; goto DFl09; pM2hn: $parsed[$itemId] = ["\x74\x79\x70\145" => $itemType, "\166\x61\x6c\165\x65" => []]; goto AxAGX; qCyBw: if (empty($optionValue)) { goto AK0xJ; } goto qvPJA; f02F3: WM6PQ: goto r8IVL; DFl09: Wo2sd: goto Vn_AR; XOj1j: iRpmk: goto qCyBw; fkhjX: qSnGH: goto bGQc0; tTrse: $sections = explode("\46", $v); goto Ctbj0; taT04: $parsed[$itemId] = ["\164\171\160\x65" => $itemType, "\166\x61\x6c\x75\x65" => $optionValue]; goto GBtUK; pWk6J: } goto PApsx; k7ISB: $items = explode("\54", $items); goto c5N9K; L4pfp: $parsed = []; goto LG7KH; mqSMS: } public function cleanSubject($subject_id) { goto A3ISb; A3ISb: Db::table("\163\x75\x62\152\145\x63\164")->where(["\151\144" => $subject_id])->delete(); goto nteQj; LXIcM: Db::table("\x73\x75\x62\x6a\145\143\x74\x5f\163\x74\141\156\x64\141\x72\144\x5f\154\x61\x74\x69\164\165\x64\x65")->where(["\163\x75\142\x6a\145\143\164\137\x69\x64" => $subject_id])->delete(); goto HZZZU; nteQj: Db::table("\163\165\142\152\145\x63\x74\137\x69\164\x65\155")->where(["\163\165\142\x6a\145\143\x74\x5f\151\144" => $subject_id])->delete(); goto fFlpI; hN6bE: Db::table("\163\x75\x62\152\x65\143\164\x5f\x73\164\141\156\x64\x61\162\x64")->where(["\x73\x75\142\x6a\x65\x63\164\x5f\151\144" => $subject_id])->delete(); goto LXIcM; fFlpI: Db::table("\163\x75\142\x6a\145\143\164\137\151\164\145\155\x5f\163\164\141\x6e\144\141\162\x64")->where(["\x73\x75\x62\152\145\143\164\x5f\151\144" => $subject_id])->delete(); goto hN6bE; HZZZU: } public function getCombinationOrderInfo($order_id) { goto tNMxP; N_Nsi: return $row; goto no80d; BJdYX: $row["\156\145\170\164\137\164\x65\163\164\137\151\144"] = 0; goto uSdKM; T5WTP: return false; goto yh4QT; hRR79: foreach ($row["\144\141\164\141"] as $sid => $finished) { goto MedMF; MedMF: if (!empty($finished)) { goto pAi1R; } goto Y_w6d; mqLK4: goto l823O; goto edojL; kY4JN: eziUV: goto TRUBh; edojL: pAi1R: goto kY4JN; Y_w6d: $row["\156\145\170\164\x5f\x74\x65\x73\164\137\151\x64"] = $sid; goto mqLK4; TRUBh: } goto SHqmI; uSdKM: if (!($row["\146\151\156\151\163\150\145\144"] == 0)) { goto iHQNM; } goto hRR79; yU6Jq: $row["\x64\x61\164\141"] = json_decode($row["\144\141\164\x61"], true); goto BJdYX; ANBSD: iHQNM: goto N_Nsi; yh4QT: W_dr8: goto yU6Jq; v81TT: if (!empty($row)) { goto W_dr8; } goto T5WTP; SHqmI: l823O: goto ANBSD; tNMxP: $row = Db::table("\x63\157\x6d\x62\x69\156\141\164\151\x6f\x6e\x5f\157\162\x64\x65\162")->where("\x69\x64", $order_id)->find(); goto v81TT; no80d: } public function getSurveyOrderInfo($order_id) { goto skScQ; cHOPm: if (!($row["\146\151\156\151\x73\x68\x65\144"] == 0)) { goto cMS0q; } goto BAsQm; UcRSk: cMS0q: goto npSsh; UhzIG: oCAEA: goto UcRSk; XtBxI: return false; goto GqSVr; ne9ic: $row["\156\x65\x78\x74\137\x74\x65\x73\164\137\151\144"] = 0; goto cHOPm; GqSVr: ExF79: goto Pth73; npSsh: return $row; goto G5l6r; E5_ob: if (!empty($row)) { goto ExF79; } goto XtBxI; skScQ: $row = Db::table("\163\x75\x72\x76\145\x79\x5f\x6f\162\x64\x65\162")->where("\x69\x64", $order_id)->find(); goto E5_ob; BAsQm: foreach ($row["\144\x61\164\x61"] as $sid => $finished) { goto J4L82; J4L82: if (!empty($finished)) { goto gwV63; } goto GgoZU; VCuCL: Dnzug: goto emGNc; p21GE: goto oCAEA; goto acM0N; acM0N: gwV63: goto VCuCL; GgoZU: $row["\x6e\145\170\x74\x5f\x74\x65\x73\164\137\x69\x64"] = $sid; goto p21GE; emGNc: } goto UhzIG; Pth73: $row["\x64\141\x74\141"] = json_decode($row["\x64\141\x74\141"], true); goto ne9ic; G5l6r: } public function updateCombinationOrderStatus($order_id, $subject_id) { goto vjwU6; c5Xvf: if (!empty($row)) { goto WuUpM; } goto dhnBD; vjwU6: $row = $this->getCombinationOrderInfo($order_id); goto c5Xvf; UVRd8: MXioM: goto tJcUb; Ddd3M: return true; goto tLUIq; gtluW: $row["\x66\x69\156\151\163\x68\x65\144"] = 1; goto UVRd8; dhnBD: return false; goto RBzyY; H8ybk: $ing = array_filter($row["\x64\141\x74\141"], function ($finished) { return $finished == 0; }); goto kI_J9; RBzyY: WuUpM: goto qOCde; kI_J9: if (!empty($ing)) { goto MXioM; } goto gtluW; qOCde: $row["\144\x61\164\141"][$subject_id] = 1; goto H8ybk; tJcUb: Db::table("\x63\x6f\x6d\142\x69\156\141\x74\151\x6f\156\x5f\x6f\x72\x64\x65\162")->where("\151\x64", $order_id)->update(["\x64\x61\x74\x61" => json_encode($row["\144\141\x74\x61"]), "\146\x69\156\x69\163\x68\x65\144" => $row["\x66\151\x6e\151\163\x68\145\x64"]]); goto Ddd3M; tLUIq: } public function updateSurveyOrderStatus($order_id, $subject_id) { goto PPb05; qctBA: $row["\146\151\x6e\x69\x73\150\x65\x64"] = 1; goto wDC0o; aaxcp: if (!empty($row)) { goto uvpK7; } goto lFaZQ; oiW29: Db::table("\163\x75\x72\x76\145\171\x5f\x6f\162\x64\x65\x72")->where("\151\144", $order_id)->update(["\144\141\164\x61" => json_encode($row["\x64\x61\164\x61"]), "\x66\x69\x6e\151\163\150\145\144" => $row["\146\x69\156\x69\163\x68\145\144"]]); goto qQCMf; lFaZQ: return false; goto Y7VHF; r7ril: $row["\x64\x61\x74\x61"][$subject_id] = 1; goto oi7Iz; qQCMf: return true; goto PhNvg; Nk5Gl: if (!empty($ing)) { goto hmM9Q; } goto qctBA; wDC0o: hmM9Q: goto oiW29; Y7VHF: uvpK7: goto r7ril; PPb05: $row = $this->getSurveyOrderInfo($order_id); goto aaxcp; oi7Iz: $ing = array_filter($row["\x64\141\x74\141"], function ($finished) { return $finished == 0; }); goto Nk5Gl; PhNvg: } }
