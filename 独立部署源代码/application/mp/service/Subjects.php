<?php
 namespace app\mp\service; use app\Defs; use think\Db; use think\Log; use app\index\logic\Defs as IndexDefs; use app\index\logic\Subject as SubjectLogic; use app\mp\service\RequestContext; use app\common\service\Redis as RedisService; class Subjects extends Bases { public function getList($map = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $paging = false) { goto xFB5i; ywn_Y: GjxZr: goto G56MX; r6Y5u: Qq1J9: goto jxM1z; jxM1z: $where["\144\x65\x6c\x65\x74\145\x5f\146\x6c\141\147"] = 0; goto hyZ46; aexIc: return ["\164\157\x74\141\x6c" => $total, "\162\157\167\x73" => $records]; goto bfGEQ; pA6Vc: return []; goto ywn_Y; tOCfl: if (empty($paging)) { goto cum94; } goto Bi8JN; gxlIE: return $records; goto pFPNk; qazpb: $where["\151\144"] = ["\x69\x6e", $subjectIds]; goto zJGl_; bfGEQ: goto rd8sG; goto TeY3j; TeY3j: cum94: goto gxlIE; Y51hU: $where["\x6e\141\155\145"] = ["\154\x69\x6b\145", "\45{$search["\x6e\141\155\x65"]}\x25"]; goto FxyIR; xFB5i: $where = isset($map["\x77\150\145\162\x65"]) ? $map["\x77\x68\145\x72\x65"] : []; goto E9EIM; G56MX: aeyBA: goto qazpb; zJGl_: BDbb7: goto KmdT0; OCsMT: PfRq0: goto wQd97; CG4Tc: $where["\164\171\x70\145"] = $search["\x74\x79\160\x65"]; goto OCsMT; o_jal: if (!empty($subjectIds)) { goto aeyBA; } goto Jz5k1; YlaAY: $where["\x6c\x61\x62\145\x6c"] = ["\154\x69\x6b\x65", "\x25{$search["\x6c\141\142\x65\x6c"]}\x25"]; goto Libq1; Jz5k1: if (!$paging) { goto r0r57; } goto y0AyW; QgqAo: $records = Db::table("\163\x75\x62\152\145\x63\x74")->field($field)->where($where)->page($page, $rows)->order($order)->select(); goto tOCfl; tfrmG: if (emptyInArray($search, "\164\171\160\145")) { goto PfRq0; } goto CG4Tc; SjBXn: $order = empty($map["\157\x72\x64\x65\x72"]) ? "\x73\x6f\162\x74\x20\x61\x73\x63\54\x69\144\x20\x64\x65\x73\x63" : $map["\157\162\144\x65\162"]; goto QgqAo; zdDWa: r0r57: goto pA6Vc; KmdT0: if (emptyInArray($search, "\x6e\x61\x6d\145")) { goto lmy_X; } goto Y51hU; y0AyW: return ["\164\157\164\x61\x6c" => 0, "\162\x6f\x77\x73" => []]; goto e2l4P; FxyIR: lmy_X: goto v_gtX; wQd97: if (emptyInArray($search, "\x63\x61\164\145\x67\x6f\x72\x79\137\151\144")) { goto BDbb7; } goto UaNGT; Libq1: VVUgK: goto r6Y5u; E9EIM: $field = isset($map["\146\x69\x65\154\x64"]) ? $map["\x66\151\145\x6c\144"] : "\x2a"; goto eozmJ; Bi8JN: $total = Db::table("\x73\x75\142\152\145\143\164")->where($where)->count(); goto aexIc; pFPNk: rd8sG: goto Ppn1r; v_gtX: if (emptyInArray($search, "\154\141\x62\145\154")) { goto VVUgK; } goto YlaAY; UaNGT: $subjectIds = Db::table("\163\165\142\152\145\x63\164\x5f\143\x61\164\145\147\x6f\162\171\x5f\162\145\x6c\141\164\145")->where(["\143\141\164\145\x67\x6f\x72\171\x5f\151\x64" => $search["\x63\141\164\145\x67\157\x72\171\x5f\x69\x64"]])->column("\x73\165\142\152\145\x63\164\137\x69\x64"); goto o_jal; e2l4P: goto GjxZr; goto zdDWa; eozmJ: if (!($search =& $map["\x73\x65\x61\x72\143\x68"])) { goto Qq1J9; } goto tfrmG; hyZ46: $where["\x73\164\141\x74\165\163"] = ["\x69\156", [IndexDefs::ENTITY_PUBLISH_STATUS]]; goto SjBXn; Ppn1r: } public function getSubjectById($id) { goto kbd_y; kbd_y: if (!empty($id)) { goto FkWtT; } goto VkgTm; k1v1C: FkWtT: goto QC3ez; VkgTm: return null; goto k1v1C; QC3ez: return Db::table("\x73\x75\142\x6a\145\143\164")->where(["\x69\x64" => $id])->field(true)->find(); goto LsNGF; LsNGF: } public function collect($uid, $subject_id, $type) { goto EviNt; W09GS: Db::table("\163\165\x62\x6a\145\x63\x74\137\x63\157\154\x6c\x65\143\164")->where(["\143\165\x73\164\x6f\155\x65\162\137\x69\x64" => $uid, "\163\165\142\152\x65\143\x74\x5f\x69\144" => $subject_id])->delete(); goto dU37H; dU37H: return; goto XG7l8; xlGoc: ftQIU: goto TW1_2; XG7l8: G5uRQ: goto ZeCnx; EviNt: if (!($type == 0)) { goto G5uRQ; } goto W09GS; ZeCnx: if ($this->isCollected($uid, $subject_id)) { goto ftQIU; } goto JLogK; JLogK: Db::table("\163\x75\x62\x6a\x65\143\x74\x5f\143\x6f\154\154\x65\143\x74")->insert(["\143\x75\163\x74\x6f\x6d\x65\x72\137\x69\x64" => $uid, "\163\165\142\152\x65\143\x74\137\151\144" => $subject_id]); goto xlGoc; TW1_2: } public function isCollected($uid, $subject_id) { return (bool) Db::table("\x73\165\x62\x6a\145\143\164\x5f\x63\157\154\154\x65\x63\x74")->where(["\143\x75\x73\164\x6f\155\145\x72\137\x69\x64" => $uid, "\x73\x75\x62\x6a\145\x63\x74\137\x69\x64" => $subject_id])->value("\x69\144"); } public function getCategories() { return Db::table("\x63\141\x74\x65\147\157\x72\x69\x65\x73")->order("\151\144\40\x61\163\x63")->column("\151\x64\x2c\156\x61\x6d\145\54\163\x74\x61\x74\x75\x73\54\x69\x6d\147\137\165\162\x6c"); } public function getUnFinishTest($uid, $subject_id, $cb_order_id = 0, $survey_order_id = 0) { goto WXpJC; ND5GZ: return null; goto Nvru2; C6Z4X: h5vUd: goto xz0WP; TxG5n: $order = Db::table("\163\x75\142\152\145\143\x74\x5f\x6f\x72\x64\145\162")->where($where)->order("\157\x72\144\145\x72\x5f\x74\151\155\x65\x20\x64\x65\x73\143")->find(); goto rsjEr; Nvru2: goto h5vUd; goto uFDNz; rsjEr: if ($order && !$order["\146\151\156\x69\x73\x68\145\144"]) { goto qocMw; } goto ND5GZ; dUFVa: return $order; goto C6Z4X; WXpJC: $where = ["\143\x75\163\x74\157\x6d\145\x72\137\151\x64" => $uid, "\x73\x75\x62\x6a\x65\x63\164\x5f\x69\x64" => $subject_id, "\160\141\x79\137\163\x74\x61\x74\165\x73" => Defs::PAY_SUCCESS, "\143\142\x5f\157\162\144\145\162\x5f\x69\x64" => $cb_order_id, "\163\x75\162\166\x65\171\x5f\x6f\162\144\145\162\137\x69\x64" => $survey_order_id]; goto TxG5n; uFDNz: qocMw: goto dUFVa; xz0WP: } public function getOrderByNo($order_no, $order_type = "\x48\x35") { goto MVvMr; ca8qU: z90s9: goto DI1pm; PCDqD: if ($result && isset($result["\162\x65\x70\157\162\164\x4c\x69\x73\164"])) { goto V4GY3; } goto N0SO_; ttA3C: $row["\162\x65\160\x6f\162\x74\x5f\154\x69\163\164"] = []; goto FqRhM; xr0t3: goto nPQAZ; goto ivXYf; l7Pjf: goto z90s9; goto FTM8p; ivXYf: V4GY3: goto CS_wX; bMnX0: $table = Defs::DB_TABLE_DEFS[$order_type]["\x6f\x72\144\x65\162"]; goto Jt1i7; Jt1i7: $row = Db::table($table)->where(["\x6f\x72\144\145\162\137\x6e\x6f" => $order_no])->field(true)->find(); goto Va3MR; FGP8f: $row["\162\x65\160\157\x72\164\x5f\x6c\x69\x73\x74"] = []; goto xr0t3; CS_wX: $row["\x72\145\160\157\162\164\x5f\x6c\x69\x73\164"] = $result["\162\x65\x70\x6f\162\x74\x4c\x69\163\x74"]; goto Ff0eO; MVvMr: if (!empty($order_no)) { goto eYPtk; } goto jVZc4; jVZc4: return null; goto G8xHj; FTM8p: WmBAf: goto jxvJv; G8xHj: eYPtk: goto bMnX0; Ff0eO: nPQAZ: goto ca8qU; FqRhM: EUDpE: goto l7Pjf; upnus: if (!$row) { goto EUDpE; } goto ttA3C; N0SO_: Log::error("\x66\141\151\154\x65\144\x20\164\x6f\40\x64\145\x63\x6f\x64\x65\x20\162\145\163\165\x6c\164\40\146\157\x72\x20\163\165\142\152\145\x63\x74\x20\x6f\162\x64\x65\x72\x3a\x20{$order_no}"); goto FGP8f; Va3MR: if ($row && !empty($row["\x72\145\163\x75\154\x74"])) { goto WmBAf; } goto upnus; jxvJv: $result = json_decode($row["\x72\145\163\x75\154\164"], true); goto PCDqD; DI1pm: return $row; goto vmqR4; vmqR4: } public function getOrderById($id) { goto GpIJW; GpIJW: if (!empty($id)) { goto foxmV; } goto S0QCp; X97ww: if ($result && isset($result["\x72\x65\160\157\162\164\114\151\163\x74"])) { goto QxgEQ; } goto Cg1Y1; HaXVy: CD1Vg: goto KEnQl; EXLOh: $row = Db::table("\x73\x75\x62\x6a\145\x63\x74\x5f\x6f\x72\x64\145\x72")->where(["\151\144" => $id])->field(true)->find(); goto JlXXc; gDkF0: $row["\x72\145\x70\157\x72\164\x5f\154\x69\163\164"] = []; goto JhrIr; GmFNE: $result = json_decode($row["\x72\145\163\165\154\164"], true); goto X97ww; WxqaU: foxmV: goto EXLOh; JlXXc: if (!($row && !empty($row["\x72\145\163\x75\154\x74"]))) { goto b43dJ; } goto GmFNE; KEnQl: b43dJ: goto XLqPE; XLqPE: return $row; goto vHsKd; S0QCp: return null; goto WxqaU; JhrIr: goto CD1Vg; goto LwXKa; LwXKa: QxgEQ: goto pjST2; Cg1Y1: Log::error("\146\x61\151\x6c\x65\x64\x20\164\157\40\144\145\x63\157\144\145\40\162\145\x73\x75\154\164\x20\x66\157\x72\x20\163\x75\142\152\x65\143\164\40\x69\x64\x3a\x20{$id}"); goto gDkF0; pjST2: $row["\x72\x65\160\x6f\162\x74\x5f\x6c\x69\163\164"] = $result["\x72\145\160\x6f\x72\164\114\151\x73\x74"]; goto HaXVy; vHsKd: } public function generateOrder($uid, $subject_id, $channel = Defs::CHANNEL_WX, $cb_order_id = 0, $survey_order_id = 0) { goto V7gyj; au1Ea: Db::table("\x63\165\163\164\157\155\x65\x72")->where(["\x69\x64" => $uid])->setInc("\x74\157\164\x61\x6c\x5f\x74\x65\x73\164\137\141\155\x6f\165\156\164", $order["\157\x72\x64\145\x72\137\141\155\157\165\x6e\164"]); goto LYsg9; V7gyj: if (!(empty($uid) || empty($subject_id))) { goto D2kIC; } goto eII0J; DEjKI: $order["\x74\157\164\x61\x6c\x5f\x69\164\145\x6d\163"] = $subject["\x69\x74\145\x6d\163"]; goto y_t4n; zZCMm: if (!empty($subject)) { goto Lurc6; } goto F4Jyj; kKavV: $survey = Db::table("\x73\x75\x72\x76\x65\171\137\x6f\162\144\145\162")->alias("\117")->join("\x73\165\x72\x76\x65\171\40\123", "\x4f\x2e\x73\165\x72\x76\145\171\137\x69\x64\75\x53\x2e\x69\x64")->where("\117\56\151\144", $survey_order_id)->field("\x53\56\x2a")->find(); goto WCRDC; eH785: $orderAmount = $subject["\x63\165\x72\162\145\156\x74\x5f\x70\x72\x69\x63\x65"]; goto yijkk; nuDgb: $order["\x73\165\142\152\x65\143\x74\x5f\151\144"] = $subject_id; goto aB1X1; eII0J: exception("\xe5\217\202\346\225\xb0\351\224\x99\350\xaf\257"); goto VAfzg; a2R2Q: $order["\x6f\x72\144\145\162\x5f\x61\x6d\x6f\x75\x6e\x74"] = $orderAmount; goto VsHsS; ArDCV: WbcG7: goto C6_MY; WCRDC: if (!empty($survey)) { goto PI0wW; } goto ZU0fN; Soms5: Db::table("\163\165\142\152\x65\143\164")->where(["\x69\144" => $subject_id])->setInc("\164\157\x74\x61\154\x5f\x61\155\157\165\x6e\x74", $order["\157\162\144\145\162\137\141\x6d\157\x75\156\164"]); goto DstnV; Z6zPK: $order["\x63\142\137\x6f\162\x64\145\x72\137\151\x64"] = intval($cb_order_id); goto aGPBd; ffCt2: JH9nh: goto XquV7; aGPBd: $order["\163\165\162\166\145\x79\x5f\157\162\x64\x65\x72\137\x69\144"] = intval($survey_order_id); goto DEjKI; gs_SG: $orderAmount = 0; goto i_3B4; C6_MY: $order = []; goto afy9P; DBxVY: exception("\xe6\xb5\213\350\xaf\204\351\207\x8f\xe8\xa1\250\xe5\214\205\xe5\x90\xab\xe7\x9a\204\351\242\x98\347\233\256\344\270\272\347\251\xba"); goto hv2fK; V63Mm: return $order; goto GUkiX; VsHsS: $order["\x70\141\171\x5f\163\164\x61\164\x75\163"] = $order["\157\x72\x64\x65\x72\x5f\x61\x6d\x6f\x75\x6e\164"] > 0 ? Defs::PAY_WAIT : Defs::PAY_SUCCESS; goto nVL6D; aB1X1: $order["\143\150\x61\x6e\x6e\x65\154\x5f\x69\144"] = intval($channel); goto Z6zPK; i_3B4: mcIwB: goto ArDCV; F4Jyj: exception("\346\xb5\213\350\257\x84\xe4\270\x8d\xe5\255\230\345\x9c\xa8"); goto fAJEp; msZv1: if (!empty($res)) { goto JH9nh; } goto Iz_ER; afy9P: $order["\x6f\x72\x64\145\162\x5f\156\x6f"] = generateSequenceNo($uid, Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\x53"); goto q1l4A; Wmqs3: Db::table("\x73\x75\142\152\145\x63\x74")->where(["\151\144" => $subject_id])->setInc("\160\141\x72\164\151\x63\151\x70\x61\x6e\164\163\x5f\x73\150\157\x77"); goto Soms5; ZU0fN: exception("\346\x99\xae\xe6\237\xa5\xe6\265\x8b\350\xaf\x95\xe8\xae\xa2\345\215\225\344\xb8\215\345\255\x98\345\x9c\250"); goto xBNyV; VAfzg: D2kIC: goto Ky7AJ; hv2fK: djN_6: goto eH785; XquV7: Db::table("\x73\x75\142\152\145\x63\164")->where(["\151\144" => $subject_id])->setInc("\x70\141\162\164\x69\x63\x69\160\x61\x6e\x74\x73"); goto Wmqs3; xBNyV: PI0wW: goto Ho6rf; Ky7AJ: $subject = $this->getSubjectById($subject_id); goto zZCMm; fAJEp: Lurc6: goto gi8AV; DstnV: Db::table("\x63\x75\163\164\157\155\145\x72")->where(["\x69\x64" => $uid])->setInc("\x74\157\164\x61\154\137\164\x65\x73\x74\137\161\x75\141\x6e\x74\151\x74\171"); goto au1Ea; drj1Y: $res = Db::table("\163\165\x62\152\x65\143\x74\137\x6f\x72\x64\x65\x72")->insert($order); goto msZv1; nVL6D: $order["\151\164\x65\x6d\137\166\145\162\163\x69\157\x6e"] = $subject["\x69\164\x65\x6d\x5f\166\x65\x72\163\x69\157\x6e"]; goto ue7l8; ue7l8: $order["\x71\x75\145\x73\x74\x69\x6f\x6e\137\x66\157\162\x6d"] = $subject["\161\x75\x65\163\164\x69\x6f\x6e\x5f\x66\157\162\155"]; goto drj1Y; gi8AV: if (!(empty($subject["\x63\165\163\164\157\155\x5f\164\x65\163\164"]) && $subject["\151\x74\145\155\163"] == 0)) { goto djN_6; } goto DBxVY; Iz_ER: exception("\xe6\x95\260\xe6\x8d\256\345\xba\223\xe6\226\xb0\xe5\242\236\350\256\xa2\xe5\215\225\345\xbc\x82\xe5\xb8\xb8"); goto ffCt2; y_t4n: $order["\151\164\x65\155\163"] = ''; goto a2R2Q; q1l4A: $order["\143\165\163\x74\157\x6d\x65\x72\x5f\x69\144"] = $uid; goto nuDgb; Ho6rf: if (!intval($survey["\x63\x66\147\x5f\x66\x72\145\x65"])) { goto mcIwB; } goto gs_SG; LYsg9: Db::table("\143\165\x73\x74\x6f\x6d\x65\x72")->where(["\x69\x64" => $uid])->setField("\154\x61\164\x65\x73\164\137\164\x65\x73\164\x5f\x74\151\x6d\x65", Db::raw("\156\x6f\x77\50\x29")); goto V63Mm; yijkk: if (!$survey_order_id) { goto WbcG7; } goto kKavV; GUkiX: } public function regenerateOrder($order_no) { goto wgs61; RTwFg: $order["\161\165\x65\x73\x74\x69\x6f\x6e\137\x66\157\x72\x6d"] = $subject["\x71\x75\x65\x73\164\x69\x6f\x6e\137\146\157\x72\155"]; goto BC3I7; vljwE: if ($order) { goto Mn1Ea; } goto kc85b; Lva5T: $order["\143\165\162\x72\x5f\x69\164\145\155"] = 0; goto C8oEx; WN87n: $order["\x69\164\145\155\137\166\145\x72\163\x69\x6f\156"] = $subject["\151\164\145\155\137\x76\x65\x72\x73\x69\x6f\156"]; goto CG7d1; vDwCn: $order["\x74\145\163\164\137\x69\x74\145\x6d\x73"] = 0; goto Lva5T; BC3I7: $order["\161\165\145\163\164\151\157\x6e\137\x61\x6e\x73\x77\145\162"] = ''; goto WN87n; wgs61: $order = $this->getOrderByNo($order_no); goto vljwE; ocM5w: $order["\164\x6f\164\x61\154\x5f\151\x74\145\155\x73"] = $subject["\x69\x74\x65\155\163"]; goto vDwCn; Xoxcc: TqCEw: goto lgEaD; V3PX4: $subject = $this->getSubjectById($subject_id); goto ZqvOG; C8oEx: $order["\x69\x74\145\155\x73"] = ''; goto igN7w; igN7w: $order["\162\145\163\165\x6c\164"] = null; goto BthF6; ZqvOG: if (!empty($subject)) { goto TqCEw; } goto fEo0J; yCCqE: Mn1Ea: goto YcdMe; lgEaD: $order = []; goto ocM5w; BthF6: $order["\146\151\x6e\151\x73\150\145\x64"] = 0; goto RTwFg; fEo0J: exception("\346\265\213\350\257\204\344\xb8\215\345\255\230\xe5\x9c\250"); goto Xoxcc; kc85b: exception("\346\x97\xa0\346\263\x95\346\211\276\345\x88\260\350\xaf\xa5\xe8\256\242\xe5\x8d\225"); goto yCCqE; CG7d1: Db::table("\x73\x75\142\x6a\145\143\164\137\x6f\x72\144\x65\162")->where("\157\162\x64\145\162\x5f\156\x6f", $order_no)->update($order); goto WZ9kF; YcdMe: $subject_id = $order["\163\165\x62\x6a\x65\x63\x74\x5f\151\x64"]; goto V3PX4; WZ9kF: } public function refreshOrderNo($customerId, $orderNo) { goto VhYL5; Fj1oY: return false; goto EoQca; j5CZo: return $orderNoNew; goto e0fsw; rEJ8T: Db::table("\x73\165\x62\152\x65\143\164\137\x6f\162\x64\x65\x72")->where(["\x63\x75\x73\x74\157\x6d\145\162\137\151\x64" => $customerId, "\x6f\162\x64\x65\162\137\x6e\157" => $orderNo])->setField("\x6f\162\x64\145\x72\137\156\x6f", $orderNoNew); goto j5CZo; VhYL5: $infos = Db::table("\163\x75\142\x6a\145\143\x74\x5f\157\x72\x64\x65\162")->where(["\x63\165\x73\164\157\155\x65\162\137\151\144" => $customerId, "\x6f\x72\144\x65\162\137\156\157" => $orderNo])->find(); goto F__oN; EoQca: cA6NS: goto M3ciT; M3ciT: $orderNoNew = generateSequenceNo($customerId, Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\x53"); goto rEJ8T; F__oN: if ($infos) { goto cA6NS; } goto Fj1oY; e0fsw: } public function refreshOrderNoById($customerId, $id) { goto QXkm9; jWtEL: if ($infos) { goto gxXVd; } goto GLZs0; GLZs0: return false; goto y94oY; y94oY: gxXVd: goto n5ckW; QXkm9: $infos = Db::table("\x73\165\x62\x6a\x65\x63\x74\137\157\x72\x64\145\162")->where(["\x69\x64" => $id])->find(); goto jWtEL; ZZUzw: Db::table("\x73\x75\x62\x6a\145\x63\164\137\157\162\x64\x65\162")->where(["\151\144" => $id])->setField("\157\x72\144\145\x72\x5f\156\157", $orderNoNew); goto bw8UT; bw8UT: return $orderNoNew; goto YY1fc; n5ckW: $orderNoNew = generateSequenceNo($customerId, Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\123"); goto ZZUzw; YY1fc: } public function paySuccessOrder($order_no) { goto fqm67; A73Mb: H54Fc: goto EX41g; fqm67: $order = $this->getOrderByNo($order_no); goto WW8Xt; EX41g: Db::table("\x73\x75\x62\152\145\x63\x74\x5f\157\162\144\x65\162")->where(["\x6f\162\x64\x65\x72\137\x6e\x6f" => $order_no])->update(["\156\x6f\x74\151\x66\171\x5f\164\151\155\145" => date("\131\55\155\x2d\144\40\110\x3a\151\72\x73"), "\x70\x61\x79\x5f\163\164\141\x74\165\163" => Defs::PAY_SUCCESS]); goto egYl7; f_sW0: exception("\xe8\256\242\345\215\x95\344\270\215\345\xad\x98\xe5\x9c\250\357\274\x9a" . $order_no); goto A73Mb; WW8Xt: if (!empty($order)) { goto H54Fc; } goto f_sW0; egYl7: } public function getSubjectItems($subject_id) { goto tDlc6; DZzAW: if (!empty($rows)) { goto BqGH5; } goto q50lA; SAQCr: $items = []; goto e8gPe; q50lA: return []; goto ya4Eb; tDlc6: $rows = Db::table("\163\x75\x62\152\145\143\164\x5f\151\164\x65\155")->where(["\163\165\142\x6a\x65\143\164\x5f\x69\x64" => $subject_id])->field(true)->order("\163\157\162\x74\40\141\x73\x63\x2c\40\x69\144\x20\141\163\x63")->select(); goto DZzAW; YLVqR: return $items; goto xRZw_; ya4Eb: BqGH5: goto SAQCr; UPoNh: zkajo: goto YLVqR; e8gPe: foreach ($rows as $k => $v) { goto t9Op9; t9Op9: $prevId = 0; goto KHAS8; KHAS8: if (!($k > 0)) { goto GE5kk; } goto pXvKh; pXvKh: $prevId = $rows[$k - 1]["\151\144"]; goto fxUWn; SUTIo: $v["\156\145\170\164\137\151\144"] = intval($nextId); goto ir0V2; XYBF8: $i++; goto hgrrv; UZauX: $i = 1; goto YDJvH; Iklqd: RcYSI: goto XYBF8; lL_HO: if (!($k < count($rows) - 1)) { goto DmD2a; } goto t8GZ7; ggq80: JSJ4F: goto S1ouv; YDJvH: ykxnM: goto wVE5u; WRFt8: $v["\x70\x72\145\166\137\151\144"] = intval($prevId); goto SUTIo; Mgs6U: DmD2a: goto WRFt8; wVE5u: if (!($i <= 12)) { goto t1Lm_; } goto EqPox; TwzRC: $nextId = 0; goto lL_HO; EqPox: if (empty($v["\157\x70\x74\151\x6f\156\x5f" . $i])) { goto RcYSI; } goto D1HNW; fxUWn: GE5kk: goto TwzRC; hgrrv: goto ykxnM; goto sdB1E; D1HNW: $v["\x6f\160\x74\x69\x6f\x6e\x5f" . $i] = nl2br($v["\157\160\164\151\x6f\x6e\137" . $i]); goto Iklqd; ir0V2: $v["\x69\x74\x65\x6d"] = nl2br($v["\x69\x74\145\155"]); goto UZauX; t8GZ7: $nextId = $rows[$k + 1]["\x69\x64"]; goto Mgs6U; sdB1E: t1Lm_: goto xOhkD; xOhkD: $items[$v["\x69\144"]] = $v; goto ggq80; S1ouv: } goto UPoNh; xRZw_: } public function getSubjectItem($item_id) { goto lENrv; BJvut: if (!($targetKey < count($itemIds) - 1)) { goto OetI6; } goto Pglx4; Pglx4: $row["\x6e\145\x78\x74\x5f\151\144"] = $itemIds[$targetKey + 1]; goto Pm8pa; rBOOq: return $row; goto BVfa4; u37eq: $row["\x6e\x65\170\x74\137\151\144"] = 0; goto YMUUS; qmAau: $itemIds = Db::table("\163\165\x62\152\145\143\164\137\151\x74\145\x6d")->where(["\x73\165\x62\152\x65\x63\164\137\151\144" => $row["\x73\165\x62\x6a\145\143\164\137\151\144"]])->order("\163\x6f\x72\164\40\x61\163\x63\54\x20\x69\144\40\x61\x73\143")->column("\151\144"); goto q3wma; QxlSx: if (!($targetKey !== false)) { goto xDS45; } goto zItPT; zItPT: if (!($targetKey > 0)) { goto K9Q4o; } goto o8SjC; YMUUS: $targetKey = array_search($item_id, $itemIds); goto QxlSx; lfOoO: K9Q4o: goto BJvut; KHilV: xDS45: goto SWHpg; o8SjC: $row["\160\162\145\166\137\x69\x64"] = $itemIds[$targetKey - 1]; goto lfOoO; SWHpg: GSbSI: goto rBOOq; Pm8pa: OetI6: goto KHilV; q3wma: $row["\x70\162\145\166\137\x69\x64"] = 0; goto u37eq; Npgjr: if (!$row) { goto GSbSI; } goto qmAau; lENrv: $row = Db::table("\163\165\x62\152\145\x63\x74\x5f\x69\x74\145\x6d")->where(["\151\x64" => $item_id])->field(true)->find(); goto Npgjr; BVfa4: } public function answerItem($order_no, $item_id, $item_type, $item_option, $order_type = "\x48\x35") { goto O2qAx; cA_90: lx9IH: goto MzH1l; cDFFR: $update["\164\145\163\x74\137\x69\x74\x65\155\x73"] = count($answer) + 1; goto Dv4He; RV7TZ: exception("\xe6\xb5\213\350\257\204\351\241\xb9\347\233\256\347\211\210\xe6\234\xac\345\217\221\347\x94\x9f\xe4\272\x86\345\217\230\xe6\233\xb4\xef\274\x8c\351\234\x80\xe8\246\x81\xe9\x87\x8d\xe6\226\260\346\265\213\xe8\xaf\x84", -1); goto GUWOk; O2qAx: if (!(empty($order_no) || empty($item_id) || empty($item_type))) { goto ewv5L; } goto x9A3J; Qrq9b: $itemExists = explode("\54", $order["\151\164\x65\x6d\x73"]); goto xzv2y; xKXh6: exception("\xe8\xaf\204\xe6\265\213\xe8\xae\xa2\345\x8d\x95\344\xb8\215\345\255\230\xe5\x9c\250\xef\xbc\x9a" . $order_no); goto DIR5C; tjsJt: Y0Q5R: goto iG0UN; fu4c7: $order = $this->getOrderByNo($order_no, $order_type); goto ooISL; RJbd7: $item_option = str_replace("\x26", "\40", $item_option); goto FVCz3; xzv2y: foreach ($itemExists as $itemExist) { goto zQP18; wiPgy: $answer[$itemIdExist] = $itemExist; goto eAq_G; zQP18: $itemIdExist = explode("\46", $itemExist)[0]; goto lqAeV; lqAeV: if (!($itemIdExist == $item_id)) { goto Zq7eA; } goto SvhJE; eAq_G: d5Ggr: goto aNhKk; LRe2g: Zq7eA: goto wiPgy; SvhJE: goto YALq2; goto LRe2g; aNhKk: } goto VZOeg; f7VDg: $item = $this->getSubjectItem($item_id); goto Ph0hM; Pt9YO: sBEo6: goto O0m7e; wHZYp: Q7KA0: goto bh6oO; mDyth: Db::table($orderTable)->where(["\157\x72\144\145\x72\x5f\156\x6f" => $order_no])->update($update); goto Ujmgj; ILOHN: $this->updateCombinationOrderStatus($order["\x63\x62\x5f\157\x72\x64\x65\162\x5f\151\144"], $order["\x73\x75\x62\x6a\x65\x63\x74\137\x69\144"]); goto h0oQG; aNuv9: nj0F6: goto m038E; i2IXR: JN7V_: goto uuboN; gcRJe: if (!empty($item["\x6e\x65\x78\164\x5f\x69\144"])) { goto LtPrj; } goto oTh1F; oTh1F: $update["\x66\x69\156\151\x73\150\145\x64"] = 1; goto V5IZg; qPIh_: tokHE: goto BebR7; GH8DC: exception("\350\xaf\204\346\xb5\213\xe9\207\217\350\xa1\xa8\344\xb8\x8d\xe5\xad\230\345\x9c\250\357\274\x9a" . $order_no); goto i2IXR; DwXAY: if (!empty($item_option)) { goto Q7KA0; } goto o3Krc; dkIGB: ewv5L: goto fu4c7; DIR5C: S9eOg: goto fQBM1; bh6oO: $item_option = join("\x2d", $item_option); goto Pt9YO; ooISL: if (!empty($order)) { goto S9eOg; } goto xKXh6; TNZLB: if (empty($order["\x73\165\162\x76\x65\x79\x5f\x6f\162\144\x65\x72\137\151\144"])) { goto Y0Q5R; } goto VHkIB; H0TgH: $answer = []; goto e1fxl; uuboN: if (!($order["\x69\x74\145\x6d\x5f\x76\145\x72\163\151\x6f\x6e"] != $subject["\x69\164\x65\155\137\166\145\x72\x73\x69\157\x6e"])) { goto qTbLm; } goto RV7TZ; V5IZg: $update["\146\151\x6e\151\163\x68\x5f\x74\x69\x6d\145"] = date("\x59\x2d\x6d\55\x64\x20\x48\72\x69\x3a\x73"); goto uPiXR; gHSTY: exception("\346\265\x8b\350\257\204\345\xb7\262\345\256\x8c\xe6\210\x90"); goto lMDgb; IFODV: TFUEc: goto WOaEt; doiDv: if (empty($order["\143\x62\137\157\162\x64\145\162\x5f\x69\x64"])) { goto HKIIT; } goto ILOHN; JzahR: $update["\143\x75\x72\162\x5f\151\164\145\155"] = $item_id; goto H0TgH; MgU0F: exception("\350\257\204\346\xb5\213\xe9\xa2\x98\xe7\x9b\256\344\270\215\345\xad\x98\345\234\xa8\357\xbc\x9a" . $item_id); goto IFODV; UJ4Q6: if (!($item_type == Defs::QUESTION_CHECKBOX)) { goto sBEo6; } goto DwXAY; gAHgr: $item_option = str_replace("\x2c", "\73", $item_option); goto RJbd7; YM8mQ: $subject = $this->getSubjectById($order["\163\165\142\152\145\143\164\x5f\x69\x64"]); goto lf9Db; uPiXR: $result = SubjectLogic::I()->generateTestResult($order["\x73\165\142\x6a\x65\143\x74\137\151\144"], $this->parseOrderItems($update["\151\x74\145\x6d\x73"])); goto RP01J; h0oQG: HKIIT: goto TNZLB; x9A3J: exception("\347\xbc\272\xe5\xb0\221\xe5\x8f\x82\xe6\225\xb0"); goto dkIGB; cw8tX: $item_option = htmlspecialchars_decode($item_option); goto gAHgr; GUWOk: qTbLm: goto f7VDg; gxp63: $orderTable = Defs::DB_TABLE_DEFS[$order_type]["\157\162\x64\x65\x72"]; goto mDyth; X_VMx: return array_merge($order, $update); goto HfOnq; EDDkC: array_walk($result, function ($item) use(&$update) { goto h06od; DX1aB: $update["\167\141\x72\156\151\x6e\147\137\x6c\x65\166\x65\154"] = $item["\167\141\162\x6e\x69\156\x67\x5f\154\x65\x76\x65\x6c"]; goto OCIgM; OCIgM: e7vxe: goto nHux1; jgRMk: return; goto An0qs; ISSvn: if (!($item["\x77\x61\x72\x6e\x69\x6e\147\137\154\145\166\145\x6c"] > $update["\x77\141\162\156\151\156\147\x5f\x6c\145\x76\145\x6c"])) { goto e7vxe; } goto DX1aB; An0qs: rPkMy: goto ISSvn; h06od: if (isset($item["\167\141\x72\x6e\151\156\147\137\154\x65\x76\145\154"])) { goto rPkMy; } goto jgRMk; nHux1: }); goto zdx4F; fQBM1: if (!$order["\146\151\156\151\163\150\145\144"]) { goto TQztH; } goto gHSTY; e1fxl: if ($order["\164\x65\163\164\137\151\164\x65\155\163"] == "\x30") { goto nj0F6; } goto Qrq9b; o3Krc: $item_option = []; goto wHZYp; WOaEt: $update = []; goto JzahR; FVCz3: $item_option = htmlspecialchars($item_option); goto qPIh_; a_hEd: $update["\x69\x74\x65\155\x73"] = join("\x2c", $answer); goto gcRJe; m038E: $update["\x74\145\163\164\137\151\164\145\155\163"] = 1; goto cA_90; lMDgb: TQztH: goto YM8mQ; lf9Db: if (!empty($subject)) { goto JN7V_; } goto GH8DC; VZOeg: YALq2: goto cDFFR; Dv4He: goto lx9IH; goto aNuv9; RP01J: $update["\167\141\162\x6e\x69\156\x67\137\154\x65\166\145\x6c"] = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto EDDkC; zdx4F: $update["\x72\145\x73\165\154\164"] = json_encode(["\162\x65\x70\157\x72\164\x4c\151\x73\164" => $result], JSON_UNESCAPED_UNICODE); goto doiDv; iG0UN: LtPrj: goto gxp63; O0m7e: goto tokHE; goto NrOtN; Ujmgj: $order["\164\x65\x73\x74\137\141\x6c\x6c\x6f\x77\137\166\151\145\167\x5f\162\x65\160\x6f\x72\x74"] = $subject["\x74\145\163\x74\137\x61\154\x6c\x6f\167\137\x76\x69\145\x77\x5f\162\145\160\x6f\x72\x74"]; goto X_VMx; VHkIB: $this->updateSurveyOrderStatus($order["\x73\165\x72\x76\x65\171\137\x6f\162\x64\145\162\x5f\151\x64"], $order["\163\165\x62\152\145\x63\164\x5f\151\144"]); goto tjsJt; Ph0hM: if (!empty($item)) { goto TFUEc; } goto MgU0F; MzH1l: if ($item_type == Defs::QUESTION_TEXT) { goto mWMBT; } goto UJ4Q6; NrOtN: mWMBT: goto cw8tX; BebR7: $answer[$item_id] = $item_id . "\46" . $item_type . "\x26" . $item_option; goto a_hEd; HfOnq: } public function answerCustomItem($order_no, $custom_data, $order_type = "\x48\x35") { goto HBt4o; FM8Qn: if (!empty($subject["\143\x75\x73\164\x6f\155\137\141\x6e\x73\x77\x65\x72"])) { goto dwsOL; } goto BzRNB; isc7s: list($class, $method) = explode("\x3a", $subject["\143\x75\163\164\157\x6d\137\141\156\163\167\x65\x72"]); goto NzxOp; h3Tmg: if (SubjectLogic::I()->checkReportAlgo($subject)) { goto iD9QM; } goto lI32u; puqGg: $orderTable = Defs::DB_TABLE_DEFS[$order_type]["\157\x72\144\x65\162"]; goto tubVB; Z8EQf: wpIB0: goto QU51z; FAutn: $this->updateCombinationOrderStatus($order["\143\142\137\157\x72\144\145\162\x5f\151\x64"], $order["\163\165\142\152\x65\x63\x74\x5f\151\x64"]); goto Z8EQf; o9bZZ: ExA2z: goto D1GO7; d9J07: $update = []; goto gaQUN; Zj3ER: exception("\xe8\257\204\xe6\265\213\xe9\x87\x8f\xe8\xa1\250\344\270\215\345\255\x98\xe5\234\xa8\xef\xbc\x9a" . $order_no); goto kaokG; NzxOp: try { $nextData = call_user_func([new $class(), $method], $order_no, $order_type, $custom_data); } catch (\Exception $e) { exception("\xe5\xae\232\xe5\x88\266\xe5\x9b\x9e\347\255\x94\345\xbc\202\xe5\xb8\xb8\xef\xbc\x8c\x6d\x73\147\72\40" . $e->getMessage()); } goto BGqeO; yOi4c: a2XSI: goto tgpKr; iMRpC: exception("\xe6\xb5\x8b\xe8\257\204\345\267\262\xe5\xae\214\346\210\220"); goto o9bZZ; XPgqo: return [$order, $nextData]; goto rxA35; se3LK: $this->updateSurveyOrderStatus($order["\x73\x75\162\x76\145\171\137\157\162\x64\x65\x72\x5f\x69\144"], $order["\163\165\142\152\145\x63\x74\137\151\x64"]); goto ylSIg; kaokG: cY26z: goto n_IMZ; MxKTB: exception("\xe6\265\213\xe8\xaf\204\xe9\241\271\xe7\x9b\xae\347\x89\x88\346\234\xac\xe5\217\221\xe7\224\x9f\xe4\272\x86\xe5\217\x98\346\233\264\xef\xbc\x8c\351\x9c\x80\350\246\201\351\x87\215\xe6\x96\260\xe6\xb5\x8b\350\xaf\x84", -1); goto U5ieN; JazC5: NX9U0: goto kjNVz; HBt4o: $order = $this->getOrderByNo($order_no, $order_type); goto PUeur; BzRNB: exception("\xe6\227\240\xe6\xb3\x95\xe6\211\276\345\210\260\345\256\232\345\210\xb6\xe5\x8c\226\346\xb5\x8b\xe8\257\x84\xe7\xad\224\xe9\xa2\230"); goto HUbTK; Zk92O: $update["\146\151\x6e\151\x73\x68\137\x74\151\155\145"] = date("\x59\x2d\x6d\x2d\x64\x20\110\x3a\151\x3a\x73"); goto F0hLd; bzYaL: $order["\164\145\x73\x74\137\141\x6c\x6c\157\x77\137\166\151\x65\167\137\162\145\160\x6f\x72\x74"] = $subject["\x74\145\163\164\x5f\x61\154\154\x6f\x77\137\166\x69\145\x77\x5f\162\x65\160\x6f\x72\164"]; goto XPgqo; lI32u: exception("\xe4\xb8\xaa\xe6\x80\247\345\x8c\226\346\265\x8b\xe8\257\204\350\265\x84\346\x96\231\xe7\xbc\272\345\xa4\261\xef\xbc\x9a" . $order_no); goto QOSW7; U5ieN: FARZU: goto FM8Qn; QU51z: if (empty($order["\x73\165\162\166\x65\x79\x5f\157\x72\144\145\162\137\x69\x64"])) { goto ZKhqX; } goto se3LK; n_IMZ: if (!($order["\x69\164\x65\155\137\166\145\x72\163\x69\157\156"] != $subject["\151\x74\x65\x6d\137\166\x65\162\x73\x69\157\156"])) { goto FARZU; } goto MxKTB; aHQ7_: exception("\350\257\x84\346\xb5\213\xe8\xae\242\xe5\x8d\x95\344\xb8\x8d\345\255\x98\xe5\234\xa8\xef\274\232" . $order_no); goto JazC5; ki80R: if (!empty($subject)) { goto cY26z; } goto Zj3ER; HUbTK: dwsOL: goto h3Tmg; F0hLd: if (empty($order["\x63\x62\137\x6f\x72\x64\145\x72\137\x69\x64"])) { goto wpIB0; } goto FAutn; ylSIg: ZKhqX: goto puqGg; BGqeO: if (!empty($nextData)) { goto a2XSI; } goto d9J07; kjNVz: if (!$order["\146\151\x6e\x69\163\150\145\144"]) { goto ExA2z; } goto iMRpC; tgpKr: $order = $this->getOrderByNo($order_no, $order_type); goto bzYaL; tubVB: Db::table($orderTable)->where(["\x6f\162\x64\145\x72\x5f\156\157" => $order_no])->update($update); goto yOi4c; PUeur: if (!empty($order)) { goto NX9U0; } goto aHQ7_; gaQUN: $update["\x66\151\x6e\x69\163\150\x65\x64"] = 1; goto Zk92O; D1GO7: $subject = $this->getSubjectById($order["\x73\x75\142\152\145\x63\164\137\x69\144"]); goto ki80R; QOSW7: iD9QM: goto isc7s; rxA35: } public function getSubjectStandards($subject_id) { $rows = Db::table("\163\165\x62\152\145\x63\x74\137\x73\x74\141\156\x64\x61\162\x64")->where(["\163\165\142\152\x65\143\x74\137\x69\144" => $subject_id])->field(true)->order("\163\x6f\x72\x74\40\x61\x73\x63\x2c\40\x69\144\40\141\x73\143")->select(); return $rows; } public function getStandardLatitude($subject_id) { goto qFmg5; OoOAB: return $rows; goto kP0Ef; VXaLP: $rows = []; goto ChfsG; eTFnR: if (!empty($rows)) { goto hmhoR; } goto VXaLP; ChfsG: hmhoR: goto OoOAB; qFmg5: $rows = Db::table("\x73\x75\142\152\145\x63\x74\137\x73\x74\141\156\144\141\162\x64\137\x6c\141\x74\151\x74\165\x64\145")->where(["\x73\165\x62\x6a\145\143\x74\x5f\151\144" => $subject_id])->field(true)->order("\x69\144\40\141\x73\x63")->select(); goto eTFnR; kP0Ef: } public function parseOrderItems($items) { goto CXVD2; M6bY2: if (!empty($items)) { goto LhPZp; } goto kiE_V; fW23S: LhPZp: goto XAjjO; kiE_V: return []; goto fW23S; dzPMO: foreach ($items as $k => $v) { goto Uxo93; tXEjx: goto uMG8P; goto fFM6Z; On5ro: $parsed[$itemId] = ["\x74\x79\160\x65" => $itemType, "\166\141\154\x75\x65" => []]; goto V1hNx; AMhdE: $parsed[$itemId] = ["\x74\x79\x70\145" => $itemType, "\166\x61\x6c\165\x65" => explode("\x2d", $optionValue)]; goto RuwaF; W9n9d: if (empty($optionValue)) { goto OBMDb; } goto AMhdE; LO17M: if ($itemType == Defs::QUESTION_CHECKBOX) { goto d39GR; } goto JwNLM; B_JR1: $itemType = $sections[1]; goto E5Y5l; aegqk: if (!(count($sections) != 3)) { goto CVb_4; } goto IVoEs; fFM6Z: LtnJA: goto nIQLM; q02Lr: yZ1PB: goto geIQq; JhNGb: if (!(empty($sections[0]) || empty($sections[1]) || empty($sections[2]))) { goto LtnJA; } goto tXEjx; Jop8M: OBMDb: goto On5ro; nRWXT: CVb_4: goto JhNGb; H5PWD: goto yZ1PB; goto cAbhh; IVoEs: goto uMG8P; goto nRWXT; cAbhh: d39GR: goto W9n9d; JwNLM: $parsed[$itemId] = ["\164\x79\x70\145" => $itemType, "\x76\x61\154\165\145" => $optionValue]; goto H5PWD; V1hNx: PZBPc: goto q02Lr; E5Y5l: $optionValue = $sections[2]; goto LO17M; geIQq: uMG8P: goto kslrz; nIQLM: $itemId = $sections[0]; goto B_JR1; Uxo93: $sections = explode("\46", $v); goto aegqk; RuwaF: goto PZBPc; goto Jop8M; kslrz: } goto njAaQ; voltS: return $parsed; goto E_fcB; XAjjO: $parsed = []; goto dzPMO; njAaQ: QXC6X: goto voltS; CXVD2: $items = explode("\54", $items); goto M6bY2; E_fcB: } public function cleanSubject($subject_id) { goto ZYTce; rInzi: Db::table("\163\x75\142\152\145\x63\164\137\x69\x74\145\x6d\137\x73\x74\x61\x6e\144\x61\x72\144")->where(["\x73\x75\x62\x6a\145\143\x74\x5f\x69\x64" => $subject_id])->delete(); goto R9crd; UrfO0: Db::table("\163\x75\x62\152\x65\x63\x74\x5f\x69\164\x65\x6d")->where(["\x73\x75\x62\x6a\x65\143\164\137\151\x64" => $subject_id])->delete(); goto rInzi; R9crd: Db::table("\163\165\x62\x6a\x65\x63\x74\137\x73\164\141\x6e\144\x61\162\144")->where(["\x73\x75\x62\x6a\145\x63\x74\137\x69\144" => $subject_id])->delete(); goto Zd5Hr; Zd5Hr: Db::table("\163\x75\142\x6a\145\143\164\137\163\164\x61\156\144\x61\162\144\x5f\x6c\x61\164\151\164\165\x64\x65")->where(["\163\165\142\x6a\145\143\164\x5f\151\144" => $subject_id])->delete(); goto TU0Za; ZYTce: Db::table("\163\165\142\x6a\145\143\164")->where(["\151\144" => $subject_id])->delete(); goto UrfO0; TU0Za: } public function getCombinationOrderInfo($order_id) { goto fUYwI; TI1hR: $row["\x64\x61\164\x61"] = json_decode($row["\144\x61\164\x61"], true); goto XQSfS; V9FVP: jzL1X: goto RCM3Y; Kul13: if (!empty($row)) { goto C11ji; } goto mFNTl; RCM3Y: QH90B: goto lAWOJ; XQSfS: $row["\x6e\x65\170\x74\x5f\x74\x65\x73\164\x5f\151\x64"] = 0; goto FrAFN; fUYwI: $row = Db::table("\143\157\x6d\142\151\x6e\x61\164\151\x6f\x6e\137\x6f\162\144\x65\x72")->where("\x69\144", $order_id)->find(); goto Kul13; FrAFN: if (!($row["\146\x69\156\x69\163\x68\x65\144"] == 0)) { goto QH90B; } goto ZDTPK; lAWOJ: return $row; goto zQ4Wo; mFNTl: return false; goto CoMDc; CoMDc: C11ji: goto TI1hR; ZDTPK: foreach ($row["\144\141\164\141"] as $sid => $finished) { goto ixK0Z; ixK0Z: if (!empty($finished)) { goto nsPB5; } goto oVeKm; U4VWN: nsPB5: goto m4EDG; m4EDG: xrHZq: goto Y2BPU; Ve3gq: goto jzL1X; goto U4VWN; oVeKm: $row["\x6e\x65\x78\x74\137\x74\x65\163\x74\137\151\x64"] = $sid; goto Ve3gq; Y2BPU: } goto V9FVP; zQ4Wo: } public function getSurveyOrderInfo($order_id) { goto vaUv4; X2OYl: $row["\x64\141\x74\141"] = json_decode($row["\144\141\164\141"], true); goto EoLVi; vpLYt: if (!empty($row)) { goto NAqfR; } goto ZhMih; EoLVi: $row["\x6e\145\170\164\x5f\x74\x65\163\x74\137\x69\x64"] = 0; goto IKmaG; KCptu: vJJZv: goto WhC0c; vaUv4: $row = Db::table("\x73\165\x72\x76\x65\x79\137\x6f\x72\x64\x65\x72")->where("\x69\144", $order_id)->find(); goto vpLYt; WhC0c: return $row; goto T8u8T; OwL1c: OpKO6: goto KCptu; IKmaG: if (!($row["\146\151\x6e\151\163\150\145\144"] == 0)) { goto vJJZv; } goto MWdZK; MWdZK: foreach ($row["\x64\141\164\x61"] as $sid => $finished) { goto PM1dV; rbQ25: mDyDS: goto cfvaU; PM1dV: if (!empty($finished)) { goto ujsCn; } goto bAuyF; tY052: ujsCn: goto rbQ25; bAuyF: $row["\x6e\x65\170\164\x5f\164\145\163\x74\137\x69\x64"] = $sid; goto D4R2x; D4R2x: goto OpKO6; goto tY052; cfvaU: } goto OwL1c; K_HUL: NAqfR: goto X2OYl; ZhMih: return false; goto K_HUL; T8u8T: } public function updateCombinationOrderStatus($order_id, $subject_id) { goto Sefkb; FhvUA: if (!empty($ing)) { goto vKOBg; } goto PmNvK; P4NiU: Db::table("\x63\157\155\142\151\x6e\141\164\x69\157\x6e\137\157\162\144\145\162")->where("\151\x64", $order_id)->update(["\144\x61\x74\x61" => json_encode($row["\x64\141\x74\x61"]), "\146\151\x6e\x69\163\x68\x65\x64" => $row["\146\x69\156\151\163\150\x65\x64"]]); goto MR6AW; kgDum: $ing = array_filter($row["\x64\141\164\141"], function ($finished) { return $finished == 0; }); goto FhvUA; yVqsX: VaXq0: goto T1Hsh; IxwyM: vKOBg: goto P4NiU; MR6AW: return true; goto U3KSR; PmNvK: $row["\x66\151\156\151\x73\x68\x65\144"] = 1; goto IxwyM; Sefkb: $row = $this->getCombinationOrderInfo($order_id); goto iWc_Y; T1Hsh: $row["\144\x61\x74\x61"][$subject_id] = 1; goto kgDum; u5EEP: return false; goto yVqsX; iWc_Y: if (!empty($row)) { goto VaXq0; } goto u5EEP; U3KSR: } public function updateSurveyOrderStatus($order_id, $subject_id) { goto pB3Cs; nIk6q: ot9TM: goto i4WiV; pB3Cs: $row = $this->getSurveyOrderInfo($order_id); goto Id1oL; FuVV5: qz9Ao: goto L5GZ4; Hovqx: if (!empty($ing)) { goto ot9TM; } goto ViO3g; L5GZ4: $row["\144\141\x74\141"][$subject_id] = 1; goto sCoOY; i4WiV: Db::table("\163\x75\x72\x76\145\x79\137\157\162\144\x65\x72")->where("\151\144", $order_id)->update(["\x64\141\x74\141" => json_encode($row["\x64\141\x74\x61"]), "\146\151\156\x69\163\150\145\x64" => $row["\146\x69\x6e\x69\x73\x68\145\x64"]]); goto L1pzp; ppS3W: return false; goto FuVV5; sCoOY: $ing = array_filter($row["\x64\x61\164\x61"], function ($finished) { return $finished == 0; }); goto Hovqx; Id1oL: if (!empty($row)) { goto qz9Ao; } goto ppS3W; L1pzp: return true; goto jK5vl; ViO3g: $row["\146\x69\x6e\x69\163\150\145\x64"] = 1; goto nIk6q; jK5vl: } }
