<?php
 namespace app\mp\service; use app\Defs; use think\Db; use think\Log; use app\index\logic\Defs as IndexDefs; use app\index\logic\Subject as SubjectLogic; use app\mp\service\RequestContext; use app\common\service\Redis as RedisService; class Subjects extends Bases { public function getList($map = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $paging = false) { goto ltwHH; VTfY_: $where["\156\141\155\x65"] = ["\154\x69\153\x65", "\x25{$search["\x6e\141\155\x65"]}\x25"]; goto tLC2H; qqimK: return []; goto xRj7e; bsN3M: if (!empty($subjectIds)) { goto g_CTo; } goto mIxT0; BCX0Y: $where["\x64\x65\x6c\145\x74\145\x5f\146\154\x61\x67"] = 0; goto Cv1w3; fvOmv: $total = Db::table("\163\165\x62\152\145\x63\164")->where($where)->count(); goto f9MWg; yFrON: $field = isset($map["\146\x69\145\154\144"]) ? $map["\146\x69\x65\154\144"] : "\x2a"; goto eUd8Q; amzBr: if (emptyInArray($search, "\143\x61\x74\x65\x67\157\x72\171\x5f\x69\x64")) { goto WEYzd; } goto Zb8l0; IgNcV: $where["\x74\171\160\145"] = $search["\164\x79\160\145"]; goto aKqPu; Zb8l0: $subjectIds = Db::table("\163\x75\x62\x6a\145\143\164\137\143\x61\164\145\x67\x6f\162\x79\x5f\162\x65\154\x61\x74\x65")->where(["\x63\141\x74\145\x67\x6f\162\171\x5f\x69\144" => $search["\x63\x61\164\145\x67\157\162\x79\137\151\x64"]])->column("\163\165\142\x6a\x65\x63\164\x5f\151\144"); goto bsN3M; tLC2H: PVU2k: goto mfnJG; eUd8Q: if (!($search =& $map["\x73\x65\141\x72\x63\x68"])) { goto RnOuC; } goto gp4Pm; rrT0u: g_CTo: goto b87wm; mfnJG: if (emptyInArray($search, "\154\x61\142\x65\x6c")) { goto ovh6N; } goto GvHMS; bbL1j: ovh6N: goto V16l2; aBZcy: OvdRF: goto xcm6c; ltwHH: $where = isset($map["\x77\150\145\162\x65"]) ? $map["\x77\x68\145\x72\x65"] : []; goto yFrON; f9MWg: return ["\164\x6f\x74\x61\x6c" => $total, "\162\157\x77\x73" => $records]; goto Z7Kj4; xRj7e: EpPNp: goto rrT0u; EV89P: mrSpe: goto EdYwn; gp4Pm: if (emptyInArray($search, "\164\171\160\x65")) { goto xzNq_; } goto IgNcV; wsAra: JeISn: goto qqimK; f7ho6: goto EpPNp; goto wsAra; iQzNT: $records = Db::table("\x73\165\142\152\x65\x63\164")->field($field)->where($where)->page($page, $rows)->order($order)->select(); goto PkG78; Z7Kj4: goto OvdRF; goto EV89P; Cv1w3: $where["\x73\164\141\164\165\163"] = ["\x69\156", [IndexDefs::ENTITY_PUBLISH_STATUS]]; goto RAiQ9; EdYwn: return $records; goto aBZcy; rL7TX: WEYzd: goto qxapp; PkG78: if (empty($paging)) { goto mrSpe; } goto fvOmv; V16l2: RnOuC: goto BCX0Y; b87wm: $where["\151\x64"] = ["\151\x6e", $subjectIds]; goto rL7TX; GvHMS: $where["\154\x61\x62\x65\x6c"] = ["\x6c\x69\153\145", "\45{$search["\154\x61\142\145\154"]}\45"]; goto bbL1j; JCpdt: return ["\x74\157\x74\141\x6c" => 0, "\x72\x6f\167\163" => []]; goto f7ho6; RAiQ9: $order = empty($map["\157\x72\x64\145\162"]) ? "\163\x6f\162\x74\40\x61\163\143\54\151\x64\40\x64\x65\163\143" : $map["\157\162\144\145\162"]; goto iQzNT; mIxT0: if (!$paging) { goto JeISn; } goto JCpdt; aKqPu: xzNq_: goto amzBr; qxapp: if (emptyInArray($search, "\156\x61\x6d\145")) { goto PVU2k; } goto VTfY_; xcm6c: } public function getSubjectById($id) { goto YMB3J; YQwty: zzB8M: goto O89lG; YMB3J: if (!empty($id)) { goto zzB8M; } goto LlLSH; LlLSH: return null; goto YQwty; O89lG: return Db::table("\x73\165\x62\152\x65\x63\164")->where(["\x69\x64" => $id])->field(true)->find(); goto vSirF; vSirF: } public function collect($uid, $subject_id, $type) { goto FaYeO; dHhih: Db::table("\x73\165\142\x6a\145\143\x74\x5f\143\x6f\154\x6c\x65\x63\164")->where(["\x63\x75\163\x74\x6f\x6d\x65\x72\137\x69\x64" => $uid, "\x73\165\142\152\x65\143\164\137\x69\x64" => $subject_id])->delete(); goto KBiPI; Cg8ch: Db::table("\163\x75\142\x6a\145\x63\164\x5f\143\x6f\154\x6c\145\143\164")->insert(["\x63\x75\x73\164\157\155\145\162\137\x69\x64" => $uid, "\x73\x75\x62\x6a\145\x63\164\137\151\x64" => $subject_id]); goto QnCBa; FaYeO: if (!($type == 0)) { goto UEXiW; } goto dHhih; KBiPI: return; goto IrZNU; IrZNU: UEXiW: goto lpzvc; QnCBa: bD1vt: goto K94lG; lpzvc: if ($this->isCollected($uid, $subject_id)) { goto bD1vt; } goto Cg8ch; K94lG: } public function isCollected($uid, $subject_id) { return (bool) Db::table("\x73\x75\142\x6a\145\143\x74\137\x63\x6f\154\154\145\143\164")->where(["\x63\165\x73\164\157\155\x65\x72\x5f\151\144" => $uid, "\x73\x75\142\152\x65\x63\x74\137\x69\144" => $subject_id])->value("\151\144"); } public function getCategories() { return Db::table("\143\141\x74\x65\x67\157\x72\x69\x65\x73")->order("\x69\x64\40\x61\x73\x63")->column("\x69\x64\54\156\141\155\x65\54\163\x74\141\x74\165\163\x2c\151\155\147\x5f\165\162\154"); } public function getUnFinishTest($uid, $subject_id, $cb_order_id = 0, $survey_order_id = 0) { goto PU13A; nFko6: xQf2g: goto qjJxr; J0qsA: return null; goto mzhaq; btRea: if ($order && !$order["\x66\x69\156\151\x73\x68\x65\x64"]) { goto xQf2g; } goto J0qsA; qjJxr: return $order; goto Gq49N; SXAyx: $order = Db::table("\x73\165\142\x6a\145\x63\x74\x5f\x6f\x72\144\x65\162")->where($where)->order("\157\x72\x64\145\162\x5f\x74\x69\x6d\x65\40\x64\x65\x73\x63")->find(); goto btRea; Gq49N: WCmSb: goto TVYBg; PU13A: $where = ["\x63\x75\x73\164\x6f\155\x65\162\x5f\151\144" => $uid, "\x73\165\142\x6a\145\x63\164\137\151\144" => $subject_id, "\160\141\x79\137\163\164\x61\164\165\x73" => Defs::PAY_SUCCESS, "\143\x62\x5f\x6f\162\x64\145\162\x5f\151\144" => $cb_order_id, "\x73\x75\x72\166\x65\171\137\157\162\x64\x65\x72\x5f\151\x64" => $survey_order_id]; goto SXAyx; mzhaq: goto WCmSb; goto nFko6; TVYBg: } public function getOrderByNo($order_no, $order_type = "\110\65") { goto r6XtE; bogot: return null; goto Sjf2O; o9aNl: vbFCW: goto MilsA; ETkHU: KNCfc: goto xmL8Q; SgD39: goto dNUi1; goto ETkHU; r6XtE: if (!empty($order_no)) { goto YFBTu; } goto bogot; zwrBX: cg8i2: goto EWfFH; HTTwn: UI4FR: goto wh0XJ; xmL8Q: $row["\x72\x65\160\157\x72\x74\137\x6c\x69\163\x74"] = $result["\x72\x65\x70\x6f\x72\x74\114\151\x73\164"]; goto hi6Nd; zPgOO: if ($row && !empty($row["\162\145\x73\x75\x6c\x74"])) { goto vbFCW; } goto v7vlP; hxF51: $table = Defs::DB_TABLE_DEFS[$order_type]["\157\x72\x64\x65\x72"]; goto zA2UE; zA2UE: $row = Db::table($table)->where(["\x6f\x72\x64\x65\x72\x5f\x6e\157" => $order_no])->field(true)->find(); goto zPgOO; TdpAy: $row["\x72\x65\x70\157\x72\164\137\x6c\x69\x73\164"] = []; goto HTTwn; D1A2a: Log::error("\146\141\151\x6c\145\144\40\164\157\40\144\x65\143\x6f\144\x65\40\x72\x65\x73\x75\x6c\164\40\146\157\x72\x20\163\165\142\152\145\143\164\x20\157\x72\x64\x65\x72\72\40{$order_no}"); goto RkLhb; EWfFH: return $row; goto ez4zC; hi6Nd: dNUi1: goto zwrBX; wh0XJ: goto cg8i2; goto o9aNl; RkLhb: $row["\x72\x65\x70\x6f\x72\164\x5f\x6c\x69\x73\164"] = []; goto SgD39; Bat3d: if ($result && isset($result["\162\x65\160\x6f\x72\164\x4c\151\163\164"])) { goto KNCfc; } goto D1A2a; MilsA: $result = json_decode($row["\x72\145\x73\x75\154\164"], true); goto Bat3d; v7vlP: if (!$row) { goto UI4FR; } goto TdpAy; Sjf2O: YFBTu: goto hxF51; ez4zC: } public function getOrderById($id) { goto vNI0Q; chvZH: return null; goto GIoXs; DvZCf: $row = Db::table("\163\x75\142\152\x65\143\x74\137\x6f\162\x64\145\162")->where(["\151\x64" => $id])->field(true)->find(); goto RPybr; RPybr: if (!($row && !empty($row["\x72\x65\163\165\154\164"]))) { goto dXjx1; } goto dkCAJ; ISD72: if ($result && isset($result["\162\x65\x70\157\162\164\x4c\151\x73\x74"])) { goto HRMKw; } goto jCFze; gC2s8: $row["\162\145\160\157\162\x74\137\x6c\x69\163\164"] = $result["\162\x65\x70\157\x72\x74\x4c\151\163\164"]; goto mMZpX; N9wIN: HRMKw: goto gC2s8; jCFze: Log::error("\x66\x61\151\154\x65\x64\40\164\x6f\x20\x64\145\143\157\144\x65\x20\162\x65\163\x75\154\x74\40\146\x6f\x72\40\x73\x75\x62\152\x65\x63\x74\40\x69\144\72\40{$id}"); goto pqR9M; cGAi9: dXjx1: goto JksZ9; mMZpX: NVWbZ: goto cGAi9; vNI0Q: if (!empty($id)) { goto hp5VE; } goto chvZH; GIoXs: hp5VE: goto DvZCf; pqR9M: $row["\162\x65\x70\157\162\x74\137\154\x69\163\x74"] = []; goto YqYQl; dkCAJ: $result = json_decode($row["\x72\145\163\165\154\164"], true); goto ISD72; YqYQl: goto NVWbZ; goto N9wIN; JksZ9: return $row; goto RKsWN; RKsWN: } public function generateOrder($uid, $subject_id, $channel = Defs::CHANNEL_WX, $cb_order_id = 0, $survey_order_id = 0) { goto CdaQ0; JS5yD: $subject = $this->getSubjectById($subject_id); goto xcgwp; pPOBf: exception("\xe6\265\213\350\257\204\xe9\x87\x8f\350\xa1\xa8\345\214\x85\xe5\220\253\xe7\232\204\351\242\x98\xe7\233\256\xe4\270\xba\xe7\xa9\272"); goto tI2dC; tI2dC: Dn3fO: goto thdcd; Exnvi: Db::table("\x63\x75\x73\164\157\x6d\145\x72")->where(["\151\144" => $uid])->setField("\x6c\x61\164\x65\x73\x74\x5f\x74\145\x73\x74\137\164\x69\x6d\145", Db::raw("\156\157\x77\50\x29")); goto QoXxN; X1f_0: $res = Db::table("\163\x75\142\x6a\x65\143\164\x5f\x6f\x72\x64\145\162")->insert($order); goto x5k7X; BnRgT: exception("\xe6\x95\xb0\xe6\x8d\xae\xe5\272\x93\xe6\226\260\345\242\x9e\xe8\256\242\xe5\x8d\225\345\xbc\x82\xe5\xb8\270"); goto PAnJN; OmFI8: Db::table("\163\x75\x62\x6a\x65\143\x74")->where(["\151\144" => $subject_id])->setInc("\164\157\164\x61\154\x5f\141\x6d\157\165\x6e\x74", $order["\x6f\x72\x64\145\162\137\x61\x6d\x6f\x75\x6e\x74"]); goto zfkXJ; D0KqR: Db::table("\x73\x75\x62\152\x65\x63\x74")->where(["\x69\x64" => $subject_id])->setInc("\160\x61\x72\x74\151\143\x69\160\141\x6e\164\x73\137\x73\x68\157\x77"); goto OmFI8; YFRoJ: if (!intval($survey["\x63\x66\x67\137\146\162\x65\145"])) { goto LikLB; } goto ZyPwc; PAnJN: Mov6u: goto p0HZN; WnuZk: BGdqj: goto YFRoJ; x5k7X: if (!empty($res)) { goto Mov6u; } goto BnRgT; kkROO: $order["\x69\164\145\x6d\x73"] = ''; goto G_5pe; h26W3: exception("\xe5\x8f\202\346\x95\260\xe9\x94\231\350\257\xaf"); goto uinNP; Fhytx: $order["\143\165\x73\164\x6f\155\145\x72\137\151\x64"] = $uid; goto DSO27; tDeoQ: LikLB: goto XVoW5; DSO27: $order["\x73\165\x62\x6a\x65\143\164\x5f\151\144"] = $subject_id; goto DBzAt; uia9q: Db::table("\143\165\163\x74\157\x6d\x65\x72")->where(["\x69\144" => $uid])->setInc("\164\157\164\x61\x6c\137\164\x65\x73\x74\x5f\141\155\x6f\x75\x6e\x74", $order["\x6f\162\144\x65\x72\137\141\155\157\165\x6e\164"]); goto Exnvi; HaEqd: zp6G3: goto Qx2N2; b3vMZ: $order["\157\162\x64\145\162\137\x6e\157"] = generateSequenceNo($uid, Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\123"); goto Fhytx; gjyuH: $order["\143\142\137\157\x72\144\145\x72\137\151\144"] = intval($cb_order_id); goto BkDfy; BkDfy: $order["\163\x75\x72\x76\145\x79\x5f\157\x72\144\x65\x72\137\x69\x64"] = intval($survey_order_id); goto B9nIs; D3RDp: exception("\346\xb5\213\350\257\204\xe4\xb8\215\xe5\255\230\xe5\234\250"); goto HaEqd; vi9E3: $order["\x70\x61\x79\x5f\163\164\141\x74\x75\x73"] = $order["\157\x72\x64\145\162\x5f\141\155\157\x75\x6e\164"] > 0 ? Defs::PAY_WAIT : Defs::PAY_SUCCESS; goto LcxZ4; CdaQ0: if (!(empty($uid) || empty($subject_id))) { goto wsw_O; } goto h26W3; siGpk: $survey = Db::table("\163\165\x72\x76\145\x79\137\157\x72\x64\x65\162")->alias("\x4f")->join("\x73\x75\x72\166\145\x79\x20\123", "\x4f\x2e\163\x75\162\x76\145\x79\137\151\144\75\123\x2e\x69\144")->where("\x4f\56\x69\144", $survey_order_id)->field("\x53\56\x2a")->find(); goto h0fny; p0HZN: Db::table("\163\165\142\x6a\145\x63\164")->where(["\x69\144" => $subject_id])->setInc("\x70\x61\x72\x74\x69\143\x69\x70\141\x6e\x74\x73"); goto D0KqR; ZyPwc: $orderAmount = 0; goto tDeoQ; DBzAt: $order["\x63\x68\141\x6e\x6e\145\x6c\137\151\x64"] = intval($channel); goto gjyuH; JYSnR: if (!$survey_order_id) { goto FDTwu; } goto siGpk; h0fny: if (!empty($survey)) { goto BGdqj; } goto ylIc2; G_5pe: $order["\x6f\x72\x64\145\162\137\x61\155\157\165\156\164"] = $orderAmount; goto vi9E3; QoXxN: return $order; goto HcTxI; xcgwp: if (!empty($subject)) { goto zp6G3; } goto D3RDp; XVoW5: FDTwu: goto oJOHA; thdcd: $orderAmount = $subject["\143\x75\x72\162\x65\156\x74\137\160\x72\x69\143\145"]; goto JYSnR; Qx2N2: if (!(empty($subject["\143\165\163\x74\x6f\155\137\x74\x65\163\164"]) && $subject["\x69\x74\x65\155\163"] == 0)) { goto Dn3fO; } goto pPOBf; uinNP: wsw_O: goto JS5yD; zfkXJ: Db::table("\143\x75\x73\x74\x6f\155\x65\x72")->where(["\151\x64" => $uid])->setInc("\x74\x6f\x74\141\154\x5f\x74\145\x73\x74\137\161\165\141\x6e\x74\151\x74\171"); goto uia9q; ylIc2: exception("\346\x99\256\xe6\x9f\245\346\265\213\xe8\xaf\225\350\xae\242\xe5\215\225\344\xb8\x8d\345\xad\x98\xe5\x9c\250"); goto WnuZk; B9nIs: $order["\164\x6f\164\141\x6c\137\x69\164\x65\x6d\x73"] = $subject["\151\164\x65\155\x73"]; goto kkROO; LcxZ4: $order["\x69\164\x65\155\x5f\166\145\162\x73\x69\x6f\156"] = $subject["\151\164\145\155\137\x76\145\162\163\x69\x6f\x6e"]; goto vBUVb; vBUVb: $order["\161\x75\x65\x73\x74\151\157\156\137\x66\x6f\x72\x6d"] = $subject["\161\165\145\x73\x74\151\x6f\x6e\x5f\x66\x6f\162\155"]; goto X1f_0; oJOHA: $order = []; goto b3vMZ; HcTxI: } public function regenerateOrder($order_no) { goto DOjfv; AmfTD: $order["\x74\145\163\164\x5f\x69\x74\x65\155\x73"] = 0; goto xgKHk; hJsd8: $order["\151\164\x65\x6d\x5f\166\x65\162\163\x69\x6f\x6e"] = $subject["\151\x74\x65\155\x5f\x76\x65\162\163\151\157\156"]; goto zCy_T; cXZl6: $order["\162\145\x73\x75\x6c\x74"] = null; goto v5XUl; GwAZ7: Wt6SB: goto Ea9Tw; gTadh: $subject = $this->getSubjectById($subject_id); goto t76Cv; v6HKo: axj8K: goto df3PN; xgKHk: $order["\143\165\x72\162\x5f\151\164\x65\x6d"] = 0; goto dsqgq; df3PN: $subject_id = $order["\x73\x75\x62\152\145\143\164\137\151\x64"]; goto gTadh; zCy_T: Db::table("\163\165\x62\152\x65\x63\x74\137\157\162\x64\x65\162")->where("\157\x72\x64\x65\162\137\156\157", $order_no)->update($order); goto z_YBz; EL7hJ: if ($order) { goto axj8K; } goto Ou_Lb; Ea9Tw: $order = []; goto ebfx4; ebfx4: $order["\164\x6f\x74\141\x6c\x5f\151\x74\x65\x6d\163"] = $subject["\x69\x74\x65\155\163"]; goto AmfTD; f2zK8: $order["\x71\165\145\x73\x74\151\157\156\137\141\156\x73\x77\145\162"] = ''; goto hJsd8; cfR66: exception("\xe6\265\213\xe8\257\x84\xe4\270\215\345\xad\x98\345\x9c\xa8"); goto GwAZ7; t76Cv: if (!empty($subject)) { goto Wt6SB; } goto cfR66; DOjfv: $order = $this->getOrderByNo($order_no); goto EL7hJ; dsqgq: $order["\x69\x74\x65\155\x73"] = ''; goto cXZl6; Ou_Lb: exception("\xe6\227\240\xe6\xb3\225\xe6\211\276\345\210\260\350\257\xa5\xe8\256\xa2\xe5\215\225"); goto v6HKo; v5XUl: $order["\x66\151\x6e\x69\163\150\145\x64"] = 0; goto Od4Fa; Od4Fa: $order["\161\x75\x65\163\164\x69\157\x6e\137\x66\157\162\x6d"] = $subject["\x71\x75\145\163\164\151\157\x6e\x5f\146\157\162\x6d"]; goto f2zK8; z_YBz: } public function refreshOrderNo($customerId, $orderNo) { goto Vqj9l; ibdW2: Db::table("\x73\165\x62\x6a\145\143\x74\x5f\157\162\x64\145\x72")->where(["\x63\x75\163\164\x6f\x6d\145\x72\137\151\x64" => $customerId, "\x6f\x72\x64\145\162\x5f\156\x6f" => $orderNo])->setField("\157\162\x64\x65\162\137\x6e\x6f", $orderNoNew); goto CXwwm; MovSA: $orderNoNew = generateSequenceNo($customerId, Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\123"); goto ibdW2; JsiSw: qg9AT: goto MovSA; CXwwm: return $orderNoNew; goto Xx7ay; Vqj9l: $infos = Db::table("\x73\165\x62\152\145\x63\164\137\x6f\162\x64\x65\x72")->where(["\x63\x75\x73\164\157\155\x65\x72\x5f\x69\144" => $customerId, "\x6f\162\144\145\162\x5f\156\157" => $orderNo])->find(); goto hZ2yH; YXNrR: return false; goto JsiSw; hZ2yH: if ($infos) { goto qg9AT; } goto YXNrR; Xx7ay: } public function refreshOrderNoById($customerId, $id) { goto zV31G; iUbsy: if ($infos) { goto pWfzd; } goto m6i3R; zV31G: $infos = Db::table("\x73\165\x62\152\x65\x63\x74\x5f\x6f\162\144\x65\x72")->where(["\151\x64" => $id])->find(); goto iUbsy; m6i3R: return false; goto nplpE; nplpE: pWfzd: goto btIJb; TRJpZ: return $orderNoNew; goto eryU9; Zzhlq: Db::table("\163\165\142\x6a\145\x63\164\x5f\157\162\144\145\x72")->where(["\151\144" => $id])->setField("\x6f\x72\144\x65\162\x5f\156\157", $orderNoNew); goto TRJpZ; btIJb: $orderNoNew = generateSequenceNo($customerId, Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\x53"); goto Zzhlq; eryU9: } public function paySuccessOrder($order_no) { goto nTVFH; nTVFH: $order = $this->getOrderByNo($order_no); goto xUQHU; vlB8T: tpUHH: goto IwsjP; IwsjP: Db::table("\x73\x75\142\152\x65\143\164\x5f\157\x72\144\145\x72")->where(["\157\x72\144\145\162\x5f\156\157" => $order_no])->update(["\156\157\164\x69\146\171\x5f\164\x69\x6d\145" => date("\131\55\x6d\55\x64\40\110\x3a\x69\x3a\x73"), "\160\x61\x79\137\x73\x74\x61\x74\x75\x73" => Defs::PAY_SUCCESS]); goto OD66Q; W1hMN: exception("\350\256\xa2\xe5\x8d\225\344\xb8\215\345\xad\x98\xe5\x9c\xa8\xef\xbc\232" . $order_no); goto vlB8T; xUQHU: if (!empty($order)) { goto tpUHH; } goto W1hMN; OD66Q: } public function getSubjectItems($subject_id) { goto u8lC6; Lr3fe: return $items; goto jaaQr; xDDUU: SI21P: goto Lr3fe; ulAK2: foreach ($rows as $k => $v) { goto NtbM_; TmddN: ZBuG7: goto u4xpY; mzAkY: $v["\156\145\170\x74\x5f\151\x64"] = intval($nextId); goto dZuRW; vt9Fk: if (empty($v["\157\x70\164\151\157\156\x5f" . $i])) { goto OzAsH; } goto Visrb; rV2o0: $nextId = 0; goto eQZoJ; teiph: $nextId = $rows[$k + 1]["\x69\144"]; goto nOj3E; KPaMO: $v["\x70\162\145\x76\137\x69\144"] = intval($prevId); goto mzAkY; u4xpY: $items[$v["\151\x64"]] = $v; goto dUvJd; Y_afa: goto iqlM_; goto TmddN; dUvJd: B8suT: goto Eqy06; Visrb: $v["\x6f\160\164\151\157\x6e\x5f" . $i] = nl2br($v["\x6f\160\x74\x69\x6f\156\137" . $i]); goto eRCJq; pe0jE: iqlM_: goto bDvgS; VitDK: $i = 1; goto pe0jE; suQC6: $i++; goto Y_afa; eQZoJ: if (!($k < count($rows) - 1)) { goto NnEGF; } goto teiph; aGt0V: $prevId = $rows[$k - 1]["\151\144"]; goto KiARV; OsX6i: if (!($k > 0)) { goto clNdn; } goto aGt0V; dZuRW: $v["\151\164\145\x6d"] = nl2br($v["\x69\164\145\155"]); goto VitDK; NtbM_: $prevId = 0; goto OsX6i; eRCJq: OzAsH: goto suQC6; KiARV: clNdn: goto rV2o0; bDvgS: if (!($i <= 12)) { goto ZBuG7; } goto vt9Fk; nOj3E: NnEGF: goto KPaMO; Eqy06: } goto xDDUU; jgSVL: $items = []; goto ulAK2; o6LzW: return []; goto jCp5X; jCp5X: Yj_8E: goto jgSVL; u8lC6: $rows = Db::table("\163\165\x62\152\145\143\x74\x5f\151\164\x65\155")->where(["\x73\x75\142\x6a\145\143\164\x5f\x69\x64" => $subject_id])->field(true)->order("\x73\x6f\x72\164\40\141\x73\x63\54\40\151\x64\40\x61\163\x63")->select(); goto YPm9U; YPm9U: if (!empty($rows)) { goto Yj_8E; } goto o6LzW; jaaQr: } public function getSubjectItem($item_id) { goto L8Afu; laa2L: $row["\160\x72\145\166\x5f\151\x64"] = $itemIds[$targetKey - 1]; goto HAKJ4; hc4p4: if (!($targetKey < count($itemIds) - 1)) { goto X9iJT; } goto V0QTV; u0Kcb: n5Feo: goto sigEB; IzHkD: $targetKey = array_search($item_id, $itemIds); goto kGzKg; MywJc: if (!($targetKey > 0)) { goto e1pe9; } goto laa2L; HAKJ4: e1pe9: goto hc4p4; oDOI_: X9iJT: goto SjeR5; TVPOl: if (!$row) { goto n5Feo; } goto dCdfb; wWM2S: $row["\160\x72\145\x76\137\x69\144"] = 0; goto ZSGTE; V0QTV: $row["\156\145\170\164\137\151\144"] = $itemIds[$targetKey + 1]; goto oDOI_; sigEB: return $row; goto fBf53; L8Afu: $row = Db::table("\163\x75\142\x6a\145\143\164\x5f\151\x74\x65\155")->where(["\151\144" => $item_id])->field(true)->find(); goto TVPOl; kGzKg: if (!($targetKey !== false)) { goto B0yev; } goto MywJc; ZSGTE: $row["\156\145\x78\x74\x5f\151\x64"] = 0; goto IzHkD; SjeR5: B0yev: goto u0Kcb; dCdfb: $itemIds = Db::table("\163\x75\x62\152\x65\x63\164\137\151\x74\x65\155")->where(["\163\x75\142\x6a\x65\x63\x74\137\x69\144" => $row["\x73\x75\x62\x6a\x65\143\x74\137\151\144"]])->order("\x73\x6f\162\x74\40\141\x73\143\x2c\40\x69\144\40\141\163\143")->column("\x69\x64"); goto wWM2S; fBf53: } public function answerItem($order_no, $item_id, $item_type, $item_option, $order_type = "\110\65") { goto Q66b5; eNILD: if (empty($order["\143\142\x5f\157\162\x64\x65\162\x5f\151\x64"])) { goto TtWm3; } goto PFEoC; cPJqS: if (!empty($item["\156\145\170\x74\137\x69\144"])) { goto RzrGf; } goto HgvX2; HmIj4: $order["\x74\145\x73\x74\x5f\x61\154\154\x6f\x77\137\166\x69\145\x77\137\162\x65\x70\x6f\162\164"] = $subject["\164\145\x73\x74\137\141\154\x6c\157\x77\x5f\166\151\x65\167\137\162\x65\160\157\162\164"]; goto hTsko; Q66b5: if (!(empty($order_no) || empty($item_id) || empty($item_type))) { goto Mg6oD; } goto qK8PF; oPBtk: yhCDN: goto fCRac; VTZth: iP_Wm: goto mc5vL; GjTR3: exception("\350\xaf\x84\xe6\xb5\213\xe9\242\230\xe7\x9b\256\344\xb8\x8d\xe5\255\230\345\234\xa8\xef\xbc\232" . $item_id); goto S6Riv; qWM0i: aqAkG: goto xCpPG; L67Rt: $update["\x69\164\x65\x6d\x73"] = join("\54", $answer); goto cPJqS; Co95R: $item = $this->getSubjectItem($item_id); goto ZBgt9; NarEl: $update["\x72\145\163\165\154\164"] = json_encode(["\162\145\160\x6f\x72\x74\x4c\x69\163\x74" => $result], JSON_UNESCAPED_UNICODE); goto eNILD; S6Riv: iTXqE: goto Tza_m; FrjlS: $result = SubjectLogic::I()->generateTestResult($order["\163\165\x62\152\x65\x63\164\x5f\151\x64"], $this->parseOrderItems($update["\x69\164\145\x6d\x73"])); goto kzz2J; bp2iE: $answer[$item_id] = $item_id . "\46" . $item_type . "\46" . $item_option; goto L67Rt; xiglO: Xc_uQ: goto Vi6I7; tIlRq: $orderTable = Defs::DB_TABLE_DEFS[$order_type]["\157\x72\144\x65\x72"]; goto bBgrF; jGSOe: if ($item_type == Defs::QUESTION_TEXT) { goto Xc_uQ; } goto DGArl; r4d41: $order = $this->getOrderByNo($order_no, $order_type); goto cBzBY; Psr8A: $this->updateSurveyOrderStatus($order["\x73\x75\162\166\x65\171\137\x6f\x72\x64\x65\x72\x5f\151\144"], $order["\163\x75\x62\x6a\145\x63\x74\137\x69\x64"]); goto N0Y8e; A3WUg: FsyOV: goto MqL_v; lO9ya: fO1MO: goto ABbdp; xkDm3: dsGpf: goto Co95R; kzz2J: $update["\x77\x61\162\156\x69\156\x67\x5f\154\145\166\x65\154"] = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto rvn5Y; EApEc: $update["\x63\x75\162\162\x5f\x69\x74\x65\155"] = $item_id; goto KINZk; pU62M: $update["\164\145\163\x74\137\151\x74\145\155\163"] = 1; goto FoXWY; G9kHC: FBJu2: goto x1W54; QRDKi: if (!empty($item_option)) { goto aqAkG; } goto alvZl; alvZl: $item_option = []; goto qWM0i; bBgrF: Db::table($orderTable)->where(["\x6f\162\x64\145\162\137\156\x6f" => $order_no])->update($update); goto HmIj4; ZBgt9: if (!empty($item)) { goto iTXqE; } goto GjTR3; qK8PF: exception("\347\xbc\xba\345\xb0\221\345\x8f\202\xe6\225\260"); goto nrMpJ; PFEoC: $this->updateCombinationOrderStatus($order["\143\142\x5f\157\162\x64\145\162\137\151\x64"], $order["\x73\x75\x62\x6a\145\x63\164\137\151\144"]); goto b5hij; Vi6I7: $item_option = htmlspecialchars_decode($item_option); goto kuMnG; db7S7: pcn2B: goto bp2iE; Jt0Vl: RzrGf: goto tIlRq; nrMpJ: Mg6oD: goto r4d41; wKUde: exception("\350\xaf\204\346\265\213\351\207\217\350\xa1\250\344\xb8\x8d\xe5\255\230\345\x9c\xa8\357\274\232" . $order_no); goto oPBtk; lT3qC: qfQ4m: goto pU62M; K0nkF: exception("\346\265\213\xe8\257\204\351\241\271\xe7\x9b\256\xe7\x89\x88\346\x9c\254\345\x8f\x91\347\224\237\344\272\x86\345\x8f\230\xe6\x9b\xb4\357\xbc\214\351\234\200\350\xa6\201\351\207\215\xe6\226\260\xe6\xb5\x8b\350\xaf\x84", -1); goto xkDm3; vAVEj: if (!empty($subject)) { goto yhCDN; } goto wKUde; xBtWM: if (empty($order["\x73\x75\162\x76\145\171\x5f\157\x72\x64\145\x72\137\151\144"])) { goto F5fqZ; } goto Psr8A; rvn5Y: array_walk($result, function ($item) use(&$update) { goto ConZ0; cw3cM: XvGHf: goto DSE7n; zu9rW: return; goto cw3cM; ConZ0: if (isset($item["\x77\x61\162\156\x69\x6e\147\137\x6c\x65\x76\145\x6c"])) { goto XvGHf; } goto zu9rW; DSE7n: if (!($item["\167\x61\162\x6e\151\x6e\x67\x5f\154\x65\x76\x65\x6c"] > $update["\167\141\162\x6e\151\156\147\137\154\145\166\x65\x6c"])) { goto cGkVu; } goto mXSl4; mXSl4: $update["\x77\x61\162\156\151\156\x67\x5f\x6c\x65\166\145\x6c"] = $item["\x77\141\162\156\151\156\x67\137\x6c\x65\166\x65\154"]; goto RQRvV; RQRvV: cGkVu: goto K69yY; K69yY: }); goto NarEl; x1W54: if (!$order["\146\x69\156\x69\x73\x68\145\144"]) { goto FsyOV; } goto PSTHs; KINZk: $answer = []; goto pMhzD; N0Y8e: F5fqZ: goto Jt0Vl; hTsko: return array_merge($order, $update); goto PnbG_; pMhzD: if ($order["\x74\145\163\164\137\151\x74\x65\155\x73"] == "\60") { goto qfQ4m; } goto nvLQQ; YPlKb: $item_option = str_replace("\x26", "\x20", $item_option); goto u0I1f; PSTHs: exception("\346\xb5\x8b\350\xaf\204\345\267\262\345\xae\x8c\xe6\x88\x90"); goto A3WUg; cBzBY: if (!empty($order)) { goto FBJu2; } goto X8a8K; D5PQN: foreach ($itemExists as $itemExist) { goto KZI_o; KZI_o: $itemIdExist = explode("\x26", $itemExist)[0]; goto C_r3e; fjYpe: EF3UJ: goto Pk3pn; oJWwL: TIMYk: goto VsqXP; C_r3e: if (!($itemIdExist == $item_id)) { goto EF3UJ; } goto Y7tI2; Pk3pn: $answer[$itemIdExist] = $itemExist; goto oJWwL; Y7tI2: goto iP_Wm; goto fjYpe; VsqXP: } goto VTZth; b5hij: TtWm3: goto xBtWM; MqL_v: $subject = $this->getSubjectById($order["\x73\x75\142\x6a\x65\x63\x74\137\151\144"]); goto vAVEj; FoXWY: lJbsr: goto jGSOe; mc5vL: $update["\164\145\x73\164\x5f\151\164\145\x6d\x73"] = count($answer) + 1; goto eNKFI; nvLQQ: $itemExists = explode("\54", $order["\151\164\x65\x6d\163"]); goto D5PQN; fCRac: if (!($order["\x69\x74\145\x6d\137\x76\145\x72\163\x69\157\156"] != $subject["\151\x74\x65\155\x5f\x76\x65\x72\x73\151\157\156"])) { goto dsGpf; } goto K0nkF; DGArl: if (!($item_type == Defs::QUESTION_CHECKBOX)) { goto fO1MO; } goto QRDKi; HgvX2: $update["\x66\x69\x6e\x69\163\150\x65\144"] = 1; goto lHbEp; xCpPG: $item_option = join("\x2d", $item_option); goto lO9ya; lHbEp: $update["\146\151\x6e\x69\163\150\137\164\x69\155\145"] = date("\x59\55\155\x2d\x64\x20\x48\x3a\151\x3a\163"); goto FrjlS; u0I1f: $item_option = htmlspecialchars($item_option); goto db7S7; X8a8K: exception("\350\257\x84\xe6\xb5\x8b\xe8\xae\242\345\x8d\225\344\xb8\x8d\xe5\xad\230\345\x9c\250\357\274\x9a" . $order_no); goto G9kHC; kuMnG: $item_option = str_replace("\54", "\73", $item_option); goto YPlKb; ABbdp: goto pcn2B; goto xiglO; eNKFI: goto lJbsr; goto lT3qC; Tza_m: $update = []; goto EApEc; PnbG_: } public function answerCustomItem($order_no, $custom_data, $order_type = "\x48\65") { goto EIPcA; k4Nah: if (!$order["\146\151\156\151\163\x68\145\x64"]) { goto zUHJT; } goto LoIcF; Tc5Yp: ITFSP: goto J7H0y; pCCG9: v6M1K: goto k4Nah; acsec: $update["\146\151\156\x69\x73\x68\137\164\151\x6d\145"] = date("\x59\x2d\x6d\55\x64\x20\110\x3a\x69\72\163"); goto mCi6I; MZtLi: KlrP1: goto kzhaU; oqphs: if (empty($order["\x73\x75\x72\166\145\171\x5f\x6f\162\x64\x65\x72\x5f\x69\x64"])) { goto KlrP1; } goto xHeOg; HdmrL: list($class, $method) = explode("\72", $subject["\143\x75\163\164\x6f\x6d\x5f\141\x6e\x73\167\145\x72"]); goto leVQe; LU23S: KKZlU: goto a6iyj; G9lIJ: zUHJT: goto Hc4xy; cY6wk: if (!empty($nextData)) { goto ITFSP; } goto pyrpL; mCi6I: if (empty($order["\x63\x62\137\x6f\162\x64\145\162\137\151\144"])) { goto jHu_l; } goto KyPks; leVQe: try { $nextData = call_user_func([new $class(), $method], $order_no, $order_type, $custom_data); } catch (\Exception $e) { exception("\xe5\xae\x9a\345\210\xb6\xe5\x9b\x9e\xe7\255\224\345\274\x82\345\270\xb8\xef\xbc\214\x6d\x73\147\72\40" . $e->getMessage()); } goto cY6wk; Hc4xy: $subject = $this->getSubjectById($order["\163\165\142\x6a\145\143\164\137\x69\144"]); goto wGp65; wGp65: if (!empty($subject)) { goto EjiXa; } goto YmQOa; pyrpL: $update = []; goto Azdth; J7H0y: $order = $this->getOrderByNo($order_no, $order_type); goto D248k; XwtVe: exception("\xe6\xb5\x8b\350\xaf\x84\xe9\xa1\xb9\347\233\256\xe7\x89\x88\346\x9c\254\xe5\217\221\xe7\224\x9f\xe4\272\x86\xe5\x8f\x98\346\x9b\264\357\xbc\x8c\351\x9c\200\350\246\201\351\x87\215\xe6\226\260\xe6\xb5\213\xe8\xaf\204", -1); goto UMc3F; lkaHW: if (!empty($subject["\143\165\163\164\157\155\137\x61\156\x73\167\x65\162"])) { goto KKZlU; } goto J06t7; a6iyj: if (SubjectLogic::I()->checkReportAlgo($subject)) { goto ADHBZ; } goto F0zf3; SSncp: jHu_l: goto oqphs; bJHg6: exception("\xe8\257\204\346\265\213\350\xae\xa2\xe5\215\x95\344\xb8\215\345\255\x98\345\234\250\xef\xbc\232" . $order_no); goto pCCG9; UMc3F: jtLCn: goto lkaHW; EIPcA: $order = $this->getOrderByNo($order_no, $order_type); goto ljbfq; kzhaU: $orderTable = Defs::DB_TABLE_DEFS[$order_type]["\x6f\162\x64\x65\x72"]; goto oXx0N; oXx0N: Db::table($orderTable)->where(["\157\162\x64\145\x72\137\x6e\157" => $order_no])->update($update); goto Tc5Yp; D248k: $order["\x74\145\x73\164\x5f\x61\x6c\154\x6f\x77\x5f\166\151\x65\x77\137\x72\145\x70\157\x72\x74"] = $subject["\x74\x65\163\164\137\141\x6c\154\157\x77\137\x76\x69\145\167\x5f\162\x65\160\x6f\162\164"]; goto ON4MR; Azdth: $update["\x66\151\x6e\151\x73\150\x65\144"] = 1; goto acsec; KYiuE: ADHBZ: goto HdmrL; LoIcF: exception("\346\xb5\x8b\350\xaf\x84\xe5\267\xb2\xe5\xae\214\346\210\220"); goto G9lIJ; YmQOa: exception("\350\xaf\x84\346\xb5\213\xe9\x87\x8f\350\xa1\250\344\xb8\x8d\345\xad\230\345\x9c\xa8\357\274\232" . $order_no); goto YWFjd; xHeOg: $this->updateSurveyOrderStatus($order["\163\x75\x72\x76\x65\x79\x5f\157\162\x64\145\x72\x5f\151\x64"], $order["\163\x75\142\x6a\x65\143\x74\137\151\x64"]); goto MZtLi; J06t7: exception("\xe6\227\240\xe6\263\x95\xe6\211\xbe\xe5\x88\xb0\xe5\xae\x9a\345\x88\xb6\345\214\226\xe6\xb5\213\xe8\xaf\x84\xe7\255\224\351\242\230"); goto LU23S; F0zf3: exception("\xe4\xb8\252\xe6\200\247\345\x8c\x96\xe6\xb5\x8b\350\xaf\x84\350\xb5\204\xe6\x96\231\xe7\xbc\xba\xe5\xa4\261\xef\274\232" . $order_no); goto KYiuE; KyPks: $this->updateCombinationOrderStatus($order["\x63\142\137\157\162\x64\145\x72\137\x69\x64"], $order["\x73\165\142\x6a\145\x63\x74\137\151\x64"]); goto SSncp; YWFjd: EjiXa: goto GGbov; ljbfq: if (!empty($order)) { goto v6M1K; } goto bJHg6; GGbov: if (!($order["\151\x74\145\x6d\137\x76\x65\162\163\x69\x6f\156"] != $subject["\151\x74\145\x6d\x5f\x76\145\162\163\151\157\156"])) { goto jtLCn; } goto XwtVe; ON4MR: return [$order, $nextData]; goto Z_fkP; Z_fkP: } public function getSubjectStandards($subject_id) { $rows = Db::table("\x73\165\142\x6a\x65\143\164\x5f\163\x74\141\156\144\141\x72\x64")->where(["\x73\165\142\x6a\145\143\164\x5f\x69\144" => $subject_id])->field(true)->order("\163\157\162\164\40\141\163\x63\x2c\x20\x69\x64\40\x61\163\143")->select(); return $rows; } public function getStandardLatitude($subject_id) { goto rKkpo; uMRLs: return $rows; goto RTMy_; rKkpo: $rows = Db::table("\163\x75\x62\x6a\145\143\x74\137\163\164\141\x6e\x64\x61\162\144\137\154\x61\164\151\164\x75\x64\145")->where(["\163\165\x62\152\x65\143\x74\137\x69\x64" => $subject_id])->field(true)->order("\151\144\40\x61\163\x63")->select(); goto DqC9v; c7rMM: yMceX: goto uMRLs; DqC9v: if (!empty($rows)) { goto yMceX; } goto conGX; conGX: $rows = []; goto c7rMM; RTMy_: } public function parseOrderItems($items) { goto uuQDH; UgSbj: Dn5uB: goto aa0m8; XwbAk: return []; goto UgSbj; aa0m8: $parsed = []; goto pcJIh; MkaTK: return $parsed; goto JPj29; pcJIh: foreach ($items as $k => $v) { goto OkER2; vh8iz: amlBr: goto X64pi; KjF04: if (!(count($sections) != 3)) { goto vKM1f; } goto Ou8kQ; X64pi: c59D0: goto LMmmn; If9P5: oQfPI: goto wM2p6; oJuV1: if (empty($optionValue)) { goto NG9Ss; } goto Ppgcz; hLX_N: $parsed[$itemId] = ["\x74\x79\160\x65" => $itemType, "\x76\x61\154\x75\x65" => []]; goto uTCKB; dKTKH: NG9Ss: goto hLX_N; SV8Jq: goto hns4o; goto dKTKH; zL9Ut: $parsed[$itemId] = ["\x74\x79\x70\x65" => $itemType, "\x76\141\x6c\165\145" => $optionValue]; goto cflQD; hkAjw: $itemType = $sections[1]; goto Px_iG; zpt_m: mcoXa: goto oJuV1; Ou8kQ: goto c59D0; goto nxxl_; cflQD: goto amlBr; goto zpt_m; Ppgcz: $parsed[$itemId] = ["\x74\171\x70\145" => $itemType, "\x76\x61\x6c\x75\145" => explode("\x2d", $optionValue)]; goto SV8Jq; OkER2: $sections = explode("\46", $v); goto KjF04; Px_iG: $optionValue = $sections[2]; goto Zk0JF; uTCKB: hns4o: goto vh8iz; Nwdtg: if (!(empty($sections[0]) || empty($sections[1]) || empty($sections[2]))) { goto oQfPI; } goto fqGvn; wM2p6: $itemId = $sections[0]; goto hkAjw; Zk0JF: if ($itemType == Defs::QUESTION_CHECKBOX) { goto mcoXa; } goto zL9Ut; fqGvn: goto c59D0; goto If9P5; nxxl_: vKM1f: goto Nwdtg; LMmmn: } goto iJ0YN; Intto: if (!empty($items)) { goto Dn5uB; } goto XwbAk; iJ0YN: YlqbR: goto MkaTK; uuQDH: $items = explode("\54", $items); goto Intto; JPj29: } public function cleanSubject($subject_id) { goto k_CiU; AaesQ: Db::table("\x73\165\142\152\145\143\x74\x5f\x73\x74\x61\x6e\144\141\162\x64")->where(["\163\165\142\152\x65\x63\164\137\x69\144" => $subject_id])->delete(); goto mtlKb; C2rr0: Db::table("\163\x75\x62\x6a\x65\143\x74\x5f\151\164\x65\x6d")->where(["\x73\165\x62\x6a\x65\143\x74\137\x69\144" => $subject_id])->delete(); goto vr_Z5; mtlKb: Db::table("\163\x75\x62\x6a\x65\143\x74\137\163\x74\x61\x6e\x64\141\162\x64\137\x6c\x61\x74\x69\164\x75\144\145")->where(["\163\x75\142\x6a\x65\x63\164\x5f\151\144" => $subject_id])->delete(); goto FEfH6; vr_Z5: Db::table("\163\x75\142\152\x65\143\164\137\x69\x74\x65\155\x5f\x73\164\141\156\x64\141\x72\x64")->where(["\163\x75\x62\152\x65\x63\164\137\151\x64" => $subject_id])->delete(); goto AaesQ; k_CiU: Db::table("\163\165\x62\152\145\x63\164")->where(["\x69\x64" => $subject_id])->delete(); goto C2rr0; FEfH6: } public function getCombinationOrderInfo($order_id) { goto FEgmk; CPshX: $row["\144\x61\x74\141"] = json_decode($row["\144\x61\x74\x61"], true); goto ztZdq; MwMfO: return false; goto e_42H; ztZdq: $row["\156\145\170\164\x5f\x74\x65\x73\x74\137\x69\144"] = 0; goto lPCJh; cyfzE: foreach ($row["\144\x61\x74\x61"] as $sid => $finished) { goto WeCDG; ORKjf: goto eCfpE; goto VJuY1; UPqOw: $row["\156\x65\170\164\137\x74\x65\163\x74\137\151\x64"] = $sid; goto ORKjf; VJuY1: tDKPd: goto qVyQO; WeCDG: if (!empty($finished)) { goto tDKPd; } goto UPqOw; qVyQO: qRUsW: goto aGYfW; aGYfW: } goto cy3tS; lPCJh: if (!($row["\146\x69\x6e\151\x73\150\x65\x64"] == 0)) { goto og4As; } goto cyfzE; QAMWs: og4As: goto vpFTi; FEgmk: $row = Db::table("\x63\157\155\142\151\156\x61\x74\x69\x6f\156\x5f\x6f\162\x64\x65\162")->where("\151\x64", $order_id)->find(); goto lCmNo; vpFTi: return $row; goto yYY2F; cy3tS: eCfpE: goto QAMWs; e_42H: Fggbl: goto CPshX; lCmNo: if (!empty($row)) { goto Fggbl; } goto MwMfO; yYY2F: } public function getSurveyOrderInfo($order_id) { goto Rdqf_; BLygn: if (!($row["\146\x69\156\x69\163\150\145\144"] == 0)) { goto Nowur; } goto fJOm2; nxc9i: Nowur: goto L0lau; kko3n: yNjKU: goto Z1eE8; dznIp: return false; goto kko3n; XJQyX: CqAR0: goto nxc9i; L0lau: return $row; goto DCYc0; tAYhx: $row["\x6e\x65\170\164\137\x74\145\x73\x74\137\x69\x64"] = 0; goto BLygn; UFhW4: if (!empty($row)) { goto yNjKU; } goto dznIp; Rdqf_: $row = Db::table("\163\165\162\x76\x65\x79\137\157\162\144\x65\162")->where("\x69\x64", $order_id)->find(); goto UFhW4; Z1eE8: $row["\144\x61\x74\141"] = json_decode($row["\x64\141\x74\141"], true); goto tAYhx; fJOm2: foreach ($row["\144\141\164\x61"] as $sid => $finished) { goto x4eZI; knA5p: $row["\x6e\145\170\x74\x5f\x74\x65\x73\x74\x5f\151\x64"] = $sid; goto YeIkm; x4eZI: if (!empty($finished)) { goto WjJ5q; } goto knA5p; YeIkm: goto CqAR0; goto OoIwN; G0Fas: k2aKd: goto ZZUyI; OoIwN: WjJ5q: goto G0Fas; ZZUyI: } goto XJQyX; DCYc0: } public function updateCombinationOrderStatus($order_id, $subject_id) { goto yTqWe; OOBMq: $row["\x66\151\156\x69\163\x68\x65\x64"] = 1; goto i_CGg; dPqo2: return false; goto ju3Ik; mMs1_: if (!empty($row)) { goto g1gf2; } goto dPqo2; DyDqd: return true; goto E16mN; T12Ks: if (!empty($ing)) { goto ml0Jf; } goto OOBMq; i_CGg: ml0Jf: goto RguI1; ju3Ik: g1gf2: goto jceRh; RguI1: Db::table("\143\157\x6d\142\151\156\141\x74\151\x6f\x6e\x5f\157\x72\x64\x65\162")->where("\151\x64", $order_id)->update(["\144\x61\x74\141" => json_encode($row["\144\x61\164\x61"]), "\x66\x69\156\151\x73\x68\x65\144" => $row["\x66\151\x6e\151\x73\x68\x65\144"]]); goto DyDqd; yTqWe: $row = $this->getCombinationOrderInfo($order_id); goto mMs1_; S5Vf2: $ing = array_filter($row["\144\141\164\x61"], function ($finished) { return $finished == 0; }); goto T12Ks; jceRh: $row["\x64\x61\164\141"][$subject_id] = 1; goto S5Vf2; E16mN: } public function updateSurveyOrderStatus($order_id, $subject_id) { goto Uvh4b; Uvh4b: $row = $this->getSurveyOrderInfo($order_id); goto g8Nac; AZtM8: return true; goto U4LVW; wyZ2l: Db::table("\163\x75\162\x76\145\171\137\157\162\144\x65\162")->where("\x69\144", $order_id)->update(["\x64\x61\x74\141" => json_encode($row["\144\141\x74\141"]), "\x66\151\156\x69\163\150\145\144" => $row["\146\x69\x6e\151\x73\x68\x65\x64"]]); goto AZtM8; g8Nac: if (!empty($row)) { goto Sf0A2; } goto UOo51; UOo51: return false; goto h9O1j; A6wWf: $ing = array_filter($row["\x64\141\164\141"], function ($finished) { return $finished == 0; }); goto aAQtf; tUJsQ: $row["\x66\x69\x6e\151\163\x68\145\x64"] = 1; goto AfEF_; aAQtf: if (!empty($ing)) { goto ngIJb; } goto tUJsQ; J8aV6: $row["\144\141\x74\x61"][$subject_id] = 1; goto A6wWf; AfEF_: ngIJb: goto wyZ2l; h9O1j: Sf0A2: goto J8aV6; U4LVW: } }
