<?php
 namespace app\mp\service; use app\Defs; use think\Db; use think\Log; use EasyWeChat\Factory; use app\index\logic\Defs as IndexDefs; use app\index\logic\Subject as SubjectLogic; use app\mp\service\RequestContext; use app\common\service\Redis as RedisService; use app\mp\controller\Wx; use app\index\logic\Expert as ExpertLogic; use app\index\logic\Sms as SmsLogic; use app\index\logic\AppointOrder as AppointOrderLogic; use app\index\service\EventLogs as EventLogsService; class Expert extends Bases { public function loadExperts($categoryId, $name, $page, $rows) { goto NYinX; Ealua: goto oqeYX; goto L0Bfk; pdpWI: $total = Db::table("\145\170\x70\145\162\x74")->alias("\x45")->join("\145\x78\160\145\162\164\x5f\x63\141\164\x65\147\x6f\x72\x79\137\162\145\154\x61\x74\145\40\105\103\122", "\x45\56\151\144\75\105\x43\122\x2e\x65\170\x70\x65\x72\x74\x5f\151\x64")->where($conditions)->count(); goto Xciub; L0Bfk: O2a_s: goto NQPAE; NYinX: $conditions = ["\x45\56\144\x65\154\145\164\145\137\146\154\141\x67" => 0, "\105\56\163\164\141\164\x75\x73" => IndexDefs::ENTITY_PUBLISH_STATUS]; goto tSkaH; TI6jC: KHLI1: goto xFei3; stZ0P: if ($categoryId) { goto O2a_s; } goto QU0hY; vGnbe: mMzSq: goto stZ0P; NFdp5: oqeYX: goto s38XE; MEpjO: $records = Db::table("\145\170\160\145\x72\x74")->alias("\x45")->where($conditions)->page($page, $rows)->field(true)->select(); goto Ealua; xFei3: $totalReturn = ($page - 1) * $rows + count($records); goto a37W9; s38XE: foreach ($records as &$record) { goto GqL10; hWTyU: $fieldNames = Db::table("\145\x78\160\145\x72\164\137\x66\151\x65\x6c\144\137\162\145\x6c\141\x74\x65")->alias("\105\x46\x52")->join("\145\170\160\x65\x72\x74\x5f\x66\151\145\x6c\x64\x5f\x69\164\x65\155\40\x45\106\111", "\105\x46\x52\x2e\146\x69\x65\154\144\x5f\151\x74\x65\x6d\137\x69\x64\75\x45\106\x49\x2e\151\x64")->where(["\105\106\x52\56\x65\170\x70\x65\x72\x74\137\151\x64" => $record["\151\x64"]])->column("\x45\106\x49\56\146\151\x65\154\144\137\x69\164\x65\155"); goto bSsBy; F4crR: $record["\145\170\160\145\162\164\137\x71\165\141\154\151\164\171"] = nl2br($record["\145\x78\x70\145\162\x74\137\x71\165\141\x6c\x69\x74\171"]); goto eWnBm; eWnBm: $record["\167\x6f\162\153\151\x6d\147\137\x75\162\x6c"] = generateThumbnailUrl($record["\x77\157\162\153\x69\155\x67\137\165\162\x6c"], 300); goto bXaN4; bSsBy: $record["\146\x69\x65\x6c\144\137\x6e\141\155\145\x73"] = $fieldNames; goto F4crR; GqL10: $targetNames = Db::table("\x65\x78\160\145\162\x74\137\164\x61\x72\147\x65\x74\x5f\162\x65\x6c\141\x74\145")->alias("\105\x54\x52")->join("\145\170\160\145\x72\x74\x5f\x74\141\162\x67\x65\164\40\x45\x54", "\105\124\x52\56\x74\141\x72\x67\x65\164\x5f\x69\x64\75\x45\124\56\151\144")->where(["\105\124\x52\x2e\x65\170\x70\145\x72\164\x5f\x69\144" => $record["\151\x64"]])->column("\x45\124\x2e\164\141\x72\147\145\164"); goto F8lD_; F8lD_: $record["\x74\x61\162\147\x65\164\137\x6e\x61\x6d\x65\163"] = $targetNames; goto hWTyU; bXaN4: MyZN6: goto ysCWT; ysCWT: } goto TI6jC; a37W9: return ["\x72\x6f\x77\x73" => $records, "\160\141\x67\145\x5f\x65\x6e\x64" => $totalReturn >= $total]; goto Eeq6v; NQPAE: $conditions["\x45\103\122\56\143\141\x74\145\147\x6f\162\171\137\151\144"] = $categoryId; goto pdpWI; tSkaH: if (!$name) { goto mMzSq; } goto dBn9M; QU0hY: $total = Db::table("\145\x78\x70\x65\162\164")->alias("\x45")->where($conditions)->count(); goto MEpjO; dBn9M: $conditions["\x45\x2e\162\x65\141\x6c\137\156\x61\x6d\x65"] = ["\x6c\151\153\145", "\45" . $name . "\45"]; goto vGnbe; Xciub: $records = Db::table("\145\x78\160\145\x72\x74")->alias("\x45")->join("\145\170\160\145\162\164\137\x63\x61\164\x65\x67\x6f\x72\171\137\162\x65\154\141\x74\145\40\105\103\122", "\x45\x2e\x69\x64\x3d\x45\103\x52\56\145\170\160\x65\162\164\137\x69\x64")->where($conditions)->page($page, $rows)->field("\151\x64\54\x20\167\157\162\x6b\x69\x6d\147\x5f\x75\x72\x6c\54\40\162\x65\x61\154\137\156\141\x6d\x65\x2c\40\x65\x78\160\145\x72\x74\x5f\x71\x75\x61\x6c\151\164\171\x2c\40\x61\160\160\x6f\x69\156\164\137\146\145\x65\x2c\40\143\x6f\156\163\x75\x6c\164\137\161\x75\x61\x6e\164\x69\164\171")->select(); goto NFdp5; Eeq6v: } public function getExpert($expertId) { goto zzEcc; Rq62S: $record["\146\x69\x65\x6c\x64\137\151\x74\145\155\163"] = array_slice($record["\146\x69\145\154\144\x5f\x69\x74\145\155\163\x5f\141\154\x6c"], 0); goto Uu8cj; kkC4Y: if ($record["\x66\151\162\163\x74\x5f\x6a\157\x62\x5f\x74\x69\155\145"]) { goto Dm8Kl; } goto Q9HLV; wMUW8: $record["\164\x61\162\x67\145\164\163"] = array_slice($record["\164\x61\x72\147\x65\x74\x73\x5f\x61\x6c\x6c"], 0, 3); goto kkC4Y; LTJct: wexception("\xe4\xb8\x93\xe5\256\xb6\344\xb8\215\xe5\xad\x98\345\234\xa8"); goto rAFXL; AE8gM: return $record; goto eK411; U_VyN: wexception("\xe4\270\x93\345\xae\xb6\346\234\xaa\xe5\x8f\221\xe5\270\203"); goto ixEBM; E6Yj1: goto IvkEC; goto Y_ppQ; Uu8cj: $record["\x74\x61\x72\147\145\164\163\x5f\141\154\x6c"] = Db::table("\145\170\160\145\162\164\x5f\164\141\162\x67\145\x74\x5f\162\x65\x6c\141\x74\x65")->alias("\x45\x54\122")->join("\145\x78\160\145\162\x74\137\164\x61\x72\147\x65\164\40\x45\x54", "\x45\124\x52\x2e\164\x61\x72\147\x65\x74\137\151\x64\75\x45\124\56\151\144")->where(["\105\x54\122\56\145\x78\160\145\162\164\137\151\144" => $expertId])->column("\x45\x54\x2e\164\141\162\147\x65\x74"); goto wMUW8; csCnq: if (!($record["\x73\164\x61\164\x75\163"] == IndexDefs::ENTITY_DRAFT_STATUS)) { goto uafgT; } goto U_VyN; di3Hb: EuI_e: goto PyfZs; PkgrK: $record["\152\x6f\x62\x5f\171\145\141\162\x73"] = floor($years); goto nnlRt; nnlRt: IvkEC: goto AE8gM; iw2dm: $years = date_diff(date_create(date("\131\x2d\x6d\x2d\x64")), date_create($record["\x66\151\x72\163\164\x5f\152\x6f\142\137\x74\151\155\145"]))->days / 365; goto PkgrK; ixEBM: uafgT: goto pCSfm; pCSfm: if (!($record["\163\x74\141\164\x75\x73"] == IndexDefs::ENTITY_END_STATUS)) { goto EuI_e; } goto eG56J; b4DIC: if ($record) { goto NC8Yj; } goto LTJct; Y_ppQ: Dm8Kl: goto iw2dm; eG56J: wexception("\xe4\270\x93\345\xae\xb6\xe5\267\xb2\344\xb8\255\xe6\xad\xa2"); goto di3Hb; rAFXL: NC8Yj: goto csCnq; zzEcc: $record = Db::table("\145\x78\160\145\162\x74")->where(["\151\x64" => $expertId, "\x64\x65\154\145\164\145\x5f\146\154\x61\147" => 0])->field(true)->find(); goto b4DIC; Q9HLV: $record["\x6a\157\142\137\x79\145\141\162\x73"] = ''; goto E6Yj1; PyfZs: $record["\146\x69\x65\x6c\144\137\151\164\x65\x6d\163\x5f\141\x6c\x6c"] = Db::table("\x65\x78\x70\x65\162\164\137\146\x69\145\x6c\x64\x5f\162\145\x6c\141\164\x65")->alias("\x45\x46\x52")->join("\x65\x78\160\x65\x72\x74\x5f\146\x69\145\x6c\x64\137\x69\164\145\155\40\105\x46\111", "\105\106\x49\56\151\144\x3d\105\x46\122\56\146\151\145\154\x64\x5f\151\x74\x65\x6d\x5f\x69\144")->where(["\105\x46\x52\x2e\x65\x78\x70\x65\x72\x74\137\x69\144" => $expertId])->column("\x45\x46\111\x2e\x66\x69\x65\x6c\x64\x5f\x69\x74\x65\155"); goto Rq62S; eK411: } public function getAvailableAppointTime($expertId) { goto UeCHL; js7MQ: $appoint_order_ahead_of_days = systemSetting("\141\x70\x70\x6f\151\156\164\137\157\x72\x64\145\x72\x5f\x61\150\145\141\144\x5f\157\x66\137\144\141\x79\x73"); goto qCWdy; lcHun: $i = 0; goto ULWG9; HzSim: $weekDay = date("\x77", strtotime($nowDay)); goto m00ZE; rCwB1: $available15AppointTimes = array_values(array_diff($appointTimes15, $appointedTimes15)); goto k3AE3; JWVqH: $nowDay = date("\131\x2d\x6d\55\144", strtotime($nowDay . "\40\x2b\61\x20\144\141\x79")); goto c1Dl1; TqDQc: return $weekDayList; goto mSHoC; W0Pgw: goto xj0yv; goto gbuX_; UeCHL: $weekDayList = []; goto qnEC7; ULWG9: xj0yv: goto Pf5IU; m00ZE: $appointTimes = Db::table("\x65\x78\x70\145\162\164\x5f\141\160\x70\x6f\151\156\x74\x5f\164\151\x6d\x65")->where(["\145\170\160\145\x72\164\x5f\x69\x64" => $expertId, "\167\145\x65\153\x5f\x64\141\171" => $weekDay])->order("\141\x70\x70\x6f\151\x6e\164\x5f\164\151\155\145\40\141\x73\143")->column("\141\160\160\x6f\151\x6e\164\137\x74\151\x6d\145"); goto Ch5ln; yuS0X: $nowDay = date("\131\x2d\x6d\x2d\144", strtotime($nowDay . "\40\53{$appoint_order_ahead_of_days}\x20\x64\x61\171\x73")); goto lcHun; WidYm: $available45AppointTimes = array_values(array_diff($appointTimes45, $appointedTimes45)); goto rCwB1; fxsuP: foreach ($appointTimes as $appointTime) { goto LPADl; H0pyq: $appointTimes45[] = $appointTime; goto kYYzx; eIgKn: AT8NJ: goto CaQ_9; Uum1c: goto rO51f; goto eIgKn; c1yS6: if (count($intervals) == 1) { goto AT8NJ; } goto U_zSe; jdiD3: PzXH5: goto txAa4; LPADl: $intervals = explode("\x2c", $appointTime); goto c1yS6; U_zSe: if (!(count($intervals) == 3)) { goto IYkjX; } goto H0pyq; XCVS4: rO51f: goto jdiD3; CaQ_9: $appointTimes15[] = $appointTime; goto XCVS4; kYYzx: IYkjX: goto Uum1c; txAa4: } goto Ny6Bd; CiYqX: $appointTimes15 = []; goto fxsuP; qnEC7: $nowDay = date("\x59\55\x6d\55\x64"); goto js7MQ; k3AE3: $available = $available45AppointTimes || $available15AppointTimes ? true : false; goto ch_Gd; ch_Gd: if (!$available) { goto uw0m3; } goto O45rA; gbuX_: BwVB7: goto TqDQc; Ny6Bd: X5wBt: goto tJj8T; kQpWE: uw0m3: goto JWVqH; O45rA: $weekDayList[] = ["\x77\x65\145\153\104\141\x79" => $weekDay, "\141\x76\141\151\154\141\142\x6c\145" => $available, "\x64\141\x74\145" => $nowDay, "\154\x61\142\x65\154" => sprintf("\45\x73\40\x7c\40\45\163", getWeekdayText($weekDay), date("\155\x2d\144", strtotime($nowDay))), "\141\166\141\151\154\141\x62\154\x65\64\65\x41\x70\x70\157\151\156\164\124\151\155\x65\163" => $available45AppointTimes, "\141\x76\141\151\x6c\141\142\154\145\61\65\x41\x70\x70\x6f\151\156\x74\124\x69\155\145\163" => $available15AppointTimes]; goto kQpWE; tJj8T: $appointedTimes45 = Db::table("\145\x78\160\145\x72\164\137\157\x72\144\145\x72")->where(["\145\x78\x70\145\162\164\x5f\151\x64" => $expertId, "\x61\x70\x70\x6f\x69\156\x74\x5f\x64\x61\x74\145" => $nowDay, "\141\160\x70\x6f\151\x6e\164\x5f\x64\x75\162\x61\x74\151\157\156" => 45, "\x73\x74\141\x74\x75\163" => ["\156\145\161", IndexDefs::ORDER_CANCELLED_STATUS]])->order("\x61\160\160\157\151\x6e\164\137\x74\151\155\145\40\141\x73\x63")->column("\141\160\x70\x6f\151\156\x74\x5f\164\x69\155\x65"); goto u_rH9; Ch5ln: $appointTimes45 = []; goto CiYqX; qCWdy: $appoint_order_allow_days = systemSetting("\141\160\x70\157\x69\x6e\164\137\x6f\162\144\145\x72\137\x61\154\x6c\157\167\x5f\144\141\171\163"); goto yuS0X; c1Dl1: $i++; goto W0Pgw; u_rH9: $appointedTimes15 = Db::table("\x65\x78\x70\x65\x72\164\137\x6f\162\x64\145\162")->where(["\145\170\160\x65\x72\164\x5f\x69\144" => $expertId, "\x61\160\160\x6f\x69\156\x74\x5f\144\141\164\145" => $nowDay, "\141\160\x70\x6f\151\156\x74\x5f\x64\x75\162\141\x74\151\x6f\156" => 15, "\x73\164\x61\164\165\163" => ["\x6e\145\161", IndexDefs::ORDER_CANCELLED_STATUS]])->order("\x61\x70\160\157\151\x6e\x74\x5f\164\151\x6d\145\40\x61\163\x63")->column("\141\x70\x70\157\151\x6e\164\x5f\x74\151\155\x65"); goto WidYm; Pf5IU: if (!($i < $appoint_order_allow_days)) { goto BwVB7; } goto HzSim; mSHoC: } public function submitAppointOrder($uid, $postData) { goto iY08s; U1sYC: wexception("\xe6\x97\240\346\263\x95\xe6\211\xbe\345\x88\xb0\350\xaf\xa5\xe4\270\x93\xe5\256\266"); goto cdEuY; tZeDd: $appointTime = $postData["\x61\x70\160\157\151\x6e\x74\124\151\155\x65"] ?? ''; goto wl_2w; wNPVG: wexception("\347\237\255\344\277\xa1\351\xaa\x8c\xe8\xaf\201\xe7\240\201\351\x94\x99\xe8\xaf\xaf"); goto zY_lq; Hm3Rq: $expertInfos = ExpertLogic::I()->getInfos($expertId); goto bfptA; mNUak: $appointTimeSms = convertAppointTimesToShow($appointTime); goto wCQ3A; cdEuY: qIsrx: goto VnQPt; bfptA: if ($expertInfos) { goto qIsrx; } goto U1sYC; pHEeS: $smsResult = SmsLogic::I()->sendAppoitOrderToExpert($expertInfos["\x63\x65\154\x6c\160\150\157\x6e\x65"], date("\155\346\x9c\x88\x64\346\227\xa5", strtotime($appointDate)) . "\40" . $appointTimeSms); goto EIPn5; wCQ3A: if (!(systemSetting("\x73\145\x6e\144\137\141\160\x70\x6f\x69\156\164\137\157\x72\x64\x65\162\137\x74\157\x5f\145\x78\160\145\162\164") == "\x79\x65\163")) { goto libBB; } goto pHEeS; zY_lq: s30uY: goto Hm3Rq; IRQGW: kf3_K: goto GcXsG; GcXsG: Db::table("\145\170\x70\x65\162\164\137\x6f\162\x64\145\162")->where(["\x6f\x72\x64\145\162\x5f\x6e\x6f" => $orderNo])->update(["\154\x69\x6e\153\155\x61\x6e" => $realName, "\143\145\x6c\154\160\x68\x6f\156\x65" => $cellphone, "\x72\145\x6d\141\x72\x6b" => $remark]); goto U96bs; rTGee: Log::notice("\163\155\x73\40\143\141\x70\164\x63\150\x61\x20\143\157\x64\x65\x20\167\162\x6f\156\x67\x3a\x20" . $smsCode); goto wNPVG; IZcbV: logEvent("\345\x8f\221\xe9\200\201\351\242\204\347\xba\246\351\200\x9a\347\x9f\245\347\x9f\xad\344\277\241\xe5\210\xb0\xe4\xb8\223\xe5\256\xb6{$expertInfos["\143\145\x6c\154\x70\150\x6f\x6e\x65"]}\xe5\244\xb1\350\xb4\xa5", EventLogsService::eSeverityError); goto vg4RZ; iY08s: $expertId = $postData["\145\x78\x70\x65\162\164\x49\144"] ?? 0; goto RzhiV; MU_Fi: $realName = $postData["\162\x65\x61\154\116\141\155\145"] ?? ''; goto p0Enq; av_8n: Db::table("\143\x75\x73\x74\x6f\x6d\x65\x72")->where(["\151\144" => $uid])->update(["\154\141\164\145\x73\164\x5f\x61\160\160\x6f\151\156\x74\137\164\x69\x6d\145" => Db::raw("\156\157\167\50\51"), "\x74\157\x74\141\154\137\141\160\160\157\x69\x6e\x74\137\161\x75\141\156\x74\x69\x74\x79" => Db::raw("\164\157\x74\141\x6c\x5f\x61\160\x70\157\x69\x6e\164\x5f\x71\x75\141\x6e\x74\x69\164\x79\53\x31"), "\164\157\164\141\154\x5f\141\x70\x70\x6f\151\x6e\164\137\141\x6d\x6f\165\x6e\x74" => Db::raw("\x74\157\164\141\154\x5f\141\160\x70\x6f\151\x6e\164\x5f\x61\x6d\x6f\165\156\164\53" . $orderAmount)]); goto mNUak; eJnPV: rx1Dx: goto IOtB4; A2Sug: $orderNo = AppointOrderLogic::I()->generateOrder($uid, $expertId, $orderAmount, $appointDate, $appointTime, $appointDuration, $appointMode, $payStatus); goto BykXH; EIPn5: if ($smsResult) { goto rx1Dx; } goto IZcbV; TL9JA: $smsCode = $postData["\163\x6d\x73"] ?? ''; goto tXBe9; EFTTX: $appointDuration = $postData["\x61\x70\x70\x6f\x69\x6e\164\x44\x75\x72\141\x74\151\x6f\x6e"] ?? ''; goto tZeDd; uLbA2: Qgt5c: goto MU_Fi; U96bs: return $orderNo; goto Qk_rX; wl_2w: $appointMode = $postData["\x61\160\x70\157\x69\156\x74\x4d\157\x64\x65"] ?? ''; goto hVgt7; vg4RZ: Log::error("\146\141\151\x6c\145\x64\x20\x74\157\40\x73\x65\156\x64\x20\x73\155\163\40\164\x6f\x20\x65\x78\160\x65\162\164\x20{$expertInfos["\143\145\154\x6c\160\x68\x6f\156\x65"]}"); goto eJnPV; VnQPt: $orderAmount = $appointDuration == 15 ? $expertInfos["\x61\160\x70\157\151\156\x74\x5f\162\145\166\x69\145\167\x5f\146\145\x65"] : $expertInfos["\x61\x70\160\157\x69\x6e\164\x5f\146\145\x65"]; goto ZMfHA; tXBe9: $remark = $postData["\x72\145\x6d\x61\162\x6b"] ?? ''; goto PUt3J; kRHcS: foreach ($supportTels as $supportTel) { goto EhOUo; G5yKn: BLF5n: goto GKEmA; nhqFN: Log::notice("\164\150\145\x20\x63\x75\x73\164\157\x6d\x65\162\40\x73\x75\160\160\157\162\164\x20\x74\145\154\x20{$supportTel}\x20\x69\x73\40\156\x6f\x74\40\x76\141\x6c\151\x64\x2c\x20\163\x6b\151\160"); goto DDL5l; Epgpj: $smsResult = SmsLogic::I()->sendAppoitOrderToSupport($supportTel, date("\155\xe6\234\210\144\xe6\227\xa5", strtotime($appointDate)) . "\40" . $appointTimeSms); goto XSul_; kgEwt: Log::error("\146\x61\x69\154\x65\x64\x20\x74\157\x20\163\x65\x6e\144\40\x73\155\163\x20\x74\x6f\40\x73\165\x70\x70\157\x72\164\40{$supportTel}"); goto vCVO3; XSul_: if ($smsResult) { goto xKSSy; } goto urCuf; SK3RC: r12L_: goto Epgpj; EhOUo: if (validateMobile($supportTel)) { goto r12L_; } goto nhqFN; vCVO3: xKSSy: goto G5yKn; urCuf: logEvent("\345\x8f\x91\351\x80\x81\351\242\204\xe7\272\246\351\200\x9a\347\x9f\xa5\xe7\237\255\344\277\xa1\xe5\210\260\345\256\242\346\234\x8d{$supportTel}\xe5\xa4\261\xe8\xb4\245", EventLogsService::eSeverityError); goto kgEwt; DDL5l: goto BLF5n; goto SK3RC; GKEmA: } goto IRQGW; EOPrD: $supportTels = explode("\54", systemSetting("\x73\145\x6e\x64\x5f\x61\x70\x70\x6f\151\x6e\x74\137\x6f\162\x64\x65\x72\x5f\164\157\137\163\165\160\x70\x6f\x72\164\137\x74\145\154\163")); goto kRHcS; ZMfHA: $payStatus = systemSetting("\141\160\x70\x6f\x69\x6e\x74\x5f\x6f\x72\x64\x65\162\137\x70\141\x79\137\x6d\x6f\144\x65\154") == "\xe7\272\xbf\xe4\270\213\xe6\224\257\344\xbb\x98" ? Defs::PAY_OFFLINE : Defs::PAY_WAIT; goto A2Sug; BykXH: Db::table("\145\x78\x70\145\162\164")->where(["\151\x64" => $expertId])->update(["\x6c\x61\x74\x65\x73\x74\137\x61\x70\x70\x6f\x69\156\x74\x5f\x74\151\155\x65" => Db::raw("\x6e\x6f\167\50\x29"), "\x74\x6f\x74\141\154\137\x61\160\x70\x6f\151\x6e\164\x5f\161\x75\x61\x6e\x74\151\164\x79" => Db::raw("\164\157\x74\x61\x6c\137\x61\x70\x70\x6f\x69\x6e\x74\x5f\161\x75\141\x6e\164\151\x74\x79\53\x31"), "\164\x6f\164\141\x6c\137\141\160\160\157\x69\156\x74\x5f\x61\155\x6f\165\x6e\x74" => Db::raw("\164\157\x74\141\x6c\137\141\x70\x70\157\151\156\164\137\x61\x6d\x6f\x75\156\164\53" . $orderAmount)]); goto av_8n; RzhiV: $appointDate = $postData["\141\160\160\x6f\x69\156\164\104\141\164\145"] ?? ''; goto EFTTX; MLjfx: wexception("\346\225\260\346\215\xae\xe4\xb8\x8d\xe5\xae\x8c\xe6\225\264"); goto uLbA2; hVgt7: if (!(empty($expertId) || empty($appointDate) || empty($appointDuration) || empty($appointTime) || empty($appointMode))) { goto Qgt5c; } goto MLjfx; IOtB4: libBB: goto EOPrD; PUt3J: if (SmsLogic::I()->verifyCaptcha($cellphone, $smsCode, "\101\120\120\x4f\x49\116\x54")) { goto s30uY; } goto rTGee; p0Enq: $cellphone = $postData["\143\x65\x6c\x6c\160\150\x6f\x6e\145"] ?? ''; goto TL9JA; Qk_rX: } public function appointPay($uid, $orderNo) { goto Gr2Yf; Pmbgg: Db::table("\x65\170\160\145\162\x74\137\157\x72\x64\145\x72")->where(["\157\162\x64\x65\162\137\156\x6f" => $orderInfos["\x6f\162\x64\145\162\137\x6e\x6f"]])->setField("\x70\x61\x79\137\x73\x74\x61\x74\x75\163", $payStatus); goto ZXYOq; tgiSO: if (isset($res["\x70\162\145\160\141\171\x5f\x69\144"])) { goto Cdl2j; } goto OSO34; XBup8: logEvent("\345\217\x91\xe9\x80\201\xe9\242\204\347\272\246\351\x80\232\xe7\x9f\245\347\237\xad\344\xbf\xa1\345\x88\xb0\345\xae\xa2\346\210\xb7{$orderInfos["\143\x65\154\x6c\160\150\157\156\145"]}\345\xa4\xb1\xe8\xb4\245", EventLogsService::eSeverityError); goto cqwpO; h9HDF: wxPaySetting(); goto wn0Ci; FJ5yF: $orderAmount = floatval($orderInfos["\157\162\x64\145\162\x5f\x61\x6d\157\x75\x6e\164"]); goto MW_KA; n7D33: Db::table("\x65\x78\160\x65\162\164\137\x6f\x72\x64\145\162")->where(["\x6f\x72\144\x65\x72\137\156\157" => $orderInfos["\157\162\144\145\x72\x5f\x6e\x6f"]])->setField("\x70\x72\x65\x70\141\x79\137\x69\144", $res["\160\x72\x65\x70\x61\x79\137\x69\x64"]); goto kDG1q; VEyO2: Log::error("{$orderNo}\40\345\xbe\256\344\277\xa1\xe4\270\x8b\345\215\x95\xe5\244\xb1\350\xb4\245\357\274\x9a\xe8\277\x94\345\233\x9e\347\xa9\272"); goto kBnq5; kDG1q: $data["\x63\x6f\x6e\146\x69\x67"] = $app->jssdk->bridgeConfig($res["\160\162\x65\160\x61\171\137\x69\144"], false); goto oJZ8c; gp902: wexception("\xe8\257\267\xe9\x85\x8d\347\xbd\256\xe5\xbe\xae\344\277\241\xe5\205\xac\xe4\274\227\xe5\217\267\345\x92\214\345\xbe\xae\344\277\241\xe6\224\257\xe4\273\230\xe5\x8f\202\346\x95\260"); goto jmW20; xTXOJ: wexception("\345\275\223\xe5\x89\x8d\xe7\x8e\xaf\345\242\x83\xe4\270\x8d\xe6\x94\xaf\xe6\214\201\346\224\xaf\344\273\x98\346\223\x8d\xe4\275\234"); goto gD3FU; COJwn: if (!($uid == 1)) { goto O0kBk; } goto xTXOJ; wn0Ci: if (!(empty(config("\167\170\x2e\x6f\x66\146\151\x63\151\x61\x6c\x5f\x61\143\x63\x6f\165\x6e\x74")["\x61\160\160\137\151\144"]) || empty(config("\x77\170\56\160\141\x79\155\145\156\164")["\x6d\x63\150\x5f\x69\144"]))) { goto cJZHR; } goto gp902; GhMXG: if ($orderInfos) { goto Hi9Z8; } goto FuEMr; sfs8g: Log::error("{$orderNo}\x20\345\276\xae\xe4\xbf\241\344\xb8\x8b\345\x8d\225\xe5\xa4\xb1\xe8\264\245\357\xbc\x9a\350\xbf\224\345\233\x9e\40" . $res); goto Yi8lp; Ln2eA: Hi9Z8: goto FJ5yF; tr1cK: wexception("\xe5\276\xae\344\xbf\241\344\270\x8b\345\215\x95\345\244\xb1\xe8\xb4\xa5\xef\274\x9a" . $res["\162\x65\164\x75\x72\156\137\155\163\x67"]); goto Dy0lG; mk5ci: $data["\x6e\145\145\144\137\160\141\171"] = false; goto Z1Fla; S8FCv: $data["\x6e\x65\x65\144\x5f\160\141\171"] = true; goto h9HDF; Xnlkz: Log::error("{$orderNo}\40\xe5\xbe\256\xe4\xbf\241\xe4\270\213\345\x8d\x95\345\244\xb1\xe8\264\xa5\xef\274\232\xe8\277\224\345\x9b\236\40" . var_export($res, true)); goto F0IUt; KYIG7: wshg2: goto cVJj0; joXVS: Log::notice("{$orderNo}\x20\x77\145\143\150\141\164\x20\160\x61\171\x20\162\145\164\x75\x72\156\40" . var_export($res, true)); goto Cbs3K; iQwrg: $payStatus = systemSetting("\141\160\160\x6f\151\156\164\x5f\x6f\162\144\x65\x72\137\x70\141\x79\x5f\x6d\x6f\144\x65\154") == "\347\272\xbf\xe4\xb8\x8b\346\x94\xaf\344\xbb\230" ? Defs::PAY_OFFLINE : Defs::PAY_SUCCESS; goto Pmbgg; PMeHZ: if (is_array($res)) { goto caRup; } goto sfs8g; oJZ8c: goto uzb6Z; goto Z_98N; Cga_z: logEvent("\xe5\x92\250\350\257\242\xe9\xa2\x84\xe7\xba\xa6\xe8\xae\242\345\x8d\x95{$orderNo}\346\224\xaf\344\xbb\230\xe5\244\xb1\350\xb4\245\x2c\40{$res["\162\x65\164\x75\162\156\137\155\163\147"]}", EventLogsService::eSeverityWarning); goto tr1cK; Z_98N: sf2wI: goto iQwrg; Z1Fla: uzb6Z: goto nOApI; FuEMr: wexception("\xe8\256\xa2\xe5\215\225\344\270\x8d\xe5\255\230\345\x9c\250"); goto Ln2eA; p_HJ9: $data["\165\x72\x6c"] = url("\x6d\160\57\x45\x78\x70\145\x72\164\57\x61\160\x70\157\151\156\x74\123\x75\143\143\145\163\x73", ["\x6f\162\144\145\162\116\x6f" => $orderNo]); goto J5eqS; Yi8lp: wexception("\xe5\xbe\256\344\277\241\xe4\xb8\213\345\x8d\225\xe5\244\261\350\264\xa5\xef\274\232\350\xbf\x94\345\233\236" . $res); goto JQnOB; jmW20: cJZHR: goto Er8yj; gD3FU: O0kBk: goto S8FCv; R3ZX5: if (!($res["\x72\145\164\x75\162\x6e\137\x63\157\x64\x65"] == "\106\x41\111\x4c")) { goto Mv4Qj; } goto Cga_z; ZGs7U: Ozwm6: goto tgiSO; F0IUt: wexception("\345\xbe\256\344\xbf\241\344\xb8\x8b\xe5\215\x95\xe5\244\xb1\xe8\264\245\357\xbc\x9a" . $res["\145\x72\x72\137\x63\x6f\144\145\137\144\x65\x73"]); goto ZGs7U; gBC90: Cdl2j: goto n7D33; kYhpW: $smsResult = SmsLogic::I()->sendAppoitOrderToCustomer($orderInfos["\143\x65\154\x6c\160\x68\x6f\156\x65"], date("\155\346\234\x88\x64\xe6\x97\245", strtotime($orderInfos["\141\160\160\x6f\151\x6e\164\x5f\144\141\x74\x65"])) . "\40" . $appointTimeSms, systemSetting("\x61\x70\160\x6f\151\x6e\164\137\157\162\x64\x65\x72\137\157\x66\146\151\143\x65\x5f\141\x64\x64\x72\145\163\163")); goto h5r8i; zQPJq: $appointTimeSms = convertAppointTimesToShow($orderInfos["\141\160\x70\x6f\x69\x6e\164\x5f\x74\151\155\145"]); goto kYhpW; jmIhm: logEvent("\xe5\222\250\xe8\xaf\xa2\351\242\x84\xe7\272\xa6\xe8\256\xa2\xe5\215\x95{$orderNo}\xe6\224\xaf\xe4\273\x98\345\xa4\xb1\xe8\264\xa5\x2c\40{$res["\145\x72\162\x5f\x63\157\144\x65\137\144\145\x73"]}", EventLogsService::eSeverityWarning); goto Xnlkz; cqwpO: Log::error("\146\141\151\154\145\144\40\164\x6f\x20\x73\x65\156\x64\40\x73\155\163\x20\164\x6f\x20\143\165\x73\164\x6f\x6d\145\162\40{$orderInfos["\143\145\x6c\x6c\x70\150\157\156\x65"]}"); goto KYIG7; Gr2Yf: $data = ["\x6f\162\x64\x65\162\x4e\x6f" => $orderNo]; goto p_HJ9; cVJj0: RHR6d: goto mk5ci; J5eqS: $orderInfos = AppointOrderLogic::I()->getOrderInfos($uid, $orderNo); goto GhMXG; Cbs3K: if (!empty($res)) { goto NCMAl; } goto VEyO2; rsZgs: if (!(systemSetting("\163\x65\x6e\144\x5f\x61\160\x70\x6f\151\x6e\x74\x5f\157\162\x64\145\x72\x5f\x74\x6f\137\143\x75\163\x74\x6f\155\145\x72") == "\171\x65\163")) { goto RHR6d; } goto zQPJq; gxRd6: wexception("\xe5\276\256\xe4\277\241\xe4\270\x8b\345\x8d\225\xe5\xa4\xb1\xe8\xb4\xa5\xef\274\x9a\xe6\227\xa0\346\263\x95\346\211\xbe\345\x88\260\x70\162\145\160\141\x79\x5f\151\x64"); goto gBC90; kBnq5: wexception("\345\276\256\344\277\241\344\270\x8b\xe5\215\225\345\244\xb1\350\264\xa5\357\274\x9a\350\xbf\x94\345\x9b\x9e\347\251\272"); goto MPhwF; MPhwF: NCMAl: goto PMeHZ; Dy0lG: Mv4Qj: goto wu0l7; h5r8i: if ($smsResult) { goto wshg2; } goto XBup8; ZXYOq: Db::table("\x65\x78\x70\x65\162\164\137\157\x72\144\x65\162")->where(["\x6f\x72\144\x65\162\137\x6e\x6f" => $orderInfos["\157\x72\x64\x65\x72\137\156\157"]])->setField("\163\x74\141\164\165\163", IndexDefs::ORDER_APPOINTED_STATUS); goto rsZgs; nsJmt: $res = $app->order->unify(["\142\x6f\x64\x79" => "\351\xa2\x84\xe7\xba\246\xe8\264\271\xe7\x94\xa8", "\x6f\165\x74\137\x74\162\x61\144\145\x5f\x6e\x6f" => $orderInfos["\x6f\162\x64\x65\162\137\156\157"], "\x74\x6f\164\x61\x6c\137\146\x65\145" => $orderInfos["\x6f\162\144\x65\x72\x5f\x61\155\x6f\165\x6e\x74"] * 100, "\156\157\164\151\146\171\x5f\x75\x72\x6c" => url("\155\160\x2f\x57\170\57\x70\x61\151\144\x45\x78\160\145\162\164\117\x72\x64\x65\x72", '', false, true), "\164\x72\141\144\145\x5f\164\171\160\x65" => "\112\x53\101\120\x49", "\157\x70\145\156\x69\144" => $uid]); goto joXVS; wu0l7: if (!($res["\162\x65\x73\x75\154\x74\x5f\143\157\144\x65"] == "\x46\101\111\114")) { goto Ozwm6; } goto jmIhm; OSO34: Log::error("{$orderNo}\40\345\xbe\xae\344\xbf\xa1\xe4\270\213\345\215\225\xe5\244\xb1\350\xb4\245\xef\xbc\x9a\xe6\x97\240\160\162\145\x70\x61\x79\137\x69\x64\54\x20\350\xbf\x94\345\x9b\x9e\40" . var_export($res, true)); goto gxRd6; nOApI: return $data; goto tneRJ; JQnOB: caRup: goto R3ZX5; MW_KA: if (systemSetting("\x61\x70\160\157\x69\156\164\x5f\157\162\144\145\162\x5f\160\141\x79\x5f\x6d\157\x64\145\154") == "\xe7\xba\xbf\xe4\xb8\213\346\224\xaf\344\xbb\230" || !$orderAmount) { goto sf2wI; } goto COJwn; Er8yj: $app = Factory::payment(array_merge(config("\167\x78\x2e\x70\x61\171\155\x65\x6e\x74"), ["\141\160\x70\137\151\x64" => config("\167\170\56\157\x66\146\x69\143\151\141\154\137\x61\x63\143\157\x75\156\164")["\x61\160\160\x5f\151\x64"]])); goto nsJmt; tneRJ: } }
