<?php
 namespace app\mp\service; use app\Defs; use think\Db; use think\Log; use EasyWeChat\Factory; use app\index\logic\Defs as IndexDefs; use app\index\logic\Subject as SubjectLogic; use app\mp\service\RequestContext; use app\common\service\Redis as RedisService; use app\mp\controller\Wx; use app\index\logic\Expert as ExpertLogic; use app\index\logic\Sms as SmsLogic; use app\index\logic\AppointOrder as AppointOrderLogic; use app\index\service\EventLogs as EventLogsService; class Expert extends Bases { public function loadExperts($categoryId, $name, $page, $rows) { goto fxv8r; svOqz: foreach ($records as &$record) { goto jSHXm; WxgjE: $record["\164\x61\162\147\145\x74\137\156\141\x6d\x65\x73"] = $targetNames; goto kEzJ3; jSHXm: $targetNames = Db::table("\x65\170\x70\145\x72\x74\x5f\x74\x61\x72\147\145\x74\x5f\x72\x65\x6c\x61\x74\145")->alias("\105\124\122")->join("\145\x78\x70\145\162\x74\x5f\x74\x61\x72\147\x65\164\40\x45\124", "\x45\124\x52\x2e\x74\x61\x72\x67\145\x74\137\x69\144\x3d\x45\124\56\x69\144")->where(["\105\x54\x52\56\145\x78\x70\x65\x72\164\137\151\144" => $record["\x69\144"]])->column("\105\124\56\x74\141\x72\147\x65\164"); goto WxgjE; yyaDy: $record["\167\x6f\162\153\151\155\147\137\165\x72\x6c"] = generateThumbnailUrl($record["\x77\157\x72\153\x69\155\x67\x5f\x75\162\154"], 300); goto S0QWK; xdN3h: $record["\x66\x69\145\154\x64\x5f\x6e\x61\155\x65\163"] = $fieldNames; goto HBZLQ; S0QWK: kbL3G: goto I0vQT; kEzJ3: $fieldNames = Db::table("\x65\170\160\x65\x72\x74\x5f\x66\x69\145\x6c\x64\x5f\x72\145\x6c\141\x74\145")->alias("\x45\x46\x52")->join("\x65\170\x70\x65\162\x74\137\x66\151\145\154\144\x5f\x69\164\x65\155\40\x45\x46\x49", "\x45\x46\122\56\x66\x69\145\154\x64\137\x69\164\145\155\x5f\x69\144\x3d\x45\x46\111\x2e\x69\x64")->where(["\105\x46\122\56\x65\170\x70\x65\162\164\x5f\151\144" => $record["\151\x64"]])->column("\x45\106\x49\56\146\151\145\154\144\137\151\x74\x65\155"); goto xdN3h; HBZLQ: $record["\145\x78\x70\x65\x72\164\137\161\165\x61\x6c\x69\x74\x79"] = nl2br($record["\x65\x78\160\x65\x72\x74\x5f\161\165\141\x6c\151\x74\x79"]); goto yyaDy; I0vQT: } goto aJKlv; e8AJN: $total = Db::table("\145\170\x70\145\x72\x74")->alias("\x45")->where($conditions)->count(); goto fcA3d; fFDVa: $conditions["\105\x43\x52\x2e\143\x61\164\x65\x67\x6f\162\x79\x5f\x69\144"] = $categoryId; goto wx7SY; aJKlv: e_w4s: goto MULU1; DmHVV: if (!$name) { goto sdzrj; } goto Lenk_; fcA3d: $records = Db::table("\x65\x78\160\145\x72\164")->alias("\105")->where($conditions)->page($page, $rows)->field(true)->select(); goto T9OmA; tW2T7: sdzrj: goto hyn5C; sRf6P: wAsJD: goto fFDVa; N3Vbg: mf0gY: goto svOqz; Lenk_: $conditions["\105\x2e\162\x65\141\x6c\x5f\x6e\141\155\x65"] = ["\154\151\153\x65", "\45" . $name . "\x25"]; goto tW2T7; NpRR4: return ["\162\x6f\x77\x73" => $records, "\x70\x61\x67\145\137\x65\x6e\144" => $totalReturn >= $total]; goto rpJ2e; wx7SY: $total = Db::table("\145\170\x70\145\162\x74")->alias("\105")->join("\145\170\160\145\x72\x74\137\x63\x61\x74\145\147\x6f\162\x79\x5f\162\x65\x6c\x61\164\145\x20\x45\103\x52", "\x45\x2e\x69\x64\x3d\x45\103\122\56\145\x78\160\x65\162\164\x5f\151\144")->where($conditions)->count(); goto UT5FN; T9OmA: goto mf0gY; goto sRf6P; UT5FN: $records = Db::table("\x65\x78\x70\x65\162\164")->alias("\x45")->join("\x65\x78\160\x65\x72\164\137\143\141\x74\x65\x67\x6f\162\x79\137\162\x65\x6c\141\x74\x65\40\x45\x43\122", "\105\56\151\144\x3d\105\x43\x52\56\145\x78\x70\x65\162\164\137\151\x64")->where($conditions)->page($page, $rows)->field("\x69\144\54\40\x77\x6f\x72\153\151\x6d\147\x5f\165\162\154\54\40\162\x65\x61\x6c\x5f\x6e\141\x6d\x65\x2c\x20\145\170\160\145\x72\x74\x5f\161\165\x61\x6c\151\164\171\54\x20\x61\x70\x70\x6f\151\156\x74\137\146\145\x65\54\x20\143\157\x6e\x73\x75\x6c\164\137\x71\x75\x61\156\164\x69\164\x79")->select(); goto N3Vbg; hyn5C: if ($categoryId) { goto wAsJD; } goto e8AJN; fxv8r: $conditions = ["\105\56\x64\145\154\145\164\145\x5f\x66\154\x61\x67" => 0, "\105\x2e\x73\164\x61\x74\x75\163" => IndexDefs::ENTITY_PUBLISH_STATUS]; goto DmHVV; MULU1: $totalReturn = ($page - 1) * $rows + count($records); goto NpRR4; rpJ2e: } public function getExpert($expertId) { goto f9nXh; gec7y: $record["\152\x6f\142\x5f\x79\x65\141\162\163"] = ''; goto e9XfU; re2Yv: $record["\146\x69\145\x6c\144\137\151\x74\145\x6d\x73\137\141\x6c\154"] = Db::table("\145\x78\160\145\x72\x74\137\x66\151\145\154\x64\137\x72\x65\154\x61\164\145")->alias("\x45\106\x52")->join("\145\x78\x70\x65\x72\x74\137\x66\x69\x65\x6c\144\x5f\x69\164\145\x6d\x20\105\106\111", "\105\x46\111\56\151\x64\75\x45\x46\x52\x2e\x66\151\x65\154\x64\x5f\x69\164\145\155\137\151\x64")->where(["\x45\106\x52\x2e\145\x78\x70\x65\162\x74\x5f\151\144" => $expertId])->column("\105\106\x49\x2e\146\x69\145\x6c\x64\x5f\151\164\145\155"); goto onU1T; lvSCH: wexception("\xe4\270\223\345\256\xb6\xe5\267\xb2\xe4\270\255\346\xad\242"); goto xVxCv; tOcRY: wexception("\344\xb8\223\xe5\xae\266\346\234\252\xe5\217\x91\xe5\xb8\x83"); goto lRY0r; e9XfU: goto JSdWX; goto S1NZa; B0fLP: if (!($record["\x73\x74\x61\x74\x75\163"] == IndexDefs::ENTITY_END_STATUS)) { goto l3hqB; } goto lvSCH; J5k2t: if (!($record["\163\x74\x61\164\x75\163"] == IndexDefs::ENTITY_DRAFT_STATUS)) { goto BaTzW; } goto tOcRY; LoRxA: if ($record) { goto b11uZ; } goto OJAis; OJAis: wexception("\344\xb8\x93\345\256\xb6\344\xb8\x8d\345\xad\230\xe5\234\250"); goto KC_B_; S3lGI: $record["\x74\141\x72\147\145\x74\163"] = array_slice($record["\x74\x61\162\147\x65\x74\x73\137\x61\x6c\x6c"], 0, 3); goto XuPJr; f9nXh: $record = Db::table("\x65\x78\x70\145\162\x74")->where(["\x69\x64" => $expertId, "\x64\145\154\145\164\x65\137\x66\x6c\141\x67" => 0])->field(true)->find(); goto LoRxA; onU1T: $record["\x66\151\145\154\144\137\x69\x74\x65\x6d\163"] = array_slice($record["\146\151\145\154\144\137\x69\x74\145\x6d\x73\137\141\154\154"], 0); goto NOsrr; cDC2O: $record["\152\157\142\x5f\x79\x65\141\x72\x73"] = floor($years); goto hjiJ2; lRY0r: BaTzW: goto B0fLP; iL7Ex: return $record; goto Grpsc; KC_B_: b11uZ: goto J5k2t; S1NZa: Vp1ex: goto nkJ4s; nkJ4s: $years = date_diff(date_create(date("\x59\55\x6d\55\144")), date_create($record["\x66\151\162\163\164\137\152\157\142\137\164\151\x6d\x65"]))->days / 365; goto cDC2O; XuPJr: if ($record["\x66\x69\162\x73\164\137\x6a\x6f\x62\x5f\164\x69\x6d\145"]) { goto Vp1ex; } goto gec7y; NOsrr: $record["\x74\141\162\147\x65\x74\163\x5f\141\154\x6c"] = Db::table("\145\170\x70\x65\x72\x74\x5f\164\141\x72\147\x65\x74\137\x72\145\154\141\x74\145")->alias("\105\124\122")->join("\145\170\160\x65\162\x74\137\164\x61\162\x67\145\164\40\105\x54", "\105\x54\x52\x2e\164\141\x72\147\145\x74\x5f\x69\x64\75\x45\x54\56\151\144")->where(["\x45\124\x52\56\145\x78\160\x65\162\164\x5f\151\x64" => $expertId])->column("\105\x54\56\x74\x61\x72\x67\x65\164"); goto S3lGI; hjiJ2: JSdWX: goto iL7Ex; xVxCv: l3hqB: goto re2Yv; Grpsc: } public function getAvailableAppointTime($expertId) { goto uxOrd; k5ZZ2: $appoint_order_allow_days = systemSetting("\x61\x70\x70\x6f\151\x6e\x74\137\x6f\x72\144\x65\x72\137\141\154\x6c\x6f\167\137\x64\x61\171\163"); goto JIulx; JZOEP: $i++; goto oqePk; Sy93b: if (!$available) { goto ad66_; } goto vJkJ9; JIulx: $nowDay = date("\x59\55\155\x2d\x64", strtotime($nowDay . "\40\x2b{$appoint_order_ahead_of_days}\40\144\x61\171\x73")); goto oJrVE; cqteD: if (!($i < $appoint_order_allow_days)) { goto H6wsx; } goto kunwJ; kYkVh: $appointTimes = Db::table("\x65\x78\160\145\162\164\x5f\x61\x70\160\x6f\151\x6e\164\x5f\x74\151\155\145")->where(["\145\170\160\x65\x72\x74\137\x69\x64" => $expertId, "\x77\145\x65\x6b\137\144\141\x79" => $weekDay])->order("\x61\160\x70\x6f\151\156\164\x5f\x74\151\155\145\x20\x61\163\143")->column("\141\160\160\x6f\151\156\x74\x5f\x74\x69\x6d\x65"); goto qqXdl; XiIv8: $available = $available45AppointTimes || $available15AppointTimes ? true : false; goto Sy93b; oJrVE: $i = 0; goto ZEfH0; kunwJ: $weekDay = date("\167", strtotime($nowDay)); goto kYkVh; L3M6Y: H6wsx: goto M4ehN; qqXdl: $appointTimes45 = []; goto m_uW3; vJkJ9: $weekDayList[] = ["\x77\145\145\x6b\104\141\171" => $weekDay, "\141\166\x61\151\154\x61\x62\154\x65" => $available, "\144\x61\x74\x65" => $nowDay, "\154\x61\142\x65\154" => sprintf("\45\x73\x20\x7c\40\45\x73", getWeekdayText($weekDay), date("\155\x2d\x64", strtotime($nowDay))), "\141\x76\x61\x69\154\141\142\154\145\64\x35\x41\160\x70\157\151\x6e\164\124\151\x6d\145\x73" => $available45AppointTimes, "\141\166\x61\151\x6c\x61\x62\x6c\x65\x31\65\101\160\160\x6f\151\x6e\x74\124\x69\x6d\x65\x73" => $available15AppointTimes]; goto CO4WT; Wpkjx: $nowDay = date("\x59\55\x6d\55\144"); goto K4JvR; T872q: $nowDay = date("\131\x2d\155\x2d\144", strtotime($nowDay . "\x20\x2b\61\x20\144\141\171")); goto JZOEP; NqRCM: $appointedTimes15 = Db::table("\145\170\160\x65\x72\164\137\157\x72\x64\x65\x72")->where(["\x65\x78\x70\145\x72\x74\x5f\151\x64" => $expertId, "\141\x70\160\157\151\x6e\x74\x5f\144\141\164\x65" => $nowDay, "\x61\160\160\x6f\151\x6e\x74\137\x64\x75\x72\141\164\151\x6f\x6e" => 15, "\x73\164\141\x74\x75\163" => ["\156\145\x71", IndexDefs::ORDER_CANCELLED_STATUS]])->order("\141\160\x70\x6f\x69\156\164\137\164\x69\155\145\40\x61\x73\143")->column("\x61\x70\x70\157\x69\156\x74\x5f\x74\151\155\145"); goto OGhQI; M4ehN: return $weekDayList; goto bpFGK; m_uW3: $appointTimes15 = []; goto XJnu0; f1b6v: $available15AppointTimes = array_values(array_diff($appointTimes15, $appointedTimes15)); goto XiIv8; CO4WT: ad66_: goto T872q; uxOrd: $weekDayList = []; goto Wpkjx; K4JvR: $appoint_order_ahead_of_days = systemSetting("\141\x70\x70\x6f\151\156\164\137\157\162\144\x65\162\137\x61\150\145\x61\144\137\157\x66\137\144\x61\171\x73"); goto k5ZZ2; ZEfH0: ZrTRM: goto cqteD; gJc9z: $appointedTimes45 = Db::table("\145\170\x70\145\x72\164\137\x6f\x72\x64\145\x72")->where(["\x65\170\160\x65\x72\x74\x5f\151\x64" => $expertId, "\x61\160\160\157\151\x6e\x74\x5f\144\x61\x74\145" => $nowDay, "\141\160\x70\157\151\156\164\137\144\x75\x72\x61\x74\151\x6f\x6e" => 45, "\163\164\141\164\165\x73" => ["\x6e\145\161", IndexDefs::ORDER_CANCELLED_STATUS]])->order("\x61\160\x70\x6f\151\x6e\164\x5f\164\151\x6d\145\x20\141\x73\143")->column("\x61\x70\x70\x6f\x69\x6e\x74\x5f\x74\151\x6d\145"); goto NqRCM; NopmT: yOef9: goto gJc9z; oqePk: goto ZrTRM; goto L3M6Y; XJnu0: foreach ($appointTimes as $appointTime) { goto FVvKQ; vWy0O: if (count($intervals) == 1) { goto d9HwW; } goto Sqond; zcSGI: d9HwW: goto Zaydd; VjQKj: nF2jy: goto DYZxr; Sqond: if (!(count($intervals) == 3)) { goto nF2jy; } goto o7laz; Zaydd: $appointTimes15[] = $appointTime; goto ztkP7; FVvKQ: $intervals = explode("\54", $appointTime); goto vWy0O; DYZxr: goto PLR6i; goto zcSGI; nqVb2: bjKlX: goto YDoC2; o7laz: $appointTimes45[] = $appointTime; goto VjQKj; ztkP7: PLR6i: goto nqVb2; YDoC2: } goto NopmT; OGhQI: $available45AppointTimes = array_values(array_diff($appointTimes45, $appointedTimes45)); goto f1b6v; bpFGK: } public function submitAppointOrder($uid, $postData) { goto SrWUu; OxXpT: srPBx: goto QaUBW; PmOm2: $smsCode = $postData["\163\x6d\163"] ?? ''; goto N7brd; HOTfZ: Db::table("\x65\x78\x70\145\x72\x74")->where(["\151\x64" => $expertId])->update(["\154\141\164\x65\163\164\137\141\160\160\x6f\x69\156\x74\137\164\151\x6d\145" => Db::raw("\x6e\x6f\x77\50\51"), "\x74\157\x74\x61\x6c\x5f\141\x70\160\x6f\151\156\x74\x5f\161\x75\x61\156\164\151\164\171" => Db::raw("\164\157\164\x61\154\137\141\x70\x70\157\151\x6e\164\x5f\161\165\141\x6e\164\151\x74\x79\53\61"), "\164\x6f\164\141\154\x5f\x61\160\160\x6f\151\156\x74\137\141\155\157\165\x6e\164" => Db::raw("\164\157\164\141\154\137\x61\160\160\x6f\151\x6e\x74\137\x61\155\157\165\156\x74\x2b" . $orderAmount)]); goto Ai85r; G9cCs: return $orderNo; goto jAvo6; U0dpw: tiiJl: goto NzMWn; N7brd: $remark = $postData["\x72\x65\155\x61\x72\153"] ?? ''; goto viQ4i; QaUBW: $expertInfos = ExpertLogic::I()->getInfos($expertId); goto mFdy2; F800j: if (!(empty($expertId) || empty($appointDate) || empty($appointDuration) || empty($appointTime) || empty($appointMode))) { goto WyMYp; } goto bW8lM; sEafY: WyMYp: goto ibxRI; VLewB: foreach ($supportTels as $supportTel) { goto rEyOw; t22po: Log::error("\146\141\x69\x6c\x65\144\x20\x74\157\x20\x73\x65\x6e\x64\40\x73\x6d\163\40\x74\157\x20\x73\165\x70\x70\x6f\162\164\40{$supportTel}"); goto iOMc7; dnjr7: Log::notice("\x74\150\x65\x20\x63\x75\163\x74\x6f\155\145\x72\x20\163\165\160\x70\157\x72\164\40\164\x65\154\x20{$supportTel}\x20\151\x73\40\x6e\x6f\164\x20\166\x61\x6c\151\x64\x2c\x20\x73\x6b\151\160"); goto m1qlu; iOMc7: IBmpo: goto MKnPi; S2pk2: $smsResult = SmsLogic::I()->sendAppoitOrderToSupport($supportTel, date("\x6d\xe6\234\210\x64\xe6\227\245", strtotime($appointDate)) . "\x20" . $appointTimeSms); goto WeSLF; m1qlu: goto KPMdA; goto Sqt4L; KlB80: logEvent("\xe5\x8f\221\xe9\x80\x81\xe9\xa2\204\347\xba\xa6\351\x80\x9a\347\x9f\xa5\xe7\237\255\xe4\277\xa1\345\210\xb0\xe5\256\xa2\xe6\234\x8d{$supportTel}\345\244\xb1\xe8\264\xa5", EventLogsService::eSeverityError); goto t22po; WeSLF: if ($smsResult) { goto IBmpo; } goto KlB80; MKnPi: KPMdA: goto u7Wk5; rEyOw: if (validateMobile($supportTel)) { goto fbm2v; } goto dnjr7; Sqt4L: fbm2v: goto S2pk2; u7Wk5: } goto U0dpw; mg72Z: Log::notice("\163\155\163\40\143\141\160\x74\x63\x68\x61\x20\x63\157\x64\x65\x20\x77\x72\157\x6e\147\x3a\40" . $smsCode); goto QzaXO; SLwWe: $appointMode = $postData["\141\x70\x70\x6f\151\x6e\x74\x4d\x6f\144\x65"] ?? ''; goto F800j; sZVGX: $smsResult = SmsLogic::I()->sendAppoitOrderToExpert($expertInfos["\x63\x65\x6c\x6c\x70\150\157\156\x65"], date("\x6d\xe6\x9c\210\x64\346\227\xa5", strtotime($appointDate)) . "\x20" . $appointTimeSms); goto fLWok; bW8lM: wexception("\346\x95\xb0\xe6\215\256\xe4\270\215\345\xae\x8c\xe6\x95\264"); goto sEafY; qp7Ns: Z8QU6: goto oWWOP; TReV5: $cellphone = $postData["\x63\145\x6c\154\x70\x68\157\156\145"] ?? ''; goto PmOm2; viQ4i: if (SmsLogic::I()->verifyCaptcha($cellphone, $smsCode, "\x41\x50\x50\x4f\111\x4e\x54")) { goto srPBx; } goto mg72Z; ibxRI: $realName = $postData["\162\x65\x61\154\x4e\x61\155\145"] ?? ''; goto TReV5; mFdy2: if ($expertInfos) { goto HPEGl; } goto Pe0WG; JeNN1: $appointTimeSms = convertAppointTimesToShow($appointTime); goto mc0RW; S7mig: $appointDate = $postData["\x61\160\x70\157\x69\x6e\164\104\x61\x74\145"] ?? ''; goto Fqv4r; SrWUu: $expertId = $postData["\x65\170\x70\145\162\x74\x49\144"] ?? 0; goto S7mig; Gr0Y6: HPEGl: goto AUfDa; mc0RW: if (!(systemSetting("\163\145\156\144\137\141\160\x70\157\x69\x6e\x74\137\x6f\x72\144\145\162\x5f\164\157\x5f\x65\170\x70\145\x72\x74") == "\x79\145\x73")) { goto Z8QU6; } goto sZVGX; WHd8p: $orderNo = AppointOrderLogic::I()->generateOrder($uid, $expertId, $orderAmount, $appointDate, $appointTime, $appointDuration, $appointMode, $payStatus); goto HOTfZ; FdVyz: $appointTime = $postData["\x61\x70\x70\x6f\151\x6e\164\x54\151\155\145"] ?? ''; goto SLwWe; AUfDa: $orderAmount = $appointDuration == 15 ? $expertInfos["\141\x70\160\x6f\x69\156\164\137\162\145\x76\151\x65\x77\137\146\x65\145"] : $expertInfos["\141\x70\160\157\x69\x6e\x74\137\x66\x65\145"]; goto Yejtc; OyOcy: Log::error("\146\141\x69\x6c\145\144\40\164\x6f\x20\163\145\x6e\x64\x20\x73\x6d\x73\40\x74\157\40\x65\170\160\145\x72\164\x20{$expertInfos["\x63\x65\x6c\154\x70\150\157\156\145"]}"); goto PyFKp; oWWOP: $supportTels = explode("\54", systemSetting("\163\145\x6e\144\137\x61\160\x70\x6f\151\x6e\x74\x5f\x6f\162\144\x65\162\x5f\164\157\x5f\163\x75\160\160\x6f\162\x74\137\164\x65\154\163")); goto VLewB; QzaXO: wexception("\xe7\x9f\xad\xe4\277\241\351\252\214\xe8\xaf\201\347\240\201\xe9\224\231\xe8\xaf\xaf"); goto OxXpT; Fqv4r: $appointDuration = $postData["\x61\x70\160\157\151\x6e\164\x44\x75\x72\x61\x74\x69\x6f\x6e"] ?? ''; goto FdVyz; fLWok: if ($smsResult) { goto olXqK; } goto ZGhEa; Pe0WG: wexception("\xe6\227\xa0\xe6\xb3\225\346\211\276\345\x88\260\350\257\xa5\344\xb8\223\xe5\256\266"); goto Gr0Y6; Yejtc: $payStatus = systemSetting("\x61\160\160\157\151\156\x74\137\157\x72\144\145\x72\137\160\141\171\x5f\x6d\157\x64\145\154") == "\xe7\xba\277\344\270\213\xe6\224\257\xe4\273\x98" ? Defs::PAY_OFFLINE : Defs::PAY_WAIT; goto WHd8p; NzMWn: Db::table("\145\170\x70\x65\x72\x74\x5f\157\162\144\x65\162")->where(["\x6f\162\144\x65\162\137\x6e\x6f" => $orderNo])->update(["\154\x69\x6e\x6b\x6d\x61\x6e" => $realName, "\143\x65\154\154\160\150\157\156\x65" => $cellphone, "\x72\145\x6d\141\162\153" => $remark]); goto G9cCs; PyFKp: olXqK: goto qp7Ns; Ai85r: Db::table("\x63\x75\163\164\x6f\x6d\x65\162")->where(["\151\x64" => $uid])->update(["\x6c\x61\x74\145\x73\x74\137\141\x70\x70\157\151\x6e\164\137\x74\151\x6d\145" => Db::raw("\156\x6f\167\50\x29"), "\x74\157\164\141\154\x5f\x61\160\x70\x6f\151\x6e\164\x5f\x71\165\x61\x6e\x74\151\164\x79" => Db::raw("\x74\157\164\x61\x6c\137\x61\x70\x70\x6f\151\x6e\164\x5f\x71\x75\141\x6e\x74\151\x74\x79\x2b\x31"), "\x74\x6f\x74\141\x6c\137\141\160\x70\157\x69\x6e\164\137\x61\155\157\x75\x6e\x74" => Db::raw("\x74\157\x74\x61\x6c\137\141\160\x70\157\x69\156\x74\x5f\x61\x6d\x6f\165\156\x74\x2b" . $orderAmount)]); goto JeNN1; ZGhEa: logEvent("\xe5\x8f\221\351\200\201\351\xa2\204\347\272\246\xe9\x80\x9a\347\237\xa5\347\x9f\xad\344\277\xa1\xe5\x88\xb0\344\xb8\x93\345\256\xb6{$expertInfos["\143\145\154\154\160\x68\157\x6e\145"]}\345\244\xb1\350\xb4\245", EventLogsService::eSeverityError); goto OyOcy; jAvo6: } public function appointPay($uid, $orderNo) { goto VI1As; Ly4jc: Log::error("{$orderNo}\x20\345\xbe\256\xe4\xbf\241\344\xb8\x8b\xe5\215\225\345\244\261\xe8\264\245\xef\xbc\x9a\xe8\xbf\224\345\233\x9e\347\xa9\xba"); goto fsBpF; VIlCd: $data["\x6e\145\x65\x64\x5f\x70\141\171"] = false; goto fkVmC; mfMGb: Db::table("\145\x78\x70\x65\162\x74\137\x6f\162\x64\145\x72")->where(["\x6f\x72\144\145\x72\x5f\x6e\x6f" => $orderInfos["\157\162\144\145\162\137\x6e\157"]])->setField("\160\162\145\160\141\x79\x5f\151\x64", $res["\x70\x72\145\x70\141\x79\137\x69\x64"]); goto ruM9B; gHkU8: wkoqB: goto W9SfE; V3TfW: wexception("\345\xbd\x93\345\211\215\xe7\216\257\xe5\xa2\x83\344\270\x8d\346\224\xaf\xe6\214\x81\xe6\224\257\xe4\273\x98\xe6\x93\215\344\xbd\x9c"); goto cl2DV; zrGqX: wxPaySetting(); goto C6yqV; ZGYfV: Log::error("{$orderNo}\x20\345\xbe\256\344\xbf\241\xe4\xb8\x8b\345\x8d\x95\xe5\xa4\261\350\264\xa5\357\xbc\232\xe8\xbf\224\xe5\x9b\236\40" . var_export($res, true)); goto dndtv; VI1As: $data = ["\157\162\x64\145\162\116\157" => $orderNo]; goto mOKx1; yq2_m: NbAcP: goto yURST; YEiB6: wexception("\345\276\xae\344\xbf\xa1\xe4\270\213\xe5\x8d\225\345\244\xb1\350\264\xa5\357\274\232" . $res["\x72\x65\x74\165\x72\x6e\137\155\163\147"]); goto EoHGN; BU2On: $res = $app->order->unify(["\x62\157\x64\171" => "\xe9\242\204\xe7\272\246\350\xb4\xb9\347\224\250", "\x6f\165\x74\x5f\x74\162\141\x64\145\137\x6e\157" => $orderInfos["\x6f\x72\x64\145\162\x5f\156\x6f"], "\x74\x6f\164\141\x6c\137\x66\145\x65" => $orderInfos["\x6f\x72\144\x65\x72\x5f\141\155\157\x75\x6e\x74"] * 100, "\156\157\x74\151\x66\x79\x5f\x75\162\x6c" => url("\x6d\x70\x2f\x57\x78\x2f\160\141\151\x64\x45\170\160\145\162\164\117\162\144\x65\162", '', false, true), "\164\x72\141\x64\x65\137\x74\x79\x70\145" => "\x4a\x53\101\x50\x49", "\x6f\160\x65\156\x69\144" => $uid]); goto FaVWu; yheTG: logEvent("\345\x92\xa8\xe8\257\xa2\xe9\xa2\204\347\xba\xa6\350\256\xa2\345\215\225{$orderNo}\346\224\xaf\344\xbb\230\xe5\xa4\xb1\350\xb4\245\54\40{$res["\145\162\162\137\143\157\x64\145\x5f\x64\x65\x73"]}", EventLogsService::eSeverityWarning); goto ZGYfV; J4Q7Q: $appointTimeSms = convertAppointTimesToShow($orderInfos["\x61\x70\160\157\x69\x6e\164\137\x74\151\155\145"]); goto G0Imr; scOlx: if ($orderInfos) { goto tGQQG; } goto bP5Vq; uB2lV: EMpyr: goto mfMGb; YNqJ4: Db::table("\145\170\x70\145\162\x74\137\157\162\x64\145\x72")->where(["\157\x72\x64\145\x72\x5f\156\157" => $orderInfos["\x6f\162\144\x65\162\137\156\157"]])->setField("\x70\x61\171\x5f\163\164\x61\x74\x75\163", $payStatus); goto OVzQs; NESRc: wexception("\xe5\xbe\xae\344\xbf\xa1\344\270\213\xe5\215\225\xe5\xa4\261\350\xb4\xa5\357\xbc\x9a\350\277\x94\345\233\236" . $res); goto a6Z3A; O7gO3: Log::error("{$orderNo}\x20\xe5\xbe\xae\xe4\xbf\xa1\344\270\213\xe5\x8d\x95\xe5\244\xb1\xe8\264\xa5\xef\xbc\x9a\350\277\x94\345\233\236\x20" . $res); goto NESRc; G0Imr: $smsResult = SmsLogic::I()->sendAppoitOrderToCustomer($orderInfos["\143\145\154\154\x70\150\157\156\145"], date("\x6d\346\234\x88\x64\xe6\227\245", strtotime($orderInfos["\141\x70\x70\x6f\151\156\164\137\144\141\x74\145"])) . "\x20" . $appointTimeSms, systemSetting("\x61\x70\160\157\151\x6e\164\x5f\x6f\x72\144\x65\162\137\x6f\x66\x66\151\x63\145\x5f\141\144\x64\x72\145\163\163")); goto m3s3x; t9RR5: tGQQG: goto FqfM5; luXLR: $payStatus = systemSetting("\141\x70\x70\x6f\151\156\x74\137\157\162\144\145\162\137\x70\x61\x79\137\x6d\157\144\145\154") == "\347\xba\xbf\344\270\x8b\xe6\x94\257\344\xbb\230" ? Defs::PAY_OFFLINE : Defs::PAY_SUCCESS; goto YNqJ4; aaVbr: goto TmVLj; goto ixr3A; pklOA: if (systemSetting("\x61\160\x70\157\x69\x6e\x74\x5f\157\x72\144\x65\x72\137\160\x61\171\x5f\155\x6f\x64\145\x6c") == "\xe7\xba\277\xe4\xb8\x8b\xe6\224\257\xe4\xbb\x98" || !$orderAmount) { goto rY2FT; } goto JNNNA; m3s3x: if ($smsResult) { goto wkoqB; } goto u4G3Y; BrXES: tgi22: goto qUuXf; kvOnL: if (!($res["\x72\x65\x74\x75\x72\156\137\x63\157\144\x65"] == "\106\101\x49\114")) { goto Ob1eV; } goto rv5tc; fsBpF: wexception("\345\276\256\xe4\xbf\241\344\270\x8b\xe5\x8d\x95\345\244\xb1\350\xb4\245\357\274\x9a\350\277\224\345\233\x9e\xe7\xa9\272"); goto BrXES; bP5Vq: wexception("\xe8\xae\xa2\xe5\x8d\x95\344\270\215\xe5\255\230\345\234\250"); goto t9RR5; HWBRq: $data["\x6e\x65\145\144\x5f\160\x61\171"] = true; goto zrGqX; uZ9Y1: $app = Factory::payment(array_merge(config("\167\x78\56\x70\141\x79\155\x65\x6e\164"), ["\x61\160\x70\x5f\151\x64" => config("\x77\x78\56\157\146\x66\x69\143\x69\141\154\x5f\x61\143\143\157\x75\156\164")["\x61\x70\160\x5f\151\x64"]])); goto BU2On; cl2DV: D9WA_: goto HWBRq; mOKx1: $data["\165\162\x6c"] = url("\x6d\x70\x2f\105\170\x70\145\162\x74\x2f\x61\x70\x70\x6f\x69\156\164\x53\x75\x63\143\145\163\x73", ["\x6f\x72\144\145\x72\116\157" => $orderNo]); goto EILGE; qUuXf: if (is_array($res)) { goto r7Y7F; } goto O7gO3; rv5tc: logEvent("\xe5\222\250\xe8\xaf\xa2\351\242\x84\xe7\xba\xa6\xe8\256\xa2\345\215\x95{$orderNo}\xe6\x94\xaf\xe4\273\230\xe5\xa4\xb1\xe8\264\245\54\x20{$res["\162\145\164\165\162\x6e\x5f\155\163\147"]}", EventLogsService::eSeverityWarning); goto YEiB6; OVzQs: Db::table("\145\170\x70\x65\162\x74\x5f\x6f\162\144\x65\162")->where(["\157\162\144\x65\162\137\156\x6f" => $orderInfos["\x6f\x72\144\x65\162\137\156\x6f"]])->setField("\x73\x74\141\x74\x75\163", IndexDefs::ORDER_APPOINTED_STATUS); goto p2A7_; uwknT: if (!empty($res)) { goto tgi22; } goto Ly4jc; c_e0Q: Log::error("\146\x61\151\154\145\144\x20\164\157\x20\163\145\x6e\144\x20\163\x6d\x73\40\x74\157\40\143\x75\163\x74\157\155\x65\x72\40{$orderInfos["\x63\x65\154\154\160\150\157\156\145"]}"); goto gHkU8; FqfM5: $orderAmount = floatval($orderInfos["\x6f\x72\144\x65\x72\x5f\141\155\157\x75\156\164"]); goto pklOA; dndtv: wexception("\xe5\xbe\xae\344\xbf\241\xe4\xb8\x8b\xe5\x8d\225\xe5\244\261\350\264\xa5\xef\xbc\232" . $res["\145\162\x72\137\x63\157\144\x65\x5f\144\145\163"]); goto yq2_m; iV9D2: return $data; goto vSDB0; U6LuW: XTGD7: goto uZ9Y1; JNNNA: if (!($uid == 1)) { goto D9WA_; } goto V3TfW; p2A7_: if (!(systemSetting("\163\x65\x6e\x64\x5f\x61\x70\160\157\151\x6e\x74\x5f\x6f\x72\x64\145\162\137\164\157\x5f\143\165\x73\164\157\155\145\x72") == "\x79\145\163")) { goto ptRyR; } goto J4Q7Q; a6Z3A: r7Y7F: goto kvOnL; W9SfE: ptRyR: goto VIlCd; Ek4KK: if (!($res["\162\145\163\x75\154\x74\x5f\143\x6f\144\x65"] == "\x46\x41\111\114")) { goto NbAcP; } goto yheTG; z40TZ: Log::error("{$orderNo}\x20\345\xbe\xae\xe4\xbf\241\xe4\270\213\xe5\215\x95\345\244\261\xe8\264\xa5\xef\274\232\346\227\xa0\160\x72\145\160\141\171\x5f\x69\144\54\40\350\xbf\x94\345\233\236\40" . var_export($res, true)); goto hXBfA; ruM9B: $data["\143\157\156\x66\x69\x67"] = $app->jssdk->bridgeConfig($res["\x70\x72\x65\x70\x61\x79\137\151\x64"], false); goto aaVbr; u4G3Y: logEvent("\345\217\221\351\200\x81\xe9\xa2\204\xe7\xba\246\351\x80\x9a\xe7\237\245\xe7\x9f\255\344\xbf\xa1\345\x88\xb0\345\xae\xa2\xe6\x88\267{$orderInfos["\143\x65\154\154\160\150\x6f\x6e\x65"]}\345\244\xb1\xe8\264\xa5", EventLogsService::eSeverityError); goto c_e0Q; yURST: if (isset($res["\x70\162\x65\x70\x61\x79\137\151\x64"])) { goto EMpyr; } goto z40TZ; fkVmC: TmVLj: goto iV9D2; BezMj: wexception("\xe8\xaf\xb7\xe9\x85\215\347\275\xae\345\276\256\xe4\xbf\241\345\x85\xac\xe4\xbc\x97\345\217\xb7\xe5\222\x8c\345\xbe\256\xe4\277\241\346\x94\xaf\344\273\x98\345\217\x82\xe6\225\xb0"); goto U6LuW; C6yqV: if (!(empty(config("\x77\170\56\x6f\x66\x66\x69\x63\x69\141\154\137\141\x63\143\157\x75\x6e\164")["\141\160\160\x5f\151\x64"]) || empty(config("\x77\x78\x2e\x70\141\171\155\x65\x6e\164")["\x6d\x63\x68\x5f\151\x64"]))) { goto XTGD7; } goto BezMj; EoHGN: Ob1eV: goto Ek4KK; ixr3A: rY2FT: goto luXLR; FaVWu: Log::notice("{$orderNo}\x20\167\x65\143\x68\141\x74\x20\x70\141\171\x20\162\x65\x74\165\x72\x6e\40" . var_export($res, true)); goto uwknT; hXBfA: wexception("\345\xbe\256\344\xbf\241\xe4\270\x8b\345\x8d\x95\345\244\xb1\350\264\245\xef\xbc\x9a\346\227\240\346\263\x95\xe6\211\xbe\345\210\260\160\x72\145\x70\x61\x79\x5f\x69\144"); goto uB2lV; EILGE: $orderInfos = AppointOrderLogic::I()->getOrderInfos($uid, $orderNo); goto scOlx; vSDB0: } }
