<?php
 namespace app\mp\service; use app\Defs; use think\Db; use think\Log; use EasyWeChat\Factory; use app\index\logic\Defs as IndexDefs; use app\index\logic\Subject as SubjectLogic; use app\mp\service\RequestContext; use app\common\service\Redis as RedisService; use app\mp\controller\Wx; use app\index\logic\Expert as ExpertLogic; use app\index\logic\Sms as SmsLogic; use app\index\logic\AppointOrder as AppointOrderLogic; use app\index\service\EventLogs as EventLogsService; class Expert extends Bases { public function loadExperts($categoryId, $name, $page, $rows) { goto ctmtH; ixZJl: return ["\x72\157\x77\x73" => $records, "\160\x61\147\145\x5f\x65\156\144" => $totalReturn >= $total]; goto AJ9vt; cGLQp: $records = Db::table("\x65\x78\x70\x65\162\164")->alias("\105")->join("\x65\170\160\x65\162\x74\137\x63\141\x74\145\147\x6f\162\x79\137\x72\x65\154\x61\x74\145\x20\x45\103\122", "\105\56\151\144\x3d\105\x43\x52\56\x65\x78\x70\x65\162\x74\x5f\151\x64")->where($conditions)->page($page, $rows)->field("\151\144\x2c\40\x77\x6f\162\x6b\x69\x6d\x67\x5f\165\x72\x6c\x2c\x20\162\145\141\154\137\x6e\141\x6d\x65\54\40\x65\x78\x70\x65\x72\164\137\x71\165\141\154\x69\164\x79\54\40\x61\x70\x70\x6f\151\156\164\x5f\x66\145\x65\x2c\x20\x63\157\x6e\x73\165\154\164\137\x71\165\x61\x6e\x74\x69\x74\171")->select(); goto QOBgS; CS_nW: CjgKU: goto xUiOP; lCIsv: $totalReturn = ($page - 1) * $rows + count($records); goto ixZJl; QAUpk: if (!$name) { goto CjgKU; } goto XdZOp; RveXq: foreach ($records as &$record) { goto A5bbB; aeRik: $fieldNames = Db::table("\145\170\x70\x65\162\164\137\146\151\x65\x6c\144\137\162\x65\154\x61\164\145")->alias("\105\x46\x52")->join("\145\170\160\x65\162\164\x5f\146\x69\x65\x6c\144\x5f\151\x74\145\x6d\40\x45\106\x49", "\105\106\x52\56\x66\151\x65\x6c\144\x5f\151\164\145\x6d\x5f\151\144\75\x45\106\x49\56\151\144")->where(["\105\106\122\x2e\x65\170\x70\x65\x72\x74\137\151\144" => $record["\151\144"]])->column("\x45\x46\x49\x2e\146\x69\x65\154\x64\x5f\151\164\145\155"); goto BAw3N; eRJhl: R2NQe: goto mMSgu; A5bbB: $targetNames = Db::table("\145\x78\160\145\162\164\x5f\164\141\x72\x67\145\164\x5f\162\145\154\141\x74\145")->alias("\x45\x54\122")->join("\145\170\x70\x65\x72\164\137\x74\141\162\147\x65\164\40\105\x54", "\105\x54\122\x2e\164\x61\x72\147\x65\164\x5f\x69\x64\x3d\x45\124\x2e\x69\144")->where(["\105\x54\x52\56\145\170\x70\145\x72\164\137\x69\144" => $record["\x69\x64"]])->column("\x45\124\56\164\141\x72\x67\x65\x74"); goto bYb9a; bYb9a: $record["\x74\x61\x72\x67\145\x74\137\156\x61\x6d\x65\163"] = $targetNames; goto aeRik; wFYpY: $record["\x65\x78\160\x65\162\164\x5f\x71\165\141\154\x69\164\171"] = nl2br($record["\145\x78\160\x65\x72\x74\137\161\165\141\154\151\164\171"]); goto q_1mH; BAw3N: $record["\x66\151\x65\x6c\x64\x5f\x6e\141\155\x65\x73"] = $fieldNames; goto wFYpY; q_1mH: $record["\167\x6f\x72\153\x69\155\147\x5f\165\162\154"] = generateThumbnailUrl($record["\x77\157\162\x6b\151\155\147\137\x75\x72\154"], 300); goto eRJhl; mMSgu: } goto AVFMg; ctmtH: $conditions = ["\x45\x2e\144\x65\x6c\x65\x74\x65\x5f\146\x6c\141\x67" => 0, "\x45\56\x73\164\x61\x74\165\x73" => IndexDefs::ENTITY_PUBLISH_STATUS]; goto QAUpk; XdZOp: $conditions["\x45\x2e\x72\145\141\x6c\x5f\x6e\141\155\145"] = ["\x6c\x69\x6b\x65", "\x25" . $name . "\x25"]; goto CS_nW; O4YeU: $total = Db::table("\145\x78\x70\145\162\x74")->alias("\105")->where($conditions)->count(); goto dcMrM; htH0E: $total = Db::table("\145\x78\x70\x65\x72\164")->alias("\x45")->join("\145\170\160\145\162\x74\x5f\143\141\x74\145\x67\x6f\x72\171\137\162\145\154\141\164\x65\x20\105\103\x52", "\105\x2e\x69\144\75\105\103\x52\56\145\170\160\145\x72\x74\x5f\x69\144")->where($conditions)->count(); goto cGLQp; dcMrM: $records = Db::table("\145\170\160\x65\162\x74")->alias("\x45")->where($conditions)->page($page, $rows)->field(true)->select(); goto G2Yk1; xUiOP: if ($categoryId) { goto yw561; } goto O4YeU; B6ygz: yw561: goto AO47m; G2Yk1: goto tmhxp; goto B6ygz; QOBgS: tmhxp: goto RveXq; AVFMg: ZkWKK: goto lCIsv; AO47m: $conditions["\105\x43\122\56\x63\x61\164\x65\x67\157\x72\171\137\x69\x64"] = $categoryId; goto htH0E; AJ9vt: } public function getExpert($expertId) { goto wOtHk; oc1fU: $record["\152\157\x62\x5f\171\x65\141\x72\x73"] = ''; goto To5ug; To5ug: goto ZBLs2; goto rK_03; txHzC: wexception("\xe4\xb8\x93\345\256\xb6\345\xb7\xb2\xe4\xb8\xad\346\255\xa2"); goto hOo9f; wOtHk: $record = Db::table("\145\170\x70\145\x72\x74")->where(["\151\144" => $expertId, "\144\145\x6c\145\x74\x65\x5f\146\154\141\x67" => 0])->field(true)->find(); goto NXYVO; CVv4X: if (!($record["\x73\x74\x61\164\165\163"] == IndexDefs::ENTITY_DRAFT_STATUS)) { goto DTwp2; } goto Ul0WX; sWhYZ: return $record; goto cpotA; IdCOC: DHBhh: goto CVv4X; vdUFS: wexception("\344\270\223\345\xae\xb6\xe4\270\x8d\345\xad\x98\xe5\x9c\xa8"); goto IdCOC; hOo9f: yFsBg: goto tK3Hc; wS7Fl: if ($record["\x66\151\162\x73\164\137\x6a\157\142\x5f\164\151\155\145"]) { goto h1mmG; } goto oc1fU; LJA_5: $record["\x74\x61\162\x67\x65\x74\x73\137\141\x6c\x6c"] = Db::table("\145\170\160\x65\x72\x74\137\164\x61\x72\147\145\x74\x5f\162\x65\154\x61\x74\x65")->alias("\x45\124\x52")->join("\145\x78\x70\x65\162\x74\x5f\164\141\162\x67\145\164\x20\105\124", "\105\x54\x52\x2e\x74\x61\x72\x67\x65\x74\137\x69\x64\x3d\105\124\56\x69\x64")->where(["\105\x54\x52\56\145\170\x70\x65\162\x74\x5f\151\x64" => $expertId])->column("\105\124\x2e\x74\141\x72\x67\x65\x74"); goto T_zS_; tK3Hc: $record["\146\x69\x65\154\144\137\151\x74\x65\x6d\163\x5f\141\154\x6c"] = Db::table("\x65\x78\x70\145\162\x74\137\x66\151\x65\154\144\137\x72\x65\x6c\x61\164\145")->alias("\105\x46\x52")->join("\x65\x78\160\x65\x72\164\x5f\146\x69\145\154\144\137\151\x74\x65\x6d\x20\105\x46\111", "\x45\106\111\x2e\151\144\x3d\105\x46\x52\x2e\x66\x69\145\x6c\x64\137\x69\164\145\x6d\x5f\151\144")->where(["\x45\x46\122\56\x65\x78\160\145\162\x74\137\151\144" => $expertId])->column("\x45\x46\x49\56\146\151\x65\154\x64\137\151\x74\145\155"); goto tMF_n; Liuzp: ZBLs2: goto sWhYZ; NXYVO: if ($record) { goto DHBhh; } goto vdUFS; mG4ZJ: if (!($record["\163\164\141\164\165\163"] == IndexDefs::ENTITY_END_STATUS)) { goto yFsBg; } goto txHzC; Sw3Rm: $years = date_diff(date_create(date("\131\55\155\55\144")), date_create($record["\146\x69\162\163\164\137\152\157\142\x5f\164\x69\x6d\x65"]))->days / 365; goto KhXrW; rK_03: h1mmG: goto Sw3Rm; T_zS_: $record["\164\141\x72\x67\145\164\163"] = array_slice($record["\164\141\x72\x67\x65\x74\x73\137\x61\x6c\x6c"], 0, 3); goto wS7Fl; Ul0WX: wexception("\xe4\270\x93\345\xae\266\346\x9c\252\345\x8f\221\xe5\xb8\203"); goto oCUCd; tMF_n: $record["\146\151\145\154\144\137\x69\x74\145\x6d\163"] = array_slice($record["\x66\x69\145\x6c\144\x5f\x69\164\145\x6d\163\x5f\141\154\154"], 0); goto LJA_5; KhXrW: $record["\x6a\157\x62\x5f\171\x65\141\x72\163"] = floor($years); goto Liuzp; oCUCd: DTwp2: goto mG4ZJ; cpotA: } public function getAvailableAppointTime($expertId) { goto B6Hm0; PTm7I: if (!$available) { goto tQ7Si; } goto hZsu0; is61y: EbFaO: goto XkDSS; XXdSG: $appoint_order_allow_days = systemSetting("\141\160\160\x6f\151\x6e\164\137\x6f\162\144\x65\162\137\x61\154\154\157\x77\137\144\x61\x79\x73"); goto UdyrZ; yK4dB: goto Resk7; goto is61y; NgIgp: $i++; goto yK4dB; FezaI: $weekDay = date("\x77", strtotime($nowDay)); goto EPMT6; Yizdw: tQ7Si: goto gnhq4; XkDSS: return $weekDayList; goto neJsX; b1ALP: $available = $available45AppointTimes || $available15AppointTimes ? true : false; goto PTm7I; B6Hm0: $weekDayList = []; goto yZCD3; EPMT6: $appointTimes = Db::table("\x65\x78\160\x65\x72\164\137\141\x70\x70\x6f\151\x6e\x74\137\x74\151\155\145")->where(["\x65\x78\x70\145\162\x74\137\151\x64" => $expertId, "\167\145\x65\x6b\x5f\x64\x61\171" => $weekDay])->order("\141\x70\160\x6f\x69\x6e\164\137\164\151\155\x65\40\x61\163\x63")->column("\141\160\x70\157\151\x6e\x74\x5f\x74\x69\155\x65"); goto WqBLY; TSMLy: $available45AppointTimes = array_values(array_diff($appointTimes45, $appointedTimes45)); goto q2L4C; E3_Hg: $appointedTimes15 = Db::table("\145\170\160\145\x72\x74\x5f\157\162\144\x65\162")->where(["\145\x78\x70\145\x72\x74\x5f\x69\x64" => $expertId, "\x61\x70\160\157\151\x6e\x74\x5f\144\x61\x74\145" => $nowDay, "\141\x70\160\x6f\151\x6e\164\137\x64\x75\162\141\x74\x69\157\x6e" => 15, "\x73\164\141\164\x75\163" => ["\x6e\x65\161", IndexDefs::ORDER_CANCELLED_STATUS]])->order("\x61\x70\160\157\151\156\164\137\x74\x69\x6d\x65\40\141\163\x63")->column("\141\x70\160\157\x69\x6e\x74\137\164\x69\155\x65"); goto TSMLy; yZCD3: $nowDay = date("\131\x2d\155\x2d\x64"); goto A2Ssa; TrTSm: if (!($i < $appoint_order_allow_days)) { goto EbFaO; } goto FezaI; EU5F2: Resk7: goto TrTSm; WqBLY: $appointTimes45 = []; goto KRcEK; UdyrZ: $nowDay = date("\131\x2d\x6d\x2d\x64", strtotime($nowDay . "\x20\53{$appoint_order_ahead_of_days}\40\144\141\x79\163")); goto ae9Mf; gnhq4: $nowDay = date("\131\55\x6d\55\144", strtotime($nowDay . "\x20\53\61\40\x64\141\171")); goto NgIgp; A2Ssa: $appoint_order_ahead_of_days = systemSetting("\x61\x70\160\157\x69\x6e\x74\137\x6f\162\144\x65\162\137\x61\150\x65\x61\x64\x5f\157\x66\137\x64\x61\x79\163"); goto XXdSG; q2L4C: $available15AppointTimes = array_values(array_diff($appointTimes15, $appointedTimes15)); goto b1ALP; ae9Mf: $i = 0; goto EU5F2; sI6kH: e6pKB: goto HzWwB; hZsu0: $weekDayList[] = ["\x77\145\x65\153\104\x61\171" => $weekDay, "\141\166\141\151\154\x61\x62\154\x65" => $available, "\144\141\164\145" => $nowDay, "\x6c\x61\x62\145\x6c" => sprintf("\45\x73\40\x7c\x20\45\163", getWeekdayText($weekDay), date("\155\x2d\144", strtotime($nowDay))), "\x61\166\141\x69\154\141\142\x6c\x65\x34\65\x41\x70\160\157\x69\x6e\x74\x54\151\x6d\x65\x73" => $available45AppointTimes, "\141\x76\x61\151\x6c\x61\x62\154\x65\61\65\x41\160\x70\x6f\x69\156\164\x54\151\x6d\145\x73" => $available15AppointTimes]; goto Yizdw; KRcEK: $appointTimes15 = []; goto AEeAN; AEeAN: foreach ($appointTimes as $appointTime) { goto yrYKV; RKHHz: kPRAG: goto HBqXn; twH2T: if (!(count($intervals) == 3)) { goto Ltp99; } goto OaTdG; yrYKV: $intervals = explode("\x2c", $appointTime); goto YoH10; QBtoc: goto R_cNm; goto RKHHz; OaTdG: $appointTimes45[] = $appointTime; goto L701v; L701v: Ltp99: goto QBtoc; ueR83: bLEnl: goto v19Hg; HBqXn: $appointTimes15[] = $appointTime; goto DNYq9; DNYq9: R_cNm: goto ueR83; YoH10: if (count($intervals) == 1) { goto kPRAG; } goto twH2T; v19Hg: } goto sI6kH; HzWwB: $appointedTimes45 = Db::table("\145\x78\x70\145\162\x74\x5f\157\x72\144\145\162")->where(["\x65\x78\x70\x65\x72\x74\x5f\x69\144" => $expertId, "\141\x70\x70\x6f\151\156\x74\137\144\x61\x74\x65" => $nowDay, "\x61\x70\x70\157\151\156\164\x5f\144\165\x72\x61\x74\x69\x6f\x6e" => 45, "\163\x74\141\x74\165\163" => ["\x6e\x65\x71", IndexDefs::ORDER_CANCELLED_STATUS]])->order("\141\x70\160\157\x69\x6e\x74\x5f\164\151\x6d\x65\40\x61\163\143")->column("\141\x70\160\x6f\151\156\164\137\x74\151\x6d\x65"); goto E3_Hg; neJsX: } public function submitAppointOrder($uid, $postData) { goto R9S4B; ost42: $cellphone = $postData["\143\145\154\154\x70\150\x6f\x6e\x65"] ?? ''; goto Ocil6; kKHAp: $appointDate = $postData["\141\x70\x70\157\x69\156\x74\x44\x61\164\x65"] ?? ''; goto IMKue; lb251: $appointMode = $postData["\x61\x70\x70\157\x69\156\164\x4d\x6f\x64\x65"] ?? ''; goto s_NBJ; jYF1m: kdA61: goto Ris31; nI4Q_: Db::table("\145\170\160\145\x72\x74\137\x6f\x72\x64\145\x72")->where(["\x6f\x72\x64\x65\x72\x5f\156\x6f" => $orderNo])->update(["\154\x69\156\153\x6d\x61\156" => $realName, "\x63\x65\154\154\x70\150\x6f\x6e\x65" => $cellphone, "\x72\x65\155\x61\162\x6b" => $remark]); goto lYPkv; XnVl8: $appointTimeSms = convertAppointTimesToShow($appointTime); goto Dz6Wm; V60Bu: if ($expertInfos) { goto kdA61; } goto WPM2_; jqPZR: foreach ($supportTels as $supportTel) { goto Ffg6x; pViXN: $smsResult = SmsLogic::I()->sendAppoitOrderToSupport($supportTel, date("\x6d\346\234\210\144\xe6\x97\245", strtotime($appointDate)) . "\40" . $appointTimeSms); goto NnRRl; NnRRl: if ($smsResult) { goto CFtu9; } goto mgrTX; NOSGR: Log::error("\x66\141\151\154\x65\144\40\164\x6f\40\x73\x65\156\144\40\x73\155\x73\x20\164\x6f\40\163\x75\x70\x70\x6f\x72\164\40{$supportTel}"); goto BTApe; SI2Qp: P7i0D: goto pViXN; BTApe: CFtu9: goto H76fh; mgrTX: logEvent("\xe5\217\x91\351\200\201\351\242\204\347\xba\246\xe9\x80\232\347\237\245\xe7\237\xad\344\xbf\241\xe5\210\260\345\256\xa2\346\x9c\215{$supportTel}\xe5\244\261\xe8\xb4\245", EventLogsService::eSeverityError); goto NOSGR; ToXhk: goto ojTyD; goto SI2Qp; shhRR: Log::notice("\x74\x68\145\x20\143\x75\x73\x74\x6f\155\145\x72\40\x73\165\160\x70\x6f\162\164\x20\x74\145\x6c\x20{$supportTel}\40\x69\163\40\x6e\x6f\164\x20\x76\141\154\151\144\x2c\40\163\153\151\160"); goto ToXhk; H76fh: ojTyD: goto ONK9j; Ffg6x: if (validateMobile($supportTel)) { goto P7i0D; } goto shhRR; ONK9j: } goto Eo6we; crgzf: Log::error("\x66\141\151\x6c\145\144\40\164\157\x20\x73\x65\156\x64\40\x73\155\x73\x20\164\x6f\40\145\170\x70\145\x72\x74\40{$expertInfos["\143\145\x6c\154\160\x68\x6f\x6e\x65"]}"); goto i0mJZ; hzWoV: $supportTels = explode("\x2c", systemSetting("\163\145\x6e\x64\x5f\141\x70\160\157\x69\x6e\x74\137\157\162\x64\x65\x72\x5f\164\x6f\x5f\163\x75\x70\160\x6f\x72\x74\x5f\164\145\154\x73")); goto jqPZR; g67JU: Log::notice("\163\x6d\163\x20\143\x61\x70\x74\x63\x68\141\x20\x63\x6f\x64\145\x20\x77\x72\x6f\156\x67\72\40" . $smsCode); goto AM1ke; Rjqbc: $appointTime = $postData["\x61\160\x70\157\151\156\164\x54\x69\x6d\x65"] ?? ''; goto lb251; IQIOa: Db::table("\143\x75\x73\x74\157\x6d\x65\x72")->where(["\x69\144" => $uid])->update(["\x6c\141\164\145\x73\x74\137\x61\160\x70\157\151\x6e\164\137\164\x69\155\145" => Db::raw("\156\157\x77\50\51"), "\164\157\x74\141\x6c\137\141\x70\x70\x6f\x69\x6e\x74\x5f\161\165\141\x6e\164\151\x74\171" => Db::raw("\x74\x6f\164\x61\154\x5f\141\160\160\157\x69\156\x74\x5f\161\165\x61\156\x74\151\x74\x79\x2b\61"), "\x74\157\x74\x61\154\x5f\x61\160\x70\157\151\156\164\x5f\141\155\157\165\156\x74" => Db::raw("\x74\x6f\x74\141\x6c\137\141\160\x70\x6f\x69\156\164\137\141\155\157\x75\156\164\53" . $orderAmount)]); goto XnVl8; IMKue: $appointDuration = $postData["\141\160\x70\157\151\156\x74\104\x75\162\141\x74\x69\157\156"] ?? ''; goto Rjqbc; CnCRT: z2kYU: goto wEh_p; WPM2_: wexception("\346\227\xa0\xe6\263\x95\346\x89\xbe\345\210\xb0\350\xaf\245\xe4\xb8\x93\345\256\266"); goto jYF1m; lYPkv: return $orderNo; goto LX9WC; STDif: if ($smsResult) { goto PoZXH; } goto JoOFS; nXuiZ: tCeHB: goto hzWoV; XlQrn: $payStatus = systemSetting("\141\x70\x70\157\151\x6e\164\x5f\x6f\162\x64\x65\x72\x5f\160\141\x79\x5f\x6d\157\x64\145\154") == "\xe7\272\277\344\270\x8b\346\x94\xaf\344\273\230" ? Defs::PAY_OFFLINE : Defs::PAY_WAIT; goto C7y94; Eo6we: PSvn4: goto nI4Q_; Ris31: $orderAmount = $appointDuration == 15 ? $expertInfos["\x61\160\x70\157\151\x6e\x74\137\x72\145\x76\151\x65\x77\x5f\x66\145\x65"] : $expertInfos["\x61\160\160\x6f\151\x6e\164\x5f\146\145\x65"]; goto XlQrn; R9S4B: $expertId = $postData["\x65\x78\160\x65\x72\164\x49\x64"] ?? 0; goto kKHAp; kq1H_: $remark = $postData["\162\145\x6d\141\162\x6b"] ?? ''; goto Dettd; DMHcK: wexception("\346\x95\xb0\346\x8d\256\xe4\xb8\x8d\345\256\214\xe6\225\264"); goto CnCRT; JoOFS: logEvent("\xe5\217\x91\xe9\200\x81\351\242\204\xe7\272\xa6\xe9\x80\x9a\xe7\x9f\xa5\xe7\x9f\255\344\xbf\xa1\345\210\260\344\xb8\223\345\xae\266{$expertInfos["\x63\145\154\154\160\x68\x6f\x6e\x65"]}\345\244\xb1\xe8\264\xa5", EventLogsService::eSeverityError); goto crgzf; iOwQg: qqket: goto CxEWm; ForRy: $smsResult = SmsLogic::I()->sendAppoitOrderToExpert($expertInfos["\143\145\x6c\154\x70\150\157\x6e\145"], date("\x6d\xe6\x9c\x88\x64\346\227\245", strtotime($appointDate)) . "\x20" . $appointTimeSms); goto STDif; wEh_p: $realName = $postData["\x72\145\x61\x6c\x4e\141\155\145"] ?? ''; goto ost42; C7y94: $orderNo = AppointOrderLogic::I()->generateOrder($uid, $expertId, $orderAmount, $appointDate, $appointTime, $appointDuration, $appointMode, $payStatus); goto ZUef_; Dettd: if (SmsLogic::I()->verifyCaptcha($cellphone, $smsCode, "\101\x50\120\x4f\x49\116\124")) { goto qqket; } goto g67JU; AM1ke: wexception("\347\x9f\xad\xe4\xbf\xa1\xe9\252\214\350\257\x81\347\240\x81\xe9\x94\231\xe8\xaf\xaf"); goto iOwQg; i0mJZ: PoZXH: goto nXuiZ; s_NBJ: if (!(empty($expertId) || empty($appointDate) || empty($appointDuration) || empty($appointTime) || empty($appointMode))) { goto z2kYU; } goto DMHcK; ZUef_: Db::table("\x65\170\x70\x65\162\x74")->where(["\151\144" => $expertId])->update(["\x6c\x61\x74\x65\x73\164\137\141\160\160\157\x69\x6e\x74\137\x74\151\155\x65" => Db::raw("\x6e\157\167\x28\51"), "\164\157\164\141\x6c\x5f\x61\160\160\x6f\x69\x6e\x74\137\161\165\x61\x6e\164\151\164\x79" => Db::raw("\164\157\x74\141\154\137\141\x70\160\157\x69\x6e\164\x5f\161\165\x61\156\164\x69\x74\x79\53\61"), "\164\x6f\164\x61\154\x5f\x61\160\160\157\x69\156\x74\x5f\x61\x6d\157\x75\x6e\164" => Db::raw("\164\x6f\x74\141\x6c\x5f\141\160\x70\157\151\x6e\164\x5f\141\x6d\x6f\x75\x6e\164\x2b" . $orderAmount)]); goto IQIOa; Ocil6: $smsCode = $postData["\x73\x6d\163"] ?? ''; goto kq1H_; Dz6Wm: if (!(systemSetting("\163\145\x6e\144\x5f\x61\x70\160\x6f\151\156\x74\x5f\157\x72\x64\x65\x72\137\164\x6f\137\x65\170\x70\x65\162\164") == "\171\x65\x73")) { goto tCeHB; } goto ForRy; CxEWm: $expertInfos = ExpertLogic::I()->getInfos($expertId); goto V60Bu; LX9WC: } public function appointPay($uid, $orderNo) { goto fjci4; TYiwj: wxPaySetting(); goto few1y; josy6: $data["\x75\162\154"] = url("\155\x70\57\x45\170\x70\145\x72\164\x2f\x61\160\x70\157\x69\156\x74\x53\165\x63\x63\145\163\x73", ["\157\162\144\x65\x72\x4e\x6f" => $orderNo]); goto oiV12; ImQH1: UGipT: goto BS4Fh; fjci4: $data = ["\x6f\x72\x64\145\162\x4e\x6f" => $orderNo]; goto josy6; XXHoa: if (!(systemSetting("\163\x65\x6e\x64\137\x61\160\160\x6f\151\156\164\x5f\x6f\x72\x64\145\162\x5f\x74\x6f\137\x63\x75\163\164\x6f\155\145\162") == "\171\145\163")) { goto xP3lk; } goto diCN4; lC_t9: wexception("\xe8\256\242\xe5\x8d\x95\xe4\270\215\345\xad\x98\345\x9c\xa8"); goto PDlK2; DO96l: logEvent("\345\222\xa8\350\257\242\351\xa2\204\xe7\272\246\350\256\242\345\215\225{$orderNo}\346\224\257\344\xbb\230\xe5\xa4\261\350\264\245\54\x20{$res["\162\x65\x74\165\162\x6e\137\155\163\147"]}", EventLogsService::eSeverityWarning); goto IpXFh; mqnu5: if ($smsResult) { goto RyBrn; } goto FZXV9; PDlK2: FxAAD: goto bXvtU; few1y: if (!(empty(config("\x77\x78\56\x6f\146\146\x69\x63\x69\x61\154\137\x61\x63\x63\157\165\x6e\164")["\x61\160\x70\137\x69\x64"]) || empty(config("\x77\170\56\160\x61\171\155\145\156\x74")["\155\143\x68\x5f\151\144"]))) { goto Oy4BC; } goto gkXyI; bYcAQ: if (systemSetting("\141\x70\160\x6f\151\156\164\x5f\x6f\162\144\x65\x72\x5f\x70\141\x79\137\155\157\x64\x65\x6c") == "\xe7\xba\277\344\270\x8b\346\224\257\xe4\xbb\x98" || !$orderAmount) { goto NI2WE; } goto NL0g0; gEVQs: Log::error("{$orderNo}\x20\xe5\xbe\xae\xe4\277\241\xe4\270\213\345\x8d\225\xe5\244\261\350\xb4\245\xef\274\232\350\xbf\224\345\233\236\x20" . var_export($res, true)); goto SLOiD; lPPKm: Log::notice("{$orderNo}\40\167\x65\143\150\141\164\40\x70\x61\x79\x20\162\145\x74\x75\x72\x6e\40" . var_export($res, true)); goto OpoFs; IUHFj: xP3lk: goto sb35A; Bau4n: RTxDl: goto apytb; WlwHs: Oy4BC: goto n2Rwf; kLUD6: Db::table("\x65\170\x70\x65\162\164\137\157\162\x64\x65\162")->where(["\x6f\x72\144\145\162\x5f\x6e\157" => $orderInfos["\x6f\x72\144\x65\162\x5f\156\157"]])->setField("\x70\141\171\137\163\x74\141\x74\165\x73", $payStatus); goto OhQPe; gkXyI: wexception("\350\xaf\267\xe9\205\215\xe7\275\xae\xe5\xbe\256\xe4\277\241\345\x85\xac\344\xbc\227\xe5\217\xb7\xe5\x92\214\xe5\xbe\256\344\277\xa1\xe6\x94\xaf\344\xbb\230\345\217\x82\346\225\xb0"); goto WlwHs; AuVtA: if (isset($res["\x70\x72\145\x70\x61\x79\137\151\x64"])) { goto ZoqCg; } goto scAgD; VnX1x: NI2WE: goto xP8JM; NHKAZ: xs2mP: goto L5HbP; OHAK3: RyBrn: goto IUHFj; a63qm: Log::error("\x66\141\x69\154\145\144\x20\164\157\40\163\x65\156\x64\x20\163\x6d\163\40\164\x6f\40\143\165\x73\x74\157\155\x65\162\x20{$orderInfos["\x63\x65\x6c\x6c\x70\150\157\156\x65"]}"); goto OHAK3; OpoFs: if (!empty($res)) { goto RTxDl; } goto VLyZ5; sb35A: $data["\156\x65\145\144\137\x70\141\x79"] = false; goto Xu2PJ; oruUf: ZoqCg: goto N1oXA; qbksY: KNTms: goto VqWLE; x6zQ9: Log::error("{$orderNo}\40\345\xbe\256\344\277\241\xe4\270\213\345\x8d\x95\345\244\xb1\xe8\xb4\xa5\357\274\x9a\xe8\277\224\xe5\x9b\236\x20" . $res); goto qvPKc; FZXV9: logEvent("\xe5\x8f\221\351\x80\x81\351\242\204\xe7\xba\246\351\x80\232\xe7\x9f\245\347\237\xad\xe4\277\241\xe5\210\xb0\xe5\256\xa2\346\210\xb7{$orderInfos["\143\145\x6c\154\160\150\x6f\156\x65"]}\xe5\xa4\xb1\xe8\xb4\245", EventLogsService::eSeverityError); goto a63qm; scAgD: Log::error("{$orderNo}\40\345\276\256\344\xbf\241\xe4\xb8\x8b\345\x8d\x95\345\xa4\xb1\350\xb4\245\357\xbc\232\346\x97\240\x70\162\x65\160\x61\x79\x5f\151\x64\54\40\350\xbf\x94\345\x9b\x9e\x20" . var_export($res, true)); goto yRR0L; L5HbP: if (!($res["\x72\x65\164\165\x72\156\x5f\x63\x6f\144\x65"] == "\106\x41\x49\114")) { goto UGipT; } goto DO96l; NL0g0: if (!($uid == 1)) { goto KNTms; } goto ZWX9s; diCN4: $appointTimeSms = convertAppointTimesToShow($orderInfos["\141\x70\x70\157\151\156\164\x5f\164\151\x6d\145"]); goto o62HH; DZAb8: return $data; goto QM7Fv; apytb: if (is_array($res)) { goto xs2mP; } goto x6zQ9; yRR0L: wexception("\345\276\256\344\277\241\xe4\270\213\345\x8d\x95\345\244\xb1\350\264\xa5\xef\274\232\xe6\x97\240\xe6\263\225\xe6\x89\xbe\xe5\210\260\x70\162\145\160\141\171\137\x69\x64"); goto oruUf; bXvtU: $orderAmount = floatval($orderInfos["\157\162\144\145\x72\x5f\x61\x6d\157\165\x6e\164"]); goto bYcAQ; oiV12: $orderInfos = AppointOrderLogic::I()->getOrderInfos($uid, $orderNo); goto EmUPN; nXm4_: $res = $app->order->unify(["\142\157\x64\x79" => "\xe9\242\204\347\xba\xa6\350\264\271\347\224\250", "\x6f\x75\164\137\x74\162\141\144\145\137\156\157" => $orderInfos["\157\x72\x64\145\162\137\156\x6f"], "\x74\157\164\x61\154\x5f\146\145\x65" => $orderInfos["\157\x72\x64\145\x72\x5f\141\x6d\157\165\156\164"] * 100, "\x6e\x6f\164\151\x66\171\137\x75\x72\x6c" => url("\x6d\160\57\x57\170\x2f\x70\141\151\x64\x45\x78\160\x65\162\164\x4f\x72\144\x65\x72", '', false, true), "\x74\162\141\144\x65\137\164\171\x70\x65" => "\112\x53\101\120\111", "\157\x70\x65\x6e\151\144" => $uid]); goto lPPKm; n2Rwf: $app = Factory::payment(array_merge(config("\167\170\x2e\160\x61\171\155\x65\156\164"), ["\141\x70\160\x5f\x69\x64" => config("\167\170\x2e\157\146\x66\x69\143\151\x61\x6c\x5f\141\143\143\x6f\165\156\164")["\141\x70\x70\x5f\151\144"]])); goto nXm4_; BS4Fh: if (!($res["\162\145\x73\x75\154\x74\x5f\143\157\144\145"] == "\106\101\x49\x4c")) { goto yMLaB; } goto RH5cq; OhQPe: Db::table("\145\170\160\x65\162\x74\x5f\x6f\x72\144\145\162")->where(["\157\x72\x64\x65\x72\137\x6e\157" => $orderInfos["\157\x72\144\145\x72\137\x6e\157"]])->setField("\x73\x74\x61\x74\x75\163", IndexDefs::ORDER_APPOINTED_STATUS); goto XXHoa; f1ya_: goto XvunV; goto VnX1x; VLyZ5: Log::error("{$orderNo}\40\xe5\276\256\xe4\277\241\344\270\x8b\xe5\x8d\x95\345\xa4\261\xe8\xb4\245\xef\274\x9a\350\xbf\224\345\233\x9e\347\251\272"); goto twDaS; o62HH: $smsResult = SmsLogic::I()->sendAppoitOrderToCustomer($orderInfos["\x63\x65\x6c\x6c\x70\150\157\x6e\x65"], date("\x6d\346\234\x88\144\xe6\x97\xa5", strtotime($orderInfos["\x61\x70\160\x6f\151\x6e\x74\137\x64\x61\x74\145"])) . "\40" . $appointTimeSms, systemSetting("\x61\x70\x70\x6f\x69\156\x74\x5f\157\x72\x64\x65\x72\x5f\x6f\x66\146\x69\x63\145\x5f\x61\144\144\162\x65\163\163")); goto mqnu5; IpXFh: wexception("\xe5\xbe\xae\344\xbf\241\344\270\213\345\215\x95\xe5\xa4\xb1\350\xb4\245\xef\xbc\x9a" . $res["\x72\x65\164\x75\162\x6e\x5f\155\163\x67"]); goto ImQH1; EmUPN: if ($orderInfos) { goto FxAAD; } goto lC_t9; SLOiD: wexception("\xe5\xbe\xae\xe4\277\241\xe4\xb8\x8b\xe5\215\225\xe5\244\xb1\xe8\264\xa5\357\xbc\x9a" . $res["\145\162\162\137\143\157\x64\x65\137\x64\145\163"]); goto r1V6v; RH5cq: logEvent("\xe5\x92\250\xe8\xaf\xa2\xe9\242\x84\xe7\272\246\xe8\256\xa2\xe5\x8d\225{$orderNo}\346\x94\xaf\xe4\273\230\345\xa4\261\xe8\264\245\x2c\40{$res["\x65\162\x72\x5f\x63\157\x64\x65\137\144\145\x73"]}", EventLogsService::eSeverityWarning); goto gEVQs; twDaS: wexception("\xe5\xbe\256\344\277\241\344\xb8\213\345\x8d\x95\345\xa4\xb1\xe8\264\xa5\357\xbc\x9a\xe8\277\x94\xe5\233\236\347\xa9\272"); goto Bau4n; xP8JM: $payStatus = systemSetting("\x61\160\160\x6f\x69\156\164\x5f\157\162\x64\x65\162\x5f\160\x61\171\x5f\155\157\144\145\x6c") == "\xe7\272\277\xe4\270\x8b\xe6\224\xaf\344\xbb\230" ? Defs::PAY_OFFLINE : Defs::PAY_SUCCESS; goto kLUD6; ZWX9s: wexception("\xe5\xbd\x93\345\x89\215\xe7\216\xaf\xe5\242\x83\344\270\215\346\x94\xaf\346\214\x81\346\x94\257\xe4\273\230\xe6\x93\x8d\344\275\x9c"); goto qbksY; VqWLE: $data["\156\x65\x65\x64\x5f\160\141\x79"] = true; goto TYiwj; Xu2PJ: XvunV: goto DZAb8; r1V6v: yMLaB: goto AuVtA; Vh80q: $data["\143\157\x6e\146\x69\147"] = $app->jssdk->bridgeConfig($res["\160\x72\145\160\x61\x79\137\151\144"], false); goto f1ya_; N1oXA: Db::table("\145\170\160\x65\x72\x74\137\x6f\162\x64\145\x72")->where(["\x6f\162\144\145\x72\x5f\x6e\x6f" => $orderInfos["\x6f\162\x64\145\162\x5f\156\157"]])->setField("\160\162\x65\x70\141\171\x5f\x69\x64", $res["\x70\162\145\x70\x61\x79\x5f\x69\x64"]); goto Vh80q; qvPKc: wexception("\345\276\xae\344\277\xa1\344\xb8\x8b\xe5\x8d\x95\345\xa4\xb1\350\xb4\245\xef\274\x9a\350\xbf\x94\345\x9b\x9e" . $res); goto NHKAZ; QM7Fv: } }
