<?php
 namespace app\cli\logic; use think\Log; use think\Db; use app\Defs; use app\index\logic\Defs as IndexDefs; class System { public function __construct() { } public function detectSlowQuery() { goto gVQTY; ZLhFK: bT02F: goto kNqLD; G0yq8: Db::table("\163\154\157\167\x5f\x71\x75\x65\x72\x79")->insert(["\157\x63\x63\x75\162\x5f\164\x69\155\145" => $occur_time, "\157\x63\143\x75\x72\x5f\x75\163\145\162" => $occur_user, "\x6f\143\143\165\x72\137\164\x68\162\x65\141\x64" => $occur_thread, "\x71\165\x65\162\171\x5f\164\x69\x6d\x65" => $query_time, "\154\x6f\x63\x6b\137\164\x69\x6d\x65" => $lock_time, "\162\x6f\167\163\137\x73\145\156\x74" => $rows_sent, "\x72\x6f\x77\163\x5f\145\170\141\155\x69\156\x65\x64" => $rows_examined, "\157\x63\x63\x75\x72\x5f\x73\x71\x6c" => $occur_sql]); goto p2WZE; k3gOK: $query_time = $matches[1]; goto k4UKA; gVQTY: $logFile = "\57\x76\141\162\57\x6c\157\147\57\x6d\171\x73\x71\x6c\x2f\x73\154\x6f\167\137\x71\x75\145\x72\x79\137\154\157\147\56\x6c\x6f\x67"; goto Lkcdx; eBrpM: if (!($pos !== 0)) { goto AHikz; } goto xa1Ei; VXKXO: if (!(($line = fgets($handle)) !== false)) { goto WLK_5; } goto w4KKD; kqm6I: vrJdP: goto VXKXO; EYCl0: $totalDetectedCount++; goto hNoBK; KZNbk: $existInDb = Db::table("\x73\x6c\x6f\167\x5f\161\x75\x65\162\171")->where(["\157\143\143\165\162\x5f\164\x69\x6d\x65" => $occur_time])->count(); goto rZ7Pc; Lkcdx: $beginDate = date("\x59\55\x6d\x2d\x64"); goto K833k; KQh3s: if (!(($line = fgets($handle)) === false)) { goto MerE4; } goto dwcUY; nXGQv: AF1T2: goto gZ5VJ; lJP0e: OWnSe: goto KQh3s; zDYDI: hWEv7: goto fZSSn; CK588: WLK_5: goto Dn1iw; Oi1EJ: Db::table("\x73\154\x6f\x77\137\x71\x75\145\162\x79")->insert(["\157\x63\143\x75\162\137\164\151\155\145" => $occur_time, "\x6f\x63\143\x75\x72\x5f\165\163\145\162" => $occur_user, "\157\143\x63\x75\162\x5f\x74\150\162\145\141\144" => $occur_thread, "\161\165\145\162\x79\137\164\151\155\x65" => $query_time, "\154\157\x63\x6b\x5f\x74\x69\155\145" => $lock_time, "\162\157\x77\163\137\x73\145\x6e\164" => $rows_sent, "\162\157\x77\163\x5f\145\x78\x61\x6d\151\156\x65\x64" => $rows_examined, "\157\143\x63\165\x72\137\x73\161\x6c" => $occur_sql]); goto EYCl0; hNoBK: echo "\x74\x6f\164\x61\154\104\145\x74\145\143\164\145\144\x43\157\165\156\164\72\x20{$totalDetectedCount}\12"; goto t_SsP; szN3v: if (!(strtotime($occur_time) > strtotime($beginDate))) { goto hWEv7; } goto KZNbk; qUK29: $matches = []; goto qShZt; gZ5VJ: fclose($handle); goto xn8Uf; Jn9ti: $handle = fopen($logFile, "\x72"); goto cYOwB; npkgh: W5mtq: goto zDYDI; xwQQi: exception("\x66\141\151\x6c\x65\144\40\x74\x6f\40\x6f\x70\145\156\x20\x66\151\x6c\x65\72\40" . $logFile); goto drs7g; VXdXj: if (!($result && count($matches) == 5)) { goto SDn33; } goto k3gOK; oEB6M: SDn33: goto Gzrhp; opX9l: $pos = strpos($line, $prefixTrait); goto eBrpM; hXKgy: NDjXP: goto AqPCP; gnjDG: M23L_: goto ty0ag; f5_6N: $occur_time = $occur_user = $occur_thread = $query_time = $lock_time = $rows_sent = $rows_examined = $occur_sql = ''; goto kqm6I; K833k: $totalDetectedCount = 0; goto Jn9ti; xa1Ei: if (!$occur_time) { goto W5t6k; } goto luSFH; nMEG4: goto vrJdP; goto s1nYh; WWLG1: if (!$occur_time) { goto ZAvt1; } goto szN3v; CBU2t: $occur_time = date("\x59\x2d\155\55\x64\40\x48\x3a\x69\x3a\x73", strtotime($occur_time)); goto q9ZEL; XKOTF: MerE4: goto qUK29; kNqLD: $prefixTrait = "\x23\x20\124\x69\x6d\x65\x3a\x20"; goto opX9l; p2WZE: $totalDetectedCount++; goto Bi1VK; fZSSn: $occur_time = $occur_user = $occur_thread = $query_time = $lock_time = $rows_sent = $rows_examined = $occur_sql = ''; goto TUjbi; Bi1VK: echo "\x74\x6f\164\141\x6c\104\x65\x74\145\143\x74\x65\144\x43\x6f\x75\x6e\x74\x3a\40{$totalDetectedCount}\xa"; goto npkgh; drs7g: jBtdD: goto f5_6N; w4KKD: if (!empty($line)) { goto bT02F; } goto MLMku; Dn1iw: if (!$occur_time) { goto AF1T2; } goto UTqx9; HVCCs: $occur_user = substr($line, strlen($prefixTrait)); goto HG5Z6; xn8Uf: return "\x74\157\164\141\154\x44\x65\x74\145\x63\x74\x65\x64\x43\157\x75\156\x74\72\40{$totalDetectedCount}"; goto GSzTg; k4UKA: $lock_time = $matches[2]; goto ThtXb; s1nYh: AHikz: goto WWLG1; PXF4b: $occur_time = substr($line, strlen($prefixTrait)); goto VnJkz; qShZt: $result = preg_match("\57\121\x75\x65\162\x79\x5f\164\x69\x6d\x65\x3a\x5c\163\x2a\x28\x5b\60\x2d\x39\x2e\135\x2b\x29\134\163\52\114\x6f\x63\153\x5f\x74\x69\155\145\72\134\163\x2a\50\133\60\x2d\x39\x2e\135\x2b\x29\134\x73\52\x52\x6f\x77\x73\x5f\163\x65\x6e\x74\72\x5c\163\x2a\50\x5b\x30\55\71\x2e\x5d\53\x29\x5c\163\52\x52\157\x77\x73\137\x65\170\x61\x6d\151\156\145\144\72\134\163\52\x28\133\x30\55\71\x2e\x5d\53\51\x5c\163\x2a\57", $line, $matches); goto VXdXj; q9ZEL: if (!(($line = fgets($handle)) === false)) { goto M23L_; } goto vDj9v; zc9aN: if ($existInDb) { goto widmE; } goto Oi1EJ; Gzrhp: $occur_sql = ''; goto mvcKa; rZ7Pc: if ($existInDb) { goto W5mtq; } goto G0yq8; VnJkz: $occur_time = trim($occur_time); goto CBU2t; zUYYe: echo "\x66\x61\151\154\x65\144\40\x74\x6f\x20\157\x70\145\x6e\40\x66\x69\154\145\x3a\x20" . $logFile . "\12"; goto xwQQi; AqPCP: $occur_time = $occur_user = $occur_thread = $query_time = $lock_time = $rows_sent = $rows_examined = $occur_sql = ''; goto nXGQv; MLMku: goto vrJdP; goto ZLhFK; mvcKa: goto vrJdP; goto CK588; Va2xT: $existInDb = Db::table("\163\x6c\x6f\x77\x5f\161\x75\145\162\171")->where(["\x6f\143\x63\165\162\137\164\x69\155\145" => $occur_time])->count(); goto zc9aN; UTqx9: if (!(strtotime($occur_time) > strtotime($beginDate))) { goto NDjXP; } goto Va2xT; HG5Z6: $occur_user = trim($occur_user); goto lJP0e; t_SsP: widmE: goto hXKgy; uuIAj: $rows_examined = $matches[4]; goto oEB6M; dwcUY: goto WLK_5; goto XKOTF; luSFH: $occur_sql .= $line; goto aFlNi; TUjbi: ZAvt1: goto PXF4b; ty0ag: $prefixTrait = "\43\40\125\163\145\x72\100\x48\x6f\163\164\x3a\40"; goto cotE3; vDj9v: goto WLK_5; goto gnjDG; cYOwB: if ($handle) { goto jBtdD; } goto zUYYe; cotE3: if (!(strpos($line, $prefixTrait) === 0)) { goto OWnSe; } goto HVCCs; ThtXb: $rows_sent = $matches[3]; goto uuIAj; aFlNi: W5t6k: goto nMEG4; GSzTg: } }
