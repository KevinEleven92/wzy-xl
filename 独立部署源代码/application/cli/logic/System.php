<?php
 namespace app\cli\logic; use think\Log; use think\Db; use app\Defs; use app\index\logic\Defs as IndexDefs; class System { public function __construct() { } public function detectSlowQuery() { goto L2KDQ; nS17M: if (!(strpos($line, $prefixTrait) === 0)) { goto Ze8rI; } goto XUBnk; IupeG: if ($existInDb) { goto ktgG_; } goto CgLLT; PuW1u: goto ajsZ8; goto M3GOg; XSXfX: if ($handle) { goto PVUEO; } goto a3KbG; xDvSj: $occur_sql = ''; goto FIGp3; dEPNo: if (!($result && count($matches) == 5)) { goto Eiceu; } goto ibZwP; v8ZC2: ktgG_: goto lfRDq; ylNcy: $occur_time = $occur_user = $occur_thread = $query_time = $lock_time = $rows_sent = $rows_examined = $occur_sql = ''; goto Brncq; lDXKA: goto JRFsM; goto U5LJH; U5LJH: XR54R: goto RwYIB; vYMm9: goto JRFsM; goto AIy6E; CgLLT: Db::table("\x73\x6c\157\x77\137\x71\165\x65\x72\171")->insert(["\x6f\143\x63\x75\x72\137\x74\151\x6d\x65" => $occur_time, "\x6f\x63\143\165\162\x5f\x75\163\145\x72" => $occur_user, "\x6f\143\143\x75\x72\x5f\x74\x68\162\145\141\144" => $occur_thread, "\161\165\x65\162\x79\137\164\151\155\145" => $query_time, "\154\x6f\x63\153\x5f\164\151\x6d\x65" => $lock_time, "\x72\157\x77\x73\x5f\x73\x65\156\164" => $rows_sent, "\x72\x6f\x77\x73\137\145\170\141\x6d\151\156\145\144" => $rows_examined, "\157\143\x63\165\x72\x5f\163\161\x6c" => $occur_sql]); goto uV6pq; FC_kG: Eiceu: goto xDvSj; p1ClQ: if (!$occur_time) { goto WiUof; } goto URYtf; DQkHQ: $occur_time = trim($occur_time); goto tDWog; tDWog: $occur_time = date("\131\x2d\155\55\144\40\110\x3a\151\x3a\x73", strtotime($occur_time)); goto QQ9JD; SyYjC: if (!$occur_time) { goto Md5kb; } goto ER46S; uV6pq: $totalDetectedCount++; goto oXoZ_; BQ08I: $occur_user = trim($occur_user); goto JkWC6; dkBtu: fclose($handle); goto Sn3kK; ibZwP: $query_time = $matches[1]; goto aHTw1; Sxzvb: JRFsM: goto AMLFj; CLSy6: $prefixTrait = "\43\x20\125\x73\x65\x72\100\110\x6f\x73\x74\x3a\x20"; goto nS17M; kLRvV: $totalDetectedCount++; goto hSImg; aHTw1: $lock_time = $matches[2]; goto A5OQJ; AMLFj: if (!(($line = fgets($handle)) !== false)) { goto ajsZ8; } goto RWPhk; AIy6E: L_9BE: goto cLM_D; rJuq6: if (!(($line = fgets($handle)) === false)) { goto xgDTU; } goto PTDUa; sIMdr: xgDTU: goto WWCkB; pd3Sk: VSHDf: goto E_F7U; M3GOg: fionp: goto CLSy6; XY_GR: if (!($pos !== 0)) { goto L_9BE; } goto p1ClQ; lfRDq: SwyHQ: goto qFMXw; YQ1o6: if ($existInDb) { goto VSHDf; } goto PFBiJ; a3KbG: echo "\146\141\151\x6c\x65\144\40\164\157\40\x6f\160\145\156\40\146\x69\154\x65\72\40" . $logFile . "\xa"; goto pzkeC; JkWC6: Ze8rI: goto rJuq6; xKrTK: $result = preg_match("\x2f\x51\165\145\x72\171\x5f\x74\x69\155\145\72\134\x73\52\x28\133\x30\x2d\71\x2e\135\x2b\x29\134\x73\x2a\114\x6f\x63\x6b\137\x74\x69\155\145\x3a\134\x73\52\x28\x5b\x30\55\x39\56\x5d\x2b\51\x5c\163\x2a\122\x6f\x77\x73\x5f\x73\145\x6e\x74\72\x5c\x73\x2a\x28\x5b\x30\55\71\x2e\x5d\53\x29\x5c\x73\52\x52\x6f\167\x73\137\145\170\141\x6d\151\x6e\145\144\72\x5c\163\x2a\50\133\60\55\x39\56\135\53\x29\x5c\x73\x2a\57", $line, $matches); goto dEPNo; QQ9JD: if (!(($line = fgets($handle)) === false)) { goto fionp; } goto PuW1u; fOjt0: $existInDb = Db::table("\x73\x6c\157\x77\x5f\161\165\145\x72\x79")->where(["\157\x63\143\165\162\x5f\164\x69\155\145" => $occur_time])->count(); goto YQ1o6; A5OQJ: $rows_sent = $matches[3]; goto VquI9; n75KK: ajsZ8: goto SyYjC; cLM_D: if (!$occur_time) { goto ZA2Zd; } goto FT9wR; L2KDQ: $logFile = "\57\166\141\x72\x2f\154\157\147\x2f\155\171\x73\161\154\57\163\x6c\157\x77\x5f\x71\165\145\162\x79\x5f\154\157\x67\x2e\x6c\x6f\147"; goto H3J6z; FT9wR: if (!(strtotime($occur_time) > strtotime($beginDate))) { goto iV81a; } goto fOjt0; PFBiJ: Db::table("\x73\x6c\x6f\167\137\161\165\x65\162\171")->insert(["\157\x63\143\x75\x72\137\164\151\x6d\145" => $occur_time, "\x6f\143\x63\165\x72\137\165\x73\x65\162" => $occur_user, "\157\x63\143\x75\x72\137\164\150\162\145\141\x64" => $occur_thread, "\x71\x75\x65\x72\171\137\x74\151\x6d\145" => $query_time, "\154\157\x63\x6b\x5f\x74\x69\155\x65" => $lock_time, "\x72\x6f\167\x73\137\x73\x65\x6e\164" => $rows_sent, "\x72\x6f\x77\163\137\x65\170\x61\x6d\x69\x6e\x65\x64" => $rows_examined, "\x6f\x63\x63\x75\x72\x5f\163\x71\x6c" => $occur_sql]); goto kLRvV; WApQg: $pos = strpos($line, $prefixTrait); goto XY_GR; ZPLY6: $handle = fopen($logFile, "\162"); goto XSXfX; Brncq: ZA2Zd: goto aq5YP; Sn3kK: return "\164\157\x74\141\154\x44\x65\x74\x65\x63\164\145\144\103\157\165\156\164\x3a\x20{$totalDetectedCount}"; goto zOu9M; XUBnk: $occur_user = substr($line, strlen($prefixTrait)); goto BQ08I; VquI9: $rows_examined = $matches[4]; goto FC_kG; H3J6z: $beginDate = date("\131\x2d\155\55\x64"); goto ZiT7e; oXoZ_: echo "\x74\x6f\x74\x61\x6c\104\145\164\145\143\x74\145\144\x43\x6f\165\156\x74\72\x20{$totalDetectedCount}\12"; goto v8ZC2; WWCkB: $matches = []; goto xKrTK; qFMXw: $occur_time = $occur_user = $occur_thread = $query_time = $lock_time = $rows_sent = $rows_examined = $occur_sql = ''; goto b0O2G; C53pP: $occur_time = $occur_user = $occur_thread = $query_time = $lock_time = $rows_sent = $rows_examined = $occur_sql = ''; goto Sxzvb; E_F7U: iV81a: goto ylNcy; RWPhk: if (!empty($line)) { goto XR54R; } goto lDXKA; sAEKJ: PVUEO: goto C53pP; pzkeC: exception("\x66\x61\x69\x6c\x65\144\40\x74\x6f\x20\x6f\x70\x65\x6e\40\146\151\154\145\72\40" . $logFile); goto sAEKJ; URYtf: $occur_sql .= $line; goto Rr2zl; FIGp3: goto JRFsM; goto n75KK; PTDUa: goto ajsZ8; goto sIMdr; mTmGj: $existInDb = Db::table("\x73\154\x6f\x77\137\x71\165\x65\x72\x79")->where(["\x6f\143\x63\165\x72\x5f\164\x69\155\x65" => $occur_time])->count(); goto IupeG; aq5YP: $occur_time = substr($line, strlen($prefixTrait)); goto DQkHQ; Rr2zl: WiUof: goto vYMm9; hSImg: echo "\x74\x6f\x74\x61\x6c\104\x65\x74\x65\143\164\x65\x64\x43\x6f\165\x6e\x74\72\x20{$totalDetectedCount}\12"; goto pd3Sk; RwYIB: $prefixTrait = "\43\x20\x54\151\x6d\x65\72\40"; goto WApQg; ZiT7e: $totalDetectedCount = 0; goto ZPLY6; b0O2G: Md5kb: goto dkBtu; ER46S: if (!(strtotime($occur_time) > strtotime($beginDate))) { goto SwyHQ; } goto mTmGj; zOu9M: } }
