<?php
 namespace app\cli\logic; use think\Log; use app\index\service\Setting; use think\Db; class CleanServer { public function __construct() { } public function clean() { goto wmvse; AxK1G: $this->cleanDb(); goto tSqXx; wmvse: $this->cleanWeb(); goto AxK1G; tSqXx: return "\xe6\270\x85\347\x90\206\346\x88\220\xe5\212\x9f"; goto Gmj4L; Gmj4L: } protected function cleanWeb() { goto yrSd9; V3kAg: N9QQ0: goto msSr_; a51Hp: goto L53xR; goto tGxmD; umJHU: if (!(false !== ($file = readdir($handle)))) { goto cQdO2; } goto VOlvx; w8G8o: if (!(is_dir($tmpPath) && file_exists($tmpPath) && ($handle = opendir($tmpPath)))) { goto rOHO3; } goto Ql7o7; wT9AM: goto J_GUo; goto fPBlw; Ql7o7: J_GUo: goto umJHU; x5wCC: $tmpPath = rtrim(TEMP_PATH, "\x2f\x5c"); goto w8G8o; tGxmD: gylvC: goto ju3tn; CYLPt: $logPath = rtrim(LOG_PATH, "\x2f\134"); goto uNisZ; ZTCOz: $filePath = $logPath . DS . $file; goto lNpaj; ASmWN: goto J_GUo; goto ETHrn; m6tvX: goto J_GUo; goto TjccK; ZRvQo: goto L53xR; goto V3kAg; cJufe: if (!($nowTime > $lastModTime && $nowTime - $lastModTime > 30 * 24 * 3600)) { goto BStGR; } goto zboQW; fPBlw: cQdO2: goto VpKGQ; yrSd9: $nowTime = time(); goto CYLPt; evDTb: BStGR: goto a51Hp; D0K5L: eFZ05: goto ZTCOz; uNisZ: if (!(is_dir($logPath) && file_exists($logPath) && ($handle = opendir($logPath)))) { goto ctrNG; } goto ckhl5; zboQW: Log::notice("\xe6\270\x85\xe7\220\x86\xe6\x97\245\xe5\277\227\xe6\x96\207\xe4\xbb\xb6\72\x20{$filePath}"); goto yMY9J; OHKA3: goto L53xR; goto D0K5L; VOlvx: if (!($file == "\x2e" || $file == "\56\x2e")) { goto gvroy; } goto m6tvX; qQNFO: $filePath = $tmpPath . DS . $file; goto B1_NI; lNpaj: if (!is_dir($filePath)) { goto N9QQ0; } goto ZRvQo; td8fX: if (!($file == "\x2e" || $file == "\56\56")) { goto eFZ05; } goto OHKA3; rx8Dq: if (!(false !== ($file = readdir($handle)))) { goto gylvC; } goto td8fX; yMY9J: unlink($filePath); goto evDTb; fgr0O: Log::notice("\346\xb8\205\347\220\206\350\247\206\xe5\233\276\xe6\226\207\xe4\xbb\266\x3a\x20{$filePath}"); goto VVTMw; bOYEf: ctrNG: goto x5wCC; ETHrn: KrKNl: goto fgr0O; B1_NI: if (!is_dir($filePath)) { goto KrKNl; } goto ASmWN; VpKGQ: closedir($handle); goto CSWSC; ju3tn: closedir($handle); goto bOYEf; msSr_: $lastModTime = filemtime($filePath); goto cJufe; CSWSC: rOHO3: goto aY2lJ; VVTMw: unlink($filePath); goto wT9AM; TjccK: gvroy: goto qQNFO; ckhl5: L53xR: goto rx8Dq; aY2lJ: } protected function cleanDb() { goto onCk3; vNkQV: Db::table("\x6a\x6f\142\x5f\161\x75\145\x75\x65")->whereTime("\145\x6e\164\145\x72\145\x64", "\x3c", $beginDate)->delete(); goto ILGA0; onCk3: $today = date("\x59\55\x6d\x2d\x64"); goto jJanu; ILGA0: $beginDate = date("\131\x2d\155\x2d\x64", strtotime($today . "\40\55\x31\40\x6d\x6f\156\164\x68")); goto FEIoD; xtx3i: Db::table("\145\166\145\156\164\x5f\154\157\147\163")->whereTime("\145\156\164\x65\162\145\x64", "\74", $beginDate)->delete(); goto PnRbQ; FEIoD: Db::table("\155\145\x73\163\141\147\x65\163")->whereTime("\x65\156\164\145\162\145\x64", "\x3c", $beginDate)->delete(); goto xtx3i; jJanu: $beginDate = date("\x59\55\155\x2d\144", strtotime($today . "\40\55\61\x20\155\x6f\156\x74\150")); goto vNkQV; PnRbQ: } }
