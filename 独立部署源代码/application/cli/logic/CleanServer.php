<?php
 namespace app\cli\logic; use think\Log; use app\index\service\Setting; use think\Db; class CleanServer { public function __construct() { } public function clean() { goto HGHg8; HGHg8: $this->cleanWeb(); goto ehrbX; ehrbX: $this->cleanDb(); goto Q0FPR; Q0FPR: return "\346\xb8\x85\xe7\x90\x86\346\210\x90\345\x8a\237"; goto ffoRh; ffoRh: } protected function cleanWeb() { goto wkEMm; ADnQw: closedir($handle); goto F8_3H; g_7Lg: VHxBy: goto ADnQw; GxcM9: goto ooS6b; goto ue7yM; wkEMm: $nowTime = time(); goto dqHlg; dVRZr: if (!($file == "\x2e" || $file == "\x2e\x2e")) { goto aegUE; } goto kDz_z; qouxx: goto ooS6b; goto Cnrqc; KVw4l: OV8mk: goto hQBQ5; JPf7W: $filePath = $tmpPath . DS . $file; goto YMK0X; wEK5r: aegUE: goto wquUe; x8qpy: unlink($filePath); goto m6brh; Cnrqc: scoyC: goto bKWT4; rom64: unlink($filePath); goto qouxx; YMK0X: if (!is_dir($filePath)) { goto XgFzF; } goto GxcM9; ue7yM: XgFzF: goto iaoZu; zxL0d: goto OV8mk; goto g_7Lg; EvuOP: goto OV8mk; goto MGEzU; XreIg: if (!($file == "\56" || $file == "\x2e\x2e")) { goto cJjiW; } goto BPb0q; bKWT4: closedir($handle); goto eVmo9; m6brh: CPelj: goto zxL0d; iaoZu: Log::notice("\xe6\270\x85\347\220\x86\350\247\206\345\233\xbe\xe6\x96\x87\xe4\xbb\266\72\x20{$filePath}"); goto rom64; rC83e: if (!is_dir($filePath)) { goto Mu5vt; } goto EvuOP; BPb0q: goto ooS6b; goto nBY5e; eVmo9: yoTt4: goto J4WKc; Y0Y3v: $lastModTime = filemtime($filePath); goto L5Rjr; zE0ZS: if (!(is_dir($tmpPath) && file_exists($tmpPath) && ($handle = opendir($tmpPath)))) { goto yoTt4; } goto Qypbc; dqHlg: $logPath = rtrim(LOG_PATH, "\x2f\134"); goto iEwzh; Qypbc: ooS6b: goto dNn1c; dNn1c: if (!(false !== ($file = readdir($handle)))) { goto scoyC; } goto XreIg; wquUe: $filePath = $logPath . DS . $file; goto rC83e; F8_3H: vWMhd: goto EJyvD; MGEzU: Mu5vt: goto Y0Y3v; hQBQ5: if (!(false !== ($file = readdir($handle)))) { goto VHxBy; } goto dVRZr; L5Rjr: if (!($nowTime > $lastModTime && $nowTime - $lastModTime > 30 * 24 * 3600)) { goto CPelj; } goto p8_u7; kDz_z: goto OV8mk; goto wEK5r; p8_u7: Log::notice("\346\xb8\205\xe7\220\x86\346\x97\xa5\xe5\xbf\x97\xe6\x96\x87\344\273\xb6\x3a\40{$filePath}"); goto x8qpy; iEwzh: if (!(is_dir($logPath) && file_exists($logPath) && ($handle = opendir($logPath)))) { goto vWMhd; } goto KVw4l; EJyvD: $tmpPath = rtrim(TEMP_PATH, "\x2f\x5c"); goto zE0ZS; nBY5e: cJjiW: goto JPf7W; J4WKc: } protected function cleanDb() { goto QUkq7; QUkq7: $today = date("\131\55\x6d\x2d\144"); goto nfsHq; SdWtr: $beginDate = date("\x59\55\155\x2d\x64", strtotime($today . "\40\55\x31\40\x6d\x6f\x6e\x74\x68")); goto iUY2k; iUY2k: Db::table("\x6d\x65\x73\163\141\147\145\163")->whereTime("\x65\x6e\x74\145\162\x65\x64", "\x3c", $beginDate)->delete(); goto IScj2; RW1To: Db::table("\152\157\142\137\161\x75\145\x75\x65")->whereTime("\x65\156\164\145\x72\145\x64", "\x3c", $beginDate)->delete(); goto SdWtr; nfsHq: $beginDate = date("\131\55\155\x2d\x64", strtotime($today . "\40\x2d\x31\40\x6d\x6f\156\164\150")); goto RW1To; IScj2: Db::table("\145\x76\145\156\x74\137\154\157\147\163")->whereTime("\145\156\164\145\162\145\144", "\x3c", $beginDate)->delete(); goto v94VI; v94VI: } }
