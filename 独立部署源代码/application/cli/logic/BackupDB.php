<?php
 namespace app\cli\logic; use app\index\service\Setting; use think\Log; class BackupDB { private $mysql_dump = ROOT_PATH . "\142\151\x6e" . DS . "\155\171\163\161\154\144\165\155\160\x2e\x65\170\x65"; private $compressor = ROOT_PATH . "\142\x69\156" . DS . "\x37\x7a\56\x65\x78\145"; public $backup_path = ROOT_PATH . "\144\142" . DS . "\x62\x61\143\153\165\160"; public $expiration = 30 * 86400; public $error = null; public function __construct() { goto XkrT0; w55au: exception("\xe5\244\x87\xe4\273\275\347\233\256\xe5\275\225\357\xbc\232" . $this->backup_path . "\xe6\x97\240\xe6\263\225\xe5\206\x99\xe5\205\xa5\xef\274\x8c\350\xaf\xb7\346\xa3\x80\xe6\x9f\245\xe6\x9d\x83\351\231\220"); goto QM3G1; cZlzx: mkdir($this->backup_path, 0775); goto kytvh; ijOak: $this->backup_path = rtrim($this->backup_path, "\x2f\x5c"); goto d7yz2; Owr0i: $this->backup_path = $config["\x44\102\137\x42\x41\103\113\x55\x50\137\120\x41\x54\110"]; goto H43xS; X0UHc: $this->expiration = $config["\x44\x42\x5f\x42\101\103\113\x55\120\x5f\105\130\120\x49\122\101\124\x49\x4f\x4e"] * 86400; goto wNHwU; kytvh: WTD5N: goto KMkLI; jT7tT: if (!$config["\x44\102\137\102\101\x43\x4b\125\120\137\x50\101\x54\x48"]) { goto Gf2wy; } goto Owr0i; XkrT0: $config = ["\104\102\x5f\x42\x41\x43\x4b\x55\x50\137\x50\x41\124\x48" => systemSetting("\x44\102\137\102\x41\103\x4b\x55\120\x5f\x50\x41\124\110"), "\104\102\137\x42\x41\x43\113\125\x50\137\x45\x58\x50\111\122\101\x54\x49\117\x4e" => systemSetting("\104\102\x5f\102\101\103\x4b\x55\120\137\x45\130\120\x49\122\101\124\111\x4f\x4e")]; goto jT7tT; wNHwU: na8Pp: goto ijOak; wfUDI: if (!$config["\x44\x42\137\102\x41\x43\113\125\120\137\x45\x58\120\x49\122\101\x54\111\117\116"]) { goto na8Pp; } goto X0UHc; QM3G1: p_LVc: goto xnzYH; H43xS: Gf2wy: goto wfUDI; KMkLI: if (!(!file_exists($this->backup_path) || !is_writable($this->backup_path))) { goto p_LVc; } goto w55au; d7yz2: if (file_exists($this->backup_path)) { goto WTD5N; } goto cZlzx; xnzYH: } public function cleanUp() { goto hMUVR; zpaMg: exception("\146\x61\x69\x6c\145\x64\40\x74\157\x20\x66\151\x6e\144\x20{$this->backup_path}"); goto vkEWa; WSb67: $unlinkCount = 0; goto gedzb; i3amO: goto WUM7V; goto NlAcu; Yihrr: $t_now = time(); goto WSb67; VLC64: goto WUM7V; goto lzloj; X0YBA: $filenamePrefix = sprintf("\x25\x73\x23", $conf["\x64\x61\x74\x61\142\x61\x73\145"]); goto MMNn7; hMUVR: $conf = config("\144\x61\164\141\x62\x61\x73\145"); goto X0YBA; NX9ol: PM4sN: goto k7Y61; gedzb: WUM7V: goto pL3Lp; qefQ9: V9a0V: goto k8Uz2; BaY3x: goto WUM7V; goto Th732; QK9V4: if (!($file == "\56" || $file == "\x2e\x2e")) { goto PM4sN; } goto y9rh2; f753k: V7YrL: goto gBmOW; pL3Lp: if (!(false !== ($file = readdir($handle)))) { goto mFQo3; } goto QK9V4; MnDRT: if (!($time >= $this->expiration)) { goto HaEXh; } goto DAC1V; vkEWa: goto V7YrL; goto uiI1c; uiI1c: SkfQO: goto Yihrr; NlAcu: mFQo3: goto lV3qK; N5VPg: return "\xe6\270\x85\xe7\220\x86\345\244\207\xe4\273\xbd\346\x96\207\344\273\xb6{$unlinkCount}\xe4\270\xaa"; goto f753k; f4cZR: unlink($this->backup_path . DS . $file); goto vwriF; k7Y61: if (!(0 !== strpos($file, $filenamePrefix))) { goto V9a0V; } goto QQQfN; vwriF: $unlinkCount++; goto tYdUk; lzloj: ZCfFA: goto THv1I; lV3qK: closedir($handle); goto N5VPg; k8Uz2: $path_parts = pathinfo($file); goto s0U47; cFBL1: if (!empty($backupDate)) { goto wgRxO; } goto BaY3x; THv1I: $time = $t_now - strtotime($backupDate); goto MnDRT; r41v7: if (!(false === strtotime($backupDate))) { goto ZCfFA; } goto VLC64; DAC1V: echo $file . "\345\xb7\xb2\xe8\xbf\x87\346\x9c\237\x3a\40" . floor($time / 86400) . "\345\244\xa9\xd\12"; goto f4cZR; tYdUk: HaEXh: goto i3amO; y9rh2: goto WUM7V; goto NX9ol; Th732: wgRxO: goto r41v7; QQQfN: goto WUM7V; goto qefQ9; s0U47: $backupDate = explode("\x23", $path_parts["\x66\151\154\145\x6e\x61\155\x65"])[1]; goto cFBL1; MMNn7: if (is_dir($this->backup_path) && file_exists($this->backup_path) && ($handle = opendir($this->backup_path))) { goto SkfQO; } goto zpaMg; gBmOW: } public function backup() { goto vJ2z0; BXmrs: $cmd = sprintf("\155\171\163\x71\154\144\x75\x6d\x70\40\55\55\x73\153\x69\x70\x2d\x6c\x6f\x63\x6b\x2d\x74\x61\142\x6c\145\163\40\55\150\x25\163\x20\x2d\x75\45\163\40\x2d\160\45\x73\x20\45\x73\x20\76\40\x25\163", $conf["\x68\157\x73\x74\156\x61\x6d\x65"], $conf["\165\x73\x65\162\x6e\141\x6d\145"], $conf["\x70\x61\x73\x73\167\157\162\x64"], $conf["\x64\141\164\141\x62\x61\x73\145"], $file_sql); goto WRYSN; L5C_p: $result = system($cmd); goto X6nej; VxLq8: exception("\x66\x61\x69\x6c\x65\x64\40\x74\157\40\163\171\163\164\x65\x6d\x20{$cmd}"); goto mbb2y; iGKOh: ad83t: goto TY7Y6; cxify: goto lsB24; goto aVsb2; WRYSN: goto abnAn; goto tsm69; C5UaC: $filename = sprintf("\x25\x73\x23\x25\x73", $conf["\x64\x61\x74\x61\142\141\163\145"], date("\x59\155\144")); goto m9o0Z; Yn2fp: if (IS_WIN) { goto eoPCp; } goto Tl5vn; j3WWx: lsB24: goto L5C_p; ZQk3h: unlink($file_sql); goto tnIMN; TY7Y6: $file_zip = $this->backup_path . DS . $filename . "\x2e\x7a\151\160"; goto Yn2fp; X6nej: if (!($result === false)) { goto v8vdO; } goto VxLq8; G88wp: if (!($result === false)) { goto ad83t; } goto BzzLR; tnIMN: return "\xe5\244\207\xe4\xbb\275\xe6\x88\x90\xe5\x8a\x9f{$filename}"; goto GlIh7; cgqKR: $cmd = sprintf("\42{$this->mysql_dump}\x22\40\x2d\x2d\x73\x6b\151\160\x2d\154\x6f\143\153\55\x74\141\x62\x6c\x65\163\x20\55\x68\45\x73\40\x2d\x75\x25\163\x20\55\x70\45\163\40\45\x73\40\76\40\45\163", $conf["\150\157\x73\164\156\x61\155\145"], $conf["\165\163\145\x72\156\x61\155\x65"], $conf["\160\x61\x73\163\167\x6f\162\x64"], $conf["\144\141\164\x61\142\x61\x73\x65"], $file_sql); goto nLKDN; Vir6H: $cmd = "\x22{$this->compressor}\x22\40\141\x20{$file_zip}\40{$file_sql}"; goto j3WWx; aVsb2: eoPCp: goto Vir6H; vJ2z0: $conf = config("\x64\x61\x74\x61\142\x61\x73\145"); goto C5UaC; BzzLR: exception("\146\x61\x69\x6c\145\x64\x20\x74\157\x20\x73\171\163\164\145\155\x20{$cmd}"); goto iGKOh; tsm69: GX3jU: goto cgqKR; Tl5vn: $cmd = "\x7a\x69\x70\x20\55\162\40{$file_zip}\x20{$file_sql}"; goto cxify; nLKDN: abnAn: goto yhEye; m9o0Z: $file_sql = $this->backup_path . DS . $filename . "\x2e\x73\x71\x6c"; goto LBguM; mbb2y: v8vdO: goto ZQk3h; yhEye: $result = system($cmd); goto G88wp; LBguM: if (IS_WIN) { goto GX3jU; } goto BXmrs; GlIh7: } }
