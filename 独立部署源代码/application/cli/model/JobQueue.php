<?php
 namespace app\cli\model; use app\cli\controller\Jobs; use think\Log; use think\Model; use app\Defs; class JobQueue extends Model { protected $pk = "\151\144"; protected $table = "\x6a\157\142\137\161\x75\x65\165\145"; const JOB_STATUS_QUEUED = 1; const JOB_STATUS_RUNNING = 2; const JOB_STATUS_DONE = 3; const JOB_STATUS = array(self::JOB_STATUS_QUEUED => array("\x76\x61\x6c\x75\x65" => self::JOB_STATUS_QUEUED, "\154\141\142\x65\x6c" => "\xe6\216\222\xe9\230\x9f\xe4\270\xad", "\x63\154\x73" => "\144\x65\146\x61\165\154\x74"), self::JOB_STATUS_RUNNING => array("\166\141\x6c\165\x65" => self::JOB_STATUS_RUNNING, "\x6c\x61\x62\x65\x6c" => "\350\277\220\xe8\241\214\xe4\xb8\255", "\x63\x6c\163" => "\x73\145\143\x6f\x6e\144\x61\x72\x79"), self::JOB_STATUS_DONE => array("\166\x61\154\x75\145" => self::JOB_STATUS_DONE, "\154\141\x62\145\154" => "\xe5\267\xb2\345\256\214\346\210\x90", "\143\154\x73" => "\163\165\143\x63\x65\163\x73")); const JOB_RESULT_PENDING = "\345\xbe\205\xe5\xae\232"; const JOB_RESULT_SUCCESS = "\xe6\210\x90\xe5\x8a\x9f"; const JOB_RESULT_FAILURE = "\xe5\xa4\261\350\xb4\xa5"; public function getExecuteTimeAttr($value) { return $value; } public function getExecuteEndTimeAttr($value) { return $value; } public function failJob($message = '') { return $this->resolveJob(self::JOB_RESULT_FAILURE, $message); } public function resolveJob($result, $message = '') { goto uR7zG; WVKMP: $this->message = truncateString($message, 1024); goto V5Up2; uR7zG: Log::record("\122\x65\163\157\154\x76\x69\x6e\147\x20\x6a\157\142\40{$this->id}\x20\141\163\x20{$result}\72\40{$message}"); goto n0i9F; fb3PF: $this->save(); goto pYwWT; n0i9F: $this->status = self::JOB_STATUS_DONE; goto WVKMP; pYwWT: Scheduler::update(["\x6c\x61\163\x74\137\162\165\156" => date("\131\x2d\155\55\144\40\110\x3a\151\x3a\x73")], ["\151\x64" => $this->scheduler_id]); goto xUP8G; xUP8G: return true; goto LrNV1; Q4LvY: $this->execute_end_time = date("\131\55\x6d\x2d\144\x20\110\72\x69\72\163"); goto fb3PF; V5Up2: $this->result = $result; goto Q4LvY; LrNV1: } public function runJob() { goto hd2QR; hd2QR: $jobs = new Jobs(); goto k32kq; k32kq: $func = $this->target; goto MPhLN; MPhLN: $callable_name = null; goto mLB2h; oFeIE: w_Cek: goto CN_IW; CN_IW: try { goto vP9JH; GzcvP: return true; goto XgvDo; NBZBT: $this->resolveJob(self::JOB_RESULT_SUCCESS, $resultMsg); goto GzcvP; vP9JH: $resultMsg = call_user_func([$jobs, $func]); goto NBZBT; XgvDo: } catch (\Exception $e) { $this->failJob($e->getMessage()); return false; } goto Llobw; fpODd: return false; goto oFeIE; Kph47: $this->failJob("\x4e\157\x74\x20\x43\141\x6c\154\x61\x62\x6c\145\x3a\40" . $callable_name); goto fpODd; mLB2h: if (!(false == is_callable([$jobs, $func], false, $callable_name))) { goto w_Cek; } goto Kph47; Llobw: } }
