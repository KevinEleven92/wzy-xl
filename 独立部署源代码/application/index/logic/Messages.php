<?php
 namespace app\index\logic; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\service\RequestContext; class Messages extends Base { const MESSAGE_ADMIN_SYSTEM_CATEGORY = 1; public static $messageCategoryDefs = array(self::MESSAGE_ADMIN_SYSTEM_CATEGORY => "\xe7\xb3\273\xe7\273\x9f\351\200\x9a\xe7\x9f\245"); public static $messageCategoryHtmlDefs = array(self::MESSAGE_ADMIN_SYSTEM_CATEGORY => "\x3c\163\160\141\156\x20\x63\x6c\141\163\163\x3d\x22\142\x61\x64\x67\x65\x20\x62\141\144\x67\x65\55\x70\x72\x69\x6d\141\162\171\42\x3e\xe7\xb3\xbb\xe7\273\237\xe9\200\x9a\347\x9f\245\74\57\163\160\141\x6e\76"); protected function __construct() { parent::__construct(); } public function load($adminId, $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto VGwq9; wHH9K: if ($sort == "\x63\x61\164\x65\147\x6f\162\x79") { goto aikpK; } goto z_And; VPD97: aikpK: goto NJH6O; NJH6O: $order = "\x63\141\164\x65\147\157\x72\x79\40" . $order; goto Pp00g; gUuP3: if (!$adminId) { goto nouiK; } goto JuvBs; NTxSC: $totalCount = Db::table("\155\x65\163\163\141\x67\145\163")->where($conditions)->count(); goto s8oQg; CWJwU: foreach ($records as &$record) { $record["\x63\x68\145\x63\153\x65\x64"] = true; vfEJn: } goto Kswlj; VGwq9: $limit = ($page - 1) * $rows . "\54" . $rows; goto wHH9K; Kswlj: F7RAe: goto DWZu4; DWZu4: return ["\164\157\164\141\x6c" => $totalCount, "\162\x6f\167\x73" => $records]; goto r4DkD; JuvBs: $conditions["\141\144\155\x69\x6e\x5f\151\144"] = $adminId; goto iA066; s8oQg: $records = Db::table("\x6d\x65\163\x73\x61\147\x65\x73")->where($conditions)->limit($limit)->order($order)->field(["\x6d\x65\163\x73\x61\x67\x65\137\151\144", "\x61\144\155\151\156\137\x69\x64", "\x74\x69\164\x6c\x65", "\x63\x6f\156\164\x65\156\x74", "\143\x61\x74\145\147\157\162\171", "\x69\x73\x5f\x72\145\141\x64", "\162\x65\x61\144\x5f\x74\x69\155\x65", "\x65\156\164\145\162\145\144"])->select(); goto CWJwU; z_And: $order = "\x6d\x65\163\x73\x61\x67\145\137\151\x64\x20\144\145\x73\143"; goto K34vv; Pp00g: BQiYv: goto tDW8s; K34vv: goto BQiYv; goto VPD97; iA066: nouiK: goto NTxSC; tDW8s: $conditions = []; goto gUuP3; r4DkD: } public function add($category, $title, $content, $adminId = 0) { goto mDzkM; xlDb5: $messageId = Db::table("\x6d\x65\x73\163\141\x67\x65\x73")->insertGetId($datas); goto ZvZO4; ZvZO4: return $messageId; goto IWnDb; mDzkM: $datas = ["\141\144\x6d\151\156\137\x69\144" => $adminId, "\164\151\x74\154\145" => mb_truncateString($title, 200), "\x63\157\156\164\x65\156\x74" => $content, "\x63\141\164\x65\147\157\162\x79" => $category]; goto xlDb5; IWnDb: } public function markRead($messageId) { Db::table("\155\x65\x73\x73\x61\x67\145\x73")->where(["\x6d\x65\x73\163\x61\x67\145\x5f\151\144" => $messageId, "\x69\163\x5f\x72\x65\141\x64" => 0])->update(["\151\x73\x5f\162\145\141\144" => 1, "\x72\145\x61\x64\137\164\x69\155\x65" => date("\x59\x2d\x6d\55\144\40\x48\72\x69\x3a\x73")]); return true; } public function markAllRead($adminId) { goto PKxjF; v00b5: sN8El: goto aKnW5; NdPvs: $conditions["\x61\144\155\151\x6e\137\x69\144"] = $adminId; goto v00b5; aKnW5: Db::table("\155\x65\163\x73\x61\147\145\163")->where($conditions)->update(["\151\163\x5f\162\x65\141\x64" => 1, "\x72\145\x61\x64\x5f\x74\x69\155\145" => Db::raw("\156\x6f\167\x28\x29")]); goto U7o4T; pmbUL: if (!$adminId) { goto sN8El; } goto NdPvs; PKxjF: $conditions = ["\x69\163\x5f\162\x65\141\144" => 0]; goto pmbUL; U7o4T: } public function markSelectedRead($messageIds) { Db::table("\155\x65\163\x73\x61\147\145\x73")->where(["\x6d\x65\x73\163\x61\x67\x65\x5f\151\144" => ["\x69\156", $messageIds], "\151\x73\137\162\x65\x61\x64" => 0])->update(["\151\163\x5f\162\x65\x61\x64" => 1, "\162\x65\141\144\137\164\151\x6d\x65" => Db::raw("\x6e\157\x77\x28\51")]); } public function getInfos($messageId) { $infos = Db::table("\x6d\x65\163\163\141\147\145\163")->where("\x6d\145\x73\x73\x61\x67\145\137\x69\144", $messageId)->field(true)->find(); return $infos; } public function unreadCount($adminId) { goto FmQow; MHjKT: $conditions["\141\x64\x6d\x69\x6e\x5f\151\x64"] = $adminId; goto oQUjW; Q4Lm1: $count = Db::table("\x6d\145\x73\163\141\147\145\163")->where($conditions)->count(); goto Ku5LX; Ku5LX: return $count; goto QhhCP; YysWP: if (!$adminId) { goto SR6z2; } goto MHjKT; oQUjW: SR6z2: goto Q4Lm1; FmQow: $conditions = ["\151\x73\x5f\x72\x65\x61\144" => 0]; goto YysWP; QhhCP: } }
