<?php
 namespace app\index\logic; use think\Log; use think\Db; use app\index\model\Subject as SubjectModel; use app\index\logic\Attachments as AttachmentsLogic; use app\index\logic\Defs as IndexDefs; use app\Defs; use app\index\service\OperationLogs; use app\index\service\RequestContext; use app\common\service\WException; use app\index\service\Wzyer as WzyerService; use app\index\service\EventLogs as EventLogsService; use report\algo\Ai as AiAlgo; class Subject extends Base { protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto sPEQa; XFgrp: QU4P3: goto e3sM1; ZbNty: goto QU4P3; goto bD0NK; x4aTb: $conditions["\x64\145\x6c\x65\x74\145\x5f\146\154\141\x67"] = 0; goto QimJb; T3QAF: $order = "\164\x6f\164\141\x6c\x5f\x61\155\157\x75\x6e\x74\40" . $order . "\x2c\x20\x63\162\x65\141\164\x65\x5f\164\151\155\145\40\144\145\x73\x63"; goto LGTHo; eLKgP: $conditions["\163\164\141\164\165\x73"] = $search["\x73\164\141\x74\165\x73"]; goto ZEpjE; jWN0J: $order = "\160\x61\x72\x74\151\143\151\160\x61\x6e\164\163\x20" . $order . "\54\40\x63\162\145\x61\x74\145\x5f\164\x69\x6d\145\x20\x64\x65\163\143"; goto PXCV1; DQskZ: $records = Db::table("\x73\165\142\x6a\x65\x63\164")->where($conditions)->page($page, $rows)->order($order)->field("\52")->select(); goto tMVdx; O7Z09: if (!empty($subjectIds)) { goto CAyCZ; } goto RLF42; xogWX: if (emptyInArray($search, "\154\141\142\x65\154")) { goto jQJXs; } goto gSuIh; deS6T: if (emptyInArray($search, "\x73\164\x61\x74\165\163")) { goto u7sCL; } goto eLKgP; lrIkk: $order = "\163\x74\141\x74\x75\163\40" . $order . "\x2c\40\143\162\x65\141\x74\145\x5f\x74\x69\x6d\145\40\x64\145\163\143"; goto XFgrp; llvqw: Yu9Qm: goto x4aTb; aSgbu: jQJXs: goto deS6T; sRedP: Ho6uB: goto PyiYL; BAYV3: zijdS: goto HVN8M; M7m24: y6NY_: goto JviAL; e3sM1: goto Ho6uB; goto cmvKs; nFIH7: $conditions = []; goto Opg7G; r6FyI: CAyCZ: goto aHJmv; y0_Qs: L4cu9: goto StU_w; SAEyP: DsIEV: goto hhzm7; bD0NK: Qmyk1: goto lrIkk; Rq420: $conditions["\x6e\141\155\x65"] = ["\x6c\151\x6b\145", "\x25{$search["\156\x61\155\145"]}\45"]; goto MObfD; VVdWq: nwpu4: goto T3QAF; mMP7y: $conditions["\164\171\160\145"] = $search["\x74\x79\x70\x65"]; goto M7m24; JviAL: if (emptyInArray($search, "\x63\x61\x74\145\x67\157\x72\x79\137\x69\x64")) { goto KHSmO; } goto vZXLf; VLg1n: goto g2JZ9; goto BAYV3; vZXLf: $subjectIds = Db::table("\163\165\142\x6a\145\x63\x74\137\x63\x61\164\145\x67\157\x72\171\x5f\x72\x65\x6c\141\x74\x65")->where(["\143\x61\164\x65\x67\x6f\162\x79\x5f\x69\144" => $search["\x63\x61\164\145\x67\x6f\162\x79\x5f\x69\x64"]])->column("\x73\x75\x62\x6a\x65\143\164\137\151\x64"); goto O7Z09; myAKj: goto jibm2; goto y0_Qs; SrcXc: HCdMD: goto jWN0J; MWqaL: if ($sort == "\163\164\x61\164\165\163") { goto Qmyk1; } goto VyQHO; iHEbn: $totalCount = Db::table("\163\165\142\x6a\x65\143\x74")->where($conditions)->count(); goto DQskZ; Opg7G: if (empty($search["\164\x79\160\145"])) { goto y6NY_; } goto mMP7y; RLF42: return ["\x74\157\164\x61\x6c" => 0, "\x72\157\x77\163" => []]; goto r6FyI; QzAii: goto BoGsn; goto llvqw; gSuIh: $conditions["\x6c\x61\142\x65\154"] = ["\154\151\x6b\145", "\x25{$search["\x6c\x61\x62\x65\154"]}\x25"]; goto aSgbu; WFKVU: jibm2: goto ZbNty; aHJmv: $conditions["\x69\x64"] = ["\x69\x6e", $subjectIds]; goto BUocG; Qkmbh: $conditions["\x64\145\154\145\x74\145\x5f\x66\x6c\141\147"] = $search["\x64\x65\x6c\x65\164\145\137\x66\x6c\x61\147"]; goto QzAii; HVN8M: $order = "\143\165\x72\162\x65\156\x74\x5f\x70\162\151\143\145\x20" . $order . "\54\x20\x63\x72\x65\x61\x74\145\x5f\x74\151\x6d\x65\x20\144\x65\x73\143"; goto TjQW_; pcS09: if (!isset($search["\x64\145\154\x65\164\145\x5f\x66\154\141\x67"])) { goto Yu9Qm; } goto Qkmbh; hhzm7: return ["\164\x6f\x74\x61\x6c" => $totalCount, "\162\x6f\x77\163" => $records]; goto o4gU1; Oah6V: if (emptyInArray($search, "\x6e\x61\155\x65")) { goto NwN0G; } goto Rq420; PXCV1: oe2_j: goto VLg1n; QimJb: BoGsn: goto iHEbn; IIQWh: if ($sort == "\164\x6f\x74\141\x6c\x5f\x61\155\x6f\165\x6e\164") { goto nwpu4; } goto RyFKm; RyFKm: if ($sort == "\x73\x6f\162\164") { goto X8r2O; } goto MWqaL; ZEpjE: u7sCL: goto pcS09; tMVdx: foreach ($records as &$record) { goto YjIZO; YjIZO: $record["\x63\141\164\145\x67\x6f\x72\x79"] = $this->getCategoryNameStr($record["\x69\144"]); goto wJ3ih; Kf8Mw: AYLh1: goto KfBnZ; wJ3ih: $record["\151\164\145\155\137\x6e\165\x6d"] = Db::table("\163\165\x62\152\x65\x63\164\137\x69\164\145\155")->where("\x73\165\x62\152\x65\143\x74\137\x69\144", $record["\151\144"])->count(); goto Umwcf; Umwcf: $record["\151\155\x61\x67\145\x5f\x75\x72\154"] = generateThumbnailUrl($record["\x69\x6d\141\x67\145\x5f\x75\x72\154"], 100); goto rvkky; rvkky: $record["\x62\141\156\156\145\x72\137\151\x6d\x67"] = generateThumbnailUrl($record["\x62\x61\156\x6e\145\162\x5f\151\x6d\x67"], 100); goto Kf8Mw; KfBnZ: } goto SAEyP; BxmvC: $order = "\x73\x6f\162\164\40\141\163\x63\54\x20\x63\x72\145\x61\164\145\x5f\x74\151\x6d\145\x20\144\x65\163\x63"; goto myAKj; oMbbm: if ($sort == "\160\x61\162\164\x69\x63\x69\160\141\x6e\164\x73") { goto HCdMD; } goto IIQWh; N7AqM: goto oe2_j; goto SrcXc; OkIPo: $order = "\163\x6f\x72\x74\x20" . $order . "\x2c\40\x63\x72\145\x61\164\145\x5f\164\x69\x6d\x65\40\144\x65\163\143"; goto sRedP; BUocG: KHSmO: goto Oah6V; StU_w: $order = "\x72\x61\x74\151\156\x67\x20" . $order . "\54\x20\x63\162\x65\x61\164\145\x5f\x74\x69\x6d\145\40\x64\x65\163\143"; goto WFKVU; VyQHO: if ($sort == "\x72\x61\164\151\156\147") { goto L4cu9; } goto BxmvC; sPEQa: if ($sort == "\143\x75\162\162\145\x6e\x74\x5f\x70\162\x69\143\x65") { goto zijdS; } goto oMbbm; PyiYL: goto uT1VV; goto VVdWq; MObfD: NwN0G: goto xogWX; TjQW_: g2JZ9: goto nFIH7; cmvKs: X8r2O: goto OkIPo; LGTHo: uT1VV: goto N7AqM; o4gU1: } public function getAvailableCategories() { return Db::table("\143\141\x74\x65\x67\x6f\x72\x69\145\x73")->order("\x69\144\x20\x61\x73\x63")->column("\x69\x64\54\156\x61\x6d\x65\54\x73\164\x61\x74\165\163\54\151\155\147\x5f\x75\x72\154"); } public function getCategoryNameStr($id) { goto xZpPT; pPPvC: return implode("\54", $names); goto MLbLB; rRniQ: D8zQG: goto pPPvC; xZpPT: $names = Db::table("\163\x75\x62\x6a\x65\143\164\137\143\x61\164\x65\x67\x6f\x72\171\137\162\x65\x6c\x61\x74\145")->alias("\x53\103\x52")->join("\x63\141\x74\145\147\x6f\x72\x69\145\163\x20\103", "\x53\103\122\56\x63\x61\x74\145\x67\x6f\162\x79\137\x69\144\x3d\103\x2e\151\x64\x20\x61\156\x64\40\x53\x43\x52\56\163\x75\142\152\x65\x63\x74\x5f\151\144\75" . $id)->column("\103\x2e\x6e\141\x6d\145"); goto b1Emv; dlUlK: return ''; goto rRniQ; b1Emv: if (!empty($names)) { goto D8zQG; } goto dlUlK; MLbLB: } public function getCategoryIds($id) { goto Z3zS9; PrhQN: if (!empty($categoryIds)) { goto NA7mH; } goto JFntz; JFntz: $categoryIds = []; goto jM0UN; o1tu3: return $categoryIds; goto PgXoQ; jM0UN: NA7mH: goto o1tu3; Z3zS9: $categoryIds = Db::table("\163\165\142\152\145\x63\x74\137\143\x61\x74\145\147\x6f\x72\171\x5f\x72\x65\x6c\141\164\145")->where("\163\x75\142\x6a\x65\x63\164\x5f\151\144", $id)->column("\x63\x61\164\145\147\x6f\x72\171\137\x69\x64"); goto PrhQN; PgXoQ: } public function getDefaultSubject() { return ["\151\x64" => 0, "\x69\x6d\x61\147\x65\137\165\x72\154" => '', "\142\141\x6e\x6e\145\162\x5f\151\155\x67" => '', "\156\141\x6d\x65" => '', "\x73\x75\x62\x74\x69\164\x6c\145" => '', "\143\x75\162\162\145\x6e\164\137\160\162\151\143\145" => 0, "\x65\x78\x70\145\143\x74\x5f\146\151\x6e\151\x73\x68\137\x74\x69\155\x65" => 8, "\163\165\142\x6a\145\x63\164\137\x64\145\x73\x63" => '', "\163\165\x62\152\145\143\x74\x5f\x74\x69\x70" => '', "\x73\x74\x61\164\x75\163" => IndexDefs::ENTITY_DRAFT_STATUS, "\162\141\164\x69\x6e\147" => 5, "\x74\145\x73\x74\137\141\154\154\157\x77\137\142\x61\143\153" => 0, "\164\x65\x73\x74\x5f\141\x6c\154\157\x77\x5f\166\x69\145\x77\x5f\162\145\160\x6f\x72\x74" => 1, "\165\156\151\137\141\x70\x70" => 0, "\160\141\x72\164\x69\x63\151\160\x61\x6e\164\163\x5f\163\x68\157\x77" => 0, "\x74\145\163\x74\137\x61\x6c\154\157\x77\137\x61\x6e\x73\167\x65\x72\137\145\155\160\x74\x79" => 0]; } public function getSubject($id) { $subject = Db::table("\x73\165\142\x6a\x65\x63\164")->where("\x69\x64", $id)->field(true)->find(); return $subject; } public function loadSubjectStandards($subjectId, $wholeFlag = false) { goto hj7xp; BMxTf: array_unshift($rows, ["\x73\164\141\x6e\x64\141\162\x64\137\x69\x64" => 0, "\154\141\x74\151\164\x75\x64\x65" => Defs::SUBJECT_WHOLE_STANDARD, "\151\164\145\x6d\x5f\x63\x6f\165\156\164" => $subject["\x69\164\x65\155\163"], "\167\x65\151\147\150\x74\x5f\x6d\x69\x6e\137\x6d\x61\x78" => $subject["\x73\164\x61\x74\151\x73\164\x69\143\x5f\167\145\151\x67\x68\x74\x5f\155\x69\x6e"] . "\40\x2d\x20" . $subject["\163\164\x61\164\x69\163\x74\x69\143\x5f\167\145\x69\x67\x68\164\x5f\155\x61\170"], "\x73\164\x61\x6e\144\x61\x72\x64\137\x77\x65\151\147\x68\164\137\155\x69\x6e\137\155\x61\170" => $subject["\x73\164\x61\156\144\141\162\144\x5f\x77\x65\x69\x67\150\x74\x5f\x6d\151\x6e"] !== null && $subject["\163\x74\x61\x6e\x64\x61\x72\144\137\x77\x65\x69\x67\x68\164\x5f\155\141\170"] !== null ? $subject["\x73\x74\141\x6e\144\141\x72\144\137\167\x65\x69\x67\150\x74\137\155\x69\x6e"] . "\40\55\40" . $subject["\163\x74\x61\156\144\x61\x72\x64\137\x77\x65\x69\147\150\x74\137\155\x61\x78"] : null]); goto NVUdt; hj7xp: $rows = Db::table("\x73\165\142\x6a\145\x63\x74\137\x73\164\x61\x6e\144\x61\x72\144")->where(["\163\165\142\x6a\145\143\x74\x5f\151\144" => $subjectId])->field("\x69\144\x20\x61\163\x20\163\164\x61\156\x64\141\x72\144\137\x69\144\54\x20\x6c\x61\164\x69\x74\165\x64\x65\54\x20\163\164\x61\164\151\x73\164\x69\143\137\x77\x65\x69\147\150\x74\x5f\x6d\151\x6e\54\x20\163\164\141\x74\x69\x73\164\x69\143\137\167\x65\151\x67\150\x74\x5f\155\x61\x78\54\40\x73\x74\141\x6e\x64\141\x72\144\137\167\145\x69\147\x68\164\x5f\x6d\x69\x6e\54\40\x73\164\x61\156\x64\141\162\144\x5f\x77\145\x69\147\x68\x74\137\155\x61\170\54\x20\x73\157\x72\x74\54\x20\162\145\x6d\x61\162\x6b")->order("\x73\x6f\162\164\x20\x61\x73\x63\x2c\x20\151\x64\40\141\x73\143")->select(); goto OWZfz; gHlL0: if (!$wholeFlag) { goto boiL6; } goto PEKgL; NVUdt: zBFmE: goto Ah0vg; Ah0vg: boiL6: goto gkcPs; ook6e: if (!$subject) { goto zBFmE; } goto BMxTf; gkcPs: return $rows; goto D9Tqs; YPWi6: CakcF: goto gHlL0; FY18x: yt6TL: goto InNHx; InNHx: foreach ($rows as &$row) { goto SyLRX; wZoeQ: $row["\x73\x74\x61\x6e\x64\x61\162\x64\x5f\167\145\x69\147\150\164\137\x6d\x69\156\137\x6d\141\x78"] = $row["\x73\164\141\156\x64\141\162\x64\137\167\145\151\x67\x68\x74\x5f\x6d\x69\156"] . "\40\x2d\40" . $row["\x73\x74\141\x6e\144\141\162\x64\137\167\145\151\147\150\164\137\x6d\x61\x78"]; goto mQSGx; yNM8u: $minWeight = $row["\x73\x74\141\x74\151\163\x74\151\x63\x5f\167\x65\x69\147\x68\x74\137\x6d\151\x6e"]; goto Chu2T; u8KCr: $row["\163\x74\x61\156\144\141\162\144\x5f\x77\x65\x69\x67\x68\x74\137\x6d\x69\156\x5f\x6d\141\170"] = null; goto RW8cv; Chu2T: $maxWeight = $row["\163\x74\141\164\x69\x73\x74\x69\143\x5f\167\x65\151\x67\x68\x74\137\155\x61\170"]; goto UMGio; mQSGx: B2vlj: goto GcNL1; RW8cv: goto B2vlj; goto Wo5U2; UMGio: $row["\167\x65\151\x67\x68\164\x5f\155\151\x6e\x5f\155\x61\170"] = $minWeight . "\x20\55\40" . $maxWeight; goto XtHKA; XtHKA: if ($row["\x73\x74\x61\156\x64\141\x72\x64\x5f\x77\145\151\147\x68\164\137\155\x69\x6e"] !== null && $row["\163\164\141\156\144\141\x72\144\137\167\145\x69\147\x68\164\x5f\155\141\170"] !== null) { goto IiWyn; } goto u8KCr; sdFJ6: $row["\x69\x74\145\155\x5f\143\x6f\165\156\164"] = Db::table("\163\165\142\x6a\145\x63\164\x5f\x69\x74\145\155\137\163\x74\141\156\x64\x61\162\x64")->where(["\163\x75\142\x6a\x65\143\164\137\151\144" => $subjectId, "\163\164\x61\156\144\141\162\x64\137\151\144" => $standardId])->count(); goto yNM8u; Wo5U2: IiWyn: goto wZoeQ; SyLRX: $standardId = $row["\x73\164\x61\156\x64\141\162\144\x5f\x69\144"]; goto sdFJ6; GcNL1: oyqiw: goto gl5we; gl5we: } goto YPWi6; PEKgL: $subject = Db::table("\163\165\x62\x6a\145\x63\164")->where("\151\144", $subjectId)->field("\x69\164\145\x6d\x73\54\40\x73\x74\141\x74\x69\163\164\x69\143\137\x77\145\x69\x67\150\x74\x5f\155\151\x6e\x2c\x20\163\164\x61\164\x69\x73\164\x69\x63\137\x77\x65\151\x67\x68\164\137\x6d\141\x78\x2c\40\x73\x74\x61\x6e\144\141\x72\144\x5f\167\145\151\147\150\x74\137\155\151\x6e\x2c\40\163\x74\141\156\144\141\x72\x64\137\x77\x65\151\x67\x68\164\137\155\141\x78")->find(); goto ook6e; dlAJM: $rows = []; goto FY18x; OWZfz: if ($rows) { goto yt6TL; } goto dlAJM; D9Tqs: } public function getSubjectStandard($id) { $standard = Db::table("\x73\165\x62\152\x65\x63\164\x5f\163\164\141\156\144\x61\162\x64")->where("\x69\144", $id)->field(true)->find(); return $standard; } public function saveSubjectStandard($subjectId, $standardId, $formData) { goto gMA_e; ICtR2: Db::table("\163\165\x62\x6a\x65\143\164\x5f\163\164\141\x6e\144\141\162\144\x5f\x6c\141\164\x69\x74\x75\x64\145")->where(["\x73\x74\x61\156\x64\x61\x72\144\137\151\144" => $standardId])->update(["\x6c\x61\164\151\x74\x75\144\x65" => $formData["\154\x61\164\151\x74\165\144\145"]]); goto dVy4B; YZr3R: VQuHT: goto Zeycb; j_ROr: Db::table("\163\x75\142\152\x65\143\164\x5f\163\164\x61\156\144\x61\162\x64")->where(["\151\x64" => $standardId])->update($formData); goto ICtR2; I3sxT: UszR9: goto MZRZb; Zeycb: $formData["\163\x75\142\152\x65\x63\164\x5f\151\x64"] = $subjectId; goto VB0H_; gMA_e: if (empty($standardId)) { goto VQuHT; } goto j_ROr; dVy4B: goto UszR9; goto YZr3R; VB0H_: Db::table("\x73\165\x62\152\x65\x63\x74\x5f\x73\x74\x61\x6e\144\141\162\x64")->insert($formData); goto I3sxT; MZRZb: } public function removeSubjectStandard($subjectId, $standardId) { goto cpgQU; kr2zg: Db::table("\x73\x75\142\x6a\145\143\x74\x5f\x69\x74\145\155\137\x73\164\141\x6e\144\x61\162\x64")->where("\x73\164\x61\156\x64\x61\162\x64\137\151\144", $standardId)->delete(); goto R9Ie3; gYCFM: $this->updateSubjectStandardMinMax($subjectId); goto sYyGF; R9Ie3: Db::table("\x73\x75\x62\152\145\x63\x74\x5f\x73\164\141\x6e\144\141\x72\144\x5f\x6c\141\x74\x69\x74\x75\x64\x65")->where("\163\x74\141\x6e\144\x61\162\144\x5f\x69\144", $standardId)->delete(); goto gYCFM; cpgQU: Db::table("\x73\x75\142\x6a\145\143\164\x5f\163\x74\141\x6e\x64\141\x72\x64")->where(["\x69\144" => $standardId])->delete(); goto kr2zg; sYyGF: } public function saveSubject($id, $formData) { goto m5gZV; N0_TQ: $subjectId = $id; goto AqPkS; rjg1s: $model->allowField(true)->save(); goto t11Mh; C6X7k: J_XaQ: goto o9_KG; SqZs6: phZ2L: goto zL6Nb; usOwL: OperationLogs::I()->subjectLog("\xe6\226\260\345\xa2\236\351\207\x8f\350\xa1\250\x20\55\40{$subjectName}", beautifyLogArray($formData, [], "\x73\x75\142\152\145\143\x74"), OperationLogs::OPT_ADD_TYPE, $subjectId); goto jKH3z; qbTFE: Vxwk7: goto Y2KR8; T33DI: wexception("\346\x97\240\xe6\263\x95\xe6\211\xbe\xe5\x88\260\350\xaf\245\xe9\207\x8f\xe8\241\250"); goto qwvkp; P_TeB: $formData["\165\156\151\x5f\141\x70\x70"] = $formData["\165\x6e\151\137\141\160\x70"] ?? 0; goto pjqHu; xS_KQ: Db::table("\163\x75\x62\152\x65\x63\164\137\143\x61\164\x65\x67\157\162\x79\x5f\x72\x65\x6c\141\164\x65")->where(["\x73\165\142\152\145\x63\164\x5f\x69\x64" => $subjectId, "\x63\141\164\x65\x67\x6f\x72\x79\x5f\x69\x64" => ["\x6e\157\x74\x20\151\x6e", $categoryIds]])->delete(); goto SqZs6; Xq_HI: $model = SubjectModel::get($id); goto oFUVH; l2lPX: goto phZ2L; goto pUNCo; m5gZV: if (empty($id)) { goto NekWf; } goto Xq_HI; xTMmZ: $categoryIds = explode("\54", $formData["\x63\x61\x74\145\147\157\162\171\137\151\144\163"]); goto R8XXt; YGEOm: NekWf: goto xJnOy; t11Mh: if (empty($id)) { goto Qs3MX; } goto N0_TQ; OpxAe: wy3xv: goto P_TeB; IwAph: if (!$imageUrl) { goto J_XaQ; } goto dJHSF; LYUBn: $imageUrl = autoGenerateImage($formData["\156\141\x6d\x65"], $formData["\x69\x6d\x61\147\145\137\x75\162\154"]); goto IwAph; ugsb0: $subjectId = $model->id; goto s32zW; qwvkp: lP7ki: goto fzF1n; AqPkS: $subjectName = Db::table("\163\x75\142\152\x65\x63\x74")->where(["\151\x64" => $id])->value("\156\x61\155\x65"); goto n1o3F; jKH3z: wDBrs: goto SJID6; s32zW: $subjectName = Db::table("\163\165\x62\152\x65\x63\164")->where(["\x69\x64" => $subjectId])->value("\156\x61\x6d\145"); goto usOwL; pUNCo: bWJ02: goto xS_KQ; zL6Nb: foreach ($categoryIds as $categoryId) { goto f1QaR; c3nG9: HspmM: goto VVOiR; fRmG3: Db::table("\163\165\x62\152\145\x63\164\137\x63\141\x74\145\147\x6f\162\171\137\162\x65\x6c\141\x74\x65")->insert(["\163\x75\x62\x6a\145\143\164\x5f\151\x64" => $subjectId, "\143\141\x74\145\147\157\162\x79\x5f\151\144" => $categoryId]); goto fAVDg; f1QaR: $bExist = Db::table("\x73\x75\x62\x6a\145\143\x74\137\x63\x61\164\145\147\157\x72\x79\137\x72\x65\x6c\x61\164\145")->where(["\163\165\142\x6a\x65\x63\164\x5f\x69\x64" => $subjectId, "\143\141\x74\x65\147\x6f\162\x79\137\x69\144" => $categoryId])->find(); goto iegvh; iegvh: if ($bExist) { goto FOEFa; } goto fRmG3; fAVDg: FOEFa: goto c3nG9; VVOiR: } goto qbTFE; fzF1n: $originals = Db::table("\163\165\142\152\x65\143\164")->where(["\x69\144" => $id])->field(true)->find(); goto XB6PV; oFUVH: if ($model) { goto lP7ki; } goto T33DI; Euf3h: Qs3MX: goto ugsb0; pjqHu: $formData["\155\157\x64\x69\146\x79\x5f\x74\151\155\x65"] = date("\x59\x2d\x6d\55\x64\40\x48\x3a\x69\x3a\163"); goto LYUBn; XB6PV: goto wy3xv; goto YGEOm; xJnOy: $model = new SubjectModel(); goto PWdfX; SJID6: $categoryIds = []; goto nFwmh; nFwmh: if (!$formData["\143\141\x74\x65\147\x6f\162\171\x5f\x69\144\163"]) { goto NiqJK; } goto xTMmZ; zwLyv: Db::table("\163\x75\x62\152\x65\143\x74\x5f\143\x61\164\x65\x67\x6f\162\x79\137\162\145\x6c\141\164\x65")->where(["\x73\x75\142\x6a\x65\143\x74\x5f\x69\144" => $subjectId])->delete(); goto l2lPX; n1o3F: OperationLogs::I()->subjectLog("\xe4\277\256\346\224\xb9\351\x87\217\350\241\xa8\x20\55\40\40{$subjectName}", beautifyLogArray($formData, $originals, "\163\165\x62\x6a\145\143\164"), OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto iuZu3; o9_KG: $model->data($formData); goto rjg1s; PWdfX: $formData["\163\x6e"] = generateSubjectSn(); goto OpxAe; o11V1: if ($categoryIds) { goto bWJ02; } goto zwLyv; R8XXt: NiqJK: goto o11V1; iuZu3: goto wDBrs; goto Euf3h; dJHSF: $formData["\x69\155\x61\147\145\x5f\165\162\154"] = $imageUrl; goto C6X7k; Y2KR8: } public function setLabel($subjectId, $label, $action) { goto pdGB8; SvFTp: $value = $value ? explode("\x2c", $value) : []; goto w0lDS; pvtFb: Wif2R: goto Bpw5x; D9hPE: if (!(empty($subject["\151\x6d\141\147\145\137\165\x72\154"]) && empty($subject["\142\141\156\156\x65\x72\137\x69\155\x67"]))) { goto QDVB2; } goto EBYhB; skyZa: if (!empty($subject)) { goto piN4E; } goto pooqh; n59D3: QDVB2: goto pvtFb; aKs0I: if (!($label == "\142\141\x6e\x6e\x65\x72")) { goto Wif2R; } goto D9hPE; XgiqB: Jy4Tn: goto PIkNE; DZP65: vT4xf: goto aKs0I; Bpw5x: $value[] = $label; goto XgiqB; XYq9K: $value = array_filter($value, function ($v) use($label) { return $v != $label; }); goto wBDfd; EBYhB: wexception("\350\xae\xbe\xe4\xb8\272\350\275\256\346\222\xad\xef\274\x8c\xe9\207\x8f\350\xa1\250\345\233\xbe\347\x89\207\344\xb8\215\350\203\xbd\344\270\272\xe7\251\xba"); goto n59D3; w0lDS: if ($action == "\x74\162\165\145" || $action == "\x31") { goto vT4xf; } goto XYq9K; pooqh: wexception("\346\227\240\346\xb3\225\346\x89\xbe\345\x88\xb0\350\257\xa5\xe9\207\217\350\241\xa8"); goto DWelz; DWelz: piN4E: goto W5yJd; W5yJd: $value = $subject["\154\x61\x62\145\x6c"]; goto SvFTp; wBDfd: goto Jy4Tn; goto DZP65; PIkNE: Db::table("\163\165\x62\x6a\x65\x63\164")->where(["\x69\x64" => $subjectId])->setField("\x6c\x61\x62\x65\154", join("\54", $value)); goto Yg75t; pdGB8: $subject = Db::table("\x73\165\142\152\x65\x63\164")->where(["\x69\x64" => $subjectId])->field("\154\141\x62\145\154\54\40\x69\x6d\141\147\x65\137\165\x72\154\54\40\x62\x61\x6e\156\x65\x72\137\151\155\x67")->find(); goto skyZa; Yg75t: } public function qrcode($id) { goto aC2bg; w4KAc: wxPaySetting(); goto I4I5L; JGkf0: return $path; goto FyPvt; Fb6o_: if (systemSetting("\127\130\137\117\x46\x46\111\x43\105\137\101\103\x43\x4f\125\116\x54\x5f\101\120\x50\x5f\111\104")) { goto e7u6M; } goto CAHsk; N_Nef: if ($subject) { goto ZBVS4; } goto OUMFa; ktbGG: Db::table("\x73\x75\142\x6a\x65\x63\164")->where(["\x69\x64" => $id])->setField("\x71\x72\x63\x6f\x64\145", $path); goto JGkf0; CAHsk: wexception("\xe7\224\x9f\346\x88\220\xe5\244\261\350\xb4\245\xef\xbc\232\346\234\252\351\x85\x8d\xe7\275\256\xe5\205\xac\xe4\xbc\x97\xe5\217\267\xe5\217\x82\xe6\x95\xb0"); goto TAmZv; aC2bg: $subject = $this->getSubject($id); goto N_Nef; I4I5L: $app = \EasyWeChat\Factory::officialAccount(config("\167\x78\x2e\157\x66\146\151\143\151\x61\x6c\137\141\x63\143\x6f\x75\156\164")); goto HkSWZ; Z5rTV: if ($result) { goto LKyA0; } goto X2OcY; TAmZv: e7u6M: goto w4KAc; VYARI: $path = "\x2f\161\x72\x63\157\x64\x65\x2f" . $scene_id . "\56\x6a\160\147"; goto Z2GUh; OUMFa: wexception("\346\x97\xa0\346\263\225\xe6\211\276\345\x88\260\xe8\xaf\xa5\xe9\x87\217\xe8\241\xa8"); goto x6Rnk; x6Rnk: ZBVS4: goto Fb6o_; GyvTT: try { goto u3kJK; vVaWZ: LWuyn: goto yLurr; hNqpC: dnGjz: goto l4UIA; XyJgJ: exception("\346\x8e\xa5\345\x8f\243\xe8\277\224\345\x9b\x9e\345\xa4\261\xe8\xb4\245\54\x20" . var_export($res, true)); goto vVaWZ; u3kJK: $res = $app->qrcode->forever($scene_id); goto YU3Ag; l4UIA: if (!(!$res || !isset($res["\x74\x69\x63\153\x65\164"]))) { goto LWuyn; } goto XyJgJ; YU3Ag: if (!$res) { goto dnGjz; } goto t10N_; t10N_: Log::notice("\163\x75\x62\x6a\x65\143\164\x20\x71\162\143\157\144\x65\x20\162\x65\x74\165\x72\156\40" . var_export($res, true)); goto hNqpC; yLurr: $url = $app->qrcode->url($res["\x74\151\143\153\x65\x74"]); goto uhSoM; uhSoM: } catch (\Exception $e) { wexception("\xe7\224\x9f\xe6\210\220\345\244\261\xe8\xb4\xa5\357\xbc\232" . $e->getMessage()); } goto VYARI; HkSWZ: $scene_id = "\164\x65\163\164\x5f\x69\x64\x5f" . $id; goto GyvTT; Z2GUh: $result = file_put_contents(SITE_DIR . $path, file_get_contents($url)); goto Z5rTV; lwdPX: LKyA0: goto ktbGG; X2OcY: wexception("\xe5\206\231\xe5\205\245\345\233\276\xe5\203\217\346\226\x87\xe4\xbb\xb6\345\xa4\xb1\xe8\264\245"); goto lwdPX; FyPvt: } public function remove($id) { goto vKo3p; s5FOA: HDws7: goto UkT1N; vKo3p: $subject = $this->getSubject($id); goto TDMd_; UkT1N: Db::table("\x73\x75\142\152\x65\143\x74")->where(["\151\x64" => $id])->setField("\144\145\154\x65\164\x65\x5f\146\x6c\141\x67", "\x31"); goto tseRe; tseRe: OperationLogs::I()->subjectLog("\xe5\210\xa0\xe9\x99\244\xe9\207\217\xe8\241\xa8", $subject["\156\141\x6d\145"], OperationLogs::OPT_DELETE_TYPE, $id); goto ra9ss; SqdJS: wexception("\xe6\227\xa0\346\xb3\x95\xe6\x89\xbe\345\210\260\xe8\257\245\xe9\207\x8f\xe8\241\250"); goto s5FOA; TDMd_: if ($subject) { goto HDws7; } goto SqdJS; ra9ss: } public function restore($id) { goto xKsSz; trCRJ: wexception("\xe6\x97\240\346\263\225\xe6\x89\xbe\xe5\210\xb0\xe8\xaf\245\351\207\x8f\350\xa1\xa8"); goto pgB0T; sqm_3: OperationLogs::I()->subjectLog("\xe6\x81\xa2\xe5\xa4\215\351\x87\x8f\350\241\250", $subject["\156\141\x6d\145"], OperationLogs::OPT_RESTORE_TYPE, $id); goto HBRnN; xKsSz: $subject = $this->getSubject($id); goto jq0Fq; tUtTd: Db::table("\x73\x75\142\152\x65\143\164")->where(["\x69\144" => $id])->setField("\144\x65\154\145\x74\145\137\146\154\141\147", "\60"); goto sqm_3; pgB0T: BWRdf: goto tUtTd; jq0Fq: if ($subject) { goto BWRdf; } goto trCRJ; HBRnN: } public function removeForce($id) { goto xGTMn; g5mY5: jwpjJ: goto jrAub; xGTMn: $subject = $this->getSubject($id); goto df5Bu; Ddnld: $subjectSurvey = Db::table("\x73\165\162\x76\x65\x79")->where([["\145\x78\160", Db::raw("\x46\111\116\x44\137\111\x4e\137\x53\105\x54\50{$id}\54\40\163\x75\x62\x6a\145\143\x74\163\51")]])->find(); goto QgBOJ; g58lK: Db::table("\x73\165\142\x6a\x65\x63\164\137\x73\164\141\x6e\x64\141\162\144\137\x6c\141\164\x69\164\x75\144\x65")->where("\x73\x75\x62\152\145\x63\164\137\151\x64", $id)->delete(); goto HiYvG; RqtvL: Db::table("\165\156\x69\137\x61\160\160\x5f\x6f\162\144\x65\162\163")->where("\x73\165\142\x6a\x65\143\164\137\x69\x64", $id)->delete(); goto oGE9d; OEqAn: nsnFi: goto RqtvL; YiliM: Db::table("\163\165\142\x6a\145\x63\164\137\163\164\x61\156\144\x61\162\144")->where("\163\x75\142\x6a\x65\x63\x74\137\x69\144", $id)->delete(); goto g58lK; lBmS1: OperationLogs::I()->subjectLog("\347\241\xac\345\x88\240\351\x99\244\351\x87\x8f\350\xa1\250", $subject["\156\141\x6d\145"], OperationLogs::OPT_DELETE_TYPE, $id); goto A1BXw; HiYvG: Db::table("\163\165\x62\152\x65\x63\x74\x5f\x63\141\164\x65\147\157\162\x79\x5f\162\x65\154\141\164\145")->where("\163\165\142\x6a\145\x63\x74\x5f\x69\x64", $id)->delete(); goto QiEvF; QiEvF: Db::table("\163\165\x62\x6a\x65\x63\164\x5f\x63\x6f\x6c\x6c\x65\143\164")->where("\163\x75\x62\152\x65\x63\164\137\151\x64", $id)->delete(); goto JHiZI; b3Fto: Y0bOH: goto ktHeL; ktHeL: $goods = Db::table("\x64\151\x61\156\137\147\x6f\157\144\163")->where(["\163\165\x62\x6a\x65\143\x74\137\151\144" => $id])->find(); goto NQ1RK; jrAub: $subjectCb = Db::table("\163\165\142\x6a\145\x63\164\137\143\157\x6d\142\151\156\141\x74\151\x6f\156")->where([["\145\170\x70", Db::raw("\106\x49\116\104\137\111\x4e\137\x53\105\124\x28{$id}\54\40\x73\x75\142\x6a\145\143\x74\x73\51")]])->find(); goto Ddnld; Zq4Y3: wexception("\xe8\257\xa5\xe9\x87\x8f\350\xa1\250\345\205\xb3\xe8\x81\224\xe7\xbb\204\345\x90\x88\xe9\207\x8f\xe8\xa1\250\x2f\346\231\256\xe6\237\xa5\xef\xbc\x8c\344\270\x8d\350\203\275\xe5\210\240\xe9\x99\xa4"); goto b3Fto; JHiZI: Db::table("\x73\165\x62\152\145\143\x74\x5f\157\162\x64\145\162")->where("\163\x75\142\152\145\143\x74\x5f\x69\x64", $id)->delete(); goto EETZB; QgBOJ: if (!($subjectCb || $subjectSurvey)) { goto Y0bOH; } goto Zq4Y3; NQ1RK: if (!$goods) { goto nsnFi; } goto BLhTk; EETZB: Db::table("\163\x75\142\152\145\143\164")->where("\151\144", $id)->delete(); goto lBmS1; BLhTk: wexception("\xe5\267\262\345\217\x91\345\xb8\203\347\x94\xb5\xe5\x95\206\xe4\xba\247\345\x93\201\357\274\x8c\xe4\xb8\215\350\203\275\xe5\x88\xa0\351\x99\xa4"); goto OEqAn; df5Bu: if ($subject) { goto jwpjJ; } goto wll7w; lfOIy: Db::table("\163\165\x62\152\145\x63\x74\x5f\x69\x74\145\x6d\137\x73\x74\x61\156\x64\141\162\x64")->where("\x73\165\142\x6a\145\143\164\137\151\x64", $id)->delete(); goto YiliM; wll7w: wexception("\xe6\x97\240\xe6\xb3\x95\xe6\x89\276\345\x88\xb0\350\257\xa5\351\x87\217\350\241\xa8"); goto g5mY5; oGE9d: Db::table("\x73\165\142\x6a\x65\x63\x74\x5f\151\164\145\155")->where("\x73\165\142\152\145\143\164\137\151\144", $id)->delete(); goto lfOIy; A1BXw: } public function saveSubjectReport($id, $formData) { goto aCpuw; RRTHk: if (empty($formData["\x72\145\x70\x6f\x72\164\x5f\x65\x6c\145\155\x65\x6e\x74\x73"])) { goto R4Yq7; } goto i6VLF; RvEiF: $model->data($formData); goto kPsOx; nkmOm: rmPOc: goto RvEiF; EbY88: OperationLogs::I()->subjectLog("\xe4\xbf\256\346\224\xb9\xe9\207\217\350\xa1\xa8\346\x8a\245\345\221\x8a\40\55\x20{$originals["\x6e\141\155\145"]}", beautifyLogArray($formData, $originals, "\163\x75\x62\152\x65\x63\x74"), OperationLogs::OPT_UPDATE_TYPE, $id); goto PBxcE; lgeDD: $formData["\x72\145\x70\157\x72\164\x5f\145\x6c\x65\155\145\156\x74\163"] = ''; goto nkmOm; jiVfM: UYtu3: goto MQQS9; MQQS9: $originals = Db::table("\163\x75\x62\152\x65\143\x74")->where(["\x69\x64" => $id])->field(true)->find(); goto RRTHk; i6VLF: $formData["\162\145\x70\157\x72\164\137\x65\154\145\155\x65\156\164\x73"] = implode("\x2c", $formData["\x72\145\x70\x6f\162\x74\137\x65\154\x65\x6d\145\156\164\x73"]); goto F4wrc; aCpuw: $model = SubjectModel::get($id); goto Lx8HD; Lx8HD: if ($model) { goto UYtu3; } goto ea840; GT9QD: R4Yq7: goto lgeDD; SI2QG: if (!$result) { goto msmHl; } goto EbY88; PBxcE: msmHl: goto pMMry; F4wrc: goto rmPOc; goto GT9QD; kPsOx: $result = $model->allowField(true)->save(); goto SI2QG; ea840: exception("\xe6\x97\xa0\346\263\x95\xe6\211\xbe\345\210\260\350\xaf\245\351\x87\217\xe8\241\xa8"); goto jiVfM; pMMry: } public function updateSubjectStandardMinMax($subjectId) { goto DihtT; Ga73U: list($weightMin, $weightMax) = $points; goto oCGzw; DihtT: $items = Db::table("\163\165\142\152\x65\x63\x74\137\151\164\145\155")->where("\x73\165\142\x6a\x65\143\164\x5f\151\x64", $subjectId)->column("\151\144\x2c\x20\164\171\x70\x65\54\40\167\145\151\x67\x68\x74\137\x31\x2c\167\145\151\x67\x68\x74\137\62\x2c\167\x65\x69\x67\x68\x74\x5f\63\54\167\x65\x69\x67\150\x74\137\64\x2c\x77\145\151\147\150\164\137\65\x2c\167\x65\151\x67\150\164\x5f\66\54\x77\145\151\147\x68\x74\x5f\x37\x2c\167\145\x69\147\x68\x74\x5f\70\54\167\x65\151\147\150\x74\x5f\x39\54\167\145\151\147\150\x74\x5f\61\60\x2c\167\x65\x69\147\150\x74\x5f\61\x31\54\x77\145\151\147\x68\164\137\x31\x32"); goto B86Wc; VLT86: $latitudes = Db::table("\x73\165\142\152\x65\x63\x74\x5f\163\x74\141\x6e\x64\x61\x72\144")->where("\x73\x75\x62\x6a\145\143\164\x5f\x69\144", $subjectId)->order("\163\157\162\164\x20\x61\163\143\x2c\x20\x69\x64\x20\x61\x73\143")->column("\x6c\x61\x74\151\x74\x75\x64\145", "\x69\x64"); goto BFJhk; Mt6fx: foreach ($items as $item) { goto lEAc5; j4miU: $itemWeights[] = $itemWeight; goto Ctr8Y; sPWDh: if (!empty($itemWeight)) { goto JRf0f; } goto ziqSR; BIzsN: if (!($i <= 12)) { goto hbLwR; } goto MmptM; EJueL: goto ycWSH; goto wOWLJ; Ikzl0: goto hbLwR; goto HD7QD; Ctr8Y: nMQjr: goto Ky8YD; MoBrH: ycWSH: goto BIzsN; lEAc5: $itemWeight = []; goto aA162; bVBVy: JRf0f: goto j4miU; aA162: $i = 1; goto MoBrH; L2GUZ: $i++; goto EJueL; NUVnd: $itemWeight[] = round($item[$field] / 100, 2); goto L2GUZ; ziqSR: goto nMQjr; goto bVBVy; Fj0hk: if (!($item[$field] === null)) { goto orviw; } goto Ikzl0; wOWLJ: hbLwR: goto sPWDh; HD7QD: orviw: goto NUVnd; MmptM: $field = "\167\145\151\x67\150\x74\x5f" . $i; goto Fj0hk; Ky8YD: } goto dyDXN; BFJhk: foreach ($latitudes as $standardId => $latitude) { goto qVG9c; LjQld: $points = $this->calculatePointsDirect($itemWeights); goto dnMan; SI2ns: $records = Db::table("\163\x75\142\152\x65\x63\x74\x5f\151\x74\x65\x6d\x5f\x73\x74\x61\x6e\144\x61\x72\144")->where(["\163\x75\142\x6a\x65\143\x74\x5f\x69\144" => $subjectId, "\x73\164\141\x6e\x64\141\x72\144\x5f\151\144" => $standardId, "\151\x74\x65\155\137\151\x64" => ["\151\156", $itemIds]])->field("\x69\164\145\x6d\x5f\151\x64")->select(); goto YuK0t; efi0d: Db::table("\x73\165\142\152\x65\x63\164\137\163\x74\141\156\x64\x61\162\144")->where(["\x73\165\142\152\x65\143\164\x5f\151\144" => $subjectId, "\151\144" => $standardId])->update(["\163\164\x61\164\x69\x73\x74\151\143\x5f\167\x65\x69\147\150\164\x5f\x6d\x69\156" => 0, "\163\x74\141\164\x69\163\x74\151\143\137\x77\145\x69\147\150\164\x5f\x6d\141\170" => 0]); goto Y00y_; N_hcK: Db::table("\163\x75\x62\x6a\x65\x63\164\x5f\x73\x74\x61\156\144\141\x72\x64")->where(["\x73\x75\142\152\x65\143\164\137\151\144" => $subjectId, "\151\x64" => $standardId])->update(["\163\164\141\164\x69\163\164\151\143\x5f\167\145\x69\x67\x68\x74\137\x6d\x69\x6e" => $weightMin, "\x73\164\x61\x74\151\163\164\151\x63\137\167\145\x69\147\x68\164\137\x6d\x61\x78" => $weightMax]); goto C3JCL; ywQ9Q: Ie21x: goto LjQld; YuK0t: foreach ($records as $record) { goto JwQIz; ytGlX: goto ZpFIZ; goto EiN1u; Uvmoi: XAMHK: goto U6FU_; scB9x: $field = "\167\145\x69\147\150\164\137" . $i; goto nDh62; nDh62: if (!($items[$itemId][$field] === null)) { goto Dkezf; } goto YXPma; FfbDd: R3K4p: goto Fk4ac; XtCbZ: $itemWeights[] = $itemWeight; goto ijOJS; c2F3y: $itemWeight[] = round($items[$itemId][$field] / 100, 2); goto Josfk; Z0Rsd: $itemWeight[] = array_sum($itemWeight); goto yiXzD; JwQIz: $itemId = $record["\x69\164\145\155\137\x69\x64"]; goto uhtT4; ijOJS: TtWg3: goto dpK_G; yiXzD: PGAL2: goto ytGlX; YNya8: goto XAMHK; goto FfbDd; Josfk: $i++; goto YNya8; eJFLg: $i = 1; goto Uvmoi; hBNVI: Dkezf: goto c2F3y; gaqH6: goto TtWg3; goto axi3K; YXPma: goto R3K4p; goto hBNVI; uhtT4: $itemWeight = []; goto eJFLg; j7LFb: ZpFIZ: goto XtCbZ; U6FU_: if (!($i <= 12)) { goto R3K4p; } goto scB9x; EiN1u: Te2qX: goto j7LFb; qNpDR: if (!($items[$itemId]["\x74\171\160\x65"] == Defs::QUESTION_CHECKBOX)) { goto PGAL2; } goto Z0Rsd; Fk4ac: if (!empty($itemWeight)) { goto Q99CT; } goto gaqH6; axi3K: Q99CT: goto oqnvf; oqnvf: if ($items[$itemId]["\164\x79\160\145"] == Defs::QUESTION_RADIO) { goto Te2qX; } goto qNpDR; dpK_G: } goto JO1Xr; Y00y_: goto nXhGo; goto ywQ9Q; dnMan: list($weightMin, $weightMax) = $points; goto N_hcK; JO1Xr: QYmLi: goto PUnag; C3JCL: nXhGo: goto TuCJK; qVG9c: $itemWeights = []; goto SI2ns; PUnag: if (!empty($itemWeights)) { goto Ie21x; } goto efi0d; TuCJK: } goto zRXin; B86Wc: $itemIds = array_keys($items); goto DBvlO; DBvlO: $itemWeights = []; goto Mt6fx; gyFIx: Db::table("\x73\x75\x62\152\145\143\164")->where(["\151\x64" => $subjectId])->update(["\163\164\x61\164\151\163\164\x69\143\137\167\145\x69\147\150\x74\137\155\151\156" => $weightMin, "\x73\x74\x61\164\151\163\164\x69\x63\137\167\x65\151\147\x68\x74\x5f\155\141\170" => $weightMax]); goto VLT86; bOZF_: $points = $this->calculatePointsDirect($itemWeights); goto Ga73U; dyDXN: ntWf7: goto bOZF_; oCGzw: Db::table("\x73\165\142\x6a\x65\143\164")->where(["\x69\144" => $subjectId])->update(["\151\x74\x65\155\x73" => count($itemIds)]); goto gyFIx; zRXin: Qyare: goto IbBWl; IbBWl: } protected function calculatePointsDirect($itemWeights) { goto Oo6Hz; D0MUj: J10q0: goto ljbpL; ca3Oq: $pointMax = 0; goto defhx; defhx: foreach ($itemWeights as $itemWeight) { goto ir5Uz; errKM: urbFu: goto TE_Eu; osyBu: goto GcDu8; goto errKM; TE_Eu: $pointMin += min($itemWeight); goto dlxgG; dlxgG: $pointMax += max($itemWeight); goto F2tUD; ir5Uz: if (!empty($itemWeight)) { goto urbFu; } goto osyBu; F2tUD: GcDu8: goto RQw7R; RQw7R: } goto D0MUj; Oo6Hz: $pointMin = 0; goto ca3Oq; ljbpL: return [$pointMin, $pointMax]; goto bKAN6; bKAN6: } public function loadLatitudes($subjectId, $standardId) { goto KlLXb; iVD0f: foreach ($rows as &$row) { goto ytx2i; jqsuD: $row["\163\x74\141\x6e\x64\x5f\x64\x65\163\x63"] = ellipsisString($row["\163\x74\x61\156\144\137\x64\x65\x73\x63"], 32); goto T76hm; ytx2i: $expression = $row["\x65\x78\160\162\x65\163\x73\x69\157\x6e"]; goto muCkt; WQX69: bPefO: goto nulbV; muCkt: $row["\x65\170\x70\162\x65\x73\163\151\x6f\156"] = convertSubjectExpression($expression); goto jqsuD; T76hm: $row["\x72\x65\155\x61\x72\153"] = ellipsisString($row["\162\145\x6d\x61\x72\153"], 32); goto WQX69; nulbV: } goto jOP1d; jOP1d: cgMR3: goto AVnNs; KlLXb: $rows = Db::table("\163\x75\x62\x6a\145\x63\164\x5f\x73\x74\x61\156\x64\x61\162\144\x5f\x6c\141\164\151\x74\x75\144\145")->where(["\x73\165\142\x6a\145\x63\x74\137\151\x64" => $subjectId, "\x73\x74\141\x6e\144\141\162\x64\137\151\144" => $standardId])->order("\x73\164\x61\156\144\x61\162\144\137\x69\144\40\x61\163\x63")->field("\x2a")->select(); goto iVD0f; AVnNs: return $rows; goto uGHMi; uGHMi: } public function getLatitude($id) { $latitude = Db::table("\163\x75\142\x6a\145\143\164\x5f\163\164\x61\156\x64\x61\x72\144\137\154\x61\164\x69\164\165\x64\x65")->where("\151\144", $id)->field(true)->find(); return $latitude; } protected function convertExpressionJson2Value($obj, $expression) { goto i6Bsq; HEs1q: Z1wfm: goto zpPd_; zpPd_: $expression = rtrim($expression, $operator); goto F9tCG; QJ9OV: if (!($obj["\157\x70"] == "\x6f\x72")) { goto m1N_G; } goto y2hai; x5ru9: foreach ($obj["\x63\x68\x69\154\144\x72\x65\x6e"] as $index => $objChild) { goto Zz1tT; bSiJ8: $expression .= $objChild["\146\x69\145\x6c\x64"]; goto Kzm1g; ypP3I: rNOUT: goto yLVoM; nU4Lt: $expression .= $objChild["\166\141\154\x75\x65"]; goto e2O2A; lgTLC: $expression .= "\x28"; goto ym17O; Xd9zY: goto Ih2WB; goto ypP3I; L8GYB: $expression .= "\x29"; goto stoSh; iO2Mj: Ih2WB: goto bmo9V; Kzm1g: $expression .= $objChild["\x6f\160"]; goto nU4Lt; Zz1tT: if (!(isset($objChild["\146\151\x65\154\144"]) && $objChild["\x66\x69\145\x6c\144"] && isset($objChild["\x6f\x70"]) && $objChild["\157\160"] && isset($objChild["\166\x61\154\165\x65"]))) { goto rNOUT; } goto bSiJ8; stoSh: $expression .= $operator; goto aOpA4; yLVoM: if (!(isset($objChild["\x6f\160"]) && isset($objChild["\143\150\151\154\144\162\145\156"]) && $objChild["\x63\150\151\154\144\162\x65\x6e"])) { goto mqB6d; } goto lgTLC; aOpA4: mqB6d: goto iO2Mj; e2O2A: $expression .= $operator; goto Xd9zY; ym17O: $expression = $this->convertExpressionJson2Value($objChild, $expression); goto L8GYB; bmo9V: } goto HEs1q; i6Bsq: $operator = "\x26\x26"; goto QJ9OV; F9tCG: return $expression; goto UFHBK; y2hai: $operator = "\x7c\174"; goto BqGxO; BqGxO: m1N_G: goto x5ru9; UFHBK: } public function saveLatitude($subjectId, $standardId, $id, $formData) { goto d3T7n; Rnmvc: goto lFXau; goto jEzKR; YuFV8: lFXau: goto viVHu; tobQc: goto OqJuC; goto GAC0Z; tHqnk: Db::table("\163\165\x62\152\x65\x63\164\x5f\x73\164\x61\156\x64\141\162\144\x5f\154\141\x74\151\x74\x75\144\x65")->insert($formData); goto YuFV8; Un59W: $expression = $this->convertExpressionJson2Value(json_decode($formData["\x65\x78\160\162\145\163\163\151\157\x6e\137\x6a\163\x6f\x6e"], true), ''); goto NeHrT; y_U9_: $formData["\x6c\141\x74\x69\164\165\x64\x65"] = $latitude; goto tobQc; jEzKR: NWJ03: goto tHqnk; d3T7n: $formData["\x65\x78\x70\x72\x65\163\x73\x69\x6f\156\x5f\x6a\163\157\x6e"] = htmlspecialchars_decode($formData["\145\170\x70\162\x65\163\163\151\x6f\x6e\x5f\152\x73\157\x6e"]); goto Un59W; JJNz2: xtYQT: goto y_U9_; bAlir: $formData["\154\x61\164\x69\x74\x75\144\145"] = Defs::SUBJECT_WHOLE_STANDARD; goto FGouq; IbLmy: if (empty($id)) { goto NWJ03; } goto MLDlP; UVd1v: wexception("\346\x97\240\xe6\xb3\x95\xe6\211\xbe\xe5\x88\260\346\211\200\345\261\x9e\347\232\204\347\xbb\xb4\345\xba\246"); goto JJNz2; GAC0Z: kMUjN: goto bAlir; QoFDL: $latitude = Db::table("\x73\165\x62\x6a\x65\143\164\x5f\163\164\x61\156\x64\x61\162\144")->where(["\x69\144" => $standardId])->value("\x6c\x61\x74\151\164\165\144\x65"); goto xpyis; VN1jf: $formData["\163\x74\x61\156\144\x61\162\144\x5f\x69\144"] = $standardId; goto vjvA7; vjvA7: if ($standardId == 0) { goto kMUjN; } goto QoFDL; NeHrT: $formData["\x65\x78\x70\x72\x65\163\x73\151\x6f\x6e"] = $expression; goto rHeX6; rHeX6: $formData["\x73\165\142\152\145\x63\164\137\x69\x64"] = $subjectId; goto VN1jf; FGouq: OqJuC: goto IbLmy; xpyis: if (!($latitude === null)) { goto xtYQT; } goto UVd1v; MLDlP: Db::table("\163\x75\x62\x6a\145\143\164\137\x73\164\141\x6e\x64\141\x72\144\137\x6c\141\x74\x69\x74\165\144\x65")->where("\151\x64", $id)->update($formData); goto Rnmvc; viVHu: } public function removeLatitude($id) { Db::table("\163\165\142\152\145\x63\164\137\x73\164\x61\x6e\144\x61\162\144\x5f\154\x61\164\x69\164\165\x64\145")->where(["\151\x64" => $id])->delete(); } public function loadSubjectItems($subjectId) { goto A35l8; A35l8: $rows = []; goto pXRyA; ZWFUd: return $rows; goto aMUZ1; qqBXH: I8BAd: goto ZWFUd; pXRyA: $items = Db::table("\x73\165\142\x6a\x65\x63\x74\137\151\164\145\x6d")->where(["\x73\x75\x62\x6a\145\143\164\137\x69\x64" => $subjectId])->field(true)->order("\163\x6f\x72\x74\40\x61\x73\x63\54\40\x69\x64\40\x61\x73\x63")->select(); goto l1PgF; l1PgF: foreach ($items as $index => $item) { goto xLjG1; ExLfl: GxnQ2: goto ayzT4; n2vJi: $optionIndex++; goto DBxYU; DCjj9: $row["\x73\x74\141\x6e\144\141\x72\144\163"] = implode("\x2c\40", $latitudes); goto LLszC; xurpj: $natureField = "\156\x61\164\x75\162\x65\137" . $optionIndex; goto io0wf; pGHLs: if (!$item[$imageField]) { goto Z3q37; } goto LDMwv; CSyWh: kq88O: goto XK3X2; OanTu: Z3q37: goto uqH8k; X5jOS: goto N14jj; goto EMDCp; AJfkz: if (!$item["\x69\164\x65\155\x5f\x32"]) { goto kq88O; } goto WTxCe; io0wf: $imageField = "\x69\155\x61\147\145\137" . $optionIndex; goto EbIRa; ikqzW: $option = ["\x69\x64" => $item["\151\x64"] . "\137" . $optionIndex, "\x69\x74\145\x6d\x5f\x6f\x70\x74\151\x6f\x6e" => strip_tags($item[$optionField]), "\167\145\151\x67\150\x74" => round($item[$weightField] / 100, 2), "\156\x61\x74\x75\x72\x65" => $item[$natureField]]; goto pGHLs; eHrSL: z367L: goto k4m45; fDOmW: N14jj: goto dkMfx; bbnXO: $row["\x69\x74\145\x6d\137\157\160\164\x69\157\156"] .= strip_tags($item["\151\164\145\x6d\x5f\x32"]); goto CSyWh; KQovq: $row["\151\x6d\x61\x67\x65"] = "\74\x69\x6d\147\40\x63\154\141\x73\163\x3d\x22\155\x79\55\x31\42\x20\x73\x72\x63\x3d\x22" . generateThumbnailUrl($item["\x69\x6d\141\147\x65"], 100, "\x2f\163\x74\141\164\x69\143\x2f\151\155\147\x2f\144\x6f\164\56\160\x6e\147") . "\42\x20\x73\x74\x79\154\x65\x3d\42\x6d\141\x78\x2d\x77\x69\144\164\150\x3a\61\x30\60\x70\170\73\42\76"; goto eHrSL; SOrKD: $optionField = "\x6f\160\164\x69\157\156\137" . $optionIndex; goto kSZko; LLszC: $optionIndex = 1; goto JlT3H; DBxYU: goto HiahL; goto fDOmW; WTxCe: $row["\x69\x74\x65\155\137\x6f\x70\x74\151\x6f\x6e"] .= "\x3b\40"; goto bbnXO; xLjG1: $row = ["\151\x64" => $item["\151\x64"], "\151\x74\145\155\x5f\157\x70\x74\x69\x6f\156" => $index + 1 . "\56\40" . strip_tags($item["\151\x74\x65\x6d"]), "\x63\150\x69\x6c\144\162\x65\x6e" => [], "\x74\x79\160\145" => $item["\164\x79\x70\x65"], "\163\x6f\162\164" => $item["\163\x6f\x72\164"], "\x74\x61\147" => $item["\x74\141\x67"]]; goto AJfkz; EMDCp: BwOpA: goto ikqzW; XK3X2: if (!$item["\151\x6d\x61\147\x65"]) { goto z367L; } goto KQovq; LDMwv: $option["\x69\155\141\147\145"] = "\x3c\x69\x6d\147\x20\x63\x6c\x61\x73\x73\x3d\42\155\171\55\61\42\x20\163\162\x63\x3d\42" . generateThumbnailUrl($item[$imageField], 100, "\x2f\163\164\x61\x74\151\143\x2f\151\155\147\57\x64\x6f\164\x2e\160\x6e\147") . "\42\x20\163\164\x79\x6c\x65\x3d\x22\x6d\141\x78\x2d\x77\151\x64\x74\x68\72\61\x30\60\160\170\73\x22\76"; goto OanTu; k4m45: $latitudes = Db::table("\163\x75\142\152\145\143\164\137\151\x74\145\155\137\163\x74\141\x6e\144\x61\162\x64")->alias("\x53\111\x53")->join("\x73\165\142\152\x65\143\164\x5f\163\x74\141\156\x64\x61\x72\144\40\x53\123", "\x53\x49\x53\56\x73\164\x61\156\x64\x61\x72\x64\x5f\x69\144\75\x53\123\x2e\151\x64")->where(["\x53\111\x53\56\x73\165\142\x6a\x65\x63\164\137\151\x64" => $subjectId, "\123\111\x53\x2e\x69\x74\145\155\x5f\151\144" => $item["\151\144"]])->column("\123\123\56\154\x61\x74\151\x74\x75\x64\x65"); goto DCjj9; QisYf: if (!($optionIndex <= 12)) { goto N14jj; } goto SOrKD; dkMfx: $rows[] = $row; goto ExLfl; uqH8k: $row["\143\150\151\154\144\162\x65\x6e"][] = $option; goto n2vJi; EbIRa: if (!(empty($item[$optionField]) && empty($item[$imageField]))) { goto BwOpA; } goto X5jOS; kSZko: $weightField = "\x77\x65\151\147\x68\x74\x5f" . $optionIndex; goto xurpj; JlT3H: HiahL: goto QisYf; ayzT4: } goto qqBXH; aMUZ1: } public function getSubjectItem($subjectId, $itemId) { goto I9lO_; LmGGp: $index = 1; goto E2bz0; OlKZE: goto GYJ6H; goto Tqiay; FMk6i: MG7Ub: goto uQYc2; E2bz0: l_vpw: goto KnGVm; nCloD: $optionField = "\x6f\160\x74\151\157\x6e\137" . $index; goto fA4P1; Ed5LX: $item["\156\x61\164\x75\162\145\137" . $index] = 0; goto Ikpjp; fA4P1: $imageField = "\151\155\141\147\x65\137" . $index; goto SK1e0; A4JOC: return null; goto QR3D1; Ikpjp: GYJ6H: goto KO1HY; KO1HY: $index++; goto txYnP; OLUSE: $standardIds = Db::table("\163\165\142\x6a\145\143\164\137\x69\x74\x65\155\137\x73\x74\141\x6e\x64\x61\162\x64")->where(["\x73\165\x62\152\145\x63\164\x5f\x69\x64" => $subjectId, "\151\164\x65\x6d\x5f\x69\x64" => $itemId])->column("\x73\164\141\x6e\x64\x61\162\x64\x5f\151\x64"); goto bAWCe; DYGvN: g111L: goto OLUSE; Tqiay: qtcoc: goto Q5wKs; I9lO_: $item = Db::table("\163\x75\142\x6a\145\143\x74\x5f\x69\164\x65\x6d")->where(["\x69\144" => $itemId])->field(true)->find(); goto JB7wq; QR3D1: tmFAm: goto LmGGp; SK1e0: if (empty(trim($item[$optionField])) && empty(trim($item[$imageField]))) { goto qtcoc; } goto pc3Tz; KnGVm: if (!($index <= 12)) { goto g111L; } goto nCloD; txYnP: goto l_vpw; goto DYGvN; Q5wKs: $item["\x77\x65\151\147\150\x74\x5f" . $index] = ''; goto Ed5LX; JB7wq: if ($item) { goto tmFAm; } goto A4JOC; bAWCe: if ($standardIds) { goto MG7Ub; } goto cwgJ8; GwyTf: return $item; goto WMTE6; uQYc2: $item["\163\x74\141\156\x64\141\162\x64\x73"] = $standardIds; goto GwyTf; cwgJ8: $standardIds = []; goto FMk6i; pc3Tz: $item["\167\145\151\147\150\x74\x5f" . $index] = round($item["\x77\145\x69\147\x68\164\137" . $index] / 100, 2); goto OlKZE; WMTE6: } public function saveSubjectItem($subjectId, $itemId, $formData, $formOptionData, $standardIds) { goto dUWf4; DoVIF: XI5TM: goto B3Zlw; gbB2s: Db::table("\163\x75\x62\152\145\x63\164")->where(["\x69\144" => $subjectId])->setInc("\151\x74\x65\155\x5f\166\x65\162\163\151\x6f\156"); goto JpgyT; Y3bwo: Db::table("\163\x75\142\152\145\x63\164\137\151\164\145\x6d")->where(["\151\144" => $itemId])->update($formOptionDataSanitized); goto MCyjA; j0QVe: if (!$updatedCount) { goto mgBf1; } goto gbB2s; B3Zlw: $formData["\163\165\x62\x6a\145\143\164\137\x69\144"] = $subjectId; goto pw_8j; zTO2a: $indexSanitized = 1; goto VccYY; JpgyT: OperationLogs::I()->subjectLog("\xe4\277\xae\346\x94\xb9\xe9\207\x8f\350\241\250\xe9\xa1\xb9\xe7\x9b\256\40\x2d\x20{$subject["\156\141\155\x65"]}", $subjectItem["\x69\164\x65\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto L34Sd; vtFJ1: if (empty($itemId)) { goto XI5TM; } goto AlBWU; laEWQ: if (!empty($subject)) { goto eJwob; } goto GFyKS; kkuJn: goto aV8_f; goto hYNYq; FYGfK: OperationLogs::I()->subjectLog("\xe5\xa2\x9e\xe5\x8a\240\xe9\207\x8f\xe8\241\xa8\xe9\xa1\271\347\x9b\256\x20\55\x20{$subject["\156\x61\x6d\x65"]}", $formData["\151\164\145\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto UPc6G; jacMm: eJwob: goto vtFJ1; pw_8j: $itemId = Db::table("\163\165\x62\152\x65\143\164\x5f\151\x74\x65\x6d")->insertGetId($formData); goto Y3bwo; sg5zN: $natureField = "\x6e\x61\164\165\162\145\137" . $index; goto iNUJr; kKBC1: $formOptionDataSanitized["\151\x6d\141\147\145\x5f" . $indexSanitized] = $formOptionData[$imageField]; goto zj0Kl; mJxKD: $formOptionDataSanitized["\x6e\141\164\165\x72\145\x5f" . $index] = null; goto QIprM; GP0PU: $formOptionDataSanitized["\x69\x6d\x61\x67\145\x5f" . $index] = ''; goto ey7s8; PqQSG: $standardIds = []; goto e2pa6; qHfUN: u30eQ: goto DU8wX; PgiDD: foreach ($standardsAdd as $standardId) { Db::table("\163\165\142\152\145\x63\164\137\x69\164\145\155\137\x73\164\x61\x6e\144\x61\x72\144")->insert(["\163\165\x62\x6a\145\x63\x74\x5f\151\x64" => $subjectId, "\151\x74\145\x6d\x5f\151\144" => $itemId, "\x73\164\141\x6e\x64\141\162\x64\x5f\x69\144" => $standardId]); Wd8Jz: } goto FqSUz; PcpSY: goto QRY20; goto DoVIF; L34Sd: mgBf1: goto PcpSY; ndjRs: foreach ($standardsDel as $standardId) { Db::table("\x73\165\142\x6a\x65\143\x74\137\x69\164\145\155\x5f\x73\164\x61\x6e\x64\141\162\144")->where(["\x73\165\142\152\145\x63\x74\x5f\x69\144" => $subjectId, "\x69\164\x65\155\x5f\151\144" => $itemId, "\163\164\141\156\x64\141\x72\x64\x5f\151\144" => $standardId])->delete(); TlLWi: } goto qCq_j; Kd10b: $formOptionDataSanitized["\x6e\141\164\x75\x72\x65\x5f" . $indexSanitized] = $formOptionData[$natureField]; goto ZVQBW; oLJoa: $formOptionDataSanitized["\151\x6d\141\147\x65\x5f" . $indexSanitized] = ''; goto VAd1J; FJgH1: $indexSanitized++; goto kkuJn; zj0Kl: $formOptionDataSanitized["\x77\145\x69\147\150\164\x5f" . $indexSanitized] = empty($formOptionData[$weightField]) ? 0 : $formOptionData[$weightField] * 100; goto Kd10b; v2XpP: $standardsAdd = array_diff($standardIds, $standardIdsDb); goto PgiDD; VudH3: t_5jb: goto qNcpn; yeEcD: HvV_n: goto Kwgw2; l_lxy: $standardsDel = array_diff($standardIdsDb, $standardIds); goto ndjRs; QEU7N: $this->updateSubjectStandardMinMax($subjectId); goto VouDh; DItlQ: if (!($index <= 12)) { goto Sj0Qu; } goto Kaxk0; RD7IR: $formOptionDataSanitized["\x6f\160\164\151\x6f\x6e\x5f" . $index] = ''; goto GP0PU; iNUJr: if (!(isset($formOptionData[$optionField]) && trim($formOptionData[$optionField]) || isset($formOptionData[$imageField]) && trim($formOptionData[$imageField]))) { goto t_5jb; } goto DiLqT; wgGXu: Sj0Qu: goto xLGJl; e2pa6: $index = 1; goto qHfUN; Kwgw2: ERA1e: goto nh4ge; EyozE: if (!empty($subjectItem)) { goto gPNFl; } goto X_cTN; MaUHz: goto u30eQ; goto yeEcD; ey7s8: $formOptionDataSanitized["\167\145\x69\147\150\164\137" . $index] = null; goto mJxKD; xLGJl: aV8_f: goto oJKqr; ZVQBW: $indexSanitized++; goto VudH3; VAd1J: $formOptionDataSanitized["\x77\145\151\147\x68\x74\137" . $indexSanitized] = null; goto kaT3K; dUWf4: $formOptionDataSanitized = []; goto uEd0b; yoC00: $formOptionDataSanitized["\157\160\x74\x69\x6f\x6e\137" . $indexSanitized] = ''; goto oLJoa; FqSUz: OPouR: goto l_lxy; GFyKS: wexception("\346\227\240\xe6\263\225\xe6\211\276\xe5\x88\xb0\345\xaf\271\345\272\224\347\232\x84\351\207\217\350\241\xa8"); goto jacMm; hcioi: $weightField = "\x77\145\151\147\150\164\137" . $index; goto sg5zN; VccYY: t0T_8: goto DItlQ; qNcpn: $index++; goto JNshh; QIprM: $index++; goto MaUHz; o3MgG: gPNFl: goto NZAAo; UPc6G: QRY20: goto WDVFd; hYNYq: x8U11: goto crL0X; kaT3K: $formOptionDataSanitized["\156\x61\x74\x75\162\145\x5f" . $indexSanitized] = null; goto FJgH1; oJKqr: if (!($indexSanitized <= 12)) { goto x8U11; } goto yoC00; crL0X: goto ERA1e; goto Y72vy; AlBWU: $subjectItem = Db::table("\163\165\142\152\145\143\164\x5f\151\x74\x65\x6d")->where(["\151\x64" => $itemId])->find(); goto EyozE; uEd0b: if ($formData["\x74\x79\x70\145"] == Defs::QUESTION_TEXT) { goto eAo9k; } goto IXP7b; X_cTN: wexception("\xe6\227\240\346\xb3\225\xe6\211\xbe\345\210\xb0\345\257\xb9\xe5\xba\224\xe7\232\204\351\207\x8f\350\xa1\250\351\241\271\xe7\x9b\256"); goto o3MgG; Kaxk0: $optionField = "\x6f\160\x74\x69\157\156\137" . $index; goto URDd5; NZAAo: $updatedCount = Db::table("\x73\x75\x62\x6a\x65\143\164\137\151\164\x65\155")->where(["\x69\x64" => $itemId])->update(array_merge($formData, $formOptionDataSanitized)); goto j0QVe; Y72vy: eAo9k: goto PqQSG; qCq_j: Pku8i: goto QEU7N; DU8wX: if (!($index <= 12)) { goto HvV_n; } goto RD7IR; JNshh: goto t0T_8; goto wgGXu; WDVFd: $standardIdsDb = Db::table("\163\x75\x62\152\145\x63\164\x5f\x69\x74\145\x6d\x5f\163\x74\141\x6e\x64\141\x72\144")->where(["\x73\x75\x62\x6a\145\x63\x74\x5f\x69\144" => $subjectId, "\x69\164\x65\x6d\x5f\x69\144" => $itemId])->column("\x73\164\141\x6e\144\x61\x72\144\x5f\x69\x64"); goto v2XpP; DiLqT: $formOptionDataSanitized["\157\160\164\x69\x6f\156\x5f" . $indexSanitized] = $formOptionData[$optionField]; goto kKBC1; MCyjA: Db::table("\x73\165\x62\x6a\x65\143\164")->where(["\x69\144" => $subjectId])->setInc("\151\164\145\155\137\166\x65\162\163\x69\x6f\x6e"); goto FYGfK; URDd5: $imageField = "\x69\x6d\x61\147\145\137" . $index; goto hcioi; nh4ge: $subject = Db::table("\x73\165\x62\x6a\145\143\164")->where(["\x69\x64" => $subjectId])->field("\156\x61\155\x65")->find(); goto laEWQ; IXP7b: $index = 1; goto zTO2a; VouDh: } public function removeSubjectItem($subjectId, $itemId) { goto dzu_2; dzu_2: $subject = Db::table("\163\x75\142\152\x65\x63\164")->where(["\x69\144" => $subjectId])->field("\156\141\x6d\145")->find(); goto NnmeR; C7DqZ: $subjectItem = Db::table("\163\165\142\152\x65\x63\164\x5f\151\164\x65\155")->where(["\x69\144" => $itemId])->field(true)->find(); goto QWw2i; ifl0T: wexception("\346\x97\240\346\xb3\x95\xe6\x89\xbe\345\210\260\xe5\257\xb9\345\272\x94\347\x9a\204\351\x87\217\350\241\250"); goto hI5tJ; bqlEc: OperationLogs::I()->subjectLog("\345\x88\xa0\351\x99\244\xe9\207\217\xe8\241\xa8\xe9\241\xb9\347\233\256\x20\x2d\x20{$subject["\156\x61\155\145"]}", $subjectItem["\x69\x74\x65\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto XxTqE; bzroQ: Db::table("\163\165\142\152\x65\x63\x74")->where(["\x69\144" => $subjectId])->setInc("\x69\164\x65\155\x5f\x76\145\162\163\151\x6f\156"); goto mFc2N; UjxxC: wOx1T: goto jx9Bi; NnmeR: if (!empty($subject)) { goto PurJU; } goto ifl0T; jx9Bi: Db::table("\x73\165\142\x6a\x65\x63\164\137\151\164\x65\x6d")->where(["\151\144" => $itemId])->delete(); goto vVW9r; QWw2i: if (!empty($subjectItem)) { goto wOx1T; } goto WCbwM; WCbwM: wexception("\346\227\xa0\xe6\263\x95\346\x89\276\xe5\x88\xb0\345\xaf\xb9\345\xba\x94\347\x9a\x84\xe9\x87\217\xe8\xa1\xa8\xe9\241\xb9\xe7\233\256"); goto UjxxC; hI5tJ: PurJU: goto C7DqZ; vVW9r: Db::table("\163\165\x62\152\x65\x63\164\x5f\x69\x74\x65\155\x5f\x73\x74\x61\x6e\x64\x61\x72\x64")->where(["\x69\x74\145\x6d\137\151\144" => $itemId])->delete(); goto bzroQ; mFc2N: $this->updateSubjectStandardMinMax($subjectId); goto bqlEc; XxTqE: } public function addTagItem($subjectId, $tag) { goto nOoOy; rlyjw: mGeTj: goto LuQbd; CZfRu: $subject = Db::table("\x73\165\142\x6a\x65\x63\164")->where(["\x69\144" => $subjectId])->field("\156\x61\x6d\x65")->find(); goto xoXR8; S_mfS: tpmoG: goto ztSw8; kIlK2: $this->updateSubjectStandardMinMax($subjectId); goto fGVJm; CiQJq: wexception("\x74\x61\x67\345\x8f\x82\xe6\225\260\xe9\235\236\346\xb3\225"); goto q11mQ; fGVJm: OperationLogs::I()->subjectLog("\345\xa2\x9e\345\x8a\240\xe9\207\x8f\350\xa1\250\xe9\xa1\xb9\xe7\233\256\x20\55\40{$subject["\x6e\141\x6d\x65"]}", $formData["\x69\x74\x65\x6d"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto VSdBZ; xoXR8: if (!empty($subject)) { goto VjXYt; } goto DIQJk; aKAve: Db::table("\163\x75\142\x6a\x65\143\x74")->where(["\x69\x64" => $subjectId])->setInc("\151\164\145\155\137\166\145\162\163\x69\157\x6e"); goto kIlK2; ztSw8: $formData = ["\163\x75\142\x6a\x65\x63\x74\x5f\151\x64" => $subjectId, "\151\164\145\155" => "\346\202\xa8\xe7\232\x84\346\200\247\345\x88\253\x3f", "\164\171\160\x65" => Defs::QUESTION_RADIO, "\x6f\x70\164\x69\x6f\x6e\137\x31" => "\xe7\224\xb7", "\x6f\x70\x74\151\157\x6e\137\x32" => "\xe5\245\xb3", "\x77\x65\x69\x67\150\x74\137\61" => 0, "\x77\x65\151\147\x68\x74\137\62" => 0, "\x69\155\x61\x67\145\x5f\x31" => "\57\x73\164\x61\164\151\143\57\151\155\x67\57\155\x61\x6e\56\160\156\x67", "\x69\x6d\141\147\x65\137\62" => "\57\163\164\141\164\x69\143\x2f\x69\155\x67\57\167\x6f\155\x61\156\x2e\160\156\147", "\x6e\x61\x74\165\162\x65\x5f\x31" => 0, "\156\x61\164\x75\x72\145\x5f\62" => 0, "\x73\157\x72\164" => 0, "\164\x61\x67" => Defs::SUBJECT_ITEM_TAG_SEX]; goto pGiff; u5cvR: if ($tag == Defs::SUBJECT_ITEM_TAG_SEX) { goto tpmoG; } goto Q63zy; S3uFP: $itemId = Db::table("\x73\165\x62\x6a\x65\x63\164\137\151\164\x65\x6d")->insertGetId($formData); goto aKAve; nOoOy: if (isset(Defs::SUBJECT_ITEM_TAG_DEFS[$tag])) { goto il3tC; } goto CiQJq; v0vdW: $formData = ["\x73\165\x62\152\x65\143\x74\x5f\x69\144" => $subjectId, "\x69\x74\x65\x6d" => "\xe6\x82\250\347\x9a\x84\xe5\xb9\xb4\xe9\276\204\x3f", "\x74\x79\160\145" => Defs::QUESTION_TEXT, "\163\157\162\x74" => 0, "\x74\141\x67" => Defs::SUBJECT_ITEM_TAG_AGE]; goto rlyjw; pGiff: OFBS_: goto S3uFP; LuQbd: goto OFBS_; goto S_mfS; DnLMw: VjXYt: goto u5cvR; q11mQ: il3tC: goto CZfRu; Q63zy: if (!($tag == Defs::SUBJECT_ITEM_TAG_AGE)) { goto mGeTj; } goto v0vdW; DIQJk: wexception("\346\x97\xa0\346\xb3\x95\xe6\211\xbe\xe5\210\xb0\345\xaf\xb9\xe5\272\x94\xe7\232\204\xe9\x87\x8f\xe8\xa1\xa8"); goto DnLMw; VSdBZ: } protected function convertOriginalToStandard($statistic_weight_min, $statistic_weight_max, $standard_weight_min, $standard_weight_max, &$weight) { goto SX_Cy; vTCFG: WB2l6: goto wI2EQ; aImQs: return false; goto s3mhm; q0iCz: return true; goto G6YsH; aX6kI: if (!($weightStandard > $standard_weight_max)) { goto WB2l6; } goto fxoRG; G6YsH: fsJGH: goto aImQs; np3tq: $scale = ($standard_weight_max - $standard_weight_min) / ($statistic_weight_max - $statistic_weight_min); goto z0xQn; SX_Cy: if (!($standard_weight_min !== null && $standard_weight_max !== null && $statistic_weight_max && $standard_weight_max && $statistic_weight_max > $statistic_weight_min && $standard_weight_max > $standard_weight_min)) { goto fsJGH; } goto np3tq; z0xQn: $weightStandard = round(($weight - $statistic_weight_min) * $scale + $standard_weight_min, 2); goto aX6kI; wI2EQ: $weight = $weightStandard; goto q0iCz; fxoRG: $weightStandard = $standard_weight_max; goto vTCFG; s3mhm: } public function checkReportAlgo(&$subject) { goto y26Ju; vquPr: if (!$downloadAlgo) { goto jc1gg; } goto PuZ6d; FMv2N: foreach ($fields as $field) { goto DQlC1; HZV2c: OxJBX: goto dR3dh; pxGuB: JXb4k: goto y0zCl; XNr59: eMfQ2: goto Ja_sg; sppf5: list($class, $method) = explode("\x3a", $subject[$field]); goto qc3Db; QnJ3A: lO7hF: goto vhEck; I_B4i: $downloadAlgo = true; goto qY8GW; Rj53a: O6hOS: goto HZV2c; EbxKk: vFcjw: goto H07Vf; qY8GW: goto qMg3S; goto Rj53a; vhEck: if (strpos($subject[$field], "\72") === false) { goto eMfQ2; } goto sppf5; H07Vf: if (file_exists($file)) { goto O6hOS; } goto I_B4i; Yey_i: fRNAs: goto y_EMG; rw4P0: $file = ROOT_PATH . "\x72\145\x70\157\162\164" . DS . "\x74\x65\163\x74" . DS . basename($class) . "\56\160\150\x70"; goto E4y1q; E4y1q: goto fRNAs; goto pxGuB; y0zCl: $file = ROOT_PATH . "\x72\x65\160\x6f\x72\x74" . DS . "\x61\154\147\x6f" . DS . basename($class) . "\56\x70\x68\x70"; goto Yey_i; DQlC1: if (!empty($subject[$field])) { goto lO7hF; } goto TEUyJ; Ja_sg: $file = ROOT_PATH . "\x72\145\160\157\162\164" . DS . "\x61\x6c\147\x6f" . DS . "\101\151\x2e\160\x68\160"; goto EbxKk; y_EMG: goto vFcjw; goto XNr59; TEUyJ: goto OxJBX; goto QnJ3A; qc3Db: if ($field == "\x72\x65\x70\157\162\164\x5f\x67\x65\156\x65\162\141\164\157\162") { goto JXb4k; } goto rw4P0; dR3dh: } goto gxhCY; qIL8L: return true; goto JB3oK; PuZ6d: logEvent("\346\227\xa0\346\xb3\225\xe6\211\xbe\xe5\210\xb0\347\x94\x9f\346\210\220\xe6\212\xa5\345\221\x8a\347\x9a\x84\xe7\256\227\xe6\263\225\346\x96\207\344\273\xb6\54\x20{$file}", EventLogsService::eSeverityError); goto EMLJR; brGzF: jc1gg: goto qIL8L; WhaxO: $downloadAlgo = false; goto FMv2N; EMLJR: try { $this->downloadReportAlgo(); } catch (WException $e) { logEvent("\xe4\xb8\213\350\xbd\275\xe7\224\237\346\x88\x90\xe6\x8a\245\xe5\x91\x8a\347\x9a\204\347\256\x97\xe6\263\x95\346\226\207\xe4\273\xb6\xe5\xa4\xb1\xe8\xb4\xa5\54\x20\x65\170\x63\145\160\x74\x69\157\x6e\x3a\40" . $e->getMessage(), EventLogsService::eSeverityError); return false; } goto brGzF; gxhCY: qMg3S: goto vquPr; y26Ju: $fields = ["\162\145\x70\x6f\x72\164\137\147\x65\156\145\x72\x61\164\157\162", "\x63\x75\x73\x74\x6f\155\137\164\x65\x73\x74", "\x63\165\x73\164\x6f\x6d\137\x61\x6e\163\167\x65\162", "\x63\x75\x73\x74\157\155\x5f\x61\x6e\163\167\x65\162\137\x70\x72\x65\x76", "\143\165\163\x74\x6f\x6d\137\162\145\160\157\x72\164"]; goto WhaxO; JB3oK: } public function generateTestResult($subjectId, $itemOptions) { goto KNgIV; KNgIV: if (!empty($itemOptions)) { goto ZEzZF; } goto lugwI; T6ndH: if (!$subject["\162\145\160\157\x72\x74\137\147\145\156\145\x72\141\x74\x6f\x72"]) { goto S0ctk; } goto v3JZ7; v3JZ7: if (strpos($subject["\162\x65\x70\x6f\x72\x74\x5f\147\145\x6e\145\x72\x61\x74\157\162"], "\72") === false) { goto jfEvO; } goto kR6L_; CZ0uH: cNVpa: goto c3nzK; S7n_t: $standards = []; goto xAg9w; HOi3h: $rows = []; goto jPvvy; Gokij: $subjectItems = Db::table("\x73\165\142\152\x65\x63\164\x5f\151\x74\145\155")->where("\163\x75\x62\x6a\x65\x63\164\x5f\x69\x64", $subjectId)->order("\x73\157\x72\164\x20\x61\163\143")->column("\x69\144\x2c\x20\xd\xa\x20\x20\40\40\x20\40\40\40\40\40\x20\40\40\40\40\40\x74\171\160\x65\54\xd\12\40\40\40\40\40\x20\40\40\40\40\40\x20\x20\x20\x20\x20\x77\x65\151\147\x68\x74\x5f\61\54\xd\12\40\x20\x20\x20\40\x20\40\40\40\x20\40\x20\40\x20\x20\40\167\145\151\147\150\164\x5f\x32\54\xd\xa\x20\x20\40\x20\x20\40\x20\x20\40\40\40\x20\x20\x20\x20\40\x77\145\x69\147\x68\x74\137\63\54\xd\12\40\40\x20\40\x20\40\40\x20\x20\40\x20\40\x20\40\x20\x20\x77\x65\151\147\150\164\x5f\64\x2c\xd\xa\x20\40\x20\40\x20\40\x20\40\x20\40\40\x20\40\40\x20\40\167\x65\x69\x67\x68\x74\137\x35\x2c\xd\xa\40\x20\x20\40\x20\40\x20\40\x20\40\40\40\40\x20\x20\x20\167\x65\x69\x67\x68\x74\137\66\54\15\xa\40\40\x20\x20\x20\40\40\x20\x20\40\40\40\x20\40\40\x20\167\x65\x69\147\150\x74\137\67\x2c\xd\12\x20\x20\40\40\40\x20\x20\40\x20\x20\x20\x20\40\40\x20\x20\x77\145\151\x67\150\164\137\x38\x2c\15\xa\x20\40\40\x20\40\x20\40\40\x20\40\40\x20\x20\40\x20\40\x77\145\x69\x67\x68\x74\137\71\54\xd\xa\x20\x20\x20\40\x20\40\40\40\40\40\40\40\x20\x20\x20\40\x77\145\x69\x67\x68\x74\137\x31\60\54\15\xa\x20\40\x20\40\40\40\x20\x20\x20\40\40\x20\40\40\x20\40\167\145\151\147\x68\164\137\x31\61\x2c\xd\12\x20\x20\40\x20\40\x20\x20\40\x20\x20\40\x20\x20\x20\x20\40\167\x65\151\x67\150\x74\x5f\61\62\x2c\15\xa\40\40\40\40\40\x20\x20\40\x20\40\x20\x20\x20\x20\x20\x20\156\x61\164\x75\162\145\x5f\61\x2c\15\xa\40\40\x20\40\x20\40\x20\x20\40\x20\x20\x20\x20\40\40\40\x6e\x61\x74\x75\162\x65\x5f\x32\x2c\xd\12\40\x20\x20\40\40\x20\x20\x20\x20\40\40\40\40\40\40\40\156\141\x74\x75\162\x65\x5f\x33\x2c\15\12\40\x20\40\40\40\40\40\x20\x20\x20\40\x20\x20\x20\x20\40\x6e\141\164\165\x72\x65\x5f\64\54\xd\xa\x20\x20\40\40\40\x20\40\40\40\40\40\40\40\x20\x20\x20\x6e\141\164\x75\x72\145\137\x35\54\15\12\x20\40\x20\40\x20\x20\x20\x20\x20\x20\40\40\x20\40\40\40\156\141\x74\x75\162\x65\x5f\66\x2c\15\12\x20\x20\x20\x20\40\x20\40\x20\40\x20\40\40\40\40\40\x20\156\x61\x74\x75\x72\145\x5f\x37\x2c\xd\12\40\x20\40\x20\40\40\x20\40\x20\40\40\x20\x20\x20\x20\x20\x6e\x61\x74\x75\162\145\x5f\x38\54\15\xa\x20\x20\x20\40\40\40\x20\40\x20\40\40\x20\x20\40\40\40\156\141\164\165\x72\x65\x5f\x39\x2c\15\12\40\x20\x20\40\40\x20\x20\40\40\40\x20\x20\x20\x20\x20\x20\156\x61\x74\165\162\x65\x5f\61\60\x2c\xd\xa\40\40\40\x20\x20\40\x20\40\x20\x20\40\x20\40\x20\40\40\x6e\141\164\165\x72\145\137\61\61\54\15\12\x20\x20\40\40\x20\40\x20\40\40\40\x20\x20\40\40\40\x20\156\141\164\x75\x72\x65\137\61\62\54\15\xa\x20\x20\x20\x20\x20\x20\40\40\40\x20\x20\x20\40\40\x20\x20\164\x61\147"); goto o3e7F; Dv8Tl: xLf5a: goto wCZOP; o3e7F: if (!empty($subjectItems)) { goto TT1sZ; } goto Y_pIk; B_q2k: TT1sZ: goto S7n_t; c3nzK: S0ctk: goto Gokij; S4MNN: return []; goto nzWH2; Y_pIk: return []; goto B_q2k; nzWH2: jvNKF: goto fS4bw; kR6L_: list($class, $method) = explode("\72", $subject["\x72\145\160\157\x72\x74\x5f\x67\x65\x6e\145\x72\x61\164\157\x72"]); goto Vsx9W; UBz3X: $subject = Db::table("\x73\165\x62\x6a\145\x63\x74")->where("\151\x64", $subjectId)->field("\x73\x6e\54\x20\163\x74\141\x74\151\x73\164\x69\143\x5f\167\145\151\x67\150\x74\137\155\x69\x6e\x2c\40\163\x74\x61\164\151\x73\x74\x69\x63\137\x77\x65\151\x67\x68\x74\137\155\141\170\54\x20\x73\x74\x61\x6e\x64\141\162\x64\x5f\x77\145\151\147\150\x74\137\155\151\x6e\x2c\40\x73\x74\141\x6e\144\x61\x72\x64\137\x77\145\151\147\150\x74\x5f\155\x61\170\x2c\40\162\x65\160\157\162\164\137\147\145\156\145\162\141\x74\x6f\162\54\40\143\165\x73\164\157\155\x5f\164\x65\x73\164\x2c\x20\143\x75\163\x74\x6f\155\137\x61\156\163\167\x65\162\54\x20\143\x75\163\164\x6f\x6d\x5f\141\x6e\x73\167\145\x72\137\x70\x72\145\x76\x2c\x20\x63\x75\163\x74\157\155\137\162\145\160\157\162\x74")->find(); goto l8utW; ppzBn: array_unshift($standards, ["\163\x74\141\x6e\x64\141\x72\x64\137\x69\144" => 0, "\x6c\141\164\151\x74\165\x64\x65" => Defs::SUBJECT_WHOLE_STANDARD, "\x73\164\x61\164\151\163\x74\x69\x63\x5f\167\x65\x69\147\150\x74\x5f\x6d\x69\x6e" => $subject["\x73\x74\x61\x74\151\x73\x74\x69\143\137\167\x65\151\x67\150\x74\137\x6d\x69\x6e"], "\x73\x74\141\x74\x69\163\164\x69\143\137\167\145\151\x67\x68\x74\x5f\155\x61\170" => $subject["\x73\164\x61\x74\x69\163\x74\151\x63\x5f\x77\x65\151\147\x68\164\x5f\x6d\141\x78"], "\x73\x74\141\x6e\144\x61\162\144\x5f\167\x65\151\147\150\x74\x5f\155\151\156" => $subject["\163\164\141\x6e\x64\141\162\x64\137\x77\145\x69\147\x68\x74\x5f\155\151\156"], "\x73\164\x61\x6e\144\141\x72\144\x5f\x77\145\x69\147\x68\164\137\155\x61\x78" => $subject["\163\x74\141\156\144\141\x72\x64\137\167\x65\x69\x67\x68\164\137\155\141\170"]]); goto HOi3h; boS1W: jfEvO: goto na0hQ; Rl_3Z: return []; goto vPVg0; wCZOP: return $rows; goto ETL6B; vPVg0: c1B68: goto T6ndH; fS4bw: if ($this->checkReportAlgo($subject)) { goto c1B68; } goto Rl_3Z; l8utW: if (!empty($subject)) { goto jvNKF; } goto S4MNN; SWi_C: return call_user_func([$reporter, $subject["\162\x65\x70\157\162\164\x5f\147\145\156\145\x72\x61\x74\157\162"]], $subjectId, $itemOptions); goto CZ0uH; lugwI: return []; goto fBmdq; Vsx9W: return call_user_func([new $class(), $method], $subjectId, $itemOptions); goto wxr7M; wxr7M: goto cNVpa; goto boS1W; na0hQ: $reporter = new AiAlgo(); goto SWi_C; jPvvy: foreach ($standards as $standard) { goto NSqLS; C9HW5: goto lMN8U; goto bDgAb; GT4Zr: goto jjOBv; goto kJjqJ; ZjhXN: $latitudes = Db::table("\x73\165\x62\152\145\143\164\x5f\163\x74\141\x6e\144\x61\162\x64\137\x6c\x61\x74\151\x74\165\144\x65")->where(["\x73\165\142\x6a\145\143\x74\x5f\151\x64" => $subjectId, "\163\x74\x61\156\144\141\162\144\137\151\144" => $standardId])->field(true)->select(); goto K__qh; Y23sE: $matchedRemarks = []; goto Rseiz; vZ_oM: $totalWeightStandard = null; goto Cn3BZ; LlsJO: $positiveAverageWeightStandard = null; goto E_rze; Uwhmo: $tempWeight = $totalWeight; goto XC8Cn; DtXKF: $convertedResult = $this->convertOriginalToStandard($standard["\x73\x74\x61\x74\x69\163\164\151\143\x5f\167\145\x69\x67\x68\x74\x5f\155\151\x6e"], $standard["\163\164\141\164\151\x73\164\x69\x63\x5f\167\145\x69\147\150\x74\137\x6d\x61\x78"], $standard["\163\164\141\156\144\x61\x72\x64\137\167\x65\x69\x67\150\164\x5f\155\x69\x6e"], $standard["\163\164\x61\x6e\x64\141\162\144\137\x77\x65\x69\147\150\x74\x5f\x6d\141\x78"], $tempWeight); goto u_LvB; AqXAq: $negativeItemCount = 0; goto RNZnp; boFhl: jjOBv: goto XA87A; tFkGn: $warningLevel = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto kHsqp; i4qP3: $matched = false; goto UhBSw; ddXS0: if (!($itemCount > 0)) { goto DUnxW; } goto LErYS; qwfua: if ($positiveItemCount) { goto Nydk2; } goto MxWUK; ACGkF: if (!empty($subjectItemIds)) { goto dmoI9; } goto Mlk8g; LY3bl: $totalWeight = 0; goto N8Yqm; hrxFS: YVOBm: goto q8hJN; w8eAL: $averageWeightMax = 0; goto sCKE8; ih3Sb: DBuy6: goto NKHBr; Mxv5H: $positiveAverageWeight = round($totalPositiveWeight / $positiveItemCount, 2); goto b8Bto; F6stj: $matchedDescs = []; goto Y23sE; jcDFa: $itemCount = 0; goto SoVew; UeCiq: $averageWeightMaxStandard = null; goto aicvb; JBUPn: FwymF: goto Lx4_H; IgUY4: ggw8j: goto gc2jr; lq0uI: $totalWeightMinStandard = $standard["\163\164\141\x6e\x64\x61\x72\x64\x5f\x77\x65\151\147\x68\164\x5f\x6d\x69\x6e"]; goto yGV8e; F3a8D: lMN8U: goto e7D0l; aB29a: $subjectItemIds = Db::table("\163\x75\142\152\145\143\x74\137\x69\164\145\x6d\x5f\163\164\x61\156\144\141\162\144")->where(["\x73\165\142\x6a\145\x63\x74\x5f\151\144" => $subjectId, "\163\x74\141\156\x64\x61\x72\x64\137\x69\144" => $standardId])->column("\151\x74\145\155\137\151\x64"); goto XELYX; wMpNO: aVWvj: goto ih3Sb; kHsqp: if ($standardId == 0) { goto dC4BX; } goto aB29a; Jr3wt: $totalWeightMin = 0; goto sRKNt; hAPCE: goto Q5EiI; goto G1Lxb; XELYX: if ($subjectItemIds) { goto onltL; } goto gNmdX; XC8Cn: $convertedResult = $this->convertOriginalToStandard($standard["\163\164\x61\164\151\x73\x74\151\143\x5f\x77\145\x69\x67\x68\164\x5f\x6d\151\156"], $standard["\163\164\141\x74\x69\163\164\x69\143\x5f\167\x65\151\147\x68\x74\137\155\x61\170"], $standard["\163\x74\x61\156\144\141\162\144\x5f\x77\x65\x69\x67\x68\x74\x5f\155\x69\x6e"], $standard["\x73\x74\x61\x6e\x64\x61\x72\144\137\x77\145\x69\147\x68\164\137\155\x61\170"], $tempWeight); goto S9P2t; kJjqJ: xOhEU: goto of7JD; rwF2Y: onltL: goto olhzv; MxWUK: $positiveAverageWeightStandard = 0; goto vg6yr; olhzv: goto JJpPt; goto GFwfP; zLHOw: $positiveAverageWeightStandard = round($tempWeight / $positiveItemCount, 2); goto hrxFS; K__qh: if (!(empty($latitudes) && $standardId == 0)) { goto kZr6Q; } goto Coay2; Knqij: goto cIwbF; goto wSuJJ; XR2xS: if ($positiveItemCount) { goto cewQv; } goto C9HW5; b8Bto: $tempWeight = $totalPositiveWeight; goto DtXKF; N8Yqm: $totalWeightMax = 0; goto Jr3wt; Ez6I4: $totalPositiveWeightStandard = null; goto LlsJO; NSqLS: $standardId = $standard["\x73\164\x61\156\144\141\x72\144\x5f\151\144"]; goto BW2W7; gNmdX: $subjectItemIds = []; goto rwF2Y; UhBSw: if (!($itemCount > 0)) { goto DBuy6; } goto jJo1y; Rseiz: $warningLevel = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto i4qP3; vg6yr: goto YVOBm; goto VrthR; E_rze: $weightDistribution = []; goto tFkGn; e7D0l: DUnxW: goto sFX2V; QCscW: $subjectItemIds = array_keys($subjectItems); goto OJygr; hxije: $averageWeight = round($totalWeight / $itemCount, 2); goto eEPxY; RNZnp: $totalPositiveWeight = 0; goto H0T7h; q8hJN: cIwbF: goto F3a8D; OJygr: JJpPt: goto ACGkF; wSuJJ: SLLA5: goto qwfua; Lx4_H: $i = 0; goto boFhl; G1Lxb: jBLpK: goto pOhZl; Gk3LC: if (isset($weightDistribution[strval($i)])) { goto z2Kq9; } goto qg14F; l6HuU: Q5EiI: goto XR2xS; of7JD: if (!($itemCount == 0)) { goto DSVaK; } goto CEVYw; m32Uz: $positiveItemCount = 0; goto AqXAq; JzKFA: $averageWeightStandard = null; goto UeCiq; C1yYx: $totalWeightMaxStandard = $standard["\163\x74\141\156\x64\141\162\x64\137\x77\145\x69\147\150\164\x5f\x6d\141\x78"]; goto lq0uI; pOhZl: $totalWeightStandard = $tempWeight; goto C1yYx; sFX2V: $matchedExpressions = []; goto F6stj; sRKNt: $averageWeight = 0; goto w8eAL; XA87A: if (!($i <= 6)) { goto xOhEU; } goto Gk3LC; ReQ7F: $totalWeightMinStandard = null; goto JzKFA; Coay2: goto ggw8j; goto C_zAd; eEPxY: $averageWeightMax = round($totalWeightMax / $itemCount, 2); goto Ab7HL; rqovW: $i++; goto GT4Zr; BW2W7: $latitudeText = $standard["\x6c\141\x74\151\164\165\x64\145"]; goto ZjhXN; C_zAd: kZr6Q: goto LY3bl; LErYS: $totalWeightMax = $standard["\x73\164\141\x74\151\163\164\151\x63\137\x77\x65\151\147\150\x74\x5f\155\x61\170"]; goto h_ObT; NKHBr: $rows[] = ["\163\164\x61\x6e\x64\141\x72\144\137\151\x64" => $standardId, "\154\141\x74\x69\x74\165\144\x65" => $latitudeText, "\164\157\x74\141\x6c\x5f\167\x65\x69\147\150\x74" => $totalWeight, "\x74\157\164\141\x6c\137\x77\x65\151\147\150\164\137\x6d\141\170" => $totalWeightMax, "\164\157\x74\x61\x6c\x5f\167\145\x69\147\150\164\137\x6d\151\156" => $totalWeightMin, "\141\166\145\x72\141\x67\145\x5f\x77\x65\151\x67\x68\164" => $averageWeight, "\x61\166\x65\x72\141\147\x65\137\167\x65\x69\147\150\164\137\x6d\141\170" => $averageWeightMax, "\x61\166\x65\162\141\147\145\x5f\167\x65\151\147\x68\164\x5f\155\x69\x6e" => $averageWeightMin, "\160\x6f\x73\x69\x74\151\166\x65\x5f\141\x76\x65\x72\x61\147\145\x5f\x77\145\151\147\150\164" => $positiveAverageWeight, "\167\145\151\x67\x68\x74\137\x64\x69\163\164\x72\151\142\x75\164\151\157\156" => $weightDistribution, "\164\x6f\x74\141\x6c\x5f\167\145\151\x67\150\164\x5f\x73\164\141\156\144\141\162\x64" => $totalWeightStandard, "\164\x6f\164\141\154\137\x77\x65\x69\x67\150\x74\137\155\141\170\x5f\163\164\141\x6e\x64\141\x72\144" => $totalWeightMaxStandard, "\164\157\164\141\154\137\x77\145\151\x67\x68\x74\137\x6d\151\156\x5f\163\x74\141\x6e\x64\141\x72\144" => $totalWeightMinStandard, "\141\x76\x65\162\x61\x67\145\137\167\x65\x69\x67\x68\x74\137\163\164\x61\x6e\x64\x61\x72\144" => $averageWeightStandard, "\141\166\x65\x72\141\147\x65\137\167\145\x69\x67\x68\x74\x5f\155\141\x78\x5f\163\x74\x61\x6e\144\x61\x72\144" => $averageWeightMaxStandard, "\141\166\x65\x72\x61\147\145\x5f\167\145\151\x67\x68\164\x5f\155\x69\156\x5f\163\164\141\156\x64\141\162\x64" => $averageWeightMinStandard, "\x70\157\163\151\x74\151\166\145\137\x61\x76\145\162\141\147\145\x5f\167\145\x69\x67\150\164\137\163\164\x61\156\144\141\x72\144" => $positiveAverageWeightStandard, "\151\164\145\x6d\137\143\x6f\x75\x6e\x74" => $itemCount, "\x70\x6f\163\x69\164\151\x76\145\137\151\164\x65\x6d\137\143\157\x75\156\164" => $positiveItemCount, "\156\145\147\x61\164\151\166\145\137\x69\164\145\x6d\x5f\x63\157\165\x6e\164" => $negativeItemCount, "\x6d\x61\164\x63\150\x65\x64" => $matched, "\155\141\164\x63\150\x65\144\137\x65\x78\160\x72\x65\x73\x73\x69\x6f\x6e\x73" => $matchedExpressions, "\155\x61\x74\143\150\x65\144\x5f\144\x65\x73\143\x73" => $matchedDescs, "\155\x61\164\x63\150\145\144\137\x72\145\x6d\141\162\x6b\x73" => $matchedRemarks, "\167\141\x72\x6e\151\x6e\147\x5f\154\x65\x76\x65\x6c" => $warningLevel]; goto IgUY4; SoVew: foreach ($itemOptions as $itemId => $itemOption) { goto av53Y; XIciq: if (isset($subjectItems[$itemId])) { goto i52fF; } goto XyDhR; sHiY4: if (!isset($subjectItems[$itemId][$weightField])) { goto PpirW; } goto He2P1; GTFt1: if (in_array($itemId, $subjectItemIds)) { goto AfTbf; } goto ZQ_Rj; VNBYU: RG9PD: goto mB1S4; zCTM0: if (is_array($optionIndex)) { goto JkjP4; } goto zW5NJ; w4eyg: goto gRFbv; goto nBJ72; mB1S4: goto TaA70; goto PH8oo; BA36U: $optionIndex = $itemOption["\x76\x61\154\165\145"]; goto XIciq; a28ra: Krj4E: goto AnyZW; plQiU: $totalPositiveWeight += round($subjectItems[$itemId][$weightField] / 100, 2); goto sGTdD; A4vUk: $itemWeight = 0; goto Jzjbf; sGTdD: diDR2: goto VNBYU; QhwnO: $positiveItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE ? 1 : 0; goto Ndpmk; xaAeG: Uqz5e: goto wb5ML; THSGM: if (isset($weightDistribution[strval($itemWeight)])) { goto Krj4E; } goto GVZ0E; yLdUY: if (!isset($subjectItems[$itemId][$natureField])) { goto RG9PD; } goto QhwnO; z96Gl: goto Uqz5e; goto a28ra; Hyc2A: $itemCount++; goto O_ykx; cn_rA: Iha_W: goto CpaYN; IMlwc: MMhj3: goto NROrf; Z3v23: $totalWeight += $itemWeight; goto THSGM; GVZ0E: $weightDistribution[strval($itemWeight)] = 1; goto z96Gl; fjD4u: EcRdr: goto GTFt1; dfJdp: lNtjL: goto mmLbI; Jzjbf: foreach ($optionIndex as $optionIndexOne) { goto PSzny; PSzny: $weightField = "\167\x65\151\147\150\x74\137" . $optionIndexOne; goto dQUuP; dQUuP: if (!isset($subjectItems[$itemId][$weightField])) { goto RHSf0; } goto TVuAe; UlUS9: RHSf0: goto dfGds; dfGds: NoxuL: goto KJw9N; TVuAe: $itemWeight += round($subjectItems[$itemId][$weightField] / 100, 2); goto UlUS9; KJw9N: } goto IMlwc; wPfNW: if (!($subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE)) { goto diDR2; } goto plQiU; q3up6: $natureField = "\x6e\x61\x74\x75\162\x65\x5f" . $optionIndex; goto yLdUY; zW5NJ: $weightField = "\167\x65\x69\147\150\x74\137" . $optionIndex; goto sHiY4; PH8oo: JkjP4: goto A4vUk; Z5PvT: goto w9xI6; goto dfJdp; AnyZW: $weightDistribution[strval($itemWeight)]++; goto xaAeG; F6ZRH: goto gRFbv; goto fjD4u; hUXQ8: w9xI6: goto OFoHg; XPG3L: AfTbf: goto eQGjS; VX67M: if (isset($weightDistribution[strval($itemWeight)])) { goto lNtjL; } goto IhMt4; Ndpmk: $negativeItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_NEGATIVE ? 1 : 0; goto wPfNW; ZQ_Rj: goto gRFbv; goto XPG3L; NROrf: $totalWeight += $itemWeight; goto VX67M; prrp0: if (!($subjectItems[$itemId]["\x74\141\147"] != "\156\157\156\145")) { goto EcRdr; } goto F6ZRH; wb5ML: PpirW: goto q3up6; av53Y: $itemType = $itemOption["\x74\171\160\145"]; goto BA36U; IhMt4: $weightDistribution[strval($itemWeight)] = 1; goto Z5PvT; XyDhR: goto gRFbv; goto heD4g; CpaYN: TaA70: goto Hyc2A; mmLbI: $weightDistribution[strval($itemWeight)]++; goto hUXQ8; heD4g: i52fF: goto prrp0; OFoHg: foreach ($optionIndex as $optionIndexOne) { goto jJQqd; w0xnn: $positiveItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE ? 1 : 0; goto xqVFK; VJQzV: $totalPositiveWeight += round($subjectItems[$itemId]["\167\145\151\147\150\164\137" . $optionIndexOne] / 100, 2); goto V3uVc; lK3sT: WMdaI: goto w0xnn; Pinhf: if (isset($subjectItems[$itemId][$natureField])) { goto WMdaI; } goto oYM2b; oYM2b: goto XanDA; goto lK3sT; xqVFK: $negativeItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_NEGATIVE ? 1 : 0; goto snvYZ; snvYZ: if (!($subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE)) { goto u5zbi; } goto VJQzV; V3uVc: u5zbi: goto F5sOB; jJQqd: $natureField = "\x6e\x61\x74\165\162\145\x5f" . $optionIndexOne; goto Pinhf; F5sOB: XanDA: goto bG9q6; bG9q6: } goto cn_rA; eQGjS: if (!($itemType == Defs::QUESTION_TEXT)) { goto nXQs2; } goto w4eyg; nBJ72: nXQs2: goto zCTM0; O_ykx: gRFbv: goto crTYW; He2P1: $itemWeight = round($subjectItems[$itemId][$weightField] / 100, 2); goto Z3v23; crTYW: } goto JBUPn; v2j0k: $averageWeightMinStandard = round($totalWeightMinStandard / $itemCount, 2); goto l6HuU; aicvb: $averageWeightMinStandard = null; goto m32Uz; Cn3BZ: $totalWeightMaxStandard = null; goto ReQ7F; d6igi: $averageWeightMaxStandard = round($totalWeightMaxStandard / $itemCount, 2); goto v2j0k; h_ObT: $totalWeightMin = $standard["\x73\x74\x61\164\151\163\x74\x69\x63\137\x77\x65\x69\x67\150\164\137\155\x69\x6e"]; goto hxije; bDgAb: cewQv: goto Mxv5H; GFwfP: dC4BX: goto QCscW; sCKE8: $averageWeightMin = 0; goto vZ_oM; Mlk8g: dmoI9: goto jcDFa; S9P2t: if ($convertedResult) { goto jBLpK; } goto hAPCE; bSKh3: z2Kq9: goto rqovW; u_LvB: if ($convertedResult) { goto SLLA5; } goto Knqij; yGV8e: $averageWeightStandard = round($totalWeightStandard / $itemCount, 2); goto d6igi; CEVYw: DSVaK: goto ddXS0; jJo1y: foreach ($latitudes as $latitude) { goto CCuev; oE5Yp: qG2R7: goto YULXv; znPlf: $warningLevel = $latitude["\x77\x61\162\156\151\156\147\137\154\x65\166\145\x6c"]; goto WVjvk; Dprw5: $expression = str_replace("\x24\x7b\127\104" . $i . "\175", "\x24\167\x65\151\x67\x68\x74\104\151\x73\x74\162\x69\142\165\164\151\x6f\x6e\x5b\x73\x74\x72\166\141\154\50" . $i . "\x29\x5d", $expression); goto s_kHl; WVjvk: ruLe6: goto FZVxb; FZVxb: if (!trim($latitude["\162\x65\155\141\162\x6b"])) { goto QsIGt; } goto q4FId; ls2h4: QsIGt: goto eXMh1; CCuev: $weightType = $latitude["\x77\145\x69\x67\150\164\137\x74\171\160\145"]; goto ALDme; RKI0K: xz0M_: goto KeKSn; JZsQL: $expression = "\162\145\164\165\162\156\40" . $expression . "\x3b"; goto K06YE; CXBJK: if (!($latitude["\x77\x61\162\156\151\156\x67\x5f\x6c\145\166\145\154"] > $warningLevel)) { goto ruLe6; } goto znPlf; PiJlk: if (!($i <= 6)) { goto w3mrk; } goto Dprw5; q4FId: $matchedRemarks[] = $latitude["\162\145\155\141\x72\153"]; goto ls2h4; uiHKo: $expression = str_replace("\x24\x7b\101\x57\x7d", "\x24\x61\166\145\162\x61\x67\x65\x57\145\151\147\x68\x74", $expression); goto ZDU2V; m3Vt1: $matchedExpressions[] = $expressionOriginal; goto GUkRK; KeKSn: $expression = str_replace("\x24\173\124\127\x7d", "\44\x74\157\x74\x61\x6c\127\145\x69\147\150\x74", $expression); goto uiHKo; rJgdy: if (!$result) { goto YrT3a; } goto m3Vt1; s_kHl: $i++; goto MGFx3; iDq03: try { $result = eval($expression); } catch (\ParseError $e) { $result = false; } goto rJgdy; K3F8P: YrT3a: goto kpKxL; ZDU2V: $expression = str_replace("\44\x7b\x50\101\x57\175", "\44\160\x6f\x73\x69\x74\x69\166\x65\101\x76\145\x72\141\x67\x65\127\x65\x69\147\x68\x74", $expression); goto ijIaz; M5Pww: lZWId: goto kDhwE; kpKxL: WittQ: goto mi2mW; Q7xI4: $expression = str_replace("\44\173\116\x49\103\x7d", "\44\156\145\x67\141\164\x69\x76\145\111\x74\145\x6d\103\x6f\x75\x6e\x74", $expression); goto JZsQL; ijIaz: $i = 0; goto eQ3Pb; K06YE: Log::notice("\145\170\160\162\145\163\x73\x69\x6f\x6e\72\x20{$expressionOriginal}\x20\55\x3e\x20{$expression}"); goto iDq03; W1DlE: goto WittQ; goto fwCzB; vufv4: goto WittQ; goto V2cMz; YULXv: $expression = str_replace("\44\173\x50\x49\103\x7d", "\44\160\x6f\x73\x69\164\x69\x76\145\x49\x74\145\x6d\x43\x6f\x75\156\164", $expression); goto Q7xI4; jHGbk: QpWCi: goto vv_qI; StZZi: $expression = preg_replace("\57\x5c\163\x2b\57", '', $expressionOriginal); goto WwtLY; MGFx3: goto hXW1w; goto IO4vZ; jOYqf: $expressionOriginal = $latitude["\145\x78\x70\162\x65\163\163\x69\x6f\x6e"]; goto StZZi; ALDme: if (!($weightType == Defs::LATITUDE_MEASURE_WEIGHT_STANDARD && $totalWeightStandard === null)) { goto pm7jm; } goto vufv4; r0xwn: if ($weightType == Defs::LATITUDE_MEASURE_WEIGHT_STANDARD) { goto QpWCi; } goto W1DlE; lLRpc: $expression = str_replace("\44\x7b\x41\x57\x7d", "\x24\141\x76\x65\x72\141\147\x65\x57\145\x69\x67\x68\x74\123\x74\141\x6e\144\141\162\144", $expression); goto QBaVJ; GUkRK: $matchedDescs[] = $latitude["\163\x74\141\156\x64\137\144\x65\163\x63"]; goto CXBJK; kDhwE: goto qG2R7; goto RKI0K; V2cMz: pm7jm: goto jOYqf; fwCzB: goto lZWId; goto jHGbk; IO4vZ: w3mrk: goto oE5Yp; vv_qI: $expression = str_replace("\44\x7b\124\127\175", "\x24\x74\157\x74\141\x6c\x57\145\x69\147\x68\x74\x53\164\x61\x6e\x64\x61\162\x64", $expression); goto lLRpc; eQ3Pb: hXW1w: goto PiJlk; QBaVJ: $expression = str_replace("\x24\173\120\101\127\x7d", "\x24\x70\157\x73\151\164\151\166\145\x41\166\145\x72\x61\147\x65\x57\x65\x69\x67\x68\164\x53\x74\141\x6e\144\141\x72\x64", $expression); goto M5Pww; WwtLY: if ($weightType == Defs::LATITUDE_MEASURE_WEIGHT_ORIGINAL) { goto xz0M_; } goto r0xwn; eXMh1: $matched = true; goto K3F8P; mi2mW: } goto wMpNO; qg14F: $weightDistribution[strval($i)] = 0; goto bSKh3; Ab7HL: $averageWeightMin = round($totalWeightMin / $itemCount, 2); goto Uwhmo; H0T7h: $positiveAverageWeight = 0; goto Ez6I4; VrthR: Nydk2: goto zLHOw; gc2jr: } goto Dv8Tl; fBmdq: ZEzZF: goto UBz3X; xAg9w: $standards = Db::table("\x73\165\142\x6a\145\143\164\x5f\x73\164\x61\156\x64\141\162\144")->where("\x73\x75\142\x6a\145\143\164\x5f\151\144", $subjectId)->field("\x69\x64\x20\x61\163\x20\163\x74\141\156\x64\x61\x72\x64\x5f\x69\144\x2c\x20\154\141\x74\x69\164\165\x64\x65\x2c\x20\xd\xa\x20\x20\x20\x20\x20\40\x20\x20\x20\x20\40\x20\40\40\40\40\163\x74\x61\x74\151\163\164\151\x63\x5f\167\x65\x69\x67\x68\x74\137\x6d\151\156\x2c\40\x73\x74\x61\164\151\x73\x74\151\x63\137\167\145\x69\147\150\x74\137\x6d\141\170\x2c\40\x73\164\141\156\x64\141\x72\x64\x5f\x77\145\151\x67\150\164\x5f\x6d\x69\156\54\x20\x73\164\141\x6e\144\x61\x72\x64\137\x77\x65\x69\147\150\x74\137\155\141\170")->order("\163\157\162\x74\x20\x61\x73\x63\x2c\x20\151\144\40\141\x73\143")->select(); goto ppzBn; ETL6B: } public function downloadReportAlgo() { goto Zqzca; N2pYQ: AqTe0: goto CPXt5; fAbu9: PZnE2: goto SEoy3; O4gB0: $zip->close(); goto bXfaA; KxIc_: $number = ''; goto eE4oT; WTvD9: $content = file_get_contents($downloadUrl); goto ZigJq; BWRO2: qL2gn: goto yCnxM; ODFkg: RiFBv: goto Sg2hX; f2UCa: qkwf3: goto G2GUU; b5JIK: $downloadUrl = WzyerService::I()->apiFetchReportAlgo($number); goto apPeX; bXfaA: unlink($localSaveFile); goto ODFkg; waQXb: if ($result) { goto AqTe0; } goto ne_hu; of7uC: $verInfo = (include_once $reportLocation . DS . "\x76\145\162\56\160\150\x70"); goto hUROG; mCi1N: nRunf: goto b5JIK; CPXt5: $zip = new \ZipArchive(); goto w1D00; uQvg6: return; goto fAbu9; apPeX: if (!empty($downloadUrl)) { goto PZnE2; } goto uQvg6; w1D00: if ($zip->open($localSaveFile) === TRUE) { goto qkwf3; } goto SYzO9; ne_hu: wexception("\347\256\227\xe6\263\225\346\226\207\344\273\266\xe5\206\231\345\205\245\xe5\244\xb1\350\264\245"); goto N2pYQ; hUROG: $number = $verInfo["\x6e\x75\155\142\x65\162"]; goto mCi1N; Zqzca: $reportLocation = ROOT_PATH . DS . "\x72\x65\x70\157\x72\x74"; goto KxIc_; eE4oT: if (!file_exists($reportLocation . DS . "\166\x65\162\x2e\160\x68\x70")) { goto nRunf; } goto of7uC; Uho_g: wexception("\344\xb8\x8b\350\275\xbd\347\256\x97\346\263\225\xe6\226\x87\344\xbb\xb6\345\244\xb1\350\xb4\245"); goto BWRO2; G2GUU: $zip->extractTo($reportLocation . DS); goto O4gB0; ie_P0: goto RiFBv; goto f2UCa; SEoy3: $localSaveFile = $reportLocation . DS . basename($downloadUrl); goto WTvD9; ZigJq: if (!empty($content)) { goto qL2gn; } goto Uho_g; yCnxM: $result = file_put_contents($localSaveFile, $content); goto waQXb; SYzO9: wexception("\350\xa7\xa3\xe5\x8e\213\xe6\x96\207\344\xbb\266\xe5\244\xb1\xe8\264\245\54\40{$localSaveFile}"); goto ie_P0; Sg2hX: } public function importSubject($subjectId) { goto GKPeO; k5Jbt: $subject["\151\x6d\x61\x67\x65\137\165\x72\154"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\151\x6d\141\x67\x65\137\165\x72\x6c"])); goto I3YHl; p37tO: $subject["\162\x65\x70\x6f\x72\x74\x5f\x69\x6d\141\147\x65\65"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x72\x65\160\x6f\162\x74\x5f\x69\155\141\x67\145\65"])); goto LkbeO; kxraJ: $subjectStandardLatitudes = $subjctData["\x73\165\142\152\145\x63\x74\x53\x74\x61\x6e\144\x61\162\x64\114\141\164\x69\x74\165\144\145\163"]; goto UyLng; ngyJS: R_V_U: goto W712F; l9yM3: $subjectStandards = $subjctData["\163\165\142\x6a\x65\x63\164\x53\x74\141\156\144\141\x72\144\163"]; goto kxraJ; W712F: $subject["\162\x65\160\x6f\162\164\137\x64\x65\x6d\x6f\x5f\x69\x6d\x61\147\145\x73"] = implode("\54", $imagesLocal); goto slFnZ; AQZdR: $subject["\x73\165\142\152\x65\143\164\x5f\x64\x65\163\x63"] = preg_replace("\x2f\x3c\x5b\x69\155\147\174\x49\x4d\107\x5d\x2e\52\77\163\162\x63\x3d\x5b\47\x7c\x5c\x22\135\50\x2e\x2a\77\x29\x5b\47\174\134\42\135\x2f", "\74\x69\155\x67\x20\x73\x72\x63\75\42\150\x74\x74\160\163\x3a\57\57\167\x77\167\56\x77\x7a\171\145\162\x2e\143\157\155\44\x7b\x31\175\x22", $subject["\x73\x75\x62\152\x65\x63\x74\x5f\x64\x65\x73\x63"]); goto wA17x; RGR0E: $subject["\141\x75\x64\x69\157\137\165\162\154"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\141\165\144\151\x6f\x5f\165\162\154"])); goto Rav0n; GKPeO: $subjctData = WzyerService::I()->apiSubject($subjectId); goto xXA_D; Milyu: $subjectStandardsNew = []; goto yK16V; wVwD7: $subjectItemsNew = []; goto VMO5h; BuiO0: foreach ($images as $image) { goto qYfPO; WJZSn: V06ns: goto y4sUg; T9MEO: $imagesLocal[] = $imageLocal; goto Slbzc; I08xd: if (!$imageLocal) { goto TFBfw; } goto T9MEO; Slbzc: TFBfw: goto WJZSn; qYfPO: $imageLocal = downloadRemoteUploadFile(generateWzyerUploadFullUrl($image)); goto I08xd; y4sUg: } goto ngyJS; uT0JU: $subjectItems = $subjctData["\163\x75\x62\152\x65\x63\x74\111\x74\145\155\163"]; goto l9yM3; Q3uVf: Log::notice("\163\165\x62\152\x65\143\x74\123\x74\x61\x6e\x64\x61\162\144\163\72\40" . json_encode($subjectStandards)); goto Milyu; UyLng: $subjectItemStandards = $subjctData["\x73\x75\x62\152\x65\143\x74\111\x74\x65\x6d\x53\164\141\x6e\x64\141\162\144\x73"]; goto k5Jbt; LkbeO: $subject["\x72\145\x70\x6f\162\x74\x5f\151\x6d\141\147\x65\x36"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x72\145\160\157\162\x74\x5f\x69\155\x61\147\x65\66"])); goto JQbyc; QIBUb: Log::notice("\x73\165\142\x6a\145\x63\164\123\164\x61\156\x64\x61\162\144\x73\116\145\x77\72\x20" . json_encode($subjectStandardsNew)); goto qNDTx; Rav0n: if (!$subject["\x72\x65\x70\x6f\162\164\137\x64\x65\155\x6f\x5f\x69\155\141\147\x65\x73"]) { goto Jl27h; } goto NHzC6; z6Xye: FUGO0: goto QIBUb; wA17x: $subject["\163\x75\142\152\x65\x63\x74\137\x64\x65\x73\143"] = htmlspecialchars($subject["\x73\165\142\152\145\143\164\x5f\144\145\x73\143"]); goto Bo8P_; H7g4k: $subject["\x72\x65\160\x6f\162\x74\137\x69\155\141\147\145\x31"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x72\x65\160\x6f\162\164\137\151\x6d\x61\x67\145\61"])); goto qgazo; ecZ2X: $subjectIdNew = Db::table("\163\165\x62\152\145\x63\x74")->insertGetId($subject); goto wVwD7; uIs5g: $subject["\x72\x65\x70\157\162\x74\x5f\151\x6d\141\147\x65\64"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\x65\160\157\x72\164\x5f\x69\155\x61\147\x65\x34"])); goto p37tO; NHzC6: $images = explode("\54", $subject["\x72\x65\160\x6f\x72\164\137\144\x65\155\x6f\x5f\x69\155\141\147\x65\x73"]); goto wWP1R; xXA_D: $subject = $subjctData["\x73\165\x62\152\145\143\164"]; goto uT0JU; AoozD: OperationLogs::I()->subjectLog("\xe5\257\xbc\xe5\205\xa5\xe9\207\x8f\350\xa1\xa8\x20\55\x20{$subject["\x6e\x61\x6d\145"]}", beautifyLogArray($subject, [], "\x73\165\142\x6a\145\143\164"), OperationLogs::OPT_ADD_TYPE, $subjectIdNew); goto l5Tgu; mpbNg: $subject["\x72\145\160\x6f\162\x74\137\x69\x6d\x61\147\145\x33"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\145\x70\157\162\164\x5f\151\x6d\x61\x67\x65\x33"])); goto uIs5g; slFnZ: Jl27h: goto r4Gvb; JQbyc: $subject["\166\x69\144\145\x6f\137\x75\x72\154"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x76\x69\x64\x65\157\137\x75\162\x6c"])); goto RGR0E; s0h9V: KeYWK: goto Q3uVf; I3YHl: $subject["\142\x61\156\156\x65\x72\137\x69\155\x67"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\142\x61\x6e\156\x65\162\x5f\x69\155\147"])); goto H7g4k; qgazo: $subject["\x72\x65\160\x6f\x72\164\x5f\151\x6d\141\147\145\x32"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\x65\160\x6f\162\x74\x5f\x69\155\x61\147\x65\62"])); goto mpbNg; qcAkU: kHuhG: goto AoozD; wWP1R: $imagesLocal = []; goto BuiO0; yK16V: foreach ($subjectStandards as $subjectStandard) { goto mbkuY; yWziv: unset($subjectStandard["\151\x64"]); goto kyTAe; fTBfo: UAh6s: goto SvOks; kyTAe: $subjectStandard["\163\x75\x62\x6a\x65\x63\164\x5f\x69\x64"] = $subjectIdNew; goto DwZv0; DwZv0: $subjectStandardIdNew = Db::table("\163\x75\142\x6a\x65\x63\164\x5f\x73\x74\x61\156\x64\141\162\x64")->insertGetId($subjectStandard); goto d0VSa; mbkuY: $subjectStandardId = $subjectStandard["\151\x64"]; goto yWziv; ldAQ4: $subjectStandardsNew[$subjectStandardId] = $subjectStandard; goto fTBfo; d0VSa: $subjectStandard["\x69\x64"] = $subjectStandardIdNew; goto ldAQ4; SvOks: } goto z6Xye; dQuOG: foreach ($subjectItemStandards as $subjectItemStandard) { goto JBm3B; Of28h: HFTr1: goto WDuUx; bXSe1: Db::table("\163\x75\142\152\145\143\164\x5f\x69\164\x65\x6d\137\x73\164\141\156\x64\x61\162\144")->insert($subjectItemStandard); goto Of28h; Y0CZP: $subjectItemStandard["\163\165\142\152\145\143\x74\137\151\144"] = $subjectIdNew; goto FcbuJ; EG8j9: $subjectItemStandard["\x73\164\141\156\x64\x61\162\144\x5f\x69\144"] = $subjectStandardsNew[$subjectItemStandard["\x73\164\141\x6e\x64\141\x72\144\137\x69\x64"]]["\151\x64"]; goto bXSe1; JBm3B: unset($subjectItemStandard["\x69\x64"]); goto Y0CZP; FcbuJ: $subjectItemStandard["\151\x74\145\x6d\x5f\151\144"] = $subjectItemsNew[$subjectItemStandard["\x69\x74\x65\x6d\x5f\x69\144"]]["\x69\144"]; goto EG8j9; WDuUx: } goto qcAkU; r4Gvb: $subject["\163\x75\142\152\x65\x63\164\137\x64\x65\163\x63"] = htmlspecialchars_decode($subject["\x73\165\x62\x6a\145\x63\164\137\144\145\163\x63"]); goto AQZdR; Bo8P_: unset($subject["\151\144"]); goto ecZ2X; qNDTx: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto iZqjB; EFxk_: if (!$subjectStandardLatitude["\163\x74\141\x6e\144\x61\x72\x64\137\151\x64"]) { goto rcOVK; } goto LQG2R; G6rjz: Db::table("\x73\165\142\x6a\145\143\x74\x5f\x73\x74\141\x6e\x64\x61\162\144\137\154\141\164\151\x74\165\x64\x65")->insert($subjectStandardLatitude); goto MMKsv; MMKsv: YMHy6: goto G2CLA; DiTI1: rcOVK: goto G6rjz; LQG2R: $subjectStandardLatitude["\163\x74\x61\156\x64\x61\x72\144\137\151\x64"] = $subjectStandardsNew[$subjectStandardLatitude["\x73\164\x61\x6e\x64\x61\162\x64\x5f\x69\144"]]["\151\144"]; goto DiTI1; QFr_I: $subjectStandardLatitude["\x73\x75\142\x6a\145\x63\x74\x5f\x69\144"] = $subjectIdNew; goto EFxk_; iZqjB: unset($subjectStandardLatitude["\x69\144"]); goto QFr_I; G2CLA: } goto ekoV2; VMO5h: foreach ($subjectItems as $subjectItem) { goto rkbu6; GWHTl: hKpr8: goto Pi2E_; vSUis: e76kR: goto qO3Sd; nJFpw: unset($subjectItem["\151\144"]); goto jZ5s4; adSE6: $i++; goto GtN9D; GtN9D: goto rua1t; goto vSUis; qO3Sd: $subjectItemIdNew = Db::table("\x73\165\142\x6a\145\x63\x74\137\151\x74\x65\x6d")->insertGetId($subjectItem); goto NyTvy; eU3KT: $i = 1; goto gNU12; jZ5s4: $subjectItem["\163\x75\x62\x6a\x65\143\164\137\x69\144"] = $subjectIdNew; goto lsHdk; prl7Z: $subjectItemsNew[$subjectItemId] = $subjectItem; goto GWHTl; lsHdk: $subjectItem["\151\155\x61\147\145"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subjectItem["\151\155\141\x67\145"])); goto eU3KT; Gjpzs: if (!($i <= 12)) { goto e76kR; } goto rsiGR; rkbu6: $subjectItemId = $subjectItem["\x69\x64"]; goto nJFpw; rsiGR: $subjectItem["\151\155\x61\x67\145\137" . $i] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subjectItem["\x69\x6d\141\147\145\x5f" . $i])); goto adSE6; NyTvy: $subjectItem["\151\144"] = $subjectItemIdNew; goto prl7Z; gNU12: rua1t: goto Gjpzs; Pi2E_: } goto s0h9V; ekoV2: DSFvy: goto dQuOG; l5Tgu: } public function duplicateSubject($subjectId) { goto fFm1w; f9PlF: X2VTp: goto iJRDl; guY7D: if (!empty($subject)) { goto nfq0U; } goto KoGqa; zXAwR: $subjectItems = Db::table("\163\165\142\x6a\x65\143\164\137\151\x74\145\x6d")->where("\163\165\x62\152\x65\143\x74\x5f\x69\144", $subjectId)->field("\52")->select(); goto YpA2a; KoGqa: exception("\346\x97\xa0\346\xb3\225\346\x89\xbe\xe5\210\xb0\351\207\x8f\xe8\xa1\250"); goto aNYHM; YpA2a: foreach ($subjectItems as $subjectItem) { goto xtMGW; QEz7f: $subjectItemsNew[$subjectItemId] = $subjectItem; goto NgueJ; xtMGW: $subjectItemId = $subjectItem["\151\x64"]; goto MV_q0; FdAb3: $subjectItem["\163\x75\x62\x6a\x65\x63\x74\137\x69\144"] = $subjectIdNew; goto yCqAj; yCqAj: $subjectItemIdNew = Db::table("\x73\x75\x62\x6a\x65\x63\164\137\x69\x74\x65\155")->insertGetId($subjectItem); goto s_5uO; s_5uO: $subjectItem["\151\x64"] = $subjectItemIdNew; goto QEz7f; MV_q0: unset($subjectItem["\151\x64"]); goto FdAb3; NgueJ: czGNG: goto CGVgj; CGVgj: } goto CS6Ja; poQvm: fqYRn: goto x7dcF; uEF_1: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto SBY92; tL0hg: $subjectStandardLatitude["\163\165\x62\x6a\145\x63\x74\137\x69\x64"] = $subjectIdNew; goto lLd8Y; SBY92: unset($subjectStandardLatitude["\151\144"]); goto tL0hg; SPbaf: Db::table("\x73\165\x62\152\145\143\x74\137\x73\x74\141\x6e\144\x61\162\x64\x5f\154\141\x74\x69\x74\x75\x64\x65")->insert($subjectStandardLatitude); goto LOAsF; lLd8Y: $subjectStandardLatitude["\x73\x74\141\156\144\141\x72\144\x5f\151\x64"] = 0; goto SPbaf; LOAsF: gnOSy: goto BhuO_; BhuO_: } goto x7Sv4; JF53w: $subject["\160\x61\x72\164\151\143\x69\160\141\156\164\x73\x5f\x73\x68\157\167"] = 0; goto Jd0eB; dUc2O: $subjectIdNew = Db::table("\x73\x75\142\x6a\145\x63\164")->insertGetId($subject); goto m963W; nyEB_: foreach ($subjectStandardsNew as $subjectStandardId => $subjectStandardNew) { goto LR2s2; Wrimj: TRGVb: goto M2rGo; M2rGo: njZy9: goto la1EO; LR2s2: $subjectStandardLatitudes = Db::table("\x73\165\142\152\x65\x63\164\137\x73\164\x61\x6e\x64\141\x72\x64\x5f\x6c\141\x74\x69\x74\x75\144\145")->where(["\x73\x75\142\152\145\x63\164\x5f\x69\x64" => $subjectId, "\x73\164\x61\x6e\144\141\x72\144\137\x69\144" => $subjectStandardId])->field("\52")->select(); goto ecZIm; ecZIm: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto Kp6IH; QBmPT: K5e5C: goto xgmB9; iLe0M: $subjectStandardLatitude["\163\165\142\x6a\x65\x63\x74\137\151\144"] = $subjectIdNew; goto hUhqg; kGfvN: Db::table("\x73\165\x62\x6a\x65\143\x74\x5f\163\x74\x61\x6e\144\x61\162\x64\x5f\x6c\141\164\x69\x74\x75\144\145")->insert($subjectStandardLatitude); goto QBmPT; Kp6IH: unset($subjectStandardLatitude["\151\x64"]); goto iLe0M; hUhqg: $subjectStandardLatitude["\163\x74\141\156\x64\141\x72\144\137\x69\144"] = $subjectStandardNew["\151\x64"]; goto kGfvN; xgmB9: } goto Wrimj; la1EO: } goto wjc4W; DqYW1: $subjectCategories = Db::table("\x73\165\x62\152\145\143\x74\x5f\143\141\164\x65\x67\157\x72\x79\x5f\x72\145\154\141\x74\x65")->where("\163\165\142\152\145\x63\x74\137\x69\144", $subjectId)->field("\x2a")->select(); goto gxzzC; OjiK1: $subject["\165\x6e\151\137\x61\x70\x70"] = 0; goto dUc2O; z2cRg: unset($subject["\155\157\144\x69\x66\171\137\x74\151\x6d\145"]); goto odpLq; Fq_Om: $subjectItemStandards = Db::table("\163\x75\142\152\145\x63\164\137\151\x74\145\155\x5f\x73\164\141\x6e\144\x61\162\x64")->where("\x73\165\142\152\145\x63\164\x5f\x69\x64", $subjectId)->field("\x2a")->select(); goto insei; x7Sv4: qBirm: goto nyEB_; f1ISY: unset($subject["\151\144"]); goto VZl8R; gxzzC: foreach ($subjectCategories as $subjectCategory) { goto w6OnJ; zOUFD: qMSEG: goto roLW7; w6OnJ: $subjectCategory["\163\x75\x62\152\145\x63\x74\x5f\151\x64"] = $subjectIdNew; goto ZmoXJ; ZmoXJ: Db::table("\x73\x75\x62\x6a\x65\143\164\x5f\143\141\x74\x65\147\157\x72\x79\x5f\162\x65\154\141\164\145")->insert($subjectCategory); goto zOUFD; roLW7: } goto f9PlF; wjc4W: TkUQa: goto Fq_Om; y_Elt: $subject["\x73\157\x72\164"] = 1000; goto jbzJF; insei: foreach ($subjectItemStandards as $subjectItemStandard) { goto EBasb; d4af3: $subjectItemStandard["\163\x75\x62\152\145\x63\164\x5f\151\x64"] = $subjectIdNew; goto WuZkF; ZHqO2: Db::table("\x73\x75\142\x6a\x65\x63\164\x5f\151\164\x65\x6d\x5f\x73\164\141\x6e\x64\141\x72\x64")->insert($subjectItemStandard); goto SjbPm; qQKox: $subjectItemStandard["\163\x74\141\x6e\144\141\x72\x64\x5f\x69\144"] = $subjectStandardsNew[$subjectItemStandard["\x73\164\x61\x6e\144\141\x72\x64\137\151\x64"]]["\x69\x64"]; goto ZHqO2; SjbPm: bAZCY: goto CL9_z; WuZkF: $subjectItemStandard["\151\164\145\155\137\x69\x64"] = $subjectItemsNew[$subjectItemStandard["\151\164\145\155\x5f\x69\144"]]["\x69\x64"]; goto qQKox; EBasb: unset($subjectItemStandard["\x69\144"]); goto d4af3; CL9_z: } goto JJL0U; C3Ola: $subjectStandards = Db::table("\x73\x75\x62\x6a\x65\x63\x74\x5f\163\164\141\156\x64\141\x72\x64")->where("\x73\x75\142\x6a\x65\143\164\x5f\x69\144", $subjectId)->field("\x2a")->select(); goto LHzHp; OoyDa: $subjectStandardsNew = []; goto C3Ola; VbjrK: $subject["\160\x61\162\164\151\143\151\160\141\x6e\x74\x73"] = 0; goto JF53w; Jd0eB: $subject["\164\x6f\164\x61\154\x5f\141\155\x6f\x75\x6e\164"] = 0; goto Wis38; CS6Ja: FbcJH: goto OoyDa; x7dcF: $subjectStandardLatitudes = Db::table("\163\x75\142\x6a\145\x63\164\x5f\x73\164\141\x6e\144\x61\162\144\137\x6c\x61\164\151\x74\x75\x64\145")->where(["\163\x75\142\x6a\x65\143\164\137\x69\x64" => $subjectId, "\163\164\141\x6e\144\141\162\x64\137\151\x64" => 0])->field("\x2a")->select(); goto uEF_1; fFm1w: $subject = Db::table("\163\165\x62\x6a\145\x63\164")->where("\x69\144", $subjectId)->field("\x2a")->find(); goto guY7D; VZl8R: $subject["\163\156"] = generateSubjectSn(); goto fmKy9; aNYHM: nfq0U: goto f1ISY; iJRDl: OperationLogs::I()->subjectLog("\xe5\244\x8d\345\x88\xb6\351\x87\x8f\xe8\xa1\xa8\40\x2d\x20{$subject["\156\x61\155\x65"]}", beautifyLogArray($subject, [], "\163\x75\x62\152\x65\x63\164"), OperationLogs::OPT_ADD_TYPE, $subjectIdNew); goto cf3c0; S9Lt1: $subject["\161\162\x63\x6f\x64\x65"] = ''; goto OjiK1; odpLq: $subject["\x73\x74\x61\164\x75\x73"] = IndexDefs::ENTITY_DRAFT_STATUS; goto WOtYv; Wis38: $subject["\144\x65\154\x65\164\x65\x5f\x66\x6c\x61\147"] = 0; goto S9Lt1; m963W: $subjectItemsNew = []; goto zXAwR; JJL0U: CfI0j: goto DqYW1; WOtYv: $subject["\154\x61\x62\x65\x6c"] = ''; goto VbjrK; LHzHp: foreach ($subjectStandards as $subjectStandard) { goto DfGrl; Uqexr: $subjectStandard["\x69\x64"] = $subjectStandardIdNew; goto ave2i; DfGrl: $subjectStandardId = $subjectStandard["\151\x64"]; goto c3bQk; c3bQk: unset($subjectStandard["\x69\144"]); goto ruIQ1; ruIQ1: $subjectStandard["\x73\165\x62\x6a\x65\x63\x74\137\151\144"] = $subjectIdNew; goto R6l9t; R6l9t: $subjectStandardIdNew = Db::table("\163\x75\x62\x6a\145\143\164\137\163\164\x61\x6e\x64\x61\162\144")->insertGetId($subjectStandard); goto Uqexr; mi0zc: tUWRT: goto MQLHJ; ave2i: $subjectStandardsNew[$subjectStandardId] = $subjectStandard; goto mi0zc; MQLHJ: } goto poQvm; jbzJF: unset($subject["\143\162\x65\141\164\145\137\164\x69\155\145"]); goto z2cRg; fmKy9: $subject["\x63\x75\x72\x72\x65\x6e\x74\137\x70\x72\x69\143\x65"] = 0; goto y_Elt; cf3c0: } }
