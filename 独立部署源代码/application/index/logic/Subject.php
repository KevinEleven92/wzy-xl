<?php
 namespace app\index\logic; use think\Log; use think\Db; use app\index\model\Subject as SubjectModel; use app\index\logic\Attachments as AttachmentsLogic; use app\index\logic\Defs as IndexDefs; use app\Defs; use app\index\service\OperationLogs; use app\index\service\RequestContext; use app\common\service\WException; use app\index\service\Wzyer as WzyerService; use app\index\service\EventLogs as EventLogsService; use report\algo\Ai as AiAlgo; class Subject extends Base { protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto ecj_H; amnfb: tyGfg: goto vfZCI; UsgmV: $conditions["\x64\145\x6c\x65\164\145\137\146\x6c\141\x67"] = $search["\x64\x65\154\145\x74\x65\137\146\x6c\141\x67"]; goto UrJRs; OlZem: BWrSr: goto Ol6vI; RTKV1: ezbx2: goto UX7nc; BG0oZ: $order = "\x73\157\x72\x74\40" . $order . "\54\x20\143\162\x65\x61\164\x65\137\x74\x69\x6d\145\40\x64\145\x73\x63"; goto UzHep; tO7BH: if ($sort == "\x73\157\162\164") { goto HAS_l; } goto HeCDC; XwbFm: goto pqEDg; goto EJAUW; vaFI2: Fb5rx: goto VZSyW; nOTcp: $conditions = []; goto PW7I2; VZSyW: goto BWrSr; goto RTKV1; huKv2: iTogA: goto uFchm; XB1VO: cHPon: goto XwbFm; PW7I2: if (empty($search["\x74\171\x70\145"])) { goto HtrQz; } goto oa_CW; FUQqD: PrcQ2: goto nOTcp; NK5su: $conditions["\154\x61\142\145\154"] = ["\154\151\153\x65", "\x25{$search["\154\x61\142\x65\154"]}\45"]; goto GrL5x; Nn4Qa: $order = "\x63\165\162\162\x65\x6e\164\137\x70\x72\151\x63\145\40" . $order . "\x2c\x20\143\x72\145\141\x74\x65\137\x74\151\155\x65\40\144\145\163\143"; goto FUQqD; wQQBC: $conditions["\156\141\155\145"] = ["\154\x69\x6b\x65", "\45{$search["\x6e\x61\x6d\x65"]}\x25"]; goto uOVIm; hvU5D: goto PrcQ2; goto LexQg; I2m5I: $conditions["\144\x65\x6c\145\164\x65\137\x66\x6c\x61\147"] = 0; goto ktY70; ac0ma: goto cHPon; goto Fq7d6; bBGkS: $conditions["\x73\x74\x61\164\165\163"] = $search["\163\164\x61\164\x75\x73"]; goto amnfb; fB3FI: EPQM5: goto CtM21; vYYMc: $order = "\x74\157\164\141\154\x5f\x61\x6d\x6f\165\156\x74\40" . $order . "\x2c\x20\143\162\145\x61\x74\145\x5f\x74\x69\155\x65\x20\144\x65\x73\x63"; goto XB1VO; EJAUW: vfF3m: goto cP_46; uFchm: $conditions["\151\x64"] = ["\151\156", $subjectIds]; goto eSaQi; Fy4u4: pqEDg: goto hvU5D; ZN1oL: if ($sort == "\160\141\x72\164\x69\143\x69\160\141\x6e\164\163") { goto vfF3m; } goto EQnyH; w4NPT: if (!empty($subjectIds)) { goto iTogA; } goto UKNhB; Mtnit: HtrQz: goto PwZEy; UX7nc: $order = "\x73\x74\x61\164\165\x73\x20" . $order . "\x2c\x20\x63\x72\x65\141\x74\x65\x5f\x74\x69\155\145\x20\144\x65\163\x63"; goto OlZem; EQnyH: if ($sort == "\x74\157\164\x61\x6c\x5f\141\155\157\165\156\x74") { goto EaqCE; } goto tO7BH; I6Qwd: $subjectIds = Db::table("\163\165\x62\152\x65\143\x74\x5f\x63\141\164\145\x67\157\x72\171\137\x72\145\x6c\x61\x74\145")->where(["\x63\141\x74\x65\147\157\162\x79\x5f\151\x64" => $search["\x63\141\164\x65\147\157\x72\171\x5f\x69\x64"]])->column("\x73\x75\x62\152\x65\x63\x74\137\151\x64"); goto w4NPT; vfZCI: if (!isset($search["\x64\145\x6c\145\164\x65\x5f\x66\154\x61\x67"])) { goto aWM2g; } goto UsgmV; K_6vL: foreach ($records as &$record) { goto G6HTb; G6HTb: $record["\x63\141\164\145\x67\x6f\162\171"] = $this->getCategoryNameStr($record["\151\x64"]); goto mte3S; ZMoyj: $record["\142\x61\x6e\156\x65\x72\x5f\151\x6d\x67"] = generateThumbnailUrl($record["\142\x61\x6e\156\145\162\137\x69\155\x67"], 100); goto WVO36; mte3S: $record["\151\164\145\155\137\x6e\165\155"] = Db::table("\163\165\142\152\145\143\x74\137\151\x74\x65\155")->where("\x73\165\142\x6a\145\143\x74\137\x69\144", $record["\151\x64"])->count(); goto xPEIR; xPEIR: $record["\x69\155\141\x67\x65\x5f\165\x72\x6c"] = generateThumbnailUrl($record["\151\x6d\141\x67\145\137\165\162\x6c"], 100); goto ZMoyj; WVO36: VisYE: goto YO4Ws; YO4Ws: } goto fB3FI; Ol6vI: goto ysGGR; goto dW2gC; eSaQi: kIhXZ: goto DflPI; UrJRs: goto QasC5; goto nkcev; l9c7y: if ($sort == "\x72\x61\164\151\x6e\147") { goto ZFEdR; } goto EyHyw; uOVIm: cc76T: goto x926b; CtM21: return ["\164\157\164\x61\154" => $totalCount, "\x72\x6f\x77\x73" => $records]; goto lGUPs; HeCDC: if ($sort == "\163\164\141\x74\165\163") { goto ezbx2; } goto l9c7y; oa_CW: $conditions["\164\x79\x70\x65"] = $search["\164\171\160\145"]; goto Mtnit; cP_46: $order = "\x70\141\162\x74\x69\x63\151\x70\x61\x6e\x74\x73\x20" . $order . "\x2c\x20\x63\162\145\x61\x74\x65\137\164\x69\155\x65\x20\x64\x65\163\143"; goto Fy4u4; psD17: ZFEdR: goto LWgKb; DflPI: if (emptyInArray($search, "\156\141\155\145")) { goto cc76T; } goto wQQBC; Tq9fU: goto Fb5rx; goto psD17; dW2gC: HAS_l: goto BG0oZ; EyHyw: $order = "\x73\157\x72\x74\x20\141\163\143\x2c\x20\143\x72\145\141\164\x65\x5f\164\151\155\145\40\144\x65\163\143"; goto Tq9fU; UKNhB: return ["\164\x6f\164\141\x6c" => 0, "\162\x6f\167\x73" => []]; goto huKv2; UzHep: ysGGR: goto ac0ma; CBwun: $totalCount = Db::table("\163\x75\142\x6a\x65\143\x74")->where($conditions)->count(); goto iSbvs; iSbvs: $records = Db::table("\163\165\x62\x6a\145\x63\x74")->where($conditions)->page($page, $rows)->order($order)->field("\52")->select(); goto K_6vL; Fq7d6: EaqCE: goto vYYMc; PwZEy: if (emptyInArray($search, "\x63\141\x74\145\x67\157\x72\x79\x5f\x69\144")) { goto kIhXZ; } goto I6Qwd; LWgKb: $order = "\162\141\164\151\156\x67\x20" . $order . "\x2c\40\x63\x72\x65\141\x74\x65\x5f\164\x69\155\x65\40\x64\145\x73\x63"; goto vaFI2; x926b: if (emptyInArray($search, "\154\141\142\145\x6c")) { goto EfkW_; } goto NK5su; nkcev: aWM2g: goto I2m5I; GrL5x: EfkW_: goto H2zb1; H2zb1: if (emptyInArray($search, "\163\x74\x61\164\165\163")) { goto tyGfg; } goto bBGkS; ecj_H: if ($sort == "\x63\x75\162\162\x65\156\x74\137\x70\x72\151\143\145") { goto hGXD0; } goto ZN1oL; LexQg: hGXD0: goto Nn4Qa; ktY70: QasC5: goto CBwun; lGUPs: } public function getAvailableCategories() { return Db::table("\143\141\164\x65\x67\x6f\162\x69\x65\x73")->order("\151\144\x20\x61\x73\x63")->column("\151\x64\54\156\141\x6d\145\54\x73\164\x61\x74\165\x73\x2c\x69\155\x67\x5f\165\x72\154"); } public function getCategoryNameStr($id) { goto cDGn7; cDGn7: $names = Db::table("\x73\165\x62\x6a\145\x63\x74\x5f\x63\141\164\x65\x67\157\x72\171\x5f\x72\x65\x6c\x61\164\145")->alias("\123\103\x52")->join("\x63\x61\x74\145\x67\x6f\x72\x69\145\163\40\103", "\123\x43\x52\x2e\x63\141\x74\145\x67\157\x72\x79\x5f\151\x64\x3d\x43\56\x69\x64\x20\x61\x6e\144\40\123\x43\122\56\163\x75\x62\152\145\x63\164\x5f\x69\144\75" . $id)->column("\x43\x2e\156\141\x6d\145"); goto y87ui; y87ui: if (!empty($names)) { goto l6Eqr; } goto hEx2j; sCpg6: return implode("\54", $names); goto rHZ7D; VfceZ: l6Eqr: goto sCpg6; hEx2j: return ''; goto VfceZ; rHZ7D: } public function getCategoryIds($id) { goto ED_lu; Q94m6: return $categoryIds; goto gKclb; BAmYD: if (!empty($categoryIds)) { goto ipcsq; } goto gr97I; nZhjL: ipcsq: goto Q94m6; ED_lu: $categoryIds = Db::table("\x73\x75\142\x6a\x65\x63\164\x5f\143\x61\x74\x65\147\x6f\x72\171\x5f\x72\x65\x6c\141\x74\x65")->where("\163\x75\x62\x6a\145\x63\164\x5f\x69\144", $id)->column("\143\x61\164\145\147\157\162\171\137\x69\144"); goto BAmYD; gr97I: $categoryIds = []; goto nZhjL; gKclb: } public function getDefaultSubject() { return ["\x69\x64" => 0, "\151\x6d\x61\147\145\x5f\x75\162\154" => '', "\142\141\x6e\x6e\x65\162\x5f\151\x6d\147" => '', "\156\x61\155\x65" => '', "\x73\165\x62\164\151\x74\x6c\145" => '', "\x63\165\162\x72\x65\156\x74\137\160\x72\x69\143\145" => 0, "\x65\170\x70\x65\x63\164\x5f\146\x69\156\x69\x73\x68\137\164\x69\x6d\x65" => 8, "\163\165\142\x6a\x65\143\164\x5f\x64\145\x73\x63" => '', "\x73\165\142\x6a\x65\x63\164\137\164\x69\160" => '', "\x73\x74\x61\164\x75\163" => IndexDefs::ENTITY_DRAFT_STATUS, "\x72\x61\164\151\x6e\147" => 5, "\x74\x65\163\x74\137\141\154\154\157\167\x5f\x62\x61\x63\x6b" => 0, "\x74\145\163\164\x5f\x61\x6c\x6c\x6f\x77\137\x76\151\x65\x77\x5f\x72\x65\x70\157\162\x74" => 1, "\x75\x6e\151\x5f\141\160\160" => 0, "\x70\x61\x72\164\151\x63\151\160\141\x6e\164\x73\x5f\163\x68\x6f\x77" => 0, "\164\x65\163\164\x5f\141\x6c\154\157\x77\137\141\x6e\x73\x77\x65\x72\x5f\145\x6d\160\x74\171" => 0]; } public function getSubject($id) { $subject = Db::table("\163\x75\x62\152\x65\143\164")->where("\151\144", $id)->field(true)->find(); return $subject; } public function loadSubjectStandards($subjectId, $wholeFlag = false) { goto V1rip; V1rip: $rows = Db::table("\x73\165\x62\152\x65\143\x74\137\x73\164\141\156\x64\141\162\x64")->where(["\x73\x75\142\152\145\x63\164\137\x69\x64" => $subjectId])->field("\151\x64\x20\x61\163\40\163\164\141\156\144\141\162\x64\x5f\x69\144\x2c\40\154\x61\x74\151\164\x75\x64\145\x2c\x20\163\x74\141\x74\151\x73\x74\x69\x63\137\167\145\151\147\x68\x74\x5f\x6d\151\x6e\54\x20\163\x74\x61\x74\151\x73\x74\151\x63\x5f\x77\145\151\x67\150\164\x5f\x6d\141\170\54\40\163\x74\x61\156\x64\x61\x72\144\x5f\x77\145\x69\147\x68\x74\x5f\x6d\151\x6e\54\x20\x73\x74\141\156\x64\x61\162\144\137\x77\x65\x69\x67\150\164\137\x6d\x61\170\54\x20\163\x6f\162\164\x2c\40\162\145\x6d\x61\x72\153")->order("\163\157\162\164\40\x61\163\143\54\x20\x69\x64\40\141\163\x63")->select(); goto SWjzM; AS2o5: array_unshift($rows, ["\163\x74\x61\x6e\x64\x61\x72\x64\x5f\x69\144" => 0, "\x6c\141\x74\151\x74\165\x64\145" => Defs::SUBJECT_WHOLE_STANDARD, "\x69\164\145\155\x5f\x63\x6f\x75\x6e\x74" => $subject["\151\164\x65\155\x73"], "\167\145\x69\147\x68\x74\x5f\x6d\x69\156\x5f\x6d\x61\170" => $subject["\x73\x74\x61\x74\151\163\164\151\143\x5f\x77\145\151\x67\150\x74\137\x6d\x69\x6e"] . "\x20\55\x20" . $subject["\163\x74\x61\x74\x69\163\164\x69\143\137\167\145\x69\x67\x68\164\x5f\155\141\x78"], "\163\x74\x61\x6e\144\x61\x72\x64\137\x77\x65\x69\147\150\164\x5f\x6d\151\156\137\155\141\x78" => $subject["\163\164\141\x6e\144\141\x72\144\x5f\167\x65\x69\147\150\x74\137\x6d\151\x6e"] !== null && $subject["\x73\x74\141\x6e\144\141\x72\x64\x5f\167\145\x69\147\150\164\137\155\x61\x78"] !== null ? $subject["\x73\164\141\156\144\141\162\x64\137\x77\145\151\147\x68\164\x5f\x6d\x69\x6e"] . "\40\55\40" . $subject["\163\x74\141\156\144\141\162\144\x5f\x77\x65\151\x67\x68\x74\x5f\x6d\x61\x78"] : null]); goto x39Z6; S6uN3: Ey0Qh: goto RwHMX; RwHMX: return $rows; goto dAqZu; SWjzM: if ($rows) { goto wa7xq; } goto AOq1Q; OaRAd: foreach ($rows as &$row) { goto Ox9cR; jQfHh: $row["\163\x74\x61\x6e\144\x61\x72\144\137\x77\x65\151\147\150\164\x5f\x6d\151\156\137\x6d\141\170"] = null; goto z7VgT; UdtND: SSIPi: goto f2ieI; cJbMn: lZehs: goto UdtND; mvWtN: $maxWeight = $row["\163\x74\x61\164\x69\x73\164\151\x63\x5f\x77\x65\151\x67\150\x74\x5f\155\x61\170"]; goto GI5gY; l3h17: $minWeight = $row["\x73\164\x61\x74\x69\x73\x74\x69\x63\137\167\145\151\147\x68\164\137\155\151\x6e"]; goto mvWtN; tnuDM: if ($row["\x73\164\x61\x6e\144\141\x72\x64\x5f\x77\x65\x69\147\150\x74\x5f\x6d\x69\x6e"] !== null && $row["\163\164\x61\156\x64\x61\x72\144\137\x77\x65\151\x67\x68\164\137\x6d\x61\170"] !== null) { goto jTWjh; } goto jQfHh; bN047: jTWjh: goto rYwj2; XYILj: $row["\x69\164\x65\155\137\143\x6f\x75\x6e\164"] = Db::table("\x73\x75\142\x6a\x65\143\x74\137\x69\x74\145\x6d\x5f\163\x74\141\156\x64\141\162\144")->where(["\163\x75\142\x6a\145\x63\x74\137\x69\144" => $subjectId, "\x73\164\141\156\x64\141\162\144\137\x69\144" => $standardId])->count(); goto l3h17; Ox9cR: $standardId = $row["\x73\164\141\156\x64\141\162\144\137\151\x64"]; goto XYILj; z7VgT: goto lZehs; goto bN047; GI5gY: $row["\167\145\151\147\x68\164\x5f\155\151\x6e\137\x6d\x61\x78"] = $minWeight . "\40\x2d\40" . $maxWeight; goto tnuDM; rYwj2: $row["\163\x74\141\x6e\x64\x61\x72\x64\137\x77\145\151\147\x68\164\x5f\x6d\x69\x6e\137\x6d\x61\170"] = $row["\x73\164\x61\156\x64\141\x72\x64\137\167\x65\151\x67\150\x74\x5f\155\151\156"] . "\x20\55\x20" . $row["\163\x74\x61\156\x64\141\x72\x64\137\167\145\x69\147\x68\164\137\x6d\x61\x78"]; goto cJbMn; f2ieI: } goto fFdLi; x39Z6: EywB0: goto S6uN3; T3fcF: if (!$subject) { goto EywB0; } goto AS2o5; AsTZe: if (!$wholeFlag) { goto Ey0Qh; } goto ebk1V; spur_: wa7xq: goto OaRAd; fFdLi: yiwmg: goto AsTZe; AOq1Q: $rows = []; goto spur_; ebk1V: $subject = Db::table("\x73\x75\x62\152\x65\143\164")->where("\x69\x64", $subjectId)->field("\151\x74\145\x6d\163\x2c\40\x73\164\x61\164\151\163\164\x69\x63\x5f\167\x65\x69\147\x68\x74\137\x6d\x69\156\54\40\163\x74\x61\164\x69\163\x74\151\143\x5f\x77\145\x69\x67\150\x74\x5f\155\141\x78\x2c\x20\163\x74\141\156\x64\141\x72\x64\x5f\x77\145\x69\147\150\x74\x5f\x6d\x69\x6e\x2c\x20\163\164\x61\x6e\144\x61\x72\x64\137\x77\x65\151\x67\150\164\137\155\x61\x78")->find(); goto T3fcF; dAqZu: } public function getSubjectStandard($id) { $standard = Db::table("\163\165\x62\152\x65\143\x74\x5f\x73\164\x61\x6e\144\x61\x72\144")->where("\x69\x64", $id)->field(true)->find(); return $standard; } public function saveSubjectStandard($subjectId, $standardId, $formData) { goto yAk9I; N30cz: Bnc5J: goto FKi6U; XZ5sk: Db::table("\x73\x75\142\x6a\x65\143\x74\x5f\163\164\x61\156\144\x61\162\x64")->insert($formData); goto N30cz; a5Ksa: goto Bnc5J; goto FooCo; FooCo: viqbd: goto k3jQx; k3jQx: $formData["\x73\x75\142\x6a\x65\x63\164\x5f\x69\144"] = $subjectId; goto XZ5sk; yAk9I: if (empty($standardId)) { goto viqbd; } goto SDAbe; SDAbe: Db::table("\x73\x75\142\x6a\x65\x63\164\137\163\164\x61\156\144\x61\x72\144")->where(["\x69\144" => $standardId])->update($formData); goto ttDbb; ttDbb: Db::table("\x73\x75\142\152\x65\x63\164\137\163\164\141\156\144\141\x72\144\137\x6c\141\164\151\x74\x75\x64\145")->where(["\163\x74\x61\156\144\x61\x72\144\x5f\151\x64" => $standardId])->update(["\x6c\141\164\151\164\x75\144\145" => $formData["\x6c\x61\164\x69\x74\x75\x64\145"]]); goto a5Ksa; FKi6U: } public function removeSubjectStandard($subjectId, $standardId) { goto dKcqp; dKcqp: Db::table("\163\165\142\x6a\x65\143\164\x5f\163\x74\141\x6e\x64\x61\x72\x64")->where(["\151\144" => $standardId])->delete(); goto pa27J; m18hB: $this->updateSubjectStandardMinMax($subjectId); goto erLKJ; wyiwi: Db::table("\x73\165\142\152\145\143\x74\137\x73\164\141\156\144\141\162\144\x5f\154\141\x74\151\164\165\144\x65")->where("\x73\x74\141\x6e\x64\x61\x72\x64\x5f\x69\x64", $standardId)->delete(); goto m18hB; pa27J: Db::table("\163\165\142\x6a\145\143\x74\137\151\x74\x65\155\x5f\163\164\141\x6e\144\141\x72\144")->where("\x73\164\x61\156\144\141\x72\x64\137\151\x64", $standardId)->delete(); goto wyiwi; erLKJ: } public function saveSubject($id, $formData) { goto muAPb; g057E: foreach ($categoryIds as $categoryId) { goto ixp_y; xO3z2: ViW60: goto jbcZZ; INyst: FR_Ov: goto xO3z2; OcXXn: Db::table("\163\165\x62\x6a\x65\x63\164\x5f\x63\141\164\145\147\x6f\162\171\x5f\162\145\154\141\x74\145")->insert(["\163\165\x62\x6a\145\143\164\x5f\151\x64" => $subjectId, "\x63\x61\x74\145\147\x6f\x72\x79\137\151\x64" => $categoryId]); goto INyst; Hvk3O: if ($bExist) { goto FR_Ov; } goto OcXXn; ixp_y: $bExist = Db::table("\x73\165\x62\x6a\x65\x63\x74\137\143\x61\x74\x65\147\157\162\171\137\162\145\x6c\141\164\145")->where(["\x73\x75\142\x6a\145\143\x74\x5f\151\144" => $subjectId, "\143\x61\164\145\147\x6f\162\x79\x5f\x69\x64" => $categoryId])->find(); goto Hvk3O; jbcZZ: } goto tzoWX; uhzbZ: $subjectName = Db::table("\163\165\142\152\145\x63\164")->where(["\x69\144" => $id])->value("\x6e\x61\x6d\145"); goto Q1mfr; tzoWX: aXjI4: goto hxEtr; mkNTt: $originals = Db::table("\x73\165\x62\152\x65\x63\x74")->where(["\x69\144" => $id])->field(true)->find(); goto PcTg_; xvI5u: MdHhk: goto IWMlq; CSRkO: if ($categoryIds) { goto XyS9U; } goto dE0nH; qWjVR: $model = new SubjectModel(); goto xLdD3; pcCN5: if (empty($id)) { goto RHurg; } goto atq1i; MHFFp: if (!$imageUrl) { goto F__tq; } goto XCr0r; IWMlq: $formData["\x75\x6e\x69\x5f\x61\160\160"] = $formData["\x75\156\x69\137\141\x70\160"] ?? 0; goto lmWKe; Mxmad: HYZWf: goto W0eow; lmWKe: $formData["\x6d\x6f\x64\x69\146\171\x5f\164\x69\x6d\145"] = date("\x59\55\155\x2d\x64\x20\110\72\x69\72\163"); goto En0DY; C8qLI: cjald: goto CSRkO; gp4B3: goto HYZWf; goto trJQg; iJ2ga: nnO1i: goto mkNTt; GtsdD: F__tq: goto hOKWc; xLdD3: $formData["\x73\156"] = generateSubjectSn(); goto xvI5u; PcTg_: goto MdHhk; goto fghtj; JZE2U: $subjectId = $model->id; goto lfJoP; trJQg: RHurg: goto JZE2U; o_mHm: XyS9U: goto E6Vjy; DAOQz: $model = SubjectModel::get($id); goto LDg1f; aCR21: if (!$formData["\143\141\164\x65\x67\157\162\171\137\x69\144\163"]) { goto cjald; } goto rYvc2; En0DY: $imageUrl = autoGenerateImage($formData["\156\x61\x6d\x65"], $formData["\x69\155\x61\x67\145\137\x75\162\154"]); goto MHFFp; rYvc2: $categoryIds = explode("\x2c", $formData["\x63\x61\x74\145\x67\157\162\171\137\x69\144\163"]); goto C8qLI; XCr0r: $formData["\151\x6d\141\x67\145\137\x75\x72\x6c"] = $imageUrl; goto GtsdD; xAZsg: $model->allowField(true)->save(); goto pcCN5; dD8I4: OperationLogs::I()->subjectLog("\xe6\x96\260\xe5\xa2\x9e\351\207\x8f\350\xa1\xa8\40\55\x20{$subjectName}", beautifyLogArray($formData, [], "\163\x75\x62\152\145\143\x74"), OperationLogs::OPT_ADD_TYPE, $subjectId); goto Mxmad; LDg1f: if ($model) { goto nnO1i; } goto eJ8qW; W0eow: $categoryIds = []; goto aCR21; E6Vjy: Db::table("\163\x75\x62\x6a\145\x63\x74\137\x63\141\164\145\x67\x6f\162\x79\137\162\145\x6c\141\x74\145")->where(["\x73\x75\142\x6a\145\x63\x74\x5f\151\144" => $subjectId, "\143\141\x74\145\x67\x6f\x72\x79\137\x69\144" => ["\156\x6f\x74\x20\x69\x6e", $categoryIds]])->delete(); goto MyInm; Rl8KE: goto lViMJ; goto o_mHm; eJ8qW: wexception("\xe6\x97\xa0\346\xb3\x95\xe6\211\xbe\345\x88\260\xe8\xaf\xa5\xe9\x87\217\xe8\xa1\xa8"); goto iJ2ga; dE0nH: Db::table("\163\x75\x62\152\x65\143\164\x5f\x63\141\164\145\147\x6f\x72\x79\137\162\x65\x6c\x61\164\x65")->where(["\163\x75\142\x6a\145\x63\164\137\151\x64" => $subjectId])->delete(); goto Rl8KE; Q1mfr: OperationLogs::I()->subjectLog("\344\277\256\346\224\271\xe9\207\x8f\xe8\xa1\250\x20\55\x20\x20{$subjectName}", beautifyLogArray($formData, $originals, "\x73\165\x62\152\145\x63\x74"), OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto gp4B3; hOKWc: $model->data($formData); goto xAZsg; lfJoP: $subjectName = Db::table("\x73\165\142\x6a\145\143\164")->where(["\151\144" => $subjectId])->value("\x6e\141\x6d\145"); goto dD8I4; MyInm: lViMJ: goto g057E; atq1i: $subjectId = $id; goto uhzbZ; muAPb: if (empty($id)) { goto v5nX3; } goto DAOQz; fghtj: v5nX3: goto qWjVR; hxEtr: } public function setLabel($subjectId, $label, $action) { goto U2fVy; kHYiU: fmbuV: goto e5ypK; U2fVy: $subject = Db::table("\x73\165\142\152\x65\143\x74")->where(["\151\x64" => $subjectId])->field("\x6c\141\x62\145\154\54\x20\x69\155\x61\147\145\x5f\x75\x72\154\x2c\x20\x62\x61\x6e\x6e\x65\162\x5f\151\155\x67")->find(); goto Dee1J; ZhLS8: iHCS8: goto xth2G; Dee1J: if (!empty($subject)) { goto fmbuV; } goto gg38V; gg38V: wexception("\346\227\xa0\346\xb3\x95\346\211\276\345\210\xb0\xe8\257\245\xe9\207\217\350\241\xa8"); goto kHYiU; SjMxO: if (!(empty($subject["\151\155\141\x67\145\x5f\x75\x72\x6c"]) && empty($subject["\x62\x61\x6e\x6e\x65\162\x5f\151\155\x67"]))) { goto iHCS8; } goto DNiUV; a8b3s: $value = array_filter($value, function ($v) use($label) { return $v != $label; }); goto dfteh; Jj5_p: if ($action == "\164\x72\x75\145" || $action == "\x31") { goto T6S_v; } goto a8b3s; xGxjz: T6S_v: goto G9E2z; O98rh: Db::table("\x73\x75\142\152\x65\143\x74")->where(["\x69\144" => $subjectId])->setField("\x6c\x61\142\x65\154", join("\54", $value)); goto aeWlG; xth2G: krkNJ: goto izP6I; G9E2z: if (!($label == "\x62\x61\156\156\x65\162")) { goto krkNJ; } goto SjMxO; DNiUV: wexception("\350\256\xbe\344\xb8\xba\xe8\275\xae\346\222\xad\357\xbc\x8c\xe9\x87\217\xe8\241\xa8\xe5\233\276\347\211\x87\xe4\xb8\215\xe8\203\275\344\xb8\272\347\251\xba"); goto ZhLS8; dfteh: goto SlVLj; goto xGxjz; nzaDN: $value = $value ? explode("\x2c", $value) : []; goto Jj5_p; PAAct: SlVLj: goto O98rh; izP6I: $value[] = $label; goto PAAct; e5ypK: $value = $subject["\154\x61\142\x65\154"]; goto nzaDN; aeWlG: } public function qrcode($id) { goto GALGR; OstNq: wexception("\346\x97\240\xe6\263\225\xe6\x89\xbe\xe5\x88\260\350\xaf\xa5\351\207\217\350\241\250"); goto rwW1y; GBWZh: if ($subject) { goto VPFKl; } goto OstNq; DMFpe: wexception("\345\x86\231\xe5\x85\xa5\345\x9b\xbe\xe5\203\x8f\346\226\x87\344\273\xb6\xe5\xa4\xb1\xe8\264\xa5"); goto OrWkj; gq9j6: if ($result) { goto dOcc5; } goto DMFpe; lo6Vq: if (systemSetting("\127\130\x5f\x4f\x46\106\x49\103\x45\x5f\101\x43\103\117\125\116\124\x5f\x41\120\120\x5f\x49\104")) { goto gNkcT; } goto tTmNn; AEAsz: gNkcT: goto ckpIQ; BuZvm: try { goto PN1k0; g83Xo: if (!(!$res || !isset($res["\x74\x69\143\x6b\x65\164"]))) { goto VZ0vu; } goto fAJMw; yQag4: Log::notice("\x73\165\x62\x6a\145\x63\164\40\161\162\143\157\144\145\x20\162\145\164\165\162\x6e\40" . var_export($res, true)); goto XD0c7; fAJMw: exception("\346\x8e\245\345\217\243\xe8\xbf\224\345\233\236\345\244\261\xe8\264\xa5\x2c\40" . var_export($res, true)); goto kGx7W; PN1k0: $res = $app->qrcode->forever($scene_id); goto BbjNH; BbjNH: if (!$res) { goto dPW80; } goto yQag4; Yb_7t: $url = $app->qrcode->url($res["\x74\x69\143\153\x65\x74"]); goto R8QQN; XD0c7: dPW80: goto g83Xo; kGx7W: VZ0vu: goto Yb_7t; R8QQN: } catch (\Exception $e) { wexception("\347\224\237\xe6\210\x90\345\244\xb1\xe8\264\245\xef\274\x9a" . $e->getMessage()); } goto qCrUD; dZcsm: $app = \EasyWeChat\Factory::officialAccount(config("\167\x78\56\157\x66\x66\x69\143\151\141\x6c\137\x61\x63\x63\157\165\156\164")); goto Enl3M; rwW1y: VPFKl: goto lo6Vq; qCrUD: $path = "\x2f\x71\162\143\157\144\x65\57" . $scene_id . "\56\152\160\x67"; goto GLnNe; Q2SJe: return $path; goto LkmeH; ckpIQ: wxPaySetting(); goto dZcsm; GLnNe: $result = file_put_contents(SITE_DIR . $path, file_get_contents($url)); goto gq9j6; GZfsF: Db::table("\163\165\x62\x6a\145\x63\164")->where(["\151\x64" => $id])->setField("\161\162\x63\157\144\145", $path); goto Q2SJe; OrWkj: dOcc5: goto GZfsF; tTmNn: wexception("\xe7\224\x9f\346\x88\220\345\244\261\xe8\xb4\xa5\xef\274\x9a\346\234\xaa\351\x85\215\xe7\275\256\xe5\205\254\xe4\274\x97\345\x8f\267\xe5\217\x82\xe6\225\260"); goto AEAsz; GALGR: $subject = $this->getSubject($id); goto GBWZh; Enl3M: $scene_id = "\164\145\163\164\137\x69\144\x5f" . $id; goto BuZvm; LkmeH: } public function remove($id) { goto bZ75E; bG2Xi: if ($subject) { goto e1bS7; } goto RO73S; fYAfX: e1bS7: goto s813A; oFUog: OperationLogs::I()->subjectLog("\xe5\x88\240\351\x99\xa4\xe9\207\x8f\350\xa1\250", $subject["\x6e\x61\x6d\145"], OperationLogs::OPT_DELETE_TYPE, $id); goto mRst0; s813A: Db::table("\163\x75\142\152\145\x63\x74")->where(["\x69\x64" => $id])->setField("\144\145\x6c\x65\x74\145\137\146\x6c\x61\147", "\61"); goto oFUog; RO73S: wexception("\xe6\x97\240\xe6\xb3\x95\346\211\276\345\210\xb0\xe8\xaf\245\351\x87\x8f\xe8\241\xa8"); goto fYAfX; bZ75E: $subject = $this->getSubject($id); goto bG2Xi; mRst0: } public function restore($id) { goto R4Mog; dcmY2: OperationLogs::I()->subjectLog("\xe6\201\xa2\xe5\xa4\x8d\351\207\x8f\xe8\xa1\xa8", $subject["\156\x61\x6d\x65"], OperationLogs::OPT_RESTORE_TYPE, $id); goto yTDkc; OiF10: if ($subject) { goto P3VyO; } goto oQRon; KraQh: Db::table("\x73\165\142\x6a\x65\x63\164")->where(["\x69\144" => $id])->setField("\x64\x65\154\145\x74\x65\137\146\154\x61\x67", "\60"); goto dcmY2; R4Mog: $subject = $this->getSubject($id); goto OiF10; jtGIe: P3VyO: goto KraQh; oQRon: wexception("\xe6\x97\240\346\263\225\346\x89\276\xe5\210\260\350\257\xa5\351\207\217\xe8\xa1\250"); goto jtGIe; yTDkc: } public function removeForce($id) { goto O9Ecg; dcPsm: $subjectSurvey = Db::table("\163\x75\x72\x76\145\171")->where([["\145\x78\x70", Db::raw("\106\111\116\104\x5f\x49\116\137\123\105\x54\50{$id}\x2c\40\x73\165\142\152\145\x63\164\163\51")]])->find(); goto T3Ohk; Eg3Tp: wexception("\345\xb7\262\345\217\x91\345\270\203\xe7\224\265\345\x95\x86\344\xba\xa7\xe5\223\201\xef\274\x8c\xe4\xb8\215\xe8\203\xbd\xe5\x88\xa0\351\x99\xa4"); goto Fp1rc; euDlP: wexception("\xe8\257\xa5\xe9\x87\x8f\xe8\xa1\250\xe5\205\263\350\x81\224\347\273\204\xe5\x90\210\xe9\x87\x8f\xe8\xa1\250\57\346\231\xae\346\x9f\245\xef\xbc\x8c\xe4\xb8\x8d\350\203\xbd\345\210\240\351\231\xa4"); goto rmz2M; rmz2M: OrPfl: goto Yxi5y; fQ03X: OperationLogs::I()->subjectLog("\xe7\xa1\xac\345\x88\xa0\351\x99\244\351\207\217\xe8\xa1\250", $subject["\156\x61\155\x65"], OperationLogs::OPT_DELETE_TYPE, $id); goto RgD5H; V4BXG: luJSM: goto rxIW5; T3Ohk: if (!($subjectCb || $subjectSurvey)) { goto OrPfl; } goto euDlP; D7R_g: Db::table("\x73\x75\142\152\x65\x63\164\x5f\x63\x6f\154\154\x65\143\164")->where("\x73\x75\x62\152\145\143\164\137\151\144", $id)->delete(); goto NQ2iF; NQ2iF: Db::table("\163\x75\x62\152\145\x63\164\137\x6f\162\144\x65\162")->where("\163\165\x62\152\145\143\x74\x5f\151\x64", $id)->delete(); goto gesz0; KRC0H: Db::table("\165\x6e\x69\x5f\x61\160\160\x5f\x6f\x72\x64\145\x72\163")->where("\163\x75\142\152\145\143\164\137\151\x64", $id)->delete(); goto Dl5Yh; Dl5Yh: Db::table("\x73\x75\x62\152\x65\x63\x74\x5f\151\164\145\155")->where("\x73\x75\x62\152\145\143\x74\137\151\x64", $id)->delete(); goto rSGqe; p57Rg: if (!$goods) { goto wixEl; } goto Eg3Tp; Yxi5y: $goods = Db::table("\144\151\x61\x6e\x5f\x67\x6f\x6f\x64\163")->where(["\x73\x75\142\x6a\145\x63\164\137\x69\x64" => $id])->find(); goto p57Rg; YQ1oA: wexception("\xe6\x97\xa0\346\xb3\225\346\x89\xbe\xe5\210\xb0\350\xaf\245\351\x87\x8f\350\xa1\xa8"); goto V4BXG; O9Ecg: $subject = $this->getSubject($id); goto Yfmn8; gesz0: Db::table("\163\165\142\x6a\x65\x63\164")->where("\x69\144", $id)->delete(); goto fQ03X; Fp1rc: wixEl: goto KRC0H; Yfmn8: if ($subject) { goto luJSM; } goto YQ1oA; kzAMz: Db::table("\163\x75\x62\x6a\x65\x63\x74\x5f\x73\x74\x61\x6e\x64\141\162\x64")->where("\163\x75\142\152\x65\x63\x74\137\151\144", $id)->delete(); goto lcRiI; DG3HO: Db::table("\x73\x75\x62\152\145\x63\164\x5f\x63\141\164\x65\147\157\x72\x79\x5f\x72\145\154\141\164\145")->where("\x73\x75\142\x6a\145\143\164\137\x69\x64", $id)->delete(); goto D7R_g; rxIW5: $subjectCb = Db::table("\163\165\142\152\x65\x63\164\x5f\x63\x6f\155\x62\x69\x6e\141\x74\x69\157\x6e")->where([["\145\170\x70", Db::raw("\106\111\116\x44\x5f\x49\116\137\123\x45\124\50{$id}\x2c\40\x73\165\x62\152\145\x63\164\163\x29")]])->find(); goto dcPsm; lcRiI: Db::table("\163\x75\x62\152\x65\x63\164\137\163\x74\x61\156\x64\x61\162\x64\137\x6c\141\x74\x69\164\x75\x64\x65")->where("\x73\165\x62\x6a\x65\x63\164\137\x69\144", $id)->delete(); goto DG3HO; rSGqe: Db::table("\x73\x75\x62\152\x65\x63\x74\137\x69\x74\x65\x6d\137\x73\164\141\156\144\141\162\144")->where("\x73\165\x62\x6a\x65\x63\x74\137\151\144", $id)->delete(); goto kzAMz; RgD5H: } public function saveSubjectReport($id, $formData) { goto LAK6x; aUkYN: rQvkN: goto HN28q; PGeuJ: OperationLogs::I()->subjectLog("\344\xbf\xae\xe6\x94\xb9\351\207\217\350\241\250\346\x8a\xa5\xe5\221\x8a\40\x2d\x20{$originals["\x6e\x61\155\145"]}", beautifyLogArray($formData, $originals, "\x73\165\x62\152\145\143\x74"), OperationLogs::OPT_UPDATE_TYPE, $id); goto UMX3P; HN28q: $formData["\162\x65\160\157\x72\x74\x5f\145\154\x65\155\x65\156\x74\x73"] = ''; goto Yga0x; mAkVM: if (empty($formData["\162\x65\160\157\162\x74\x5f\x65\154\x65\x6d\145\x6e\x74\x73"])) { goto rQvkN; } goto zi1J6; mWW0J: $model->data($formData); goto EQa0D; UMX3P: tNl_x: goto UcuQB; Yga0x: T9L8D: goto mWW0J; NZ2WR: $originals = Db::table("\x73\x75\x62\x6a\x65\x63\164")->where(["\x69\144" => $id])->field(true)->find(); goto mAkVM; zi1J6: $formData["\x72\145\160\x6f\162\x74\x5f\x65\x6c\145\155\x65\x6e\164\x73"] = implode("\54", $formData["\162\x65\160\x6f\x72\164\x5f\x65\x6c\x65\x6d\x65\x6e\164\163"]); goto rr0Z6; rr0Z6: goto T9L8D; goto aUkYN; LAK6x: $model = SubjectModel::get($id); goto yz9p1; EQa0D: $result = $model->allowField(true)->save(); goto dLT45; xpgkY: DRiyR: goto NZ2WR; yz9p1: if ($model) { goto DRiyR; } goto GSRFD; GSRFD: exception("\xe6\x97\xa0\xe6\xb3\x95\346\211\xbe\345\x88\xb0\350\257\xa5\351\207\x8f\350\xa1\250"); goto xpgkY; dLT45: if (!$result) { goto tNl_x; } goto PGeuJ; UcuQB: } public function updateSubjectStandardMinMax($subjectId) { goto PaEIi; PaEIi: $items = Db::table("\163\165\142\x6a\145\143\164\x5f\x69\x74\x65\155")->where("\163\165\x62\x6a\x65\143\164\x5f\x69\144", $subjectId)->column("\x69\x64\x2c\40\x74\x79\160\x65\54\40\167\145\151\x67\x68\x74\137\61\54\167\x65\x69\147\150\x74\x5f\x32\x2c\167\145\151\x67\150\164\x5f\63\x2c\x77\145\151\x67\x68\164\137\x34\x2c\167\145\x69\x67\150\164\137\x35\54\167\x65\x69\x67\x68\164\x5f\x36\x2c\x77\145\151\147\x68\x74\x5f\67\54\167\145\151\x67\x68\164\x5f\70\x2c\x77\x65\x69\147\x68\x74\x5f\x39\x2c\167\x65\151\x67\150\x74\x5f\x31\x30\54\167\x65\151\x67\150\x74\x5f\61\x31\54\x77\x65\x69\x67\x68\x74\x5f\61\x32"); goto eMJAG; f7vVq: $points = $this->calculatePointsDirect($itemWeights); goto bY2nb; zZfZ7: Db::table("\163\x75\x62\x6a\145\143\x74")->where(["\151\144" => $subjectId])->update(["\x69\x74\x65\155\163" => count($itemIds)]); goto uGs7U; tIb63: iFpz1: goto f7vVq; XWs3M: a6Z05: goto L4yud; AufeM: foreach ($latitudes as $standardId => $latitude) { goto EEIWU; v7t1H: Db::table("\163\x75\x62\x6a\145\143\164\x5f\163\x74\141\x6e\144\x61\162\144")->where(["\163\x75\142\x6a\x65\143\164\137\x69\144" => $subjectId, "\151\144" => $standardId])->update(["\x73\164\141\164\151\163\164\151\x63\x5f\167\x65\x69\147\150\164\137\155\x69\156" => 0, "\x73\164\x61\x74\151\163\164\x69\143\137\167\x65\x69\x67\150\164\137\155\141\x78" => 0]); goto AUmxU; o7dXq: Db::table("\x73\x75\x62\x6a\x65\x63\164\137\x73\164\141\x6e\x64\141\x72\144")->where(["\163\x75\142\x6a\x65\143\x74\x5f\151\x64" => $subjectId, "\x69\144" => $standardId])->update(["\x73\164\141\x74\x69\163\x74\151\x63\x5f\167\145\x69\147\150\x74\137\x6d\x69\x6e" => $weightMin, "\x73\x74\141\164\x69\x73\164\151\143\137\167\145\151\x67\x68\164\x5f\x6d\x61\170" => $weightMax]); goto DMpi3; jK63w: foreach ($records as $record) { goto jbXiv; jbXiv: $itemId = $record["\x69\164\145\155\137\x69\144"]; goto MedGl; WsgR3: GkP7Q: goto v4fn1; o5UG1: if (!($i <= 12)) { goto nR_KO; } goto AJVSX; fCzIJ: $itemWeight[] = array_sum($itemWeight); goto hLXvL; QydI6: k0iwV: goto nHklZ; IlJ5B: $i = 1; goto cxDOG; MedGl: $itemWeight = []; goto IlJ5B; fTy4V: Dl7cD: goto WsgR3; cxDOG: VtZrT: goto o5UG1; r9x2w: if ($items[$itemId]["\x74\171\x70\145"] == Defs::QUESTION_RADIO) { goto Dl7cD; } goto CZsNp; pXPgX: if (!($items[$itemId][$field] === null)) { goto k0iwV; } goto j_1b_; v4fn1: $itemWeights[] = $itemWeight; goto Nn36e; v4hc1: if (!empty($itemWeight)) { goto Ol99G; } goto mcj0H; CZsNp: if (!($items[$itemId]["\x74\x79\x70\x65"] == Defs::QUESTION_CHECKBOX)) { goto rB7Xe; } goto fCzIJ; fzIpg: Ol99G: goto r9x2w; nHklZ: $itemWeight[] = round($items[$itemId][$field] / 100, 2); goto WKnX5; WKnX5: $i++; goto xnuC3; mcj0H: goto nhSuN; goto fzIpg; j_1b_: goto nR_KO; goto QydI6; wH0W5: nR_KO: goto v4hc1; xnuC3: goto VtZrT; goto wH0W5; Nn36e: nhSuN: goto uNdBh; hLXvL: rB7Xe: goto NB0V8; AJVSX: $field = "\x77\145\151\147\x68\164\137" . $i; goto pXPgX; NB0V8: goto GkP7Q; goto fTy4V; uNdBh: } goto G_0ZI; AUmxU: goto HqGx_; goto dX05B; DMpi3: HqGx_: goto C_A1i; y_eVE: $points = $this->calculatePointsDirect($itemWeights); goto CMYNb; CMYNb: list($weightMin, $weightMax) = $points; goto o7dXq; G_0ZI: B9OnB: goto tnf3z; dX05B: pkEkO: goto y_eVE; tnf3z: if (!empty($itemWeights)) { goto pkEkO; } goto v7t1H; IUrMt: $records = Db::table("\163\165\142\x6a\145\143\164\137\151\164\145\155\x5f\x73\x74\141\x6e\x64\x61\x72\144")->where(["\x73\x75\x62\152\145\x63\x74\x5f\151\144" => $subjectId, "\163\164\141\156\144\141\162\144\137\x69\x64" => $standardId, "\x69\164\145\x6d\137\x69\144" => ["\151\156", $itemIds]])->field("\x69\x74\x65\x6d\137\151\x64")->select(); goto jK63w; EEIWU: $itemWeights = []; goto IUrMt; C_A1i: } goto XWs3M; bY2nb: list($weightMin, $weightMax) = $points; goto zZfZ7; bVHBh: foreach ($items as $item) { goto TJjzO; CtU6Y: $i = 1; goto Y4HYZ; GJuQy: Ws5ub: goto l7jry; PAkz9: ROXxf: goto BFA2W; TJjzO: $itemWeight = []; goto CtU6Y; G3GCr: z6Prq: goto i3twa; iYW8n: $field = "\x77\x65\x69\x67\150\x74\x5f" . $i; goto ZyX6w; Y4HYZ: VNBRj: goto El3jx; BFA2W: $itemWeight[] = round($item[$field] / 100, 2); goto PfojR; PfojR: $i++; goto R7yBr; jWVn2: if (!empty($itemWeight)) { goto Ws5ub; } goto ZNUSO; R7yBr: goto VNBRj; goto gD3D9; gD3D9: fLQ1s: goto jWVn2; ZyX6w: if (!($item[$field] === null)) { goto ROXxf; } goto vUZ_r; vUZ_r: goto fLQ1s; goto PAkz9; ZNUSO: goto z6Prq; goto GJuQy; El3jx: if (!($i <= 12)) { goto fLQ1s; } goto iYW8n; l7jry: $itemWeights[] = $itemWeight; goto G3GCr; i3twa: } goto tIb63; aMW0Q: $itemWeights = []; goto bVHBh; EFFeI: $latitudes = Db::table("\163\165\x62\152\x65\x63\x74\x5f\163\x74\141\x6e\x64\141\162\144")->where("\x73\165\x62\152\x65\x63\164\x5f\x69\x64", $subjectId)->order("\163\157\162\x74\x20\x61\163\x63\x2c\x20\x69\x64\40\x61\x73\x63")->column("\154\141\164\151\164\x75\144\145", "\151\x64"); goto AufeM; uGs7U: Db::table("\x73\x75\x62\x6a\145\x63\164")->where(["\x69\144" => $subjectId])->update(["\x73\164\x61\x74\x69\163\164\x69\143\x5f\x77\x65\151\x67\x68\x74\x5f\155\151\156" => $weightMin, "\x73\164\x61\164\151\x73\x74\151\x63\x5f\x77\x65\x69\x67\150\x74\137\155\x61\x78" => $weightMax]); goto EFFeI; eMJAG: $itemIds = array_keys($items); goto aMW0Q; L4yud: } protected function calculatePointsDirect($itemWeights) { goto N3xs0; DyREk: evTVX: goto MYJli; N3xs0: $pointMin = 0; goto Gk9_Y; MYJli: return [$pointMin, $pointMax]; goto GYBQ9; CgZQ1: foreach ($itemWeights as $itemWeight) { goto XCcLd; DhVAd: g1ucr: goto XljuE; XljuE: $pointMin += min($itemWeight); goto fPnp4; Cs_YC: zT0k2: goto liyE4; fPnp4: $pointMax += max($itemWeight); goto Cs_YC; XCcLd: if (!empty($itemWeight)) { goto g1ucr; } goto xzT81; xzT81: goto zT0k2; goto DhVAd; liyE4: } goto DyREk; Gk9_Y: $pointMax = 0; goto CgZQ1; GYBQ9: } public function loadLatitudes($subjectId, $standardId) { goto VxY6x; VxY6x: $rows = Db::table("\x73\165\x62\x6a\145\x63\x74\137\x73\x74\x61\x6e\x64\x61\x72\144\x5f\154\x61\x74\151\164\165\x64\x65")->where(["\x73\x75\142\152\145\x63\164\x5f\151\144" => $subjectId, "\x73\164\141\x6e\x64\x61\x72\144\137\151\x64" => $standardId])->order("\163\x74\x61\156\x64\141\x72\144\137\x69\x64\40\x61\163\x63")->field("\x2a")->select(); goto PKEz3; AUAkw: return $rows; goto ADfLw; IOaJF: iY9UG: goto AUAkw; PKEz3: foreach ($rows as &$row) { goto O37bU; qamQo: $row["\x72\145\x6d\x61\x72\x6b"] = ellipsisString($row["\162\x65\x6d\x61\x72\x6b"], 32); goto rCcqg; ulOcD: $row["\x65\170\x70\162\x65\x73\x73\x69\x6f\156"] = convertSubjectExpression($expression); goto b0PHD; O37bU: $expression = $row["\145\170\160\x72\145\163\x73\x69\157\x6e"]; goto ulOcD; b0PHD: $row["\x73\x74\x61\156\144\137\144\x65\x73\143"] = ellipsisString($row["\163\164\141\156\144\137\144\x65\163\x63"], 32); goto qamQo; rCcqg: q7Wbc: goto ofEwY; ofEwY: } goto IOaJF; ADfLw: } public function getLatitude($id) { $latitude = Db::table("\x73\x75\142\152\x65\x63\x74\137\163\x74\141\x6e\144\x61\x72\144\137\154\141\164\x69\164\165\x64\x65")->where("\151\144", $id)->field(true)->find(); return $latitude; } protected function convertExpressionJson2Value($obj, $expression) { goto csMvI; csMvI: $operator = "\x26\x26"; goto c7hzg; GEYpF: foreach ($obj["\143\150\x69\154\x64\162\x65\156"] as $index => $objChild) { goto tdtGs; sYs80: $expression .= "\51"; goto hysUY; If92K: $expression = $this->convertExpressionJson2Value($objChild, $expression); goto sYs80; yeSTp: if (!(isset($objChild["\x6f\x70"]) && isset($objChild["\x63\x68\151\154\x64\x72\145\x6e"]) && $objChild["\x63\150\x69\x6c\x64\x72\x65\x6e"])) { goto jpZZX; } goto fALkA; fALkA: $expression .= "\x28"; goto If92K; m3DU5: $expression .= $objChild["\x6f\x70"]; goto LiIta; H3Qmw: jpZZX: goto yIMi3; kJLV3: iFPGD: goto yeSTp; VSM5V: $expression .= $operator; goto mO4tG; tdtGs: if (!(isset($objChild["\146\151\x65\x6c\x64"]) && $objChild["\146\151\x65\x6c\x64"] && isset($objChild["\157\x70"]) && $objChild["\x6f\160"] && isset($objChild["\x76\141\154\165\x65"]))) { goto iFPGD; } goto ZA3Xl; ZA3Xl: $expression .= $objChild["\146\151\x65\x6c\x64"]; goto m3DU5; yIMi3: CUXV1: goto yqimb; LiIta: $expression .= $objChild["\x76\141\x6c\165\145"]; goto VSM5V; mO4tG: goto CUXV1; goto kJLV3; hysUY: $expression .= $operator; goto H3Qmw; yqimb: } goto jWqNI; ikSS1: return $expression; goto w7Ja4; LZVpO: q6kLU: goto GEYpF; EHp3Q: $expression = rtrim($expression, $operator); goto ikSS1; FBRDD: $operator = "\174\174"; goto LZVpO; c7hzg: if (!($obj["\157\160"] == "\157\162")) { goto q6kLU; } goto FBRDD; jWqNI: V_he9: goto EHp3Q; w7Ja4: } public function saveLatitude($subjectId, $standardId, $id, $formData) { goto RvhVV; txlgq: $formData["\154\x61\164\x69\164\x75\144\x65"] = $latitude; goto fzXQG; KxpiP: if ($standardId == 0) { goto ldGiw; } goto Q5EhM; jPQJB: $formData["\x73\x74\x61\x6e\144\141\162\144\x5f\151\144"] = $standardId; goto KxpiP; qiqzx: i0S2J: goto txlgq; AwoKE: wexception("\346\x97\240\346\xb3\225\346\x89\276\345\210\xb0\xe6\211\x80\345\xb1\x9e\347\x9a\x84\347\xbb\264\345\272\xa6"); goto qiqzx; fVdSS: Db::table("\x73\165\x62\152\x65\x63\x74\137\163\164\141\x6e\x64\x61\162\x64\x5f\x6c\x61\164\151\164\x75\x64\x65")->insert($formData); goto z8QeV; RvhVV: $formData["\145\170\x70\x72\x65\163\x73\x69\157\x6e\137\152\163\157\x6e"] = htmlspecialchars_decode($formData["\x65\170\x70\x72\x65\x73\x73\151\157\x6e\x5f\x6a\163\x6f\x6e"]); goto vZJNV; a2Zq7: $formData["\145\x78\x70\x72\x65\x73\x73\151\x6f\x6e"] = $expression; goto FkHK8; z8QeV: cosPZ: goto F6HqF; IsWKQ: Db::table("\x73\165\x62\x6a\145\143\164\x5f\163\x74\141\x6e\x64\141\x72\144\x5f\x6c\141\x74\151\164\165\x64\145")->where("\151\x64", $id)->update($formData); goto y_Ycs; UgBFd: ldGiw: goto re8iR; fzXQG: goto wg4Jh; goto UgBFd; vZJNV: $expression = $this->convertExpressionJson2Value(json_decode($formData["\145\170\160\162\x65\163\163\151\x6f\156\x5f\152\x73\x6f\156"], true), ''); goto a2Zq7; Q5EhM: $latitude = Db::table("\x73\x75\142\x6a\x65\143\164\137\163\164\x61\x6e\144\141\162\x64")->where(["\151\144" => $standardId])->value("\154\x61\x74\x69\164\x75\144\x65"); goto Zxxqu; re8iR: $formData["\154\x61\164\x69\x74\x75\x64\x65"] = Defs::SUBJECT_WHOLE_STANDARD; goto RH1AI; k3Zba: vV6br: goto fVdSS; y_Ycs: goto cosPZ; goto k3Zba; Zxxqu: if (!($latitude === null)) { goto i0S2J; } goto AwoKE; RH1AI: wg4Jh: goto fT45b; fT45b: if (empty($id)) { goto vV6br; } goto IsWKQ; FkHK8: $formData["\163\165\x62\152\x65\x63\164\137\x69\144"] = $subjectId; goto jPQJB; F6HqF: } public function removeLatitude($id) { Db::table("\x73\165\142\x6a\145\143\164\x5f\x73\164\x61\x6e\x64\x61\162\144\137\154\141\x74\x69\x74\165\x64\145")->where(["\x69\144" => $id])->delete(); } public function loadSubjectItems($subjectId) { goto lpWKI; fhUMZ: return $rows; goto tspfX; xhW16: o2oj9: goto fhUMZ; IvTut: $items = Db::table("\x73\x75\x62\x6a\x65\x63\164\x5f\x69\x74\145\155")->where(["\163\x75\x62\152\145\143\x74\137\151\144" => $subjectId])->field(true)->order("\x73\157\x72\164\40\141\163\x63\54\x20\x69\144\40\141\163\x63")->select(); goto rtAmL; lpWKI: $rows = []; goto IvTut; rtAmL: foreach ($items as $index => $item) { goto Fw2Ke; JyCUs: $row["\151\164\x65\x6d\x5f\x6f\160\164\x69\x6f\x6e"] .= strip_tags($item["\151\x74\145\x6d\x5f\x32"]); goto kfbSj; Fw2Ke: $row = ["\151\144" => $item["\x69\144"], "\151\x74\x65\x6d\137\x6f\160\x74\x69\157\x6e" => $index + 1 . "\x2e\x20" . strip_tags($item["\151\x74\x65\155"]), "\143\150\x69\154\144\162\x65\x6e" => [], "\164\171\x70\145" => $item["\164\171\x70\x65"], "\163\x6f\x72\x74" => $item["\163\157\162\x74"], "\x74\x61\x67" => $item["\164\141\147"]]; goto ZzZft; fxNyq: $optionIndex++; goto UbKam; E4Otg: $row["\x69\164\x65\x6d\x5f\157\160\x74\151\x6f\156"] .= "\x3b\x20"; goto JyCUs; CGhj_: $option["\x69\155\x61\147\145"] = "\74\x69\x6d\x67\40\143\x6c\x61\163\x73\x3d\42\155\x79\x2d\x31\x22\40\163\x72\x63\x3d\x22" . generateThumbnailUrl($item[$imageField], 100, "\x2f\x73\164\x61\164\151\143\57\x69\155\x67\x2f\x64\x6f\164\x2e\160\156\x67") . "\x22\x20\163\x74\x79\x6c\x65\x3d\x22\x6d\x61\170\55\x77\x69\x64\164\150\72\x31\x30\x30\x70\170\x3b\42\x3e"; goto zJ2jh; lUGMs: PqHlh: goto CrRxG; TIdfk: $imageField = "\x69\x6d\x61\x67\145\x5f" . $optionIndex; goto FNabG; DZtOw: $row["\x69\x6d\141\147\145"] = "\x3c\151\155\x67\40\x63\x6c\x61\x73\x73\x3d\x22\155\171\x2d\x31\42\x20\163\162\143\x3d\x22" . generateThumbnailUrl($item["\151\x6d\x61\147\x65"], 100, "\57\x73\x74\x61\164\x69\143\57\x69\155\147\57\144\x6f\164\x2e\x70\156\x67") . "\x22\x20\x73\164\x79\x6c\x65\75\42\155\141\x78\x2d\x77\151\x64\164\x68\x3a\x31\x30\60\x70\x78\73\x22\x3e"; goto UsS4c; iyhz9: $latitudes = Db::table("\163\165\142\x6a\145\x63\164\x5f\151\x74\x65\155\x5f\163\164\141\x6e\144\141\162\x64")->alias("\123\x49\123")->join("\x73\x75\142\152\x65\x63\164\137\x73\x74\x61\x6e\x64\141\x72\x64\40\123\123", "\123\x49\123\x2e\x73\164\x61\156\x64\x61\x72\144\x5f\151\144\75\123\123\56\x69\144")->where(["\123\111\x53\56\163\x75\x62\x6a\x65\x63\x74\137\x69\x64" => $subjectId, "\x53\111\123\x2e\x69\x74\145\155\x5f\x69\144" => $item["\151\144"]])->column("\x53\123\x2e\154\141\164\x69\x74\165\x64\145"); goto AQoXP; L0rmG: GtZu_: goto qLPMg; SyRQ5: if (!$item[$imageField]) { goto d4eVe; } goto CGhj_; zJ2jh: d4eVe: goto q1dqp; DAIvY: xTuFQ: goto AnDOb; J1pLR: $optionIndex = 1; goto L0rmG; JaoXK: S41Qt: goto skoHE; AnDOb: $rows[] = $row; goto lUGMs; skoHE: $option = ["\x69\x64" => $item["\x69\144"] . "\137" . $optionIndex, "\151\x74\x65\x6d\137\x6f\x70\x74\x69\x6f\x6e" => strip_tags($item[$optionField]), "\x77\x65\151\x67\x68\x74" => round($item[$weightField] / 100, 2), "\x6e\x61\x74\x75\162\145" => $item[$natureField]]; goto SyRQ5; UsS4c: ZzgV5: goto iyhz9; qLPMg: if (!($optionIndex <= 12)) { goto xTuFQ; } goto R2aXg; kfbSj: zFlZg: goto NzPZE; OOfpt: $weightField = "\x77\x65\151\147\x68\x74\137" . $optionIndex; goto LtY7z; AQoXP: $row["\163\164\x61\x6e\144\x61\x72\x64\x73"] = implode("\x2c\x20", $latitudes); goto J1pLR; LtY7z: $natureField = "\156\141\x74\x75\162\145\137" . $optionIndex; goto TIdfk; R2aXg: $optionField = "\157\160\x74\x69\x6f\x6e\137" . $optionIndex; goto OOfpt; FNabG: if (!(empty($item[$optionField]) && empty($item[$imageField]))) { goto S41Qt; } goto FBYNQ; q1dqp: $row["\143\x68\x69\154\144\162\x65\156"][] = $option; goto fxNyq; NzPZE: if (!$item["\151\x6d\141\147\x65"]) { goto ZzgV5; } goto DZtOw; ZzZft: if (!$item["\x69\x74\145\x6d\137\x32"]) { goto zFlZg; } goto E4Otg; FBYNQ: goto xTuFQ; goto JaoXK; UbKam: goto GtZu_; goto DAIvY; CrRxG: } goto xhW16; tspfX: } public function getSubjectItem($subjectId, $itemId) { goto YJU43; rCQMC: MnFmD: goto g7uXC; UdRO2: if ($standardIds) { goto eDBdf; } goto GO2mg; wduWd: $item["\167\145\151\x67\150\164\x5f" . $index] = round($item["\167\145\x69\147\x68\x74\x5f" . $index] / 100, 2); goto kPi2Y; kPi2Y: goto MnFmD; goto WDnhW; XBMzo: nKl2Z: goto dDtWn; yiXBM: $item["\163\164\x61\x6e\x64\x61\x72\x64\163"] = $standardIds; goto N1Jfk; cdNgG: eDBdf: goto yiXBM; dDtWn: $index = 1; goto huNur; KPCEt: goto UA530; goto SY7Te; nSEK5: if (!($index <= 12)) { goto I9yez; } goto JOGs_; SY7Te: I9yez: goto JnOK4; x4K8H: $item["\156\141\164\x75\162\145\x5f" . $index] = 0; goto rCQMC; JOGs_: $optionField = "\x6f\x70\164\x69\157\156\x5f" . $index; goto qMsYY; huNur: UA530: goto nSEK5; qMsYY: $imageField = "\x69\155\x61\x67\x65\x5f" . $index; goto TuF3H; AV34f: $item["\x77\145\x69\x67\150\x74\137" . $index] = ''; goto x4K8H; GO2mg: $standardIds = []; goto cdNgG; N1Jfk: return $item; goto a5dTL; YJU43: $item = Db::table("\x73\x75\142\x6a\145\143\x74\137\151\164\145\155")->where(["\151\144" => $itemId])->field(true)->find(); goto qEDvw; qpb1x: return null; goto XBMzo; WDnhW: LTH1E: goto AV34f; TuF3H: if (empty(trim($item[$optionField])) && empty(trim($item[$imageField]))) { goto LTH1E; } goto wduWd; JnOK4: $standardIds = Db::table("\x73\x75\142\152\x65\143\164\137\151\x74\x65\155\x5f\x73\164\141\156\144\x61\162\x64")->where(["\163\x75\x62\152\x65\143\x74\137\151\x64" => $subjectId, "\151\x74\x65\155\x5f\151\144" => $itemId])->column("\x73\x74\141\156\144\x61\162\x64\137\x69\x64"); goto UdRO2; qEDvw: if ($item) { goto nKl2Z; } goto qpb1x; g7uXC: $index++; goto KPCEt; a5dTL: } public function saveSubjectItem($subjectId, $itemId, $formData, $formOptionData, $standardIds) { goto izcgX; Dzn6f: wexception("\xe6\x97\xa0\346\xb3\x95\xe6\211\xbe\xe5\210\260\xe5\257\271\345\272\x94\xe7\x9a\x84\xe9\x87\217\xe8\xa1\xa8\xe9\241\xb9\xe7\233\xae"); goto ZNl15; dRYGk: $index++; goto qaByf; vwZMd: f026A: goto EamwK; XTNOy: goto LXQHe; goto we0nJ; yYMEk: $formOptionDataSanitized["\167\145\151\147\x68\x74\x5f" . $indexSanitized] = empty($formOptionData[$weightField]) ? 0 : $formOptionData[$weightField] * 100; goto SBwCM; KaoUm: $this->updateSubjectStandardMinMax($subjectId); goto DpM0N; IyNnp: $formOptionDataSanitized["\x6e\x61\x74\x75\162\x65\137" . $index] = null; goto dRYGk; yBRRL: $formOptionDataSanitized["\x77\x65\151\x67\x68\164\137" . $indexSanitized] = null; goto K0hj9; SBwCM: $formOptionDataSanitized["\156\141\164\x75\x72\145\x5f" . $indexSanitized] = $formOptionData[$natureField]; goto zWBu6; t3VTf: if (!($index <= 12)) { goto x1mC5; } goto MM5Px; oEh8t: $standardIds = []; goto up4vh; WK_U_: wexception("\xe6\227\240\346\xb3\225\346\x89\xbe\xe5\x88\xb0\xe5\xaf\xb9\345\272\x94\347\x9a\204\351\x87\x8f\xe8\xa1\xa8"); goto GLASH; mmDzC: if ($formData["\x74\171\x70\x65"] == Defs::QUESTION_TEXT) { goto umYz3; } goto WiI1u; BLgTe: Db::table("\x73\165\142\x6a\x65\143\x74\x5f\151\x74\x65\x6d")->where(["\x69\144" => $itemId])->update($formOptionDataSanitized); goto X3lxU; l7TwT: OperationLogs::I()->subjectLog("\345\xa2\x9e\345\212\xa0\351\x87\217\350\241\xa8\351\xa1\271\xe7\x9b\256\40\x2d\40{$subject["\156\x61\155\145"]}", $formData["\x69\x74\145\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto Y4ekY; nyXZA: umYz3: goto oEh8t; YIxl_: $imageField = "\x69\x6d\x61\147\x65\137" . $index; goto rRThZ; GX0Qp: $standardsDel = array_diff($standardIdsDb, $standardIds); goto Mr0R0; wSwny: $subjectItem = Db::table("\x73\165\142\x6a\x65\143\x74\137\x69\x74\145\x6d")->where(["\151\144" => $itemId])->find(); goto F7ZS_; Eco0X: goto tRM2t; goto hgXLJ; bmoIK: $formOptionDataSanitized["\151\155\x61\x67\145\137" . $indexSanitized] = $formOptionData[$imageField]; goto yYMEk; rtJSz: MobyG: goto GX0Qp; CA6Xq: wZeUM: goto nXzc2; we0nJ: kssbk: goto vwZMd; S1kur: goto YJSID; goto nyXZA; rmwbZ: if (!($index <= 12)) { goto kssbk; } goto YyeB7; nXzc2: $index++; goto XTNOy; F7ZS_: if (!empty($subjectItem)) { goto b7VGg; } goto Dzn6f; QrcGl: LXQHe: goto rmwbZ; NmHi_: Db::table("\163\165\x62\x6a\x65\x63\x74")->where(["\x69\x64" => $subjectId])->setInc("\x69\164\x65\155\137\x76\145\162\x73\x69\x6f\156"); goto vzwkq; CWGdD: $formOptionDataSanitized["\151\155\141\147\x65\137" . $index] = ''; goto TUyYv; GR3mw: $standardIdsDb = Db::table("\163\x75\142\x6a\145\143\164\x5f\x69\x74\145\x6d\x5f\163\x74\141\156\144\x61\162\144")->where(["\x73\165\142\x6a\145\x63\164\137\x69\x64" => $subjectId, "\151\x74\145\155\137\x69\x64" => $itemId])->column("\163\164\x61\x6e\x64\x61\x72\144\137\151\x64"); goto b6qzz; EamwK: if (!($indexSanitized <= 12)) { goto KtxiZ; } goto lZdzp; uiPdQ: if (!empty($subject)) { goto cnKaC; } goto WK_U_; GMEee: QZhDu: goto t3VTf; zWdHN: goto f026A; goto Q2I6u; i9AKS: if (!$updatedCount) { goto Irgsj; } goto NmHi_; VJyIp: $subject = Db::table("\163\x75\142\x6a\x65\x63\x74")->where(["\x69\x64" => $subjectId])->field("\156\x61\x6d\145")->find(); goto uiPdQ; EOefb: $updatedCount = Db::table("\x73\165\142\152\145\x63\x74\137\x69\x74\145\x6d")->where(["\x69\x64" => $itemId])->update(array_merge($formData, $formOptionDataSanitized)); goto i9AKS; Q2I6u: KtxiZ: goto S1kur; i5NXN: Xzq9U: goto KaoUm; KHlwK: if (empty($itemId)) { goto u0gf9; } goto wSwny; XF3yQ: $indexSanitized = 1; goto QrcGl; sgkFX: $indexSanitized++; goto zWdHN; vzwkq: OperationLogs::I()->subjectLog("\xe4\xbf\256\346\x94\271\xe9\x87\217\xe8\xa1\250\xe9\241\xb9\347\233\xae\x20\x2d\40{$subject["\x6e\x61\155\145"]}", $subjectItem["\151\x74\x65\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto jruGx; OwCk3: if (!(isset($formOptionData[$optionField]) && trim($formOptionData[$optionField]) || isset($formOptionData[$imageField]) && trim($formOptionData[$imageField]))) { goto wZeUM; } goto xwyaG; K0hj9: $formOptionDataSanitized["\156\x61\x74\x75\162\x65\137" . $indexSanitized] = null; goto sgkFX; qaByf: goto QZhDu; goto V0GER; hgXLJ: u0gf9: goto ByuXv; izcgX: $formOptionDataSanitized = []; goto mmDzC; MM5Px: $formOptionDataSanitized["\x6f\160\164\x69\157\x6e\x5f" . $index] = ''; goto CWGdD; zWBu6: $indexSanitized++; goto CA6Xq; BC7cE: $formOptionDataSanitized["\x69\x6d\x61\147\x65\x5f" . $indexSanitized] = ''; goto yBRRL; ByuXv: $formData["\163\x75\x62\x6a\x65\143\164\x5f\151\144"] = $subjectId; goto BpAoP; Svem8: YJSID: goto VJyIp; ZNl15: b7VGg: goto EOefb; WiI1u: $index = 1; goto XF3yQ; jruGx: Irgsj: goto Eco0X; YLfN7: $natureField = "\x6e\x61\164\x75\x72\145\137" . $index; goto OwCk3; xwyaG: $formOptionDataSanitized["\x6f\160\164\x69\x6f\156\x5f" . $indexSanitized] = $formOptionData[$optionField]; goto bmoIK; up4vh: $index = 1; goto GMEee; b6qzz: $standardsAdd = array_diff($standardIds, $standardIdsDb); goto PvX8k; rRThZ: $weightField = "\x77\x65\151\x67\x68\164\x5f" . $index; goto YLfN7; BpAoP: $itemId = Db::table("\x73\x75\x62\152\145\x63\164\x5f\x69\164\x65\x6d")->insertGetId($formData); goto BLgTe; lZdzp: $formOptionDataSanitized["\157\160\164\151\x6f\x6e\x5f" . $indexSanitized] = ''; goto BC7cE; Y4ekY: tRM2t: goto GR3mw; V0GER: x1mC5: goto Svem8; PvX8k: foreach ($standardsAdd as $standardId) { Db::table("\163\x75\142\152\x65\143\x74\137\x69\164\145\155\137\x73\164\141\x6e\144\x61\162\x64")->insert(["\163\x75\142\x6a\x65\x63\164\x5f\x69\x64" => $subjectId, "\151\x74\x65\x6d\x5f\151\x64" => $itemId, "\163\164\141\156\144\x61\162\144\137\x69\144" => $standardId]); aGurz: } goto rtJSz; TUyYv: $formOptionDataSanitized["\x77\x65\151\x67\x68\x74\x5f" . $index] = null; goto IyNnp; YyeB7: $optionField = "\157\160\x74\x69\157\x6e\x5f" . $index; goto YIxl_; Mr0R0: foreach ($standardsDel as $standardId) { Db::table("\163\165\142\x6a\x65\x63\x74\x5f\x69\x74\x65\155\137\163\164\141\156\144\141\162\x64")->where(["\x73\x75\142\152\x65\x63\x74\x5f\151\144" => $subjectId, "\151\x74\145\155\137\151\144" => $itemId, "\x73\164\x61\156\144\x61\x72\x64\137\x69\x64" => $standardId])->delete(); Hws5B: } goto i5NXN; X3lxU: Db::table("\163\165\x62\152\145\x63\164")->where(["\x69\144" => $subjectId])->setInc("\x69\x74\x65\x6d\x5f\166\145\162\163\151\x6f\x6e"); goto l7TwT; GLASH: cnKaC: goto KHlwK; DpM0N: } public function removeSubjectItem($subjectId, $itemId) { goto z2C86; z2C86: $subject = Db::table("\163\165\142\x6a\145\x63\164")->where(["\151\144" => $subjectId])->field("\156\141\x6d\145")->find(); goto wNrew; UfzhQ: l2FiZ: goto B8oU7; cIV9J: Db::table("\x73\x75\x62\x6a\145\143\164\137\x69\164\145\x6d\137\163\x74\x61\x6e\x64\141\x72\144")->where(["\151\164\145\x6d\137\x69\144" => $itemId])->delete(); goto lzGdW; B8oU7: $subjectItem = Db::table("\x73\x75\142\152\x65\x63\x74\x5f\x69\164\145\x6d")->where(["\151\144" => $itemId])->field(true)->find(); goto uuUbf; wNrew: if (!empty($subject)) { goto l2FiZ; } goto BjFGw; udIXW: wexception("\xe6\x97\xa0\xe6\263\225\xe6\211\xbe\345\210\xb0\345\257\xb9\xe5\xba\x94\347\x9a\x84\xe9\x87\217\xe8\241\xa8\351\xa1\xb9\347\x9b\xae"); goto u6LzY; R34Tx: $this->updateSubjectStandardMinMax($subjectId); goto Xd2za; Xd2za: OperationLogs::I()->subjectLog("\xe5\210\240\xe9\231\244\351\x87\217\350\241\250\xe9\241\xb9\347\233\256\40\x2d\x20{$subject["\x6e\x61\x6d\x65"]}", $subjectItem["\x69\164\145\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto mYh4V; jCy35: Db::table("\x73\x75\x62\152\145\x63\x74\137\151\164\145\155")->where(["\151\x64" => $itemId])->delete(); goto cIV9J; u6LzY: wFeXj: goto jCy35; uuUbf: if (!empty($subjectItem)) { goto wFeXj; } goto udIXW; lzGdW: Db::table("\163\165\x62\x6a\x65\x63\164")->where(["\151\x64" => $subjectId])->setInc("\x69\164\x65\155\137\166\145\x72\x73\x69\157\156"); goto R34Tx; BjFGw: wexception("\xe6\227\xa0\346\263\x95\xe6\x89\276\345\x88\xb0\xe5\xaf\xb9\345\xba\224\xe7\x9a\204\xe9\x87\x8f\xe8\241\xa8"); goto UfzhQ; mYh4V: } public function addTagItem($subjectId, $tag) { goto PtuEo; SV0In: wexception("\xe6\227\xa0\346\263\225\346\211\xbe\xe5\210\xb0\xe5\xaf\271\345\272\224\347\x9a\204\351\207\x8f\350\241\xa8"); goto Rqg3d; kg8WL: $itemId = Db::table("\x73\x75\x62\152\145\x63\x74\137\151\x74\145\x6d")->insertGetId($formData); goto gLJD8; rohZw: $this->updateSubjectStandardMinMax($subjectId); goto x56zG; x56zG: OperationLogs::I()->subjectLog("\345\242\236\xe5\212\xa0\xe9\x87\217\xe8\241\xa8\xe9\xa1\271\xe7\x9b\xae\x20\55\x20{$subject["\x6e\x61\x6d\145"]}", $formData["\x69\164\145\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto Tj45C; PtuEo: if (isset(Defs::SUBJECT_ITEM_TAG_DEFS[$tag])) { goto ynNIr; } goto Z5RSO; RTCsC: L9ugO: goto vd4Wh; a4POp: if (!empty($subject)) { goto rsjSA; } goto SV0In; Rqg3d: rsjSA: goto gb4ru; SFuyF: $formData = ["\163\165\142\x6a\x65\143\164\137\151\x64" => $subjectId, "\151\164\145\155" => "\xe6\202\250\347\232\x84\345\271\264\xe9\xbe\x84\77", "\x74\x79\x70\145" => Defs::QUESTION_TEXT, "\163\157\x72\164" => 0, "\x74\141\147" => Defs::SUBJECT_ITEM_TAG_AGE]; goto RTCsC; Z5RSO: wexception("\164\141\147\345\217\202\xe6\225\260\351\x9d\x9e\xe6\xb3\x95"); goto xfQ1y; HVCjR: $formData = ["\x73\x75\x62\152\x65\x63\164\137\x69\x64" => $subjectId, "\151\164\145\x6d" => "\346\x82\250\xe7\x9a\x84\346\x80\xa7\345\210\xab\x3f", "\164\171\x70\x65" => Defs::QUESTION_RADIO, "\x6f\160\164\151\x6f\x6e\x5f\x31" => "\xe7\224\xb7", "\157\160\164\151\157\156\137\62" => "\xe5\245\263", "\x77\145\x69\147\x68\x74\137\61" => 0, "\x77\145\x69\x67\150\x74\x5f\62" => 0, "\x69\155\x61\147\x65\x5f\x31" => "\57\x73\x74\x61\x74\151\x63\x2f\x69\155\x67\x2f\155\x61\156\56\x70\156\147", "\151\x6d\141\147\145\137\x32" => "\x2f\163\x74\x61\x74\x69\143\57\151\x6d\147\x2f\x77\157\155\141\156\56\160\x6e\x67", "\156\141\x74\x75\x72\x65\x5f\x31" => 0, "\156\x61\x74\x75\162\x65\x5f\62" => 0, "\163\157\162\164" => 0, "\164\141\147" => Defs::SUBJECT_ITEM_TAG_SEX]; goto F8hPz; gb4ru: if ($tag == Defs::SUBJECT_ITEM_TAG_SEX) { goto Crsah; } goto vNq7g; vd4Wh: goto NSK5l; goto lYzlD; F8hPz: NSK5l: goto kg8WL; xfQ1y: ynNIr: goto homb2; lYzlD: Crsah: goto HVCjR; gLJD8: Db::table("\163\x75\x62\152\x65\143\164")->where(["\x69\x64" => $subjectId])->setInc("\151\x74\x65\x6d\x5f\x76\145\x72\163\151\x6f\x6e"); goto rohZw; vNq7g: if (!($tag == Defs::SUBJECT_ITEM_TAG_AGE)) { goto L9ugO; } goto SFuyF; homb2: $subject = Db::table("\x73\x75\x62\152\x65\x63\164")->where(["\x69\144" => $subjectId])->field("\x6e\141\155\x65")->find(); goto a4POp; Tj45C: } protected function convertOriginalToStandard($statistic_weight_min, $statistic_weight_max, $standard_weight_min, $standard_weight_max, &$weight) { goto oGXsH; UDxxl: OPVLr: goto mygUi; cZJPe: $weightStandard = $standard_weight_max; goto UDxxl; oGXsH: if (!($standard_weight_min !== null && $standard_weight_max !== null && $statistic_weight_max && $standard_weight_max && $statistic_weight_max > $statistic_weight_min && $standard_weight_max > $standard_weight_min)) { goto pSqCb; } goto Yjf26; mygUi: $weight = $weightStandard; goto Haejd; VfqiD: pSqCb: goto cXdpz; Yjf26: $scale = ($standard_weight_max - $standard_weight_min) / ($statistic_weight_max - $statistic_weight_min); goto qy1a2; cXdpz: return false; goto bLY31; Haejd: return true; goto VfqiD; Qouh3: if (!($weightStandard > $standard_weight_max)) { goto OPVLr; } goto cZJPe; qy1a2: $weightStandard = round(($weight - $statistic_weight_min) * $scale + $standard_weight_min, 2); goto Qouh3; bLY31: } public function checkReportAlgo(&$subject) { goto re5ic; i1Zqq: foreach ($fields as $field) { goto Y1G4G; NbjfG: list($class, $method) = explode("\x3a", $subject[$field]); goto iZcGS; qycXM: $file = ROOT_PATH . "\x72\x65\160\x6f\x72\164" . DS . "\x61\154\147\157" . DS . basename($class) . "\56\x70\150\160"; goto vUefR; EQtRo: $file = ROOT_PATH . "\x72\x65\x70\157\x72\x74" . DS . "\x74\x65\x73\x74" . DS . basename($class) . "\56\160\150\x70"; goto uSBil; vqSFM: $downloadAlgo = true; goto BKSFo; BKSFo: goto cwkAa; goto dKR_I; Al8Ly: if (file_exists($file)) { goto mAluP; } goto vqSFM; ZlmHG: y8f8G: goto qycXM; GkewT: goto yTmtp; goto i8yp2; uSBil: goto l1_dG; goto ZlmHG; i8yp2: sQQse: goto vOA0w; Y1G4G: if (!empty($subject[$field])) { goto sQQse; } goto GkewT; vUefR: l1_dG: goto olzuH; dKR_I: mAluP: goto aWVVK; hpFZL: $file = ROOT_PATH . "\162\x65\x70\157\x72\164" . DS . "\141\154\x67\x6f" . DS . "\x41\151\x2e\160\x68\x70"; goto oL1CF; iZcGS: if ($field == "\x72\x65\x70\157\x72\x74\x5f\x67\145\156\145\162\141\x74\x6f\x72") { goto y8f8G; } goto EQtRo; olzuH: goto Ik6vP; goto avxod; avxod: W1Zh3: goto hpFZL; oL1CF: Ik6vP: goto Al8Ly; aWVVK: yTmtp: goto TGiEB; vOA0w: if (strpos($subject[$field], "\72") === false) { goto W1Zh3; } goto NbjfG; TGiEB: } goto YVq5C; en4V5: return true; goto XFrEe; re5ic: $fields = ["\162\145\x70\x6f\162\x74\x5f\147\x65\156\x65\162\141\x74\157\162", "\143\x75\x73\x74\157\x6d\x5f\164\145\163\x74", "\x63\x75\x73\164\x6f\x6d\137\141\156\x73\x77\x65\162", "\143\165\163\164\x6f\x6d\x5f\x61\x6e\x73\x77\145\x72\137\160\162\145\x76", "\143\x75\163\x74\157\x6d\137\x72\x65\x70\x6f\162\164"]; goto cZ3qm; OAtZE: Q9PpF: goto en4V5; vvkcm: logEvent("\346\227\xa0\346\263\x95\xe6\211\276\345\210\260\xe7\224\x9f\346\x88\x90\346\212\245\345\221\x8a\347\x9a\x84\xe7\256\227\346\xb3\225\346\226\207\xe4\xbb\xb6\54\40{$file}", EventLogsService::eSeverityError); goto joKDD; joKDD: try { $this->downloadReportAlgo(); } catch (WException $e) { logEvent("\344\270\x8b\xe8\xbd\275\347\224\237\xe6\210\x90\xe6\212\245\xe5\x91\212\xe7\x9a\204\xe7\xae\227\xe6\xb3\225\346\226\x87\xe4\xbb\266\345\xa4\xb1\xe8\264\245\54\40\145\170\x63\x65\x70\164\x69\157\156\72\40" . $e->getMessage(), EventLogsService::eSeverityError); return false; } goto OAtZE; cZ3qm: $downloadAlgo = false; goto i1Zqq; wZRg3: if (!$downloadAlgo) { goto Q9PpF; } goto vvkcm; YVq5C: cwkAa: goto wZRg3; XFrEe: } public function generateTestResult($subjectId, $itemOptions) { goto dd3My; PPHYr: return call_user_func([$reporter, $subject["\x72\145\x70\x6f\162\x74\137\x67\145\x6e\145\162\x61\x74\x6f\162"]], $subjectId, $itemOptions); goto BOb2S; XewBg: $rows = []; goto ckwIJ; mt7PT: return []; goto x8uXp; BOb2S: j_bUv: goto uo8rH; Kzrng: Awi9a: goto zoPYZ; dd3My: if (!empty($itemOptions)) { goto vpcQp; } goto mt7PT; uo8rH: U9eK6: goto bWPAV; z4VZW: $subject = Db::table("\x73\165\x62\152\x65\143\x74")->where("\x69\144", $subjectId)->field("\163\156\54\40\163\164\x61\x74\151\163\164\x69\x63\x5f\x77\x65\151\x67\150\x74\x5f\x6d\x69\156\x2c\40\x73\164\x61\164\151\163\164\x69\x63\x5f\167\145\x69\x67\x68\164\x5f\155\141\x78\x2c\40\163\164\141\x6e\144\x61\162\x64\137\167\x65\x69\x67\x68\164\137\155\x69\156\54\40\x73\164\141\156\144\141\162\144\x5f\167\145\151\147\150\164\137\x6d\141\170\54\40\x72\x65\160\x6f\162\164\x5f\147\145\156\145\162\x61\x74\x6f\162\x2c\40\x63\165\x73\x74\157\155\137\x74\x65\163\x74\x2c\40\143\x75\x73\x74\x6f\155\x5f\x61\x6e\163\167\145\162\54\x20\143\165\x73\x74\157\x6d\137\141\156\163\167\x65\x72\137\x70\162\145\x76\x2c\40\x63\165\x73\164\157\155\137\x72\x65\x70\x6f\162\164")->find(); goto QwQIW; AOkmv: return call_user_func([new $class(), $method], $subjectId, $itemOptions); goto xge21; OnTSc: if (!$subject["\x72\145\x70\x6f\x72\x74\x5f\x67\145\156\145\x72\x61\164\x6f\x72"]) { goto U9eK6; } goto avD1q; zoPYZ: $reporter = new AiAlgo(); goto PPHYr; xge21: goto j_bUv; goto Kzrng; A87jy: return []; goto XWZ1y; wOPU5: OfGx2: goto Q2Aaa; avD1q: if (strpos($subject["\162\145\x70\x6f\x72\164\x5f\x67\x65\x6e\x65\162\141\x74\x6f\x72"], "\72") === false) { goto Awi9a; } goto N6uci; Q2Aaa: if ($this->checkReportAlgo($subject)) { goto kE3bv; } goto PGguZ; bWPAV: $subjectItems = Db::table("\x73\x75\x62\x6a\x65\143\x74\x5f\x69\x74\x65\x6d")->where("\163\165\142\152\x65\143\x74\137\x69\x64", $subjectId)->order("\163\157\x72\x74\40\x61\163\x63")->column("\151\144\54\40\xd\xa\40\40\40\40\x20\40\40\40\x20\40\40\40\x20\x20\x20\x20\164\x79\x70\x65\x2c\xd\12\40\40\40\40\x20\x20\40\x20\x20\x20\40\40\40\x20\x20\x20\x77\x65\x69\x67\x68\164\137\x31\x2c\xd\12\x20\x20\x20\40\x20\40\x20\40\40\x20\40\x20\x20\40\x20\40\x77\145\151\147\150\164\137\x32\54\xd\12\40\40\40\x20\40\x20\40\x20\x20\40\40\x20\x20\40\x20\x20\x77\x65\151\x67\x68\164\x5f\x33\54\15\12\40\x20\x20\x20\x20\x20\40\40\40\x20\x20\x20\x20\x20\40\40\167\x65\x69\147\150\x74\137\64\54\xd\xa\x20\x20\40\x20\40\40\40\x20\40\40\40\x20\40\x20\x20\x20\167\145\151\147\150\164\137\65\x2c\xd\12\40\x20\x20\x20\40\x20\40\40\x20\40\x20\40\x20\40\x20\x20\x77\145\x69\147\150\x74\137\x36\x2c\xd\xa\x20\40\x20\x20\40\40\40\40\x20\40\40\x20\x20\40\x20\x20\x77\145\151\x67\150\164\137\x37\54\xd\xa\x20\x20\x20\x20\40\x20\x20\40\40\40\40\40\x20\40\x20\x20\167\145\x69\147\x68\164\x5f\x38\x2c\15\xa\40\40\40\x20\40\x20\40\40\x20\40\x20\40\x20\40\40\x20\167\x65\151\147\x68\x74\x5f\71\54\xd\xa\x20\40\x20\x20\40\40\x20\40\x20\40\x20\40\x20\x20\x20\40\x77\x65\151\x67\x68\164\x5f\x31\60\x2c\15\12\x20\x20\x20\40\40\40\40\40\x20\40\40\40\40\x20\x20\40\x77\x65\151\147\x68\x74\x5f\x31\61\54\xd\12\40\x20\x20\40\40\x20\40\40\40\x20\x20\40\40\40\40\x20\x77\x65\x69\x67\150\164\x5f\x31\x32\54\xd\xa\40\40\x20\40\x20\x20\x20\40\x20\40\40\40\x20\x20\40\x20\156\x61\x74\165\162\x65\137\61\54\15\12\40\40\x20\40\x20\40\40\40\40\40\40\40\x20\40\x20\40\x6e\x61\x74\x75\162\x65\x5f\62\54\xd\12\40\x20\40\40\x20\40\40\x20\x20\40\x20\40\x20\x20\x20\40\156\x61\164\x75\x72\x65\137\63\54\15\xa\x20\x20\40\40\40\40\x20\x20\x20\x20\40\40\40\40\x20\40\156\x61\x74\165\x72\145\x5f\64\54\xd\12\40\40\x20\40\x20\40\x20\40\40\40\40\40\x20\40\x20\x20\156\x61\164\x75\162\x65\137\x35\54\15\xa\x20\x20\40\x20\40\x20\40\x20\40\x20\x20\40\40\x20\40\x20\x6e\x61\x74\165\162\145\137\66\54\15\12\40\x20\x20\40\x20\x20\x20\40\x20\x20\40\40\x20\40\x20\x20\156\x61\164\x75\x72\x65\137\x37\54\xd\xa\x20\x20\40\x20\x20\x20\x20\40\40\40\40\x20\40\x20\x20\x20\x6e\x61\164\x75\x72\145\x5f\70\54\xd\xa\40\40\x20\x20\x20\40\40\40\x20\40\x20\40\x20\x20\40\40\x6e\141\164\x75\x72\x65\137\71\54\15\12\x20\40\x20\40\x20\x20\40\40\40\x20\40\x20\40\x20\x20\x20\156\x61\x74\x75\x72\145\x5f\61\60\x2c\xd\12\40\40\40\40\x20\x20\40\x20\x20\40\40\x20\40\x20\x20\x20\x6e\x61\x74\165\x72\145\137\x31\61\54\15\xa\40\x20\40\40\40\x20\x20\40\x20\x20\x20\40\x20\x20\40\x20\156\141\x74\165\x72\x65\137\x31\x32\x2c\15\xa\x20\x20\40\x20\40\x20\x20\40\40\40\40\x20\x20\x20\x20\x20\164\x61\147"); goto cUphV; XWZ1y: KeAkR: goto LGCJq; ckwIJ: foreach ($standards as $standard) { goto zgNMp; miPwK: $matchedDescs = []; goto snJIg; Z8eNr: kT9C1: goto ImdKF; E92Ix: d2nre: goto sLB8t; zqJzT: $matched = false; goto ESWNW; yb9E8: $totalPositiveWeightStandard = null; goto lkb4v; Yfyi6: if (!($itemCount > 0)) { goto b2nFh; } goto e9J8O; tjZxU: if ($positiveItemCount) { goto Rifph; } goto UnsqO; tzRag: $convertedResult = $this->convertOriginalToStandard($standard["\x73\164\x61\164\151\163\164\x69\x63\137\x77\x65\x69\147\150\164\x5f\x6d\x69\x6e"], $standard["\163\x74\x61\164\151\x73\x74\x69\x63\137\167\145\151\147\x68\164\x5f\x6d\x61\170"], $standard["\163\x74\141\156\144\x61\162\144\x5f\167\145\151\147\150\x74\137\155\151\x6e"], $standard["\x73\x74\141\156\x64\141\x72\x64\x5f\x77\145\x69\147\x68\164\137\155\x61\170"], $tempWeight); goto k_cV3; U4sbl: if ($positiveItemCount) { goto kTY_I; } goto E33j1; g9FpI: $averageWeight = 0; goto aRCIu; cUFmj: kVZab: goto tjZxU; dfEHL: kTY_I: goto b29Pc; WSK7j: $negativeItemCount = 0; goto AJ0YQ; TbndY: goto hfvlA; goto dfEHL; caiyQ: $averageWeightMin = round($totalWeightMin / $itemCount, 2); goto w5UJo; b29Pc: $positiveAverageWeightStandard = round($tempWeight / $positiveItemCount, 2); goto nVss3; TNpCE: $totalWeightMin = 0; goto g9FpI; M8zzQ: goto kT9C1; goto mYx7W; FakHD: $totalWeight = 0; goto rhmjk; axbNp: $i++; goto M8zzQ; rhmjk: $totalWeightMax = 0; goto TNpCE; Onyam: $totalWeightMin = $standard["\163\164\x61\164\151\163\164\151\143\x5f\x77\145\x69\147\150\164\x5f\155\x69\x6e"]; goto VFhO2; a2evB: goto kVZab; goto EZnxH; UnsqO: goto rwRX9; goto JRsZ1; tz4Ta: if (!empty($subjectItemIds)) { goto d2nre; } goto E92Ix; q0kfW: $totalWeightStandard = $tempWeight; goto XLoGa; QZkfw: goto KqKU1; goto LvVVE; e9J8O: $totalWeightMax = $standard["\x73\164\x61\164\x69\163\164\x69\x63\x5f\x77\145\151\x67\150\164\137\x6d\x61\x78"]; goto Onyam; WU7E4: $totalWeightMinStandard = $standard["\x73\164\141\x6e\144\141\162\144\x5f\x77\x65\x69\x67\150\164\x5f\x6d\151\x6e"]; goto PN9p4; ErK5a: $averageWeightMaxStandard = null; goto Vu0g1; hoHS_: d9WJG: goto tz4Ta; aRCIu: $averageWeightMax = 0; goto L2ob3; Bj4Cv: if ($subjectItemIds) { goto GArWF; } goto Za51V; F5uCj: $i = 0; goto Z8eNr; VFhO2: $averageWeight = round($totalWeight / $itemCount, 2); goto G0bCs; VmuBJ: $positiveAverageWeight = round($totalPositiveWeight / $positiveItemCount, 2); goto coMYF; o1frD: $totalWeightMaxStandard = null; goto Z3K18; s63x1: ca1oR: goto F5uCj; snJIg: $matchedRemarks = []; goto VbdVE; k_cV3: if ($convertedResult) { goto WgShG; } goto a2evB; Za51V: $subjectItemIds = []; goto T2eIX; LvVVE: fzLqe: goto U4sbl; Mkwse: KqKU1: goto YAOZw; lkb4v: $positiveAverageWeightStandard = null; goto Fdv5a; QA96q: b2nFh: goto Zumcy; Ixsxz: $weightDistribution[strval($i)] = 0; goto c0ipI; L2ob3: $averageWeightMin = 0; goto Bzif0; XMfyJ: goto C82qd; goto t3FT5; wdBXU: $averageWeightMaxStandard = round($totalWeightMaxStandard / $itemCount, 2); goto OEPI7; ZHgew: zKK0g: goto Lk66p; hR58G: C82qd: goto HMhGA; Dsv8Z: $warningLevel = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto dn1r2; SzleT: $averageWeightStandard = null; goto ErK5a; JRsZ1: Rifph: goto VmuBJ; OEPI7: $averageWeightMinStandard = round($totalWeightMinStandard / $itemCount, 2); goto cUFmj; iRK4W: if (isset($weightDistribution[strval($i)])) { goto StM9E; } goto Ixsxz; ICAFq: $subjectItemIds = array_keys($subjectItems); goto hoHS_; ESWNW: if (!($itemCount > 0)) { goto zKK0g; } goto qjjdm; sLB8t: $itemCount = 0; goto DsDOE; dn1r2: if ($standardId == 0) { goto XVCHT; } goto xSC8_; uyHhY: $convertedResult = $this->convertOriginalToStandard($standard["\163\164\x61\x74\151\163\x74\151\x63\137\167\x65\x69\x67\150\164\137\x6d\151\x6e"], $standard["\x73\164\141\x74\x69\x73\164\151\x63\x5f\x77\x65\x69\147\x68\x74\x5f\155\141\170"], $standard["\x73\x74\x61\156\144\141\162\144\137\x77\x65\x69\x67\x68\x74\137\155\151\156"], $standard["\163\x74\x61\156\x64\x61\162\144\137\x77\x65\151\147\150\x74\137\x6d\x61\x78"], $tempWeight); goto EHPiz; c0ipI: StM9E: goto axbNp; YAOZw: rwRX9: goto QA96q; U0GU_: Zfb25: goto ZHgew; T2eIX: GArWF: goto qOb20; Z3K18: $totalWeightMinStandard = null; goto SzleT; qjjdm: foreach ($latitudes as $latitude) { goto Zz7Zf; ty6CD: $expression = str_replace("\x24\173\x50\x41\x57\x7d", "\44\160\157\x73\151\164\x69\x76\x65\x41\166\x65\x72\x61\x67\x65\127\145\151\147\150\x74", $expression); goto cICiH; W6JnO: wSKMQ: goto kTeeh; eqlpz: if ($weightType == Defs::LATITUDE_MEASURE_WEIGHT_ORIGINAL) { goto BDIKi; } goto INAmn; Qg9tJ: if (!($i <= 6)) { goto Epmuf; } goto fQ9zn; vn2E0: if (!($latitude["\167\141\x72\x6e\x69\x6e\147\137\x6c\x65\x76\145\x6c"] > $warningLevel)) { goto d8LLb; } goto vkz5a; NeR9p: $expression = str_replace("\x24\x7b\116\x49\x43\x7d", "\44\x6e\145\147\141\x74\151\166\145\111\164\x65\x6d\103\x6f\165\156\164", $expression); goto pOVMU; HGyhL: goto FPNyK; goto IHDxx; Zz7Zf: $weightType = $latitude["\x77\x65\x69\147\150\x74\137\x74\171\x70\x65"]; goto Q7znk; jchI1: $matchedExpressions[] = $expressionOriginal; goto Q0YWJ; vkz5a: $warningLevel = $latitude["\x77\x61\162\x6e\151\x6e\x67\137\154\x65\166\145\x6c"]; goto VzZQ0; B3OC5: PmbwA: goto BKb5K; gdgPv: goto Ghwza; goto Yn4d3; gha0D: $expression = str_replace("\x24\x7b\124\127\x7d", "\x24\164\x6f\x74\141\x6c\x57\x65\x69\x67\150\164\x53\x74\141\156\144\x61\x72\x64", $expression); goto YD5oC; cICiH: $i = 0; goto VE7WD; n5OSc: B_7wj: goto kZ9bN; v3R9v: ZF8yU: goto NRpvl; VE7WD: Ghwza: goto Qg9tJ; kZ9bN: $matched = true; goto B3OC5; fQ9zn: $expression = str_replace("\44\x7b\127\x44" . $i . "\175", "\44\x77\145\x69\147\x68\164\x44\x69\163\x74\x72\151\x62\165\164\x69\x6f\156\133\x73\164\162\166\141\154\x28" . $i . "\x29\135", $expression); goto o0c_6; m1SAQ: $expression = str_replace("\44\173\101\x57\175", "\44\x61\166\145\162\141\147\145\x57\145\x69\147\x68\164", $expression); goto ty6CD; kTeeh: $expression = str_replace("\x24\173\x50\111\103\175", "\x24\160\157\x73\151\164\151\x76\145\111\164\x65\x6d\x43\157\165\156\164", $expression); goto NeR9p; AJEL1: $expressionOriginal = $latitude["\145\x78\160\162\145\x73\x73\x69\x6f\156"]; goto iLqZQ; VzZQ0: d8LLb: goto S7v2j; BKb5K: FPNyK: goto EBR9Y; xcK_o: $expression = str_replace("\x24\x7b\124\127\175", "\x24\x74\x6f\x74\141\x6c\127\x65\x69\147\150\x74", $expression); goto m1SAQ; H6X_D: try { $result = eval($expression); } catch (\ParseError $e) { $result = false; } goto a0r8h; NRpvl: goto wSKMQ; goto X0Wah; pK_hR: $matchedRemarks[] = $latitude["\x72\x65\155\141\162\x6b"]; goto n5OSc; YD5oC: $expression = str_replace("\44\x7b\101\127\175", "\x24\x61\x76\145\162\141\x67\x65\127\x65\x69\x67\x68\x74\123\x74\x61\156\144\141\x72\144", $expression); goto rDDx2; yrX3O: goto ZF8yU; goto oos6W; iPD6L: goto FPNyK; goto yrX3O; Yn4d3: Epmuf: goto W6JnO; oos6W: V3hGH: goto gha0D; IHDxx: DSE90: goto AJEL1; WfVv3: Log::notice("\x65\x78\160\x72\x65\163\163\x69\157\x6e\x3a\x20{$expressionOriginal}\x20\55\76\x20{$expression}"); goto H6X_D; Q0YWJ: $matchedDescs[] = $latitude["\x73\164\141\156\x64\137\x64\145\x73\x63"]; goto vn2E0; X0Wah: BDIKi: goto xcK_o; rDDx2: $expression = str_replace("\x24\x7b\x50\x41\x57\x7d", "\x24\160\x6f\163\x69\164\151\x76\x65\101\x76\x65\x72\x61\x67\x65\x57\145\151\147\150\x74\123\x74\141\x6e\x64\141\x72\x64", $expression); goto v3R9v; iLqZQ: $expression = preg_replace("\x2f\134\x73\53\57", '', $expressionOriginal); goto eqlpz; o0c_6: $i++; goto gdgPv; Q7znk: if (!($weightType == Defs::LATITUDE_MEASURE_WEIGHT_STANDARD && $totalWeightStandard === null)) { goto DSE90; } goto HGyhL; a0r8h: if (!$result) { goto PmbwA; } goto jchI1; S7v2j: if (!trim($latitude["\162\x65\155\x61\162\x6b"])) { goto B_7wj; } goto pK_hR; pOVMU: $expression = "\x72\145\x74\165\x72\x6e\40" . $expression . "\x3b"; goto WfVv3; INAmn: if ($weightType == Defs::LATITUDE_MEASURE_WEIGHT_STANDARD) { goto V3hGH; } goto iPD6L; EBR9Y: } goto U0GU_; nVss3: hfvlA: goto Mkwse; EZnxH: WgShG: goto q0kfW; w5UJo: $tempWeight = $totalWeight; goto tzRag; EHPiz: if ($convertedResult) { goto fzLqe; } goto QZkfw; Fdv5a: $weightDistribution = []; goto Dsv8Z; Bzif0: $totalWeightStandard = null; goto o1frD; t3FT5: q9yuh: goto FakHD; v6Jm_: sWZOc: goto Yfyi6; xSC8_: $subjectItemIds = Db::table("\163\165\x62\x6a\x65\x63\x74\x5f\151\164\x65\x6d\137\x73\x74\141\156\x64\141\162\x64")->where(["\163\x75\x62\152\145\143\164\137\151\144" => $subjectId, "\x73\164\141\156\144\x61\x72\x64\x5f\x69\x64" => $standardId])->column("\x69\x74\145\x6d\137\151\x64"); goto Bj4Cv; JIVSr: $positiveAverageWeight = 0; goto yb9E8; G0bCs: $averageWeightMax = round($totalWeightMax / $itemCount, 2); goto caiyQ; s_O_m: if (!($itemCount == 0)) { goto sWZOc; } goto v6Jm_; Lk66p: $rows[] = ["\163\164\x61\x6e\144\141\162\x64\137\151\x64" => $standardId, "\x6c\x61\164\x69\164\x75\x64\145" => $latitudeText, "\x74\x6f\x74\141\x6c\137\167\145\x69\147\150\x74" => $totalWeight, "\x74\157\164\141\154\137\167\x65\151\147\150\x74\137\155\141\170" => $totalWeightMax, "\x74\x6f\164\x61\154\137\167\145\x69\147\x68\164\x5f\x6d\151\x6e" => $totalWeightMin, "\x61\166\x65\162\141\x67\145\137\167\x65\x69\147\x68\164" => $averageWeight, "\141\x76\x65\x72\141\147\145\x5f\167\145\x69\x67\150\164\137\x6d\141\x78" => $averageWeightMax, "\x61\166\145\x72\x61\x67\x65\137\167\145\151\x67\150\164\137\155\151\x6e" => $averageWeightMin, "\160\157\163\151\x74\151\x76\145\137\x61\x76\x65\x72\141\x67\x65\137\x77\145\x69\147\150\164" => $positiveAverageWeight, "\167\x65\x69\147\150\x74\137\x64\x69\163\164\162\151\142\x75\x74\x69\157\156" => $weightDistribution, "\164\x6f\x74\141\x6c\x5f\167\x65\151\x67\150\164\137\x73\164\x61\156\x64\x61\x72\x64" => $totalWeightStandard, "\164\x6f\x74\141\x6c\137\x77\145\151\147\x68\164\x5f\155\141\170\x5f\x73\x74\x61\x6e\x64\x61\162\144" => $totalWeightMaxStandard, "\164\157\164\141\x6c\x5f\x77\x65\151\147\x68\x74\137\155\151\156\x5f\x73\164\x61\156\x64\141\x72\x64" => $totalWeightMinStandard, "\x61\166\x65\162\141\x67\145\x5f\167\145\x69\147\150\164\137\x73\x74\x61\x6e\x64\141\x72\x64" => $averageWeightStandard, "\x61\x76\x65\x72\141\147\x65\137\x77\x65\x69\x67\150\x74\x5f\155\141\x78\137\163\x74\141\x6e\x64\141\162\144" => $averageWeightMaxStandard, "\x61\166\145\x72\x61\147\145\x5f\x77\145\x69\x67\150\x74\x5f\x6d\151\x6e\x5f\163\164\x61\x6e\x64\x61\x72\x64" => $averageWeightMinStandard, "\160\157\163\x69\x74\151\x76\145\137\141\166\145\162\141\x67\x65\137\x77\145\151\x67\x68\164\137\x73\x74\x61\156\144\141\x72\144" => $positiveAverageWeightStandard, "\x69\x74\145\155\137\143\x6f\165\156\164" => $itemCount, "\160\x6f\x73\x69\164\x69\166\145\137\151\x74\145\155\x5f\x63\x6f\x75\x6e\x74" => $positiveItemCount, "\156\x65\x67\141\x74\151\166\x65\x5f\x69\x74\x65\155\137\143\157\165\156\x74" => $negativeItemCount, "\155\x61\164\x63\150\x65\144" => $matched, "\155\x61\x74\x63\x68\145\x64\137\x65\x78\160\162\145\x73\x73\x69\x6f\156\x73" => $matchedExpressions, "\155\x61\164\143\x68\x65\144\x5f\144\x65\x73\x63\163" => $matchedDescs, "\x6d\x61\x74\x63\x68\145\x64\x5f\162\145\155\x61\x72\153\163" => $matchedRemarks, "\x77\x61\162\x6e\151\156\147\137\x6c\x65\166\145\x6c" => $warningLevel]; goto hR58G; d8hXB: $latitudes = Db::table("\163\x75\142\152\145\x63\164\x5f\163\x74\141\x6e\x64\x61\x72\x64\x5f\154\x61\x74\151\x74\165\144\145")->where(["\163\165\x62\152\145\143\x74\137\151\144" => $subjectId, "\x73\x74\141\x6e\x64\x61\162\x64\137\x69\144" => $standardId])->field(true)->select(); goto AFPrh; ImdKF: if (!($i <= 6)) { goto ELKVh; } goto iRK4W; Zumcy: $matchedExpressions = []; goto miPwK; coMYF: $tempWeight = $totalPositiveWeight; goto uyHhY; AJ0YQ: $totalPositiveWeight = 0; goto JIVSr; VbdVE: $warningLevel = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto zqJzT; DsDOE: foreach ($itemOptions as $itemId => $itemOption) { goto RgTLa; g04Ym: if (!($subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE)) { goto ti_re; } goto fnnPl; CGgoH: if (!isset($subjectItems[$itemId][$weightField])) { goto OGbHa; } goto tt_Xx; m5sCJ: glSVs: goto b5de2; G2M5R: goto I7N6G; goto WQOy0; V71e7: foreach ($optionIndex as $optionIndexOne) { goto SeJWM; SeJWM: $weightField = "\167\x65\151\147\x68\164\x5f" . $optionIndexOne; goto uu332; T3Ea0: HEd7C: goto C9ZEp; KcKHf: TxYS8: goto T3Ea0; uu332: if (!isset($subjectItems[$itemId][$weightField])) { goto TxYS8; } goto LqkE2; LqkE2: $itemWeight += round($subjectItems[$itemId][$weightField] / 100, 2); goto KcKHf; C9ZEp: } goto ZUgzJ; q_0oq: $weightDistribution[strval($itemWeight)] = 1; goto zIV1u; zIV1u: goto LZ52G; goto DCUUe; tNRj1: $natureField = "\x6e\x61\x74\x75\x72\145\137" . $optionIndex; goto Gu1Ye; aMFU5: nbOSw: goto bHLnq; DCUUe: oRpah: goto hktoY; bHgze: $itemWeight = 0; goto V71e7; ZUgzJ: xJbT6: goto XjPK_; F7mB1: $weightField = "\x77\x65\x69\x67\150\164\137" . $optionIndex; goto CGgoH; itFTk: P45Py: goto sjIXU; sjIXU: QMKyT: goto pTFfz; WQOy0: oxpSU: goto TIAtv; Qu29I: qSCdF: goto B1Sor; FPDhn: if (isset($subjectItems[$itemId])) { goto glSVs; } goto wzMvx; Q75Jq: qYwbH: goto BOMb6; qdizv: if (isset($weightDistribution[strval($itemWeight)])) { goto qSCdF; } goto X2k86; BOMb6: goto QMKyT; goto Fpi8z; hktoY: $weightDistribution[strval($itemWeight)]++; goto nwppC; RibdB: foreach ($optionIndex as $optionIndexOne) { goto FpEEc; roW6G: goto pzOdP; goto Cw4YN; Cw4YN: tlR_E: goto HF028; FpEEc: $natureField = "\156\141\164\165\x72\x65\137" . $optionIndexOne; goto woLGR; N2bYp: pzOdP: goto GN3L0; c0aBR: if (!($subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE)) { goto x1wp_; } goto B883c; woLGR: if (isset($subjectItems[$itemId][$natureField])) { goto tlR_E; } goto roW6G; dBL_y: x1wp_: goto N2bYp; KvUYU: $negativeItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_NEGATIVE ? 1 : 0; goto c0aBR; B883c: $totalPositiveWeight += round($subjectItems[$itemId]["\x77\145\151\147\x68\x74\137" . $optionIndexOne] / 100, 2); goto dBL_y; HF028: $positiveItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE ? 1 : 0; goto KvUYU; GN3L0: } goto itFTk; Fpi8z: gM42m: goto bHgze; f4OIl: goto I7N6G; goto SLTom; mMoxf: $negativeItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_NEGATIVE ? 1 : 0; goto g04Ym; pTFfz: $itemCount++; goto QnTcR; XjPK_: $totalWeight += $itemWeight; goto qdizv; B1Sor: $weightDistribution[strval($itemWeight)]++; goto IZzS0; aaelG: $optionIndex = $itemOption["\x76\x61\x6c\165\145"]; goto FPDhn; NP4gG: if (!($itemType == Defs::QUESTION_TEXT)) { goto nbOSw; } goto KEtik; nwppC: LZ52G: goto cfvWq; TIAtv: if (in_array($itemId, $subjectItemIds)) { goto mB8IE; } goto f4OIl; CDejf: $totalWeight += $itemWeight; goto GJDNe; KEtik: goto I7N6G; goto aMFU5; fnnPl: $totalPositiveWeight += round($subjectItems[$itemId][$weightField] / 100, 2); goto Of2vM; Gu1Ye: if (!isset($subjectItems[$itemId][$natureField])) { goto qYwbH; } goto Bbwsh; Of2vM: ti_re: goto Q75Jq; IZzS0: wRVA6: goto RibdB; X2k86: $weightDistribution[strval($itemWeight)] = 1; goto Lg9RP; SLTom: mB8IE: goto NP4gG; Bbwsh: $positiveItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE ? 1 : 0; goto mMoxf; RgTLa: $itemType = $itemOption["\164\x79\160\145"]; goto aaelG; wzMvx: goto I7N6G; goto m5sCJ; GJDNe: if (isset($weightDistribution[strval($itemWeight)])) { goto oRpah; } goto q_0oq; Lg9RP: goto wRVA6; goto Qu29I; tt_Xx: $itemWeight = round($subjectItems[$itemId][$weightField] / 100, 2); goto CDejf; bHLnq: if (is_array($optionIndex)) { goto gM42m; } goto F7mB1; b5de2: if (!($subjectItems[$itemId]["\164\141\147"] != "\156\x6f\156\145")) { goto oxpSU; } goto G2M5R; cfvWq: OGbHa: goto tNRj1; QnTcR: I7N6G: goto hYfa8; hYfa8: } goto s63x1; ej2yc: $latitudeText = $standard["\154\x61\164\x69\x74\x75\x64\145"]; goto d8hXB; zgNMp: $standardId = $standard["\x73\x74\x61\x6e\x64\141\x72\144\x5f\x69\144"]; goto ej2yc; XLoGa: $totalWeightMaxStandard = $standard["\x73\x74\x61\x6e\x64\141\162\x64\x5f\167\145\x69\x67\x68\164\x5f\x6d\x61\x78"]; goto WU7E4; E33j1: $positiveAverageWeightStandard = 0; goto TbndY; v5Tzn: XVCHT: goto ICAFq; qOb20: goto d9WJG; goto v5Tzn; AFPrh: if (!(empty($latitudes) && $standardId == 0)) { goto q9yuh; } goto XMfyJ; Vu0g1: $averageWeightMinStandard = null; goto a2xSX; mYx7W: ELKVh: goto s_O_m; a2xSX: $positiveItemCount = 0; goto WSK7j; PN9p4: $averageWeightStandard = round($totalWeightStandard / $itemCount, 2); goto wdBXU; HMhGA: } goto N90nL; O_lcJ: $standards = Db::table("\x73\x75\142\152\145\143\164\137\x73\x74\x61\156\144\x61\x72\x64")->where("\x73\165\142\152\x65\x63\x74\x5f\151\144", $subjectId)->field("\151\144\40\141\163\x20\163\164\x61\x6e\144\141\162\144\137\151\x64\x2c\40\x6c\141\x74\x69\x74\165\144\x65\x2c\x20\15\xa\40\x20\40\40\40\40\x20\40\x20\40\40\x20\x20\x20\40\40\163\x74\141\x74\151\163\164\x69\143\x5f\x77\x65\x69\147\150\x74\137\155\x69\156\54\40\163\164\x61\x74\x69\163\x74\x69\143\x5f\167\145\x69\x67\150\x74\x5f\155\141\x78\x2c\x20\163\164\141\156\x64\141\162\x64\x5f\167\145\x69\x67\150\164\x5f\155\x69\156\x2c\x20\x73\164\141\156\144\141\x72\144\x5f\167\145\x69\x67\150\x74\137\x6d\x61\170")->order("\x73\157\x72\x74\40\141\163\143\54\x20\x69\144\40\141\x73\143")->select(); goto NmdMG; LGCJq: $standards = []; goto O_lcJ; xrI1W: return $rows; goto H9hN1; N6uci: list($class, $method) = explode("\x3a", $subject["\162\145\160\x6f\162\x74\137\147\145\156\x65\162\141\164\x6f\x72"]); goto AOkmv; cUphV: if (!empty($subjectItems)) { goto KeAkR; } goto A87jy; asUvo: kE3bv: goto OnTSc; PGguZ: return []; goto asUvo; QwQIW: if (!empty($subject)) { goto OfGx2; } goto QWZPX; QWZPX: return []; goto wOPU5; N90nL: FPcXk: goto xrI1W; x8uXp: vpcQp: goto z4VZW; NmdMG: array_unshift($standards, ["\163\x74\x61\x6e\x64\x61\x72\144\x5f\151\x64" => 0, "\x6c\x61\164\x69\164\165\x64\x65" => Defs::SUBJECT_WHOLE_STANDARD, "\x73\x74\x61\164\x69\x73\164\151\x63\137\x77\145\151\147\x68\x74\137\x6d\x69\x6e" => $subject["\163\x74\x61\x74\151\x73\x74\x69\x63\x5f\x77\x65\151\x67\x68\x74\x5f\155\151\x6e"], "\x73\x74\x61\164\x69\x73\164\x69\143\x5f\x77\145\x69\147\150\164\137\x6d\x61\x78" => $subject["\163\164\x61\x74\151\163\x74\151\x63\x5f\x77\x65\151\x67\150\x74\137\155\141\170"], "\x73\164\x61\x6e\x64\x61\162\144\137\167\145\x69\x67\x68\164\137\x6d\151\x6e" => $subject["\163\164\x61\x6e\144\x61\162\144\x5f\x77\x65\x69\x67\150\x74\137\155\151\156"], "\x73\x74\x61\x6e\x64\x61\x72\144\137\167\x65\151\x67\150\164\137\155\141\170" => $subject["\x73\x74\x61\x6e\x64\x61\162\x64\x5f\x77\x65\151\147\x68\164\x5f\155\141\170"]]); goto XewBg; H9hN1: } public function downloadReportAlgo() { goto jPVCb; QBnIT: unlink($localSaveFile); goto ngUZ0; fYeBu: wexception("\xe4\270\x8b\xe8\275\275\xe7\xae\x97\xe6\xb3\x95\346\x96\x87\344\xbb\266\345\244\xb1\350\264\245"); goto qTnrd; qTnrd: wHz2d: goto ACLTW; lgiHd: Am3NR: goto vwMHJ; MXma1: if (!file_exists($reportLocation . DS . "\x76\145\162\56\x70\x68\160")) { goto ImCGg; } goto MKU4Q; p5GvF: ebFIP: goto lDqaD; umZMk: if ($zip->open($localSaveFile) === TRUE) { goto Am3NR; } goto wjaEh; jiCvj: goto PKptU; goto lgiHd; caUX_: if (!empty($content)) { goto wHz2d; } goto fYeBu; KmJuj: $number = ''; goto MXma1; MKU4Q: $verInfo = (include_once $reportLocation . DS . "\166\145\162\x2e\x70\x68\160"); goto DSfNm; lDqaD: $zip = new \ZipArchive(); goto umZMk; zp5LG: $content = file_get_contents($downloadUrl); goto caUX_; RIoOm: wexception("\xe7\xae\x97\xe6\263\x95\346\226\x87\344\273\266\xe5\206\x99\345\205\xa5\xe5\244\261\350\xb4\xa5"); goto p5GvF; wjaEh: wexception("\350\xa7\xa3\xe5\216\213\346\226\x87\xe4\273\xb6\xe5\xa4\xb1\350\xb4\245\x2c\40{$localSaveFile}"); goto jiCvj; DSfNm: $number = $verInfo["\x6e\165\x6d\142\145\162"]; goto QmH8V; U9bjC: return; goto eDGth; p9Yiq: $downloadUrl = WzyerService::I()->apiFetchReportAlgo($number); goto veqLD; vwMHJ: $zip->extractTo($reportLocation . DS); goto l98qn; l98qn: $zip->close(); goto QBnIT; ACLTW: $result = file_put_contents($localSaveFile, $content); goto uN4jN; Cm6F5: $localSaveFile = $reportLocation . DS . basename($downloadUrl); goto zp5LG; uN4jN: if ($result) { goto ebFIP; } goto RIoOm; veqLD: if (!empty($downloadUrl)) { goto OOlDF; } goto U9bjC; jPVCb: $reportLocation = ROOT_PATH . DS . "\162\145\160\157\162\164"; goto KmJuj; ngUZ0: PKptU: goto mKw8y; QmH8V: ImCGg: goto p9Yiq; eDGth: OOlDF: goto Cm6F5; mKw8y: } public function importSubject($subjectId) { goto WT5VL; ZLzzA: $subjectStandardsNew = []; goto yaIdN; ZleCs: OperationLogs::I()->subjectLog("\345\257\274\xe5\205\xa5\351\x87\x8f\xe8\241\250\x20\x2d\40{$subject["\x6e\141\155\x65"]}", beautifyLogArray($subject, [], "\163\165\142\x6a\145\x63\x74"), OperationLogs::OPT_ADD_TYPE, $subjectIdNew); goto RxARJ; EE6On: $imagesLocal = []; goto vboYg; fIVWX: $subject["\x73\x75\142\152\145\143\164\137\144\145\x73\143"] = htmlspecialchars_decode($subject["\x73\165\x62\152\145\x63\x74\137\x64\145\163\143"]); goto lS04X; fDiFd: $subject["\162\145\x70\x6f\x72\164\137\151\x6d\x61\147\x65\x33"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\x65\x70\157\x72\x74\137\151\x6d\141\x67\x65\63"])); goto ga5_Z; gnAW5: L08iU: goto Pz_xQ; Pz_xQ: Log::notice("\163\165\x62\152\145\143\164\123\164\141\x6e\x64\x61\x72\x64\x73\72\x20" . json_encode($subjectStandards)); goto ZLzzA; DTFL6: $subjectItems = $subjctData["\163\x75\142\x6a\145\143\x74\x49\164\145\x6d\163"]; goto Wb5oZ; m9H7k: IO1dY: goto MqHhS; gIFRq: $subject["\162\145\x70\x6f\162\164\x5f\151\155\141\147\x65\x31"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\145\x70\x6f\x72\164\x5f\151\x6d\141\147\x65\61"])); goto qOjpq; tcvuF: $images = explode("\x2c", $subject["\x72\145\160\157\162\164\137\x64\145\155\x6f\x5f\151\155\x61\x67\145\163"]); goto EE6On; yeXfH: $subjectItemStandards = $subjctData["\x73\x75\142\152\145\143\164\111\x74\x65\x6d\x53\x74\141\x6e\x64\141\162\x64\163"]; goto PAuzm; JAHmz: $subject["\162\x65\160\x6f\x72\x74\x5f\151\x6d\141\x67\x65\65"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\x65\160\157\x72\x74\x5f\151\155\x61\x67\145\65"])); goto cXriz; ilbXR: $subject["\162\145\x70\x6f\x72\164\x5f\x64\145\155\x6f\137\x69\x6d\141\147\x65\163"] = implode("\x2c", $imagesLocal); goto uJfiO; VNQJ6: unset($subject["\151\x64"]); goto NBmtZ; cXriz: $subject["\x72\145\x70\157\x72\164\x5f\x69\155\x61\x67\145\66"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\145\x70\x6f\162\x74\x5f\151\155\141\147\x65\66"])); goto Od7kg; yaIdN: foreach ($subjectStandards as $subjectStandard) { goto t1doL; i69AI: unset($subjectStandard["\x69\144"]); goto faYBL; faYBL: $subjectStandard["\x73\165\x62\x6a\x65\143\x74\137\151\x64"] = $subjectIdNew; goto xF6hF; VhD06: GgXNS: goto LiyxD; t1doL: $subjectStandardId = $subjectStandard["\151\x64"]; goto i69AI; xF6hF: $subjectStandardIdNew = Db::table("\163\x75\142\x6a\145\x63\164\137\x73\164\141\x6e\144\141\x72\144")->insertGetId($subjectStandard); goto vLHr_; S9Xw2: $subjectStandardsNew[$subjectStandardId] = $subjectStandard; goto VhD06; vLHr_: $subjectStandard["\151\x64"] = $subjectStandardIdNew; goto S9Xw2; LiyxD: } goto abE1J; qOjpq: $subject["\x72\145\x70\157\162\164\x5f\x69\x6d\141\147\145\x32"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x72\x65\160\x6f\162\164\x5f\151\155\141\147\145\62"])); goto fDiFd; b6vdW: $subject["\163\x75\142\x6a\x65\143\164\137\x64\x65\163\143"] = htmlspecialchars($subject["\x73\165\142\x6a\x65\x63\164\x5f\144\145\163\143"]); goto VNQJ6; Xslra: Log::notice("\163\x75\x62\x6a\x65\x63\164\123\x74\x61\156\x64\x61\162\x64\163\x4e\x65\167\72\40" . json_encode($subjectStandardsNew)); goto iVrEc; vboYg: foreach ($images as $image) { goto blnWK; blnWK: $imageLocal = downloadRemoteUploadFile(generateWzyerUploadFullUrl($image)); goto ftUsT; ftUsT: if (!$imageLocal) { goto qRVPU; } goto Za8BS; aqPyd: dSYhh: goto K21kf; Za8BS: $imagesLocal[] = $imageLocal; goto MPBbd; MPBbd: qRVPU: goto aqPyd; K21kf: } goto dIJJH; HsMUu: $subject = $subjctData["\x73\165\x62\x6a\x65\143\164"]; goto DTFL6; lS04X: $subject["\x73\x75\x62\152\x65\x63\164\137\x64\x65\x73\x63"] = preg_replace("\x2f\74\133\151\155\147\174\111\115\x47\135\x2e\52\x3f\163\x72\x63\x3d\x5b\47\x7c\134\x22\135\x28\x2e\52\77\x29\133\x27\x7c\x5c\42\135\57", "\x3c\x69\x6d\147\40\163\x72\143\x3d\x22\150\x74\164\x70\x73\x3a\57\x2f\167\167\x77\56\167\172\x79\x65\x72\56\x63\x6f\155\x24\x7b\x31\x7d\x22", $subject["\x73\x75\142\152\145\143\x74\x5f\144\x65\x73\x63"]); goto b6vdW; Od7kg: $subject["\x76\151\x64\145\157\137\165\162\x6c"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x76\151\x64\145\157\x5f\x75\x72\x6c"])); goto r0ycN; MqHhS: foreach ($subjectItemStandards as $subjectItemStandard) { goto YT14T; DHnx7: Db::table("\163\x75\x62\152\145\143\x74\137\x69\x74\x65\155\x5f\x73\164\x61\x6e\144\141\x72\x64")->insert($subjectItemStandard); goto kSJZe; GT52W: $subjectItemStandard["\x73\x75\x62\152\145\x63\x74\x5f\151\x64"] = $subjectIdNew; goto RZA4M; kSJZe: FABS8: goto kcW8V; YT14T: unset($subjectItemStandard["\151\x64"]); goto GT52W; ihSxK: $subjectItemStandard["\163\164\x61\156\x64\141\x72\x64\x5f\x69\x64"] = $subjectStandardsNew[$subjectItemStandard["\x73\164\141\156\x64\141\x72\144\137\151\x64"]]["\x69\x64"]; goto DHnx7; RZA4M: $subjectItemStandard["\151\x74\x65\x6d\137\x69\x64"] = $subjectItemsNew[$subjectItemStandard["\x69\x74\x65\155\137\151\x64"]]["\151\144"]; goto ihSxK; kcW8V: } goto Jm8OQ; Jm8OQ: l9yl9: goto ZleCs; abE1J: y3TaX: goto Xslra; r0ycN: $subject["\x61\165\x64\151\x6f\x5f\165\162\x6c"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x61\165\x64\151\x6f\x5f\x75\162\154"])); goto fzZ5w; uJfiO: giFkv: goto fIVWX; fXNVl: foreach ($subjectItems as $subjectItem) { goto LdTSy; W2_oY: $subjectItem["\151\155\x61\147\145\137" . $i] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subjectItem["\x69\155\x61\x67\x65\x5f" . $i])); goto ooQCX; qcC6P: obPp0: goto pfZ_D; ooQCX: $i++; goto SAUzl; XsOIf: $subjectItem["\x73\x75\142\152\145\143\164\x5f\151\x64"] = $subjectIdNew; goto Q5hnN; pEGPs: $subjectItemsNew[$subjectItemId] = $subjectItem; goto spdV8; SAUzl: goto obPp0; goto stZEk; LdTSy: $subjectItemId = $subjectItem["\151\144"]; goto rk7c0; rk7c0: unset($subjectItem["\151\144"]); goto XsOIf; End1U: $i = 1; goto qcC6P; stZEk: IXvEH: goto BXwiM; YXQ6e: $subjectItem["\151\x64"] = $subjectItemIdNew; goto pEGPs; pfZ_D: if (!($i <= 12)) { goto IXvEH; } goto W2_oY; Q5hnN: $subjectItem["\x69\155\x61\x67\x65"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subjectItem["\151\155\141\x67\145"])); goto End1U; spdV8: OkVHG: goto XgI_o; BXwiM: $subjectItemIdNew = Db::table("\163\165\x62\x6a\145\x63\x74\137\x69\x74\145\x6d")->insertGetId($subjectItem); goto YXQ6e; XgI_o: } goto gnAW5; dIJJH: kZ6HE: goto ilbXR; fzZ5w: if (!$subject["\162\145\160\157\162\x74\137\144\145\155\x6f\x5f\x69\155\x61\x67\145\163"]) { goto giFkv; } goto tcvuF; ga5_Z: $subject["\162\x65\x70\157\x72\164\x5f\151\155\x61\x67\x65\x34"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x72\145\x70\157\162\164\x5f\151\x6d\x61\x67\x65\64"])); goto JAHmz; QKdGv: $subject["\142\141\x6e\x6e\x65\162\x5f\151\x6d\147"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x62\141\x6e\156\145\162\137\151\155\x67"])); goto gIFRq; L2dFM: $subjectStandardLatitudes = $subjctData["\163\165\142\x6a\145\143\164\x53\x74\141\x6e\x64\141\x72\x64\x4c\x61\x74\151\x74\165\x64\145\x73"]; goto yeXfH; WT5VL: $subjctData = WzyerService::I()->apiSubject($subjectId); goto HsMUu; GVP_u: $subjectItemsNew = []; goto fXNVl; PAuzm: $subject["\x69\155\141\x67\x65\137\x75\x72\154"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x69\155\141\147\x65\x5f\x75\x72\x6c"])); goto QKdGv; NBmtZ: $subjectIdNew = Db::table("\163\x75\142\x6a\x65\143\164")->insertGetId($subject); goto GVP_u; iVrEc: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto KMoy0; d8EET: sCiRf: goto mw118; ChkzK: $subjectStandardLatitude["\x73\x75\x62\x6a\145\x63\x74\x5f\x69\x64"] = $subjectIdNew; goto r83Rs; Hwc9i: GKgVb: goto Lc8qc; r83Rs: if (!$subjectStandardLatitude["\x73\164\141\x6e\144\141\x72\x64\x5f\151\144"]) { goto sCiRf; } goto l3s0y; KMoy0: unset($subjectStandardLatitude["\x69\144"]); goto ChkzK; mw118: Db::table("\x73\x75\142\x6a\145\x63\164\137\163\164\141\156\144\141\162\144\x5f\x6c\x61\x74\151\164\x75\144\x65")->insert($subjectStandardLatitude); goto Hwc9i; l3s0y: $subjectStandardLatitude["\163\x74\x61\x6e\144\x61\162\x64\137\151\x64"] = $subjectStandardsNew[$subjectStandardLatitude["\x73\164\141\156\x64\x61\x72\144\x5f\x69\x64"]]["\x69\144"]; goto d8EET; Lc8qc: } goto m9H7k; Wb5oZ: $subjectStandards = $subjctData["\163\165\142\x6a\145\x63\x74\123\164\x61\156\x64\x61\x72\144\163"]; goto L2dFM; RxARJ: } public function duplicateSubject($subjectId) { goto aihUu; WG9gO: $subjectIdNew = Db::table("\163\165\x62\152\145\143\x74")->insertGetId($subject); goto dYH3o; LI3Yk: NGceb: goto ajmMS; pZ9cB: $subjectStandards = Db::table("\x73\x75\x62\152\x65\x63\x74\137\163\164\141\156\x64\x61\x72\x64")->where("\163\x75\x62\x6a\x65\x63\x74\137\151\x64", $subjectId)->field("\x2a")->select(); goto JM35Y; ftAnK: foreach ($subjectItemStandards as $subjectItemStandard) { goto nkUZA; aKarW: Db::table("\163\165\x62\152\x65\x63\x74\137\151\164\145\x6d\x5f\x73\x74\x61\156\x64\x61\162\x64")->insert($subjectItemStandard); goto XRMmK; zO73n: $subjectItemStandard["\x73\x74\x61\156\144\141\x72\x64\x5f\151\144"] = $subjectStandardsNew[$subjectItemStandard["\x73\x74\x61\x6e\x64\x61\162\x64\137\151\x64"]]["\x69\144"]; goto aKarW; mKB5Z: $subjectItemStandard["\x73\x75\x62\x6a\145\x63\164\137\151\144"] = $subjectIdNew; goto cmmkp; cmmkp: $subjectItemStandard["\x69\164\x65\155\x5f\x69\144"] = $subjectItemsNew[$subjectItemStandard["\x69\x74\145\155\137\x69\144"]]["\151\x64"]; goto zO73n; nkUZA: unset($subjectItemStandard["\x69\x64"]); goto mKB5Z; XRMmK: Ak9DP: goto pHuVX; pHuVX: } goto CGzwh; kDmmo: $subject["\x75\x6e\151\137\141\x70\160"] = 0; goto WG9gO; xnqZm: $subject["\x70\x61\x72\164\151\143\x69\160\141\x6e\x74\x73\x5f\x73\x68\157\x77"] = 0; goto eQh3Y; aihUu: $subject = Db::table("\x73\165\142\152\145\x63\x74")->where("\x69\x64", $subjectId)->field("\x2a")->find(); goto HZFHm; LH3KQ: exception("\346\x97\xa0\xe6\xb3\225\346\211\276\xe5\210\260\xe9\207\x8f\350\xa1\xa8"); goto V4Fe_; tg99Q: $subjectCategories = Db::table("\x73\165\x62\x6a\145\x63\x74\x5f\x63\x61\164\145\x67\x6f\x72\x79\137\162\x65\154\x61\164\145")->where("\163\165\142\x6a\145\143\x74\x5f\x69\144", $subjectId)->field("\52")->select(); goto tZLnk; yKQNe: $subjectItems = Db::table("\x73\165\x62\152\145\x63\164\137\x69\x74\145\155")->where("\163\x75\x62\152\145\143\164\x5f\151\x64", $subjectId)->field("\52")->select(); goto soPdb; Vc63l: $subjectItemStandards = Db::table("\x73\165\142\152\145\x63\x74\137\x69\x74\x65\155\x5f\163\164\141\x6e\144\141\x72\144")->where("\163\165\142\x6a\145\x63\x74\137\x69\x64", $subjectId)->field("\52")->select(); goto ftAnK; NK6S2: $subject["\x73\164\141\164\x75\163"] = IndexDefs::ENTITY_DRAFT_STATUS; goto U9IbP; qfWB3: CYdJz: goto Yt5GU; uGAT2: OperationLogs::I()->subjectLog("\xe5\xa4\215\345\x88\266\351\207\217\xe8\xa1\250\40\55\40{$subject["\x6e\141\x6d\x65"]}", beautifyLogArray($subject, [], "\163\165\x62\152\x65\143\164"), OperationLogs::OPT_ADD_TYPE, $subjectIdNew); goto sk5V3; OyQ_V: $subjectStandardLatitudes = Db::table("\x73\x75\x62\152\x65\143\164\x5f\163\x74\141\x6e\x64\141\162\144\x5f\154\141\x74\151\x74\165\x64\145")->where(["\163\165\x62\152\145\x63\164\x5f\151\x64" => $subjectId, "\163\164\x61\x6e\x64\x61\x72\x64\x5f\151\144" => 0])->field("\x2a")->select(); goto uTP4M; dYH3o: $subjectItemsNew = []; goto yKQNe; CGzwh: WtmgX: goto tg99Q; Z1DyV: $subject["\143\x75\x72\x72\145\156\164\x5f\160\162\x69\x63\x65"] = 0; goto ksr67; tZLnk: foreach ($subjectCategories as $subjectCategory) { goto GM6cU; GyVR1: Db::table("\163\165\142\152\x65\143\x74\x5f\x63\x61\x74\x65\147\x6f\162\x79\x5f\x72\145\x6c\x61\164\x65")->insert($subjectCategory); goto YxVKQ; YxVKQ: XpcPk: goto VTo1D; GM6cU: $subjectCategory["\163\x75\x62\152\x65\x63\x74\x5f\x69\144"] = $subjectIdNew; goto GyVR1; VTo1D: } goto kJr0f; uTP4M: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto ti4sm; ti4sm: unset($subjectStandardLatitude["\151\x64"]); goto qx0Dr; qx0Dr: $subjectStandardLatitude["\163\165\142\152\x65\143\164\137\151\144"] = $subjectIdNew; goto ei0Qe; VYY7z: WZmTB: goto HSQvi; ei0Qe: $subjectStandardLatitude["\163\x74\141\x6e\144\x61\162\x64\x5f\x69\x64"] = 0; goto WuMpf; WuMpf: Db::table("\x73\165\142\152\145\143\164\137\163\x74\141\156\x64\141\162\144\137\x6c\141\164\x69\164\165\x64\x65")->insert($subjectStandardLatitude); goto VYY7z; HSQvi: } goto LI3Yk; ksr67: $subject["\x73\157\x72\164"] = 1000; goto sSb9C; Yt5GU: $subjectStandardsNew = []; goto pZ9cB; U9IbP: $subject["\x6c\141\x62\145\154"] = ''; goto DhCpZ; soPdb: foreach ($subjectItems as $subjectItem) { goto tHxIa; uY29v: HSc6H: goto mZGCI; reWwX: unset($subjectItem["\151\144"]); goto cwH9I; gCdHF: $subjectItem["\x69\x64"] = $subjectItemIdNew; goto eDfNA; tHxIa: $subjectItemId = $subjectItem["\x69\144"]; goto reWwX; eDfNA: $subjectItemsNew[$subjectItemId] = $subjectItem; goto uY29v; cwH9I: $subjectItem["\x73\165\x62\152\145\x63\164\x5f\x69\x64"] = $subjectIdNew; goto r7UWh; r7UWh: $subjectItemIdNew = Db::table("\x73\165\x62\x6a\x65\x63\164\x5f\151\164\145\x6d")->insertGetId($subjectItem); goto gCdHF; mZGCI: } goto qfWB3; Ad6kY: $subject["\x71\162\143\157\144\145"] = ''; goto kDmmo; ajmMS: foreach ($subjectStandardsNew as $subjectStandardId => $subjectStandardNew) { goto GoPws; U4hBZ: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto mzwlH; dLENf: C85bi: goto QvPTL; A3cLA: $subjectStandardLatitude["\163\x74\141\156\144\x61\x72\144\137\151\x64"] = $subjectStandardNew["\x69\x64"]; goto h6DjT; Xzh1z: $subjectStandardLatitude["\x73\165\142\152\145\143\164\x5f\x69\144"] = $subjectIdNew; goto A3cLA; h6DjT: Db::table("\x73\x75\142\x6a\145\143\x74\x5f\163\x74\141\x6e\144\141\162\144\137\x6c\141\164\x69\164\x75\144\145")->insert($subjectStandardLatitude); goto dLENf; mzwlH: unset($subjectStandardLatitude["\x69\x64"]); goto Xzh1z; QvPTL: } goto Ux9Jt; GoPws: $subjectStandardLatitudes = Db::table("\163\165\142\x6a\145\x63\164\137\x73\164\x61\156\x64\x61\x72\x64\x5f\154\x61\x74\151\164\165\x64\x65")->where(["\163\165\x62\152\x65\x63\x74\x5f\151\144" => $subjectId, "\x73\x74\x61\x6e\144\141\162\144\137\151\x64" => $subjectStandardId])->field("\52")->select(); goto U4hBZ; S7efc: Uk8Q3: goto U8GyQ; Ux9Jt: wCsE2: goto S7efc; U8GyQ: } goto vvqoQ; vvqoQ: FL4q_: goto Vc63l; sSb9C: unset($subject["\x63\x72\145\141\164\x65\x5f\x74\151\x6d\x65"]); goto PeUTn; DhCpZ: $subject["\160\141\162\x74\x69\143\151\160\141\x6e\164\x73"] = 0; goto xnqZm; JM35Y: foreach ($subjectStandards as $subjectStandard) { goto B2XUG; StCDW: $subjectStandardsNew[$subjectStandardId] = $subjectStandard; goto HkeSv; B2XUG: $subjectStandardId = $subjectStandard["\x69\x64"]; goto bhPK1; m2LDG: $subjectStandard["\163\x75\x62\152\145\143\164\x5f\151\144"] = $subjectIdNew; goto EyfM1; HkeSv: fVbHm: goto JwpIC; EyfM1: $subjectStandardIdNew = Db::table("\163\x75\142\152\x65\143\164\137\x73\164\x61\156\144\141\x72\144")->insertGetId($subjectStandard); goto qcgEN; bhPK1: unset($subjectStandard["\151\144"]); goto m2LDG; qcgEN: $subjectStandard["\x69\144"] = $subjectStandardIdNew; goto StCDW; JwpIC: } goto Y0cC_; eQh3Y: $subject["\164\x6f\164\141\x6c\137\x61\x6d\157\165\x6e\164"] = 0; goto MGF5i; vovKj: $subject["\163\x6e"] = generateSubjectSn(); goto Z1DyV; HZFHm: if (!empty($subject)) { goto ps_4Y; } goto LH3KQ; kJr0f: qxpp2: goto uGAT2; V4Fe_: ps_4Y: goto s3iRA; PeUTn: unset($subject["\155\x6f\x64\x69\x66\171\137\x74\151\x6d\x65"]); goto NK6S2; Y0cC_: KUmt8: goto OyQ_V; s3iRA: unset($subject["\151\144"]); goto vovKj; MGF5i: $subject["\144\145\x6c\145\164\145\137\146\x6c\141\x67"] = 0; goto Ad6kY; sk5V3: } }
