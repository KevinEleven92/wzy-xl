<?php
 namespace app\index\logic; use think\Log; use think\Db; use app\index\model\Subject as SubjectModel; use app\index\logic\Attachments as AttachmentsLogic; use app\index\logic\Defs as IndexDefs; use app\Defs; use app\index\service\OperationLogs; use app\index\service\RequestContext; use app\common\service\WException; use app\index\service\Wzyer as WzyerService; use app\index\service\EventLogs as EventLogsService; use report\algo\Ai as AiAlgo; class Subject extends Base { protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto Dn_Gw; LaGAM: $records = Db::table("\163\165\x62\x6a\145\143\x74")->where($conditions)->page($page, $rows)->order($order)->field("\x2a")->select(); goto qQ0H6; UiIvK: aH2rV: goto VAiJe; D9cza: if (emptyInArray($search, "\x63\x61\164\x65\x67\x6f\x72\x79\x5f\x69\144")) { goto vvVcw; } goto ZCcc5; EyNUh: if ($sort == "\164\157\164\141\x6c\x5f\x61\x6d\157\165\156\164") { goto MmayA; } goto hlIRp; uRjqE: $order = "\163\164\x61\x74\165\163\40" . $order . "\x2c\40\143\x72\145\141\x74\145\x5f\164\151\x6d\145\40\144\145\x73\143"; goto Padzi; JAIcG: if (empty($search["\164\171\x70\x65"])) { goto FMyYI; } goto oAh8o; l8nU0: goto Wm4_9; goto D70yx; GdCkt: return ["\x74\x6f\x74\141\154" => $totalCount, "\x72\157\x77\x73" => $records]; goto r9UO3; NuVjd: if ($sort == "\160\x61\162\164\151\143\x69\160\x61\156\x74\163") { goto Y18MD; } goto EyNUh; X0X2Q: Y18MD: goto O1eqd; u_WG8: $order = "\x72\x61\164\151\156\x67\40" . $order . "\x2c\40\x63\162\145\141\x74\x65\x5f\164\x69\x6d\x65\x20\144\x65\163\143"; goto E29rh; jIInl: MmayA: goto zXHzB; MaNfG: gLM2_: goto c310N; VAiJe: $conditions["\151\144"] = ["\x69\x6e", $subjectIds]; goto wn3Ks; TbOPn: $conditions["\x64\145\154\x65\164\145\x5f\x66\x6c\141\x67"] = $search["\144\145\154\x65\x74\145\x5f\x66\x6c\x61\x67"]; goto V6EcV; W7GZa: return ["\164\157\164\141\154" => 0, "\x72\x6f\x77\x73" => []]; goto UiIvK; HVDNz: hmM8W: goto MIINR; scuGy: $order = "\x63\x75\162\x72\145\156\x74\137\x70\162\151\x63\x65\x20" . $order . "\54\40\x63\x72\145\x61\x74\145\137\x74\151\155\x65\x20\x64\145\x73\143"; goto tLF2G; Y3cIP: A57kX: goto uieob; IhHs7: goto X6qua; goto Ptf0F; uRjUf: zcBBY: goto scuGy; E29rh: Wm4_9: goto IhHs7; ZCcc5: $subjectIds = Db::table("\x73\165\142\x6a\x65\143\164\x5f\x63\x61\164\145\147\x6f\x72\x79\137\x72\145\x6c\x61\x74\x65")->where(["\143\x61\x74\x65\x67\157\x72\x79\x5f\x69\144" => $search["\143\141\164\145\147\157\162\x79\137\x69\x64"]])->column("\163\165\142\152\145\143\x74\x5f\151\x64"); goto kYMnN; VPU6W: goto S6HRS; goto X0X2Q; eJ2l7: ANDUS: goto VPU6W; rG9W6: fAtWj: goto GdCkt; O1eqd: $order = "\160\141\x72\x74\x69\x63\x69\160\x61\x6e\164\x73\x20" . $order . "\x2c\x20\x63\x72\145\x61\164\x65\x5f\x74\x69\x6d\x65\x20\144\x65\163\x63"; goto S5cIo; OKa9V: $conditions["\x73\x74\141\164\165\x73"] = $search["\x73\164\x61\164\x75\163"]; goto HVDNz; Qa4Go: goto sgtRr; goto MaNfG; oAh8o: $conditions["\164\x79\160\145"] = $search["\164\171\x70\145"]; goto ty0Gc; NVdum: goto ANDUS; goto jIInl; ZN7qX: if ($sort == "\163\x74\141\x74\165\163") { goto RhLkO; } goto WhtFy; Xnjul: if (emptyInArray($search, "\x6c\141\142\145\154")) { goto EsgW1; } goto sg2Vv; WhtFy: if ($sort == "\x72\x61\x74\x69\156\147") { goto TagMJ; } goto bLRk_; hlIRp: if ($sort == "\163\x6f\162\164") { goto gLM2_; } goto ZN7qX; V6EcV: goto RQQLX; goto Y3cIP; wn3Ks: vvVcw: goto mnCy3; qQ0H6: foreach ($records as &$record) { goto F1CNl; Mjktz: cwWhf: goto nbcwM; W5J80: $record["\151\x6d\141\x67\x65\137\165\x72\x6c"] = generateThumbnailUrl($record["\x69\x6d\x61\147\x65\x5f\165\x72\154"], 100); goto s1ltq; F1CNl: $record["\x63\x61\x74\145\x67\x6f\162\171"] = $this->getCategoryNameStr($record["\x69\x64"]); goto VM0OV; s1ltq: $record["\x62\x61\156\156\x65\162\x5f\x69\x6d\x67"] = generateThumbnailUrl($record["\142\141\156\x6e\x65\162\x5f\151\155\147"], 100); goto Mjktz; VM0OV: $record["\151\164\145\x6d\x5f\156\165\155"] = Db::table("\x73\165\142\152\x65\x63\164\137\x69\164\x65\x6d")->where("\163\x75\x62\152\x65\x63\164\137\x69\x64", $record["\x69\144"])->count(); goto W5J80; nbcwM: } goto rG9W6; S5cIo: S6HRS: goto Bziei; tLF2G: ESI4Z: goto LXhfJ; kYMnN: if (!empty($subjectIds)) { goto aH2rV; } goto W7GZa; pa0AQ: $totalCount = Db::table("\163\165\x62\x6a\x65\x63\x74")->where($conditions)->count(); goto LaGAM; v6xRP: $conditions["\x6e\141\155\145"] = ["\154\x69\153\145", "\45{$search["\156\x61\x6d\145"]}\x25"]; goto PcZ1f; MIINR: if (!isset($search["\x64\145\154\x65\x74\x65\137\x66\154\x61\x67"])) { goto A57kX; } goto TbOPn; sg2Vv: $conditions["\154\141\142\x65\154"] = ["\154\x69\153\x65", "\45{$search["\x6c\141\142\x65\154"]}\x25"]; goto VeGaF; D70yx: TagMJ: goto u_WG8; VeGaF: EsgW1: goto b7MAF; PcZ1f: GYv_Z: goto Xnjul; c310N: $order = "\163\x6f\162\x74\40" . $order . "\x2c\40\x63\162\145\141\164\x65\137\164\x69\155\145\40\x64\145\163\143"; goto PPpz8; Dn_Gw: if ($sort == "\143\x75\162\162\x65\156\164\137\x70\x72\151\x63\x65") { goto zcBBY; } goto NuVjd; Bziei: goto ESI4Z; goto uRjUf; LXhfJ: $conditions = []; goto JAIcG; Padzi: X6qua: goto Qa4Go; PPpz8: sgtRr: goto NVdum; b7MAF: if (emptyInArray($search, "\x73\x74\x61\164\x75\163")) { goto hmM8W; } goto OKa9V; bLRk_: $order = "\x73\x6f\x72\x74\x20\x61\x73\143\54\40\143\162\x65\141\x74\x65\x5f\x74\x69\155\x65\x20\x64\x65\x73\143"; goto l8nU0; UzpKb: RQQLX: goto pa0AQ; Ptf0F: RhLkO: goto uRjqE; uieob: $conditions["\x64\145\154\x65\x74\x65\x5f\146\154\x61\147"] = 0; goto UzpKb; zXHzB: $order = "\164\157\x74\x61\x6c\137\x61\x6d\157\165\156\164\40" . $order . "\x2c\x20\x63\162\145\141\x74\145\137\x74\151\155\145\x20\144\x65\x73\x63"; goto eJ2l7; mnCy3: if (emptyInArray($search, "\156\x61\155\x65")) { goto GYv_Z; } goto v6xRP; ty0Gc: FMyYI: goto D9cza; r9UO3: } public function getAvailableCategories() { return Db::table("\143\x61\164\145\147\x6f\x72\x69\x65\163")->order("\x69\x64\40\x61\x73\x63")->column("\151\144\54\x6e\x61\x6d\145\x2c\163\x74\x61\x74\165\163\54\151\155\147\x5f\165\x72\154"); } public function getCategoryNameStr($id) { goto lRcds; RY5bX: return ''; goto CTFeP; CTFeP: SzhGu: goto tP2_W; ojdzx: if (!empty($names)) { goto SzhGu; } goto RY5bX; tP2_W: return implode("\54", $names); goto ByjF0; lRcds: $names = Db::table("\163\x75\x62\152\145\143\164\x5f\x63\141\164\x65\x67\157\x72\171\x5f\162\145\154\x61\164\145")->alias("\x53\x43\122")->join("\143\141\164\x65\147\157\162\151\x65\163\x20\103", "\123\x43\122\x2e\x63\x61\x74\145\147\157\162\171\137\x69\x64\75\x43\56\x69\x64\40\141\x6e\144\x20\x53\103\x52\x2e\163\x75\x62\x6a\x65\x63\164\137\x69\x64\x3d" . $id)->column("\x43\x2e\156\x61\155\x65"); goto ojdzx; ByjF0: } public function getCategoryIds($id) { goto kbOJc; ebmID: if (!empty($categoryIds)) { goto CCjvZ; } goto l9xQ9; ZOgoY: CCjvZ: goto uUF4W; l9xQ9: $categoryIds = []; goto ZOgoY; kbOJc: $categoryIds = Db::table("\163\x75\x62\152\x65\143\164\x5f\143\x61\164\145\147\x6f\x72\x79\x5f\x72\145\x6c\141\164\x65")->where("\163\x75\x62\x6a\145\143\x74\x5f\x69\144", $id)->column("\143\x61\x74\145\x67\x6f\x72\x79\137\x69\144"); goto ebmID; uUF4W: return $categoryIds; goto GkEzL; GkEzL: } public function getDefaultSubject() { return ["\x69\x64" => 0, "\151\155\141\147\x65\137\165\162\x6c" => '', "\x62\x61\156\x6e\145\x72\137\151\155\x67" => '', "\156\141\x6d\145" => '', "\163\165\x62\164\151\164\154\x65" => '', "\143\x75\x72\x72\145\156\x74\x5f\x70\x72\151\x63\145" => 0, "\145\x78\160\145\143\164\x5f\x66\x69\x6e\151\163\x68\x5f\164\151\x6d\x65" => 8, "\x73\x75\x62\152\145\143\164\x5f\x64\145\163\x63" => '', "\163\x75\x62\x6a\145\143\164\137\x74\x69\160" => '', "\163\x74\141\x74\x75\x73" => IndexDefs::ENTITY_DRAFT_STATUS, "\x72\x61\164\151\156\147" => 5, "\x74\145\163\164\137\x61\154\154\157\167\137\142\141\143\153" => 0, "\x74\145\x73\164\137\141\x6c\x6c\157\167\137\x76\151\145\x77\137\x72\x65\x70\x6f\162\164" => 1, "\165\156\x69\x5f\141\x70\x70" => 0, "\x70\x61\162\164\x69\x63\151\x70\x61\x6e\x74\x73\137\163\x68\x6f\x77" => 0, "\x74\x65\x73\164\x5f\x61\154\x6c\157\167\x5f\x61\156\x73\x77\145\x72\137\145\155\160\164\x79" => 0]; } public function getSubject($id) { $subject = Db::table("\163\x75\142\152\x65\143\x74")->where("\x69\x64", $id)->field(true)->find(); return $subject; } public function loadSubjectStandards($subjectId, $wholeFlag = false) { goto ST0Xr; ST0Xr: $rows = Db::table("\163\x75\142\152\145\143\x74\x5f\163\164\x61\x6e\144\141\x72\x64")->where(["\163\x75\x62\152\x65\x63\x74\137\x69\144" => $subjectId])->field("\151\144\x20\141\x73\x20\x73\x74\141\156\144\x61\162\144\x5f\151\144\54\40\154\x61\164\151\x74\x75\144\145\x2c\x20\163\x74\x61\164\x69\x73\164\151\143\x5f\x77\x65\151\x67\150\164\137\x6d\x69\x6e\x2c\40\163\164\x61\164\151\x73\164\x69\x63\137\x77\145\151\x67\x68\164\x5f\155\141\x78\x2c\40\163\164\141\x6e\x64\x61\x72\x64\137\x77\145\151\147\x68\x74\137\x6d\x69\156\54\40\163\x74\x61\x6e\x64\x61\162\144\137\167\145\151\147\x68\164\137\155\141\x78\x2c\40\x73\157\162\x74\x2c\x20\x72\x65\155\x61\162\153")->order("\x73\x6f\x72\x74\40\x61\x73\x63\54\40\x69\144\40\141\163\143")->select(); goto hXA6x; v5a2M: Ih_tI: goto kXaJv; wkfcO: k9FmJ: goto AlSOK; jjhg_: if (!$subject) { goto Ih_tI; } goto VxrKg; D0iMD: return $rows; goto Qoo1v; VxrKg: array_unshift($rows, ["\x73\164\x61\x6e\x64\141\x72\x64\x5f\151\144" => 0, "\154\141\164\x69\x74\x75\x64\x65" => Defs::SUBJECT_WHOLE_STANDARD, "\151\x74\x65\x6d\137\x63\157\x75\x6e\164" => $subject["\x69\164\x65\155\163"], "\x77\145\x69\x67\150\x74\x5f\155\151\156\x5f\155\141\x78" => $subject["\163\164\141\164\x69\163\164\x69\x63\137\x77\x65\x69\x67\150\x74\x5f\x6d\151\156"] . "\x20\x2d\x20" . $subject["\x73\x74\141\x74\151\163\x74\x69\143\137\167\x65\151\147\x68\164\137\x6d\141\170"], "\163\x74\141\156\x64\141\162\144\137\167\x65\151\x67\150\x74\x5f\x6d\x69\156\137\x6d\141\170" => $subject["\x73\x74\x61\156\144\141\x72\144\x5f\x77\x65\x69\x67\x68\164\137\x6d\151\156"] !== null && $subject["\x73\164\x61\x6e\x64\141\x72\x64\x5f\167\x65\151\x67\x68\164\x5f\x6d\x61\170"] !== null ? $subject["\x73\164\x61\156\144\141\x72\144\137\x77\x65\x69\147\x68\x74\137\155\151\156"] . "\40\55\40" . $subject["\x73\x74\141\156\144\141\x72\x64\137\167\x65\x69\x67\150\x74\x5f\x6d\141\170"] : null]); goto v5a2M; uqq7B: $subject = Db::table("\x73\165\x62\x6a\145\x63\164")->where("\x69\x64", $subjectId)->field("\151\164\145\155\163\x2c\x20\163\164\x61\x74\151\163\x74\151\x63\137\x77\145\151\147\x68\x74\137\155\151\156\54\40\163\x74\141\x74\151\x73\x74\151\143\137\x77\x65\x69\147\150\164\x5f\x6d\141\170\54\x20\163\164\141\156\x64\x61\162\144\137\x77\x65\x69\147\x68\164\137\155\151\x6e\54\x20\163\x74\x61\156\144\x61\162\x64\x5f\x77\145\x69\147\x68\164\x5f\x6d\141\170")->find(); goto jjhg_; AlSOK: foreach ($rows as &$row) { goto PRC37; qZlA0: f65Ac: goto izrnL; J6V2n: $maxWeight = $row["\x73\x74\141\x74\x69\163\164\151\143\137\x77\x65\151\x67\x68\x74\137\155\141\170"]; goto n3vYv; NjsKX: $row["\x73\164\x61\x6e\x64\x61\162\144\x5f\167\145\x69\147\150\164\137\x6d\151\156\x5f\x6d\141\x78"] = null; goto phEax; nWXuw: BFF0e: goto gByTu; phEax: goto TnSvh; goto qZlA0; n3vYv: $row["\x77\145\151\x67\x68\164\x5f\155\x69\156\x5f\x6d\141\x78"] = $minWeight . "\40\x2d\x20" . $maxWeight; goto i7dIT; i7dIT: if ($row["\x73\x74\x61\156\x64\141\x72\144\137\x77\x65\151\x67\150\x74\137\155\x69\156"] !== null && $row["\163\164\141\156\x64\141\x72\144\x5f\167\145\x69\x67\x68\164\137\x6d\141\x78"] !== null) { goto f65Ac; } goto NjsKX; PRC37: $standardId = $row["\163\164\141\156\x64\141\162\x64\137\x69\x64"]; goto deX0_; deX0_: $row["\151\x74\x65\x6d\x5f\143\157\x75\x6e\164"] = Db::table("\x73\x75\x62\x6a\x65\x63\164\137\151\164\145\155\137\x73\164\141\x6e\144\141\162\x64")->where(["\163\x75\142\x6a\x65\x63\x74\137\x69\x64" => $subjectId, "\163\164\x61\156\144\x61\x72\144\x5f\151\x64" => $standardId])->count(); goto mHPHj; mHPHj: $minWeight = $row["\163\164\141\x74\x69\163\x74\x69\x63\x5f\167\145\x69\147\x68\x74\x5f\155\x69\156"]; goto J6V2n; phVcs: TnSvh: goto nWXuw; izrnL: $row["\x73\x74\141\x6e\x64\141\162\x64\137\167\x65\151\x67\x68\164\137\155\x69\x6e\137\155\x61\x78"] = $row["\x73\164\141\156\144\141\x72\x64\x5f\x77\145\x69\x67\150\164\137\155\151\156"] . "\x20\55\40" . $row["\x73\164\141\156\x64\141\x72\144\137\167\145\151\147\150\164\137\155\141\x78"]; goto phVcs; gByTu: } goto iYiS0; Gtp_A: $rows = []; goto wkfcO; hXA6x: if ($rows) { goto k9FmJ; } goto Gtp_A; r8uDc: if (!$wholeFlag) { goto tfKwd; } goto uqq7B; kXaJv: tfKwd: goto D0iMD; iYiS0: frjlN: goto r8uDc; Qoo1v: } public function getSubjectStandard($id) { $standard = Db::table("\x73\x75\142\x6a\145\143\164\x5f\163\x74\141\x6e\x64\141\162\x64")->where("\x69\x64", $id)->field(true)->find(); return $standard; } public function saveSubjectStandard($subjectId, $standardId, $formData) { goto pol48; pol48: if (empty($standardId)) { goto lriK7; } goto JMAQ9; Zqtlm: lriK7: goto tYFPk; tHneP: Jae5V: goto jXz0p; JMAQ9: Db::table("\x73\x75\142\152\145\x63\x74\137\x73\x74\x61\x6e\144\141\x72\x64")->where(["\x69\144" => $standardId])->update($formData); goto YgFFg; YgFFg: Db::table("\163\165\142\x6a\145\143\x74\x5f\163\164\x61\156\x64\x61\x72\x64\x5f\154\x61\x74\x69\164\x75\x64\x65")->where(["\163\164\141\x6e\x64\141\162\x64\x5f\x69\x64" => $standardId])->update(["\x6c\141\164\x69\164\x75\144\x65" => $formData["\x6c\141\164\151\x74\x75\x64\145"]]); goto EPb53; EPb53: goto Jae5V; goto Zqtlm; tYFPk: $formData["\x73\165\142\x6a\145\x63\x74\137\x69\x64"] = $subjectId; goto bFl4T; bFl4T: Db::table("\x73\x75\142\152\x65\x63\x74\x5f\163\164\x61\x6e\x64\x61\x72\x64")->insert($formData); goto tHneP; jXz0p: } public function removeSubjectStandard($subjectId, $standardId) { goto tmQLh; w7yKM: $this->updateSubjectStandardMinMax($subjectId); goto wKrYe; E9L4d: Db::table("\x73\x75\x62\152\x65\143\x74\x5f\151\164\x65\155\137\x73\164\x61\156\x64\141\x72\144")->where("\x73\164\141\156\144\x61\162\144\137\151\x64", $standardId)->delete(); goto ihwnn; tmQLh: Db::table("\x73\165\x62\152\x65\143\164\137\163\x74\141\x6e\x64\x61\162\x64")->where(["\151\x64" => $standardId])->delete(); goto E9L4d; ihwnn: Db::table("\163\165\x62\152\145\x63\164\137\163\164\141\156\144\x61\162\144\137\x6c\x61\x74\x69\x74\x75\x64\145")->where("\163\x74\141\x6e\x64\141\x72\x64\x5f\x69\x64", $standardId)->delete(); goto w7yKM; wKrYe: } public function saveSubject($id, $formData) { goto J3Ulz; emsLK: OperationLogs::I()->subjectLog("\346\x96\xb0\xe5\242\x9e\351\207\x8f\350\xa1\xa8\x20\x2d\x20{$subjectName}", beautifyLogArray($formData, [], "\163\165\x62\152\x65\143\164"), OperationLogs::OPT_ADD_TYPE, $subjectId); goto QbtGW; x34ML: $formData["\x75\156\x69\x5f\x61\x70\x70"] = $formData["\x75\x6e\x69\137\x61\x70\160"] ?? 0; goto ySCqj; j73U8: $originals = Db::table("\x73\165\142\x6a\x65\x63\164")->where(["\x69\x64" => $id])->field(true)->find(); goto uG4vF; dWJrA: $formData["\151\x6d\141\147\x65\x5f\165\x72\x6c"] = $imageUrl; goto zwX6Z; LSmNq: if ($model) { goto IQ9TH; } goto a_sg2; ySCqj: $formData["\155\157\x64\x69\x66\x79\x5f\x74\151\155\x65"] = date("\x59\x2d\155\55\x64\x20\x48\x3a\151\72\163"); goto uXUD8; lO0_M: $subjectId = $id; goto TMweR; a_sg2: wexception("\346\227\xa0\xe6\xb3\x95\346\x89\276\xe5\210\260\350\257\xa5\351\x87\x8f\xe8\241\xa8"); goto jEXbk; sRc85: $model = SubjectModel::get($id); goto LSmNq; cDElN: if (empty($id)) { goto sp7vs; } goto lO0_M; mMJV2: Db::table("\x73\x75\142\x6a\x65\x63\164\x5f\x63\x61\x74\x65\x67\x6f\162\x79\137\162\x65\x6c\x61\164\x65")->where(["\163\165\x62\x6a\x65\143\x74\137\151\144" => $subjectId])->delete(); goto V2QBQ; xSSlo: $categoryIds = explode("\x2c", $formData["\x63\x61\164\x65\147\157\x72\x79\x5f\x69\144\163"]); goto Vys4_; jEXbk: IQ9TH: goto j73U8; uXUD8: $imageUrl = autoGenerateImage($formData["\x6e\141\155\145"], $formData["\x69\x6d\141\x67\x65\x5f\x75\162\x6c"]); goto LT1ki; UrT7Y: $categoryIds = []; goto PcZ9x; gHZOj: OperationLogs::I()->subjectLog("\344\277\xae\xe6\x94\271\xe9\207\217\350\241\xa8\40\55\40\40{$subjectName}", beautifyLogArray($formData, $originals, "\x73\165\142\152\145\143\164"), OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto Ji3fi; SrqDa: Db::table("\163\x75\x62\152\x65\143\x74\x5f\x63\141\x74\145\147\x6f\162\x79\137\x72\x65\x6c\x61\x74\145")->where(["\x73\x75\x62\x6a\145\x63\x74\x5f\151\144" => $subjectId, "\x63\141\164\145\147\157\x72\171\137\151\144" => ["\156\157\164\40\151\x6e", $categoryIds]])->delete(); goto FGfuy; I_oUB: $model->allowField(true)->save(); goto cDElN; uG4vF: goto deBg6; goto ZBPAq; LT1ki: if (!$imageUrl) { goto LVIzl; } goto dWJrA; bZ_4V: $formData["\163\156"] = generateSubjectSn(); goto uHM9q; V2QBQ: goto Erl3N; goto QaYA7; zwX6Z: LVIzl: goto cmBiL; PcZ9x: if (!$formData["\x63\x61\x74\145\x67\x6f\162\x79\x5f\x69\x64\163"]) { goto xGzVa; } goto xSSlo; KrVLc: if ($categoryIds) { goto OBgIa; } goto mMJV2; QbtGW: Vir2O: goto UrT7Y; ZBPAq: PFONU: goto Mun9Z; Ji3fi: goto Vir2O; goto CC09A; VUnDq: $subjectName = Db::table("\x73\165\x62\152\145\143\164")->where(["\x69\x64" => $subjectId])->value("\156\x61\155\x65"); goto emsLK; W6Nmr: nM5lN: goto zWpVA; FGfuy: Erl3N: goto suG5l; uHM9q: deBg6: goto x34ML; CC09A: sp7vs: goto g2SIn; J3Ulz: if (empty($id)) { goto PFONU; } goto sRc85; g2SIn: $subjectId = $model->id; goto VUnDq; suG5l: foreach ($categoryIds as $categoryId) { goto PaHYe; jeNnq: Db::table("\x73\165\142\152\x65\x63\x74\x5f\x63\141\164\145\147\x6f\162\x79\x5f\x72\x65\154\141\164\x65")->insert(["\163\165\x62\x6a\x65\x63\x74\137\x69\x64" => $subjectId, "\x63\x61\164\145\x67\157\x72\171\137\151\x64" => $categoryId]); goto P95M3; P95M3: A1nIN: goto uCTBP; uCTBP: BTCkL: goto fEXLd; PaHYe: $bExist = Db::table("\x73\165\x62\x6a\145\143\164\137\143\141\164\145\x67\x6f\x72\x79\x5f\162\145\154\x61\x74\x65")->where(["\x73\x75\x62\x6a\x65\x63\164\137\151\x64" => $subjectId, "\143\141\164\x65\147\157\162\x79\x5f\151\x64" => $categoryId])->find(); goto JzBoi; JzBoi: if ($bExist) { goto A1nIN; } goto jeNnq; fEXLd: } goto W6Nmr; Vys4_: xGzVa: goto KrVLc; Mun9Z: $model = new SubjectModel(); goto bZ_4V; cmBiL: $model->data($formData); goto I_oUB; TMweR: $subjectName = Db::table("\x73\165\x62\152\145\x63\x74")->where(["\x69\x64" => $id])->value("\x6e\141\155\x65"); goto gHZOj; QaYA7: OBgIa: goto SrqDa; zWpVA: } public function setLabel($subjectId, $label, $action) { goto LpWKE; Kcz_v: IOnd9: goto x7noN; L4uOx: $value = array_filter($value, function ($v) use($label) { return $v != $label; }); goto muw7S; muw7S: goto IOnd9; goto XuviP; DLetO: if (!($label == "\x62\141\156\156\145\162")) { goto GKbwl; } goto JYfNw; JYfNw: if (!(empty($subject["\x69\155\x61\x67\145\137\165\162\154"]) && empty($subject["\142\x61\x6e\x6e\x65\162\137\x69\x6d\147"]))) { goto QIv6U; } goto AFTcn; LpWKE: $subject = Db::table("\x73\165\142\152\x65\x63\x74")->where(["\151\144" => $subjectId])->field("\154\x61\142\145\154\54\x20\151\155\x61\147\145\137\165\x72\x6c\x2c\40\142\141\x6e\x6e\145\162\137\151\155\147")->find(); goto L8qM3; yHPec: atek1: goto xqTFP; L8qM3: if (!empty($subject)) { goto atek1; } goto r3LnI; x7noN: Db::table("\x73\165\x62\152\145\x63\164")->where(["\151\144" => $subjectId])->setField("\154\x61\x62\145\x6c", join("\54", $value)); goto lN0TP; I9iWh: $value = $value ? explode("\54", $value) : []; goto T7VfC; T7VfC: if ($action == "\164\x72\x75\x65" || $action == "\61") { goto dRa90; } goto L4uOx; r3LnI: wexception("\346\227\xa0\346\263\225\xe6\x89\xbe\345\210\260\xe8\xaf\245\351\x87\x8f\350\241\250"); goto yHPec; AFTcn: wexception("\xe8\256\276\xe4\xb8\272\xe8\xbd\xae\xe6\222\xad\357\xbc\x8c\351\x87\x8f\xe8\241\xa8\xe5\x9b\276\xe7\x89\207\344\xb8\x8d\350\203\xbd\xe4\xb8\xba\xe7\251\xba"); goto FT2Cw; XuviP: dRa90: goto DLetO; FT2Cw: QIv6U: goto ip3UA; xqTFP: $value = $subject["\154\141\142\145\x6c"]; goto I9iWh; ip3UA: GKbwl: goto MnP0j; MnP0j: $value[] = $label; goto Kcz_v; lN0TP: } public function qrcode($id) { goto EEMlb; EEMlb: $subject = $this->getSubject($id); goto NZkBe; v2vJi: if (systemSetting("\127\x58\x5f\x4f\106\x46\x49\x43\x45\x5f\x41\x43\x43\x4f\125\116\x54\x5f\x41\x50\x50\x5f\111\104")) { goto DEhzb; } goto Twm28; NZkBe: if ($subject) { goto V05nK; } goto pdZxv; Yxtjz: wexception("\xe5\x86\x99\xe5\205\245\345\x9b\xbe\345\203\217\346\x96\x87\xe4\273\266\xe5\xa4\261\xe8\264\xa5"); goto yKkcy; DXBOK: try { goto npn7b; e3VF3: if (!(!$res || !isset($res["\164\x69\x63\153\145\164"]))) { goto ZgMwj; } goto u4yvA; HrjJC: Log::notice("\x73\165\142\152\x65\x63\164\40\x71\162\143\x6f\144\145\40\x72\x65\164\165\162\156\x20" . var_export($res, true)); goto p9e7i; u4yvA: exception("\346\x8e\245\345\x8f\xa3\xe8\277\224\345\x9b\236\xe5\244\xb1\350\264\245\x2c\x20" . var_export($res, true)); goto YgUXl; V7kn4: if (!$res) { goto j4GWK; } goto HrjJC; npn7b: $res = $app->qrcode->forever($scene_id); goto V7kn4; p9e7i: j4GWK: goto e3VF3; Xj1x7: $url = $app->qrcode->url($res["\164\151\x63\153\145\x74"]); goto PI7Ah; YgUXl: ZgMwj: goto Xj1x7; PI7Ah: } catch (\Exception $e) { wexception("\xe7\x94\237\346\210\x90\xe5\xa4\xb1\350\xb4\245\xef\xbc\x9a" . $e->getMessage()); } goto bmHpv; hdrUY: V05nK: goto v2vJi; HCupG: $result = file_put_contents(SITE_DIR . $path, file_get_contents($url)); goto jA7Y9; jA7Y9: if ($result) { goto eB6Jb; } goto Yxtjz; AsuVG: Db::table("\x73\165\x62\152\x65\x63\x74")->where(["\x69\144" => $id])->setField("\161\162\x63\x6f\144\145", $path); goto BraAm; pdZxv: wexception("\xe6\227\xa0\346\263\x95\346\x89\xbe\345\x88\xb0\350\xaf\245\xe9\x87\217\350\xa1\250"); goto hdrUY; bmHpv: $path = "\x2f\161\x72\x63\x6f\x64\145\x2f" . $scene_id . "\56\152\160\147"; goto HCupG; QAEsl: DEhzb: goto uK9Px; Twm28: wexception("\347\x94\237\xe6\210\x90\xe5\xa4\xb1\350\xb4\xa5\357\274\x9a\xe6\234\252\xe9\205\215\xe7\xbd\256\xe5\x85\254\xe4\274\x97\345\217\xb7\345\x8f\202\xe6\x95\xb0"); goto QAEsl; uK9Px: wxPaySetting(); goto ae5bl; yKkcy: eB6Jb: goto AsuVG; BraAm: return $path; goto p2Nad; ae5bl: $app = \EasyWeChat\Factory::officialAccount(config("\x77\170\x2e\157\x66\146\151\143\151\141\154\x5f\x61\143\143\157\165\x6e\164")); goto FESsI; FESsI: $scene_id = "\164\145\163\164\137\151\x64\137" . $id; goto DXBOK; p2Nad: } public function remove($id) { goto EZVwF; EZVwF: $subject = $this->getSubject($id); goto kByaP; Z5Feh: Q9QlB: goto bC_7M; bC_7M: Db::table("\163\x75\142\x6a\x65\143\164")->where(["\x69\144" => $id])->setField("\x64\145\154\145\164\145\x5f\x66\154\x61\x67", "\61"); goto ao1nD; Rq7qX: wexception("\346\227\xa0\xe6\xb3\225\xe6\211\xbe\345\x88\260\xe8\xaf\xa5\351\x87\217\350\xa1\xa8"); goto Z5Feh; ao1nD: OperationLogs::I()->subjectLog("\xe5\x88\240\351\231\xa4\xe9\207\x8f\350\241\250", $subject["\156\141\x6d\x65"], OperationLogs::OPT_DELETE_TYPE, $id); goto jDY99; kByaP: if ($subject) { goto Q9QlB; } goto Rq7qX; jDY99: } public function restore($id) { goto JryJK; SJque: if ($subject) { goto RaTZw; } goto bqGKI; bqGKI: wexception("\xe6\227\240\346\xb3\x95\346\211\xbe\xe5\x88\xb0\xe8\xaf\245\xe9\x87\217\xe8\241\xa8"); goto XChwa; YE0hT: OperationLogs::I()->subjectLog("\346\201\xa2\xe5\244\215\xe9\207\217\350\241\250", $subject["\x6e\x61\x6d\x65"], OperationLogs::OPT_RESTORE_TYPE, $id); goto DVhmO; JryJK: $subject = $this->getSubject($id); goto SJque; czU_1: Db::table("\163\165\142\x6a\145\x63\x74")->where(["\151\x64" => $id])->setField("\x64\x65\x6c\145\164\x65\x5f\x66\x6c\141\x67", "\60"); goto YE0hT; XChwa: RaTZw: goto czU_1; DVhmO: } public function removeForce($id) { goto N9DrS; Zncoh: $subjectCb = Db::table("\163\x75\142\152\145\143\164\x5f\x63\x6f\155\x62\151\156\x61\164\x69\157\x6e")->where([["\145\170\160", Db::raw("\x46\111\x4e\x44\x5f\x49\x4e\137\123\x45\x54\50{$id}\x2c\x20\163\165\142\x6a\x65\x63\x74\x73\51")]])->find(); goto B4aiX; XDszC: $goods = Db::table("\144\151\x61\x6e\x5f\147\157\x6f\144\163")->where(["\x73\165\x62\x6a\145\143\164\x5f\151\x64" => $id])->find(); goto w9n2r; KyRkc: Db::table("\x75\156\x69\137\x61\160\x70\137\157\162\x64\x65\162\163")->where("\163\165\142\152\145\143\x74\137\x69\144", $id)->delete(); goto Yf_vY; N9DrS: $subject = $this->getSubject($id); goto GOwJz; V4s0Q: d3B5N: goto XDszC; Yf_vY: Db::table("\163\165\142\x6a\145\x63\164\137\151\164\145\x6d")->where("\163\165\142\152\145\x63\x74\x5f\x69\x64", $id)->delete(); goto aY3x_; MwwJn: wexception("\xe5\xb7\262\xe5\x8f\x91\xe5\270\203\347\x94\265\xe5\x95\206\xe4\xba\xa7\xe5\223\x81\xef\xbc\214\xe4\270\215\350\203\275\345\210\xa0\xe9\231\xa4"); goto uai3Z; tjWgq: OperationLogs::I()->subjectLog("\347\241\254\345\x88\xa0\xe9\x99\244\xe9\207\217\xe8\241\xa8", $subject["\156\141\x6d\145"], OperationLogs::OPT_DELETE_TYPE, $id); goto x8e3w; w9n2r: if (!$goods) { goto MBhRp; } goto MwwJn; N60K2: Db::table("\x73\165\x62\x6a\145\143\x74\x5f\143\157\x6c\154\x65\143\x74")->where("\x73\165\x62\152\145\143\x74\137\151\144", $id)->delete(); goto exWLF; B4aiX: $subjectSurvey = Db::table("\x73\x75\162\x76\x65\x79")->where([["\145\170\x70", Db::raw("\106\111\x4e\x44\137\x49\116\137\123\105\x54\50{$id}\54\x20\x73\x75\x62\152\x65\x63\x74\x73\51")]])->find(); goto Aynip; JSlp5: wexception("\346\227\xa0\xe6\xb3\225\346\211\xbe\xe5\x88\260\350\xaf\245\351\x87\x8f\350\241\250"); goto MuZbZ; nYz9P: Db::table("\163\165\142\152\145\143\x74")->where("\x69\x64", $id)->delete(); goto tjWgq; Aynip: if (!($subjectCb || $subjectSurvey)) { goto d3B5N; } goto s5sF8; GOwJz: if ($subject) { goto whwRS; } goto JSlp5; MuZbZ: whwRS: goto Zncoh; qCF02: Db::table("\163\165\142\x6a\x65\x63\x74\x5f\x73\164\141\156\144\141\162\144\137\154\141\x74\151\x74\165\144\x65")->where("\x73\x75\x62\x6a\145\x63\164\137\151\144", $id)->delete(); goto U72yq; U72yq: Db::table("\163\x75\142\152\x65\x63\x74\x5f\x63\x61\164\145\147\157\162\171\137\162\x65\154\x61\164\x65")->where("\163\x75\142\x6a\x65\x63\x74\137\x69\x64", $id)->delete(); goto N60K2; uai3Z: MBhRp: goto KyRkc; exWLF: Db::table("\163\165\x62\152\145\143\164\x5f\157\162\144\x65\x72")->where("\x73\x75\x62\x6a\x65\143\164\x5f\151\x64", $id)->delete(); goto nYz9P; NTkgW: Db::table("\x73\x75\x62\152\145\143\164\137\163\164\x61\x6e\x64\x61\x72\144")->where("\163\165\142\152\145\143\164\137\151\144", $id)->delete(); goto qCF02; s5sF8: wexception("\xe8\xaf\245\xe9\207\x8f\xe8\241\250\xe5\x85\263\350\201\224\347\273\204\345\x90\210\xe9\207\x8f\xe8\xa1\250\x2f\xe6\x99\256\xe6\237\245\xef\xbc\x8c\xe4\xb8\x8d\350\x83\xbd\345\210\xa0\xe9\x99\xa4"); goto V4s0Q; aY3x_: Db::table("\x73\165\142\152\x65\143\164\137\x69\x74\145\155\137\x73\164\141\156\x64\141\162\x64")->where("\x73\x75\142\x6a\145\x63\164\137\x69\x64", $id)->delete(); goto NTkgW; x8e3w: } public function saveSubjectReport($id, $formData) { goto xqPFa; uQSwM: goto tCLdx; goto mRiPY; R7NeF: exception("\346\x97\240\346\263\x95\346\x89\276\xe5\x88\260\xe8\257\xa5\xe9\207\217\xe8\xa1\xa8"); goto Fanre; Fanre: tJMRE: goto jPWEQ; rRGc9: if (empty($formData["\162\x65\160\x6f\x72\164\137\x65\x6c\145\155\x65\x6e\164\163"])) { goto GDXR0; } goto mx5Yd; jPWEQ: $originals = Db::table("\163\x75\142\152\145\x63\x74")->where(["\151\144" => $id])->field(true)->find(); goto rRGc9; xqPFa: $model = SubjectModel::get($id); goto jRBcG; jRBcG: if ($model) { goto tJMRE; } goto R7NeF; gZtJT: TUw2f: goto hjHIr; Qebpn: $model->data($formData); goto K8Bwz; QKwpH: OperationLogs::I()->subjectLog("\344\277\xae\xe6\224\271\xe9\207\217\xe8\xa1\xa8\xe6\212\245\345\x91\212\x20\55\x20{$originals["\156\x61\155\x65"]}", beautifyLogArray($formData, $originals, "\163\165\x62\152\x65\x63\164"), OperationLogs::OPT_UPDATE_TYPE, $id); goto gZtJT; mRiPY: GDXR0: goto eNcwC; K8Bwz: $result = $model->allowField(true)->save(); goto rEizL; eNcwC: $formData["\162\145\160\x6f\x72\x74\x5f\x65\154\x65\155\x65\x6e\x74\x73"] = ''; goto NrxAd; rEizL: if (!$result) { goto TUw2f; } goto QKwpH; mx5Yd: $formData["\162\x65\160\157\x72\164\x5f\x65\x6c\x65\155\145\156\x74\x73"] = implode("\54", $formData["\162\145\x70\x6f\x72\x74\137\145\154\145\155\x65\156\x74\163"]); goto uQSwM; NrxAd: tCLdx: goto Qebpn; hjHIr: } public function updateSubjectStandardMinMax($subjectId) { goto m4d2r; m4d2r: $items = Db::table("\163\x75\x62\x6a\x65\x63\164\x5f\x69\164\x65\155")->where("\163\165\x62\152\x65\143\164\137\151\144", $subjectId)->column("\151\x64\x2c\40\x74\x79\160\x65\x2c\x20\x77\x65\x69\147\150\x74\x5f\x31\54\167\145\x69\x67\150\164\137\x32\54\x77\x65\x69\147\150\164\137\63\54\167\145\151\x67\x68\x74\137\x34\x2c\167\145\x69\x67\150\x74\137\x35\54\x77\x65\151\147\x68\164\137\66\54\x77\x65\151\147\x68\x74\x5f\67\54\167\x65\x69\x67\150\164\137\70\54\x77\145\151\x67\x68\164\x5f\x39\x2c\x77\145\x69\147\150\x74\x5f\x31\60\54\x77\x65\151\x67\x68\x74\x5f\x31\61\x2c\167\x65\151\x67\150\164\x5f\61\x32"); goto VOncr; Eiox8: Db::table("\x73\165\142\152\145\x63\164")->where(["\151\x64" => $subjectId])->update(["\151\x74\145\x6d\163" => count($itemIds)]); goto Ldqr2; HT6ma: $points = $this->calculatePointsDirect($itemWeights); goto kPXRk; uNu7P: foreach ($latitudes as $standardId => $latitude) { goto hSZ2p; F05yD: if (!empty($itemWeights)) { goto GfUYu; } goto gkfEA; gkfEA: Db::table("\x73\165\x62\152\145\143\164\x5f\x73\x74\x61\x6e\144\x61\x72\144")->where(["\163\165\x62\152\145\x63\164\137\151\144" => $subjectId, "\x69\x64" => $standardId])->update(["\163\x74\141\164\x69\x73\x74\151\143\137\x77\145\x69\147\150\x74\x5f\155\151\x6e" => 0, "\x73\x74\x61\164\x69\x73\164\x69\143\137\x77\145\x69\x67\x68\x74\137\x6d\x61\x78" => 0]); goto lohCD; JqD3u: s3HeL: goto Lr7C3; trqil: Db::table("\x73\165\142\x6a\x65\143\x74\x5f\163\164\x61\x6e\x64\x61\x72\144")->where(["\x73\165\x62\152\x65\143\x74\x5f\x69\x64" => $subjectId, "\151\x64" => $standardId])->update(["\x73\164\x61\x74\151\163\164\151\143\137\167\145\x69\x67\x68\x74\137\155\151\156" => $weightMin, "\x73\164\141\164\x69\163\164\151\143\137\x77\145\151\147\x68\164\x5f\x6d\x61\170" => $weightMax]); goto JqD3u; HDVGw: list($weightMin, $weightMax) = $points; goto trqil; lohCD: goto s3HeL; goto C4nAQ; TavDH: $points = $this->calculatePointsDirect($itemWeights); goto HDVGw; hSZ2p: $itemWeights = []; goto wNypV; wNypV: $records = Db::table("\163\165\142\152\145\143\x74\137\x69\x74\x65\x6d\x5f\x73\164\x61\156\x64\x61\x72\144")->where(["\x73\x75\142\x6a\x65\143\x74\x5f\151\x64" => $subjectId, "\163\x74\141\156\x64\x61\162\x64\x5f\x69\144" => $standardId, "\x69\x74\145\155\137\x69\x64" => ["\151\156", $itemIds]])->field("\x69\164\x65\x6d\x5f\151\144")->select(); goto YtRHK; C4nAQ: GfUYu: goto TavDH; YtRHK: foreach ($records as $record) { goto xNaBU; Dz75o: XKJny: goto LvI2j; aEdWT: if ($items[$itemId]["\x74\171\x70\145"] == Defs::QUESTION_RADIO) { goto NFCjY; } goto AuES0; xNaBU: $itemId = $record["\151\164\145\x6d\137\x69\x64"]; goto MPkep; cfuUY: $itemWeight[] = round($items[$itemId][$field] / 100, 2); goto xDzfK; Ff3FV: goto bTT83; goto IzaxW; yYX1u: goto XjlbA; goto qvHoy; xDzfK: $i++; goto DsueB; sID0q: jiyU_: goto Ig80T; qvHoy: QFNwm: goto cfuUY; PH9ro: $field = "\x77\x65\x69\x67\150\164\x5f" . $i; goto MskfX; MskfX: if (!($items[$itemId][$field] === null)) { goto QFNwm; } goto yYX1u; ddKUn: $itemWeight[] = array_sum($itemWeight); goto Dz75o; g61Ca: if (!($i <= 12)) { goto XjlbA; } goto PH9ro; zDxan: RyqWL: goto g61Ca; MPkep: $itemWeight = []; goto LM3i_; LvI2j: goto jiyU_; goto QT9u5; vjAjq: bTT83: goto GhEVd; Ig80T: $itemWeights[] = $itemWeight; goto vjAjq; AuES0: if (!($items[$itemId]["\164\171\x70\x65"] == Defs::QUESTION_CHECKBOX)) { goto XKJny; } goto ddKUn; d6EJp: XjlbA: goto V_ayn; QT9u5: NFCjY: goto sID0q; V_ayn: if (!empty($itemWeight)) { goto c4HvD; } goto Ff3FV; IzaxW: c4HvD: goto aEdWT; LM3i_: $i = 1; goto zDxan; DsueB: goto RyqWL; goto d6EJp; GhEVd: } goto ZW7We; ZW7We: pUZmb: goto F05yD; Lr7C3: } goto k6GOU; VOncr: $itemIds = array_keys($items); goto HcSjb; CK_dz: $latitudes = Db::table("\x73\x75\x62\x6a\x65\143\164\137\163\x74\x61\156\144\141\162\x64")->where("\163\x75\x62\x6a\145\143\164\x5f\x69\x64", $subjectId)->order("\163\x6f\162\x74\40\141\x73\x63\x2c\40\151\x64\40\x61\x73\x63")->column("\154\x61\x74\151\x74\x75\x64\x65", "\151\x64"); goto uNu7P; HcSjb: $itemWeights = []; goto jk51g; k6GOU: nyVnJ: goto HLJNU; Ldqr2: Db::table("\x73\x75\x62\x6a\x65\x63\164")->where(["\151\144" => $subjectId])->update(["\163\164\141\164\x69\x73\164\x69\x63\137\x77\x65\x69\147\x68\x74\137\x6d\x69\x6e" => $weightMin, "\163\x74\x61\164\x69\163\164\151\x63\137\x77\x65\151\147\150\164\x5f\x6d\141\170" => $weightMax]); goto CK_dz; kPXRk: list($weightMin, $weightMax) = $points; goto Eiox8; IdLGE: yKBjb: goto HT6ma; jk51g: foreach ($items as $item) { goto kXOrS; yhUiS: goto E776I; goto ogpZ3; VKwCX: $field = "\x77\145\151\x67\150\164\x5f" . $i; goto zTcTr; a46ab: $itemWeights[] = $itemWeight; goto WOcoo; fIQOc: if (!($i <= 12)) { goto eQ8VN; } goto VKwCX; tJcHS: $itemWeight[] = round($item[$field] / 100, 2); goto N283K; DkpdS: LGEXn: goto fIQOc; nz3R6: if (!empty($itemWeight)) { goto Jvg74; } goto yhUiS; ipFMG: goto LGEXn; goto nf2gA; kXOrS: $itemWeight = []; goto U37yB; oIMmS: sWFQU: goto tJcHS; zTcTr: if (!($item[$field] === null)) { goto sWFQU; } goto DwVUX; DwVUX: goto eQ8VN; goto oIMmS; N283K: $i++; goto ipFMG; ogpZ3: Jvg74: goto a46ab; U37yB: $i = 1; goto DkpdS; WOcoo: E776I: goto Lumat; nf2gA: eQ8VN: goto nz3R6; Lumat: } goto IdLGE; HLJNU: } protected function calculatePointsDirect($itemWeights) { goto wQFUn; zU2uj: $pointMax = 0; goto JiJzB; wQFUn: $pointMin = 0; goto zU2uj; cGyG7: BXq2E: goto kqpqL; kqpqL: return [$pointMin, $pointMax]; goto bdbiN; JiJzB: foreach ($itemWeights as $itemWeight) { goto VyoPV; wCnL3: goto KWDlQ; goto HEk6w; WuG5E: $pointMax += max($itemWeight); goto xBb3G; VyoPV: if (!empty($itemWeight)) { goto M7FnY; } goto wCnL3; vA3eu: $pointMin += min($itemWeight); goto WuG5E; HEk6w: M7FnY: goto vA3eu; xBb3G: KWDlQ: goto kYYiW; kYYiW: } goto cGyG7; bdbiN: } public function loadLatitudes($subjectId, $standardId) { goto ca13m; vl4_W: foreach ($rows as &$row) { goto SO8R3; D8CPE: h6Yi3: goto Mp1UI; rIe1E: $row["\x72\x65\x6d\x61\x72\153"] = ellipsisString($row["\162\145\x6d\141\162\153"], 32); goto D8CPE; mbPGa: $row["\163\x74\141\x6e\x64\x5f\144\x65\x73\x63"] = ellipsisString($row["\163\x74\141\156\144\137\x64\145\163\143"], 32); goto rIe1E; MBB0k: $row["\145\170\160\162\x65\163\x73\x69\157\156"] = convertSubjectExpression($expression); goto mbPGa; SO8R3: $expression = $row["\x65\170\160\162\x65\x73\163\x69\x6f\156"]; goto MBB0k; Mp1UI: } goto kMKBy; kMKBy: cKNn6: goto X5DeI; ca13m: $rows = Db::table("\163\165\142\x6a\145\x63\164\137\163\x74\141\x6e\144\x61\162\x64\137\154\x61\164\151\164\x75\x64\x65")->where(["\163\165\142\152\x65\x63\164\x5f\x69\x64" => $subjectId, "\x73\164\x61\x6e\144\x61\162\144\x5f\x69\x64" => $standardId])->order("\x73\x74\x61\156\144\x61\x72\x64\137\x69\144\x20\141\163\143")->field("\52")->select(); goto vl4_W; X5DeI: return $rows; goto rNa5R; rNa5R: } public function getLatitude($id) { $latitude = Db::table("\163\165\142\x6a\145\143\164\137\x73\164\141\156\x64\141\162\x64\x5f\x6c\x61\164\151\x74\165\144\x65")->where("\151\144", $id)->field(true)->find(); return $latitude; } protected function convertExpressionJson2Value($obj, $expression) { goto bCOEb; bCOEb: $operator = "\46\46"; goto ltg1Z; BSpSy: $expression = rtrim($expression, $operator); goto ZccJA; ZccJA: return $expression; goto Yk7tZ; ltg1Z: if (!($obj["\157\160"] == "\157\x72")) { goto f4Dxu; } goto RXTcR; ONCnX: f4Dxu: goto fKojq; RXTcR: $operator = "\174\x7c"; goto ONCnX; fKojq: foreach ($obj["\143\x68\x69\154\144\162\x65\x6e"] as $index => $objChild) { goto TYd94; uGlxY: $expression .= $objChild["\x66\x69\145\x6c\x64"]; goto crN_n; TYd94: if (!(isset($objChild["\x66\x69\x65\x6c\x64"]) && $objChild["\146\x69\x65\x6c\x64"] && isset($objChild["\x6f\160"]) && $objChild["\x6f\x70"] && isset($objChild["\166\141\154\x75\x65"]))) { goto W5Ejh; } goto uGlxY; crN_n: $expression .= $objChild["\157\160"]; goto ra1xD; HP2Ok: $expression .= $operator; goto ERq_2; DX5iU: Dy0Pa: goto u8n6H; CUc4P: $expression = $this->convertExpressionJson2Value($objChild, $expression); goto bg6Xh; vyHaP: W5Ejh: goto u1DTE; VDBFL: $expression .= $operator; goto DX5iU; ra1xD: $expression .= $objChild["\x76\141\154\165\145"]; goto HP2Ok; ERq_2: goto Z3kyo; goto vyHaP; bg6Xh: $expression .= "\x29"; goto VDBFL; u8n6H: Z3kyo: goto eq7sn; u1DTE: if (!(isset($objChild["\157\160"]) && isset($objChild["\x63\150\x69\x6c\144\x72\145\x6e"]) && $objChild["\143\150\x69\154\144\x72\145\156"])) { goto Dy0Pa; } goto ctC9V; ctC9V: $expression .= "\x28"; goto CUc4P; eq7sn: } goto JDLi7; JDLi7: vBeCg: goto BSpSy; Yk7tZ: } public function saveLatitude($subjectId, $standardId, $id, $formData) { goto Io7dc; yDcdN: $formData["\154\x61\x74\151\x74\x75\x64\145"] = Defs::SUBJECT_WHOLE_STANDARD; goto tzuzB; d7r0i: $formData["\163\x75\142\x6a\x65\x63\x74\137\151\144"] = $subjectId; goto bUGR9; HPsmy: gxfg7: goto t1YTh; oR5a4: wexception("\xe6\x97\xa0\xe6\263\x95\346\211\xbe\345\210\260\xe6\x89\x80\345\xb1\236\xe7\x9a\204\347\xbb\xb4\345\272\246"); goto BKtd9; Io7dc: $formData["\145\170\160\x72\145\x73\163\151\157\x6e\x5f\x6a\x73\157\x6e"] = htmlspecialchars_decode($formData["\x65\170\x70\x72\145\163\x73\x69\157\x6e\x5f\x6a\163\x6f\x6e"]); goto gj5wk; tzuzB: hvY3T: goto m2ipU; yisVP: Db::table("\163\x75\142\x6a\x65\143\x74\x5f\163\164\x61\x6e\144\141\162\144\137\154\x61\164\x69\164\x75\144\x65")->where("\151\144", $id)->update($formData); goto MLoCX; bUGR9: $formData["\x73\x74\x61\156\x64\141\162\144\137\x69\x64"] = $standardId; goto rb3rz; rb3rz: if ($standardId == 0) { goto Er9sr; } goto IkdDh; rC5Bo: if (!($latitude === null)) { goto eObzr; } goto oR5a4; PTSv2: Db::table("\x73\165\142\152\x65\x63\164\x5f\x73\164\x61\156\x64\x61\162\144\137\154\x61\x74\x69\x74\165\x64\145")->insert($formData); goto HPsmy; IDWQ7: $formData["\145\x78\160\162\145\x73\163\151\x6f\x6e"] = $expression; goto d7r0i; bDNrs: goto hvY3T; goto qtgIl; m2ipU: if (empty($id)) { goto aFO4u; } goto yisVP; qtgIl: Er9sr: goto yDcdN; MLoCX: goto gxfg7; goto zyVoL; zyVoL: aFO4u: goto PTSv2; JpV9q: $formData["\x6c\141\x74\151\164\x75\144\145"] = $latitude; goto bDNrs; gj5wk: $expression = $this->convertExpressionJson2Value(json_decode($formData["\x65\170\x70\x72\145\163\x73\x69\157\x6e\x5f\152\163\157\156"], true), ''); goto IDWQ7; BKtd9: eObzr: goto JpV9q; IkdDh: $latitude = Db::table("\163\x75\142\x6a\145\x63\x74\137\163\164\x61\x6e\x64\141\x72\x64")->where(["\x69\144" => $standardId])->value("\x6c\x61\x74\151\164\165\x64\x65"); goto rC5Bo; t1YTh: } public function removeLatitude($id) { Db::table("\163\x75\x62\x6a\145\143\x74\137\163\164\x61\156\144\141\x72\144\137\154\x61\164\x69\x74\x75\144\145")->where(["\x69\144" => $id])->delete(); } public function loadSubjectItems($subjectId) { goto rZoIh; aH0Zy: return $rows; goto ku73B; CunBI: RxKnL: goto aH0Zy; HvHk4: foreach ($items as $index => $item) { goto Y150Q; PK4MB: $imageField = "\x69\x6d\x61\x67\145\x5f" . $optionIndex; goto WiYOM; EUnO8: $weightField = "\x77\145\x69\x67\150\x74\x5f" . $optionIndex; goto yWUYR; QpIa8: xnPgh: goto uGkk6; xFQ0f: goto cAqQt; goto QpIa8; RbxUw: $option["\x69\155\141\147\145"] = "\x3c\x69\x6d\147\x20\143\x6c\141\x73\163\x3d\x22\x6d\x79\55\61\x22\x20\163\162\x63\75\x22" . generateThumbnailUrl($item[$imageField], 100, "\57\x73\164\x61\x74\x69\x63\x2f\x69\155\x67\x2f\144\157\164\x2e\x70\x6e\147") . "\x22\x20\x73\x74\171\x6c\145\75\x22\x6d\141\170\x2d\167\151\144\x74\150\x3a\61\x30\60\160\170\x3b\x22\76"; goto dyxox; mOJSG: $latitudes = Db::table("\163\165\142\152\x65\x63\164\x5f\x69\164\145\x6d\x5f\x73\164\141\156\x64\141\x72\x64")->alias("\123\x49\x53")->join("\x73\165\x62\x6a\x65\143\164\137\x73\x74\x61\156\144\x61\162\x64\x20\123\x53", "\123\111\x53\56\163\164\141\x6e\x64\141\x72\144\137\x69\144\75\123\123\x2e\151\144")->where(["\x53\x49\x53\56\163\165\142\x6a\x65\x63\164\137\x69\144" => $subjectId, "\x53\111\x53\56\151\x74\x65\x6d\x5f\151\x64" => $item["\151\144"]])->column("\x53\x53\56\154\141\164\x69\x74\165\x64\x65"); goto NZozn; dSfmT: $optionField = "\157\x70\x74\151\157\x6e\137" . $optionIndex; goto EUnO8; JvSHU: $row["\x69\155\x61\x67\x65"] = "\x3c\x69\155\147\x20\x63\x6c\x61\163\163\75\x22\155\171\x2d\x31\x22\x20\163\x72\143\75\x22" . generateThumbnailUrl($item["\151\155\x61\x67\145"], 100, "\x2f\163\164\x61\164\151\143\x2f\151\x6d\x67\57\144\x6f\x74\x2e\x70\x6e\x67") . "\x22\x20\163\164\x79\154\145\75\42\x6d\141\170\55\x77\x69\144\164\x68\x3a\61\60\x30\160\170\x3b\x22\76"; goto txjEL; yWUYR: $natureField = "\x6e\141\x74\165\162\x65\137" . $optionIndex; goto PK4MB; NZozn: $row["\163\164\141\x6e\144\141\162\144\163"] = implode("\x2c\x20", $latitudes); goto hJ5Lx; rXVs0: cAqQt: goto IpOe2; IpOe2: $rows[] = $row; goto yJNe8; jC7Yo: jiS5i: goto gUWkX; Yxcat: $optionIndex++; goto dlysg; gUWkX: if (!($optionIndex <= 12)) { goto cAqQt; } goto dSfmT; o4U2y: if (!$item["\x69\x6d\141\x67\x65"]) { goto Dl7sJ; } goto JvSHU; kMhvw: if (!$item["\151\x74\145\x6d\x5f\62"]) { goto QYkT_; } goto LeasX; Y150Q: $row = ["\151\x64" => $item["\151\x64"], "\x69\x74\145\155\x5f\157\160\x74\151\x6f\156" => $index + 1 . "\x2e\40" . strip_tags($item["\x69\x74\x65\x6d"]), "\x63\x68\x69\x6c\144\x72\145\156" => [], "\x74\x79\x70\x65" => $item["\164\171\x70\145"], "\x73\157\x72\164" => $item["\x73\x6f\x72\164"], "\164\x61\x67" => $item["\x74\x61\x67"]]; goto kMhvw; dyxox: VgIzS: goto T5B0o; WiYOM: if (!(empty($item[$optionField]) && empty($item[$imageField]))) { goto xnPgh; } goto xFQ0f; hJ5Lx: $optionIndex = 1; goto jC7Yo; fot6u: if (!$item[$imageField]) { goto VgIzS; } goto RbxUw; dlysg: goto jiS5i; goto rXVs0; LeasX: $row["\151\164\145\x6d\137\157\x70\x74\x69\x6f\x6e"] .= "\x3b\40"; goto s8Ahf; mo6wu: QYkT_: goto o4U2y; uGkk6: $option = ["\151\144" => $item["\x69\144"] . "\x5f" . $optionIndex, "\x69\x74\x65\155\137\157\x70\x74\x69\x6f\156" => strip_tags($item[$optionField]), "\167\x65\151\x67\x68\x74" => round($item[$weightField] / 100, 2), "\156\141\164\165\162\x65" => $item[$natureField]]; goto fot6u; T5B0o: $row["\x63\150\151\x6c\144\162\x65\x6e"][] = $option; goto Yxcat; txjEL: Dl7sJ: goto mOJSG; s8Ahf: $row["\x69\164\145\x6d\137\x6f\x70\164\151\157\x6e"] .= strip_tags($item["\151\x74\x65\155\137\x32"]); goto mo6wu; yJNe8: p4yHX: goto ZFiQa; ZFiQa: } goto CunBI; PPKez: $items = Db::table("\163\165\142\152\145\x63\164\137\x69\x74\145\x6d")->where(["\x73\x75\142\152\145\x63\164\137\x69\144" => $subjectId])->field(true)->order("\x73\157\162\x74\40\141\163\x63\54\40\x69\x64\40\x61\x73\143")->select(); goto HvHk4; rZoIh: $rows = []; goto PPKez; ku73B: } public function getSubjectItem($subjectId, $itemId) { goto yTta5; F1pm5: $item["\167\x65\x69\147\x68\164\137" . $index] = round($item["\167\x65\151\147\150\x74\x5f" . $index] / 100, 2); goto K2gI5; ZD9fj: $item["\x6e\141\x74\x75\x72\145\x5f" . $index] = 0; goto b2uHo; VHk5o: gQPb8: goto xhtqE; QwPUQ: $standardIds = []; goto bGXwr; xhtqE: if (!($index <= 12)) { goto hbLqT; } goto UHcnV; b2uHo: QsK1U: goto jZPDd; UHcnV: $optionField = "\x6f\x70\164\151\157\156\137" . $index; goto fmiLe; JHOwg: $index = 1; goto VHk5o; bGXwr: uOwdN: goto iRahM; fmiLe: $imageField = "\151\x6d\x61\147\x65\137" . $index; goto ELAAe; GgkuX: if ($item) { goto Ly_0t; } goto LlMAS; fBOoe: hbLqT: goto RDKYt; I8jb7: if ($standardIds) { goto uOwdN; } goto QwPUQ; yTta5: $item = Db::table("\x73\x75\x62\x6a\x65\143\164\137\x69\164\x65\155")->where(["\151\144" => $itemId])->field(true)->find(); goto GgkuX; F0CgS: zo4bU: goto TPCPo; QPvjM: return $item; goto Cimz5; RDKYt: $standardIds = Db::table("\x73\x75\142\x6a\145\143\x74\137\151\164\145\x6d\x5f\x73\x74\x61\156\144\141\162\144")->where(["\163\165\x62\x6a\145\x63\164\137\x69\x64" => $subjectId, "\x69\164\145\x6d\x5f\151\144" => $itemId])->column("\163\x74\x61\x6e\144\141\162\x64\137\151\144"); goto I8jb7; K2gI5: goto QsK1U; goto F0CgS; iRahM: $item["\x73\x74\141\x6e\144\141\x72\x64\163"] = $standardIds; goto QPvjM; LlMAS: return null; goto p5tWP; zPi3q: goto gQPb8; goto fBOoe; ELAAe: if (empty(trim($item[$optionField])) && empty(trim($item[$imageField]))) { goto zo4bU; } goto F1pm5; TPCPo: $item["\x77\145\x69\x67\150\164\x5f" . $index] = ''; goto ZD9fj; jZPDd: $index++; goto zPi3q; p5tWP: Ly_0t: goto JHOwg; Cimz5: } public function saveSubjectItem($subjectId, $itemId, $formData, $formOptionData, $standardIds) { goto LYnAi; Nspht: wexception("\xe6\227\240\346\263\225\xe6\211\xbe\345\210\260\345\257\xb9\xe5\272\x94\xe7\232\204\xe9\x87\217\350\xa1\250"); goto OorBt; dxJ5U: $formOptionDataSanitized["\x6f\x70\164\151\157\x6e\x5f" . $indexSanitized] = $formOptionData[$optionField]; goto YzWme; HBBk4: if (!(isset($formOptionData[$optionField]) && trim($formOptionData[$optionField]) || isset($formOptionData[$imageField]) && trim($formOptionData[$imageField]))) { goto a2G3H; } goto dxJ5U; TD6HR: OperationLogs::I()->subjectLog("\xe5\xa2\x9e\xe5\x8a\240\351\207\217\xe8\241\250\xe9\xa1\271\xe7\x9b\xae\x20\x2d\40{$subject["\156\x61\155\x65"]}", $formData["\x69\164\x65\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto cFw82; pPtiF: $formData["\163\165\142\x6a\145\143\x74\137\151\x64"] = $subjectId; goto hLw3e; XMvul: F9MUW: goto vXlnC; tbOBT: if (!$updatedCount) { goto KdzRr; } goto cyv78; q65xA: wexception("\346\227\240\346\263\x95\346\x89\276\xe5\210\260\xe5\257\271\345\xba\224\347\x9a\x84\xe9\207\217\350\xa1\250\xe9\xa1\xb9\xe7\233\256"); goto uBgUI; OorBt: BQNHd: goto Rq5vj; iPtHE: $index++; goto VnlNL; L5W0s: $formOptionDataSanitized["\x6e\141\164\x75\162\145\137" . $index] = null; goto o7wPf; WrGeq: $this->updateSubjectStandardMinMax($subjectId); goto WBvDA; cFw82: McrrY: goto ct0S5; Blojd: goto Lu8RZ; goto am_nN; klcye: $weightField = "\167\145\x69\x67\x68\164\137" . $index; goto xluie; OGzYM: if (!empty($subjectItem)) { goto r29IY; } goto q65xA; RTMct: $formOptionDataSanitized["\167\145\151\147\150\x74\x5f" . $indexSanitized] = null; goto Mal65; srliz: $formOptionDataSanitized["\156\141\x74\165\162\145\137" . $indexSanitized] = $formOptionData[$natureField]; goto OGdt2; ekz3B: $standardsAdd = array_diff($standardIds, $standardIdsDb); goto euNWo; Rq5vj: if (empty($itemId)) { goto ZyH7s; } goto v5r7H; kbA1s: $subject = Db::table("\163\x75\142\x6a\x65\143\x74")->where(["\x69\x64" => $subjectId])->field("\156\x61\x6d\x65")->find(); goto iH_uW; RES3B: a2G3H: goto iPtHE; th5LH: $formOptionDataSanitized["\151\x6d\x61\x67\145\137" . $indexSanitized] = ''; goto RTMct; GCM2b: $formOptionDataSanitized["\x77\x65\151\x67\150\164\137" . $index] = null; goto L5W0s; ExlxJ: $formOptionDataSanitized["\x69\x6d\141\x67\x65\137" . $index] = ''; goto GCM2b; yK0BH: foreach ($standardsDel as $standardId) { Db::table("\163\x75\x62\152\x65\x63\164\137\151\x74\145\155\137\x73\164\141\x6e\x64\141\162\144")->where(["\163\x75\x62\152\145\143\x74\x5f\151\x64" => $subjectId, "\151\x74\145\x6d\137\x69\144" => $itemId, "\x73\164\141\156\144\141\162\144\137\x69\144" => $standardId])->delete(); G11EZ: } goto Nn0T6; BwGrG: if (!($indexSanitized <= 12)) { goto hm8qa; } goto LPGCb; hLw3e: $itemId = Db::table("\x73\x75\142\152\145\143\x74\137\x69\164\145\155")->insertGetId($formData); goto cpc02; DBypV: KdzRr: goto ByQwr; MEzbz: MLHsg: goto Tlx0C; usHw_: $updatedCount = Db::table("\x73\x75\142\152\x65\x63\164\x5f\x69\x74\x65\155")->where(["\x69\x64" => $itemId])->update(array_merge($formData, $formOptionDataSanitized)); goto tbOBT; qmi30: hm8qa: goto Blojd; vv25G: $formOptionDataSanitized["\167\x65\x69\147\150\x74\137" . $indexSanitized] = empty($formOptionData[$weightField]) ? 0 : $formOptionData[$weightField] * 100; goto srliz; ByQwr: goto McrrY; goto NVHG5; xluie: $natureField = "\156\141\164\x75\162\x65\137" . $index; goto HBBk4; NbzH7: FMOZ4: goto lltFn; v5r7H: $subjectItem = Db::table("\163\165\142\152\x65\x63\164\137\x69\164\x65\155")->where(["\x69\144" => $itemId])->find(); goto OGzYM; uBgUI: r29IY: goto usHw_; am_nN: PGpSi: goto KscLK; rkiN7: $index = 1; goto y6oYh; KscLK: $standardIds = []; goto yXyZF; Mal65: $formOptionDataSanitized["\x6e\x61\164\165\162\x65\137" . $indexSanitized] = null; goto uiVig; Tlx0C: if (!($index <= 12)) { goto g1YY6; } goto SYYYS; tAzTj: goto MLHsg; goto rYqUN; euNWo: foreach ($standardsAdd as $standardId) { Db::table("\x73\165\x62\x6a\145\x63\164\x5f\x69\164\145\x6d\x5f\x73\x74\141\x6e\144\x61\x72\144")->insert(["\x73\x75\x62\152\x65\143\164\x5f\x69\x64" => $subjectId, "\x69\x74\x65\155\x5f\151\144" => $itemId, "\163\x74\141\x6e\x64\x61\x72\144\x5f\x69\x64" => $standardId]); nhmiU: } goto RMsWl; yXyZF: $index = 1; goto MEzbz; RMsWl: VkcGK: goto a7Z9u; LPGCb: $formOptionDataSanitized["\157\x70\164\x69\x6f\156\137" . $indexSanitized] = ''; goto th5LH; lltFn: if (!($index <= 12)) { goto F9MUW; } goto syBWZ; uiVig: $indexSanitized++; goto sIvm7; ct0S5: $standardIdsDb = Db::table("\163\165\142\x6a\145\x63\164\x5f\x69\x74\145\155\137\x73\x74\x61\156\144\x61\x72\x64")->where(["\163\x75\x62\x6a\x65\143\164\x5f\x69\x64" => $subjectId, "\151\x74\145\x6d\x5f\151\144" => $itemId])->column("\163\164\141\x6e\x64\x61\x72\144\137\x69\x64"); goto ekz3B; NVHG5: ZyH7s: goto pPtiF; vXlnC: AGJK2: goto BwGrG; OGdt2: $indexSanitized++; goto RES3B; WTEOi: OperationLogs::I()->subjectLog("\xe4\277\xae\xe6\x94\xb9\351\207\x8f\350\xa1\xa8\351\241\xb9\347\x9b\xae\40\55\x20{$subject["\156\x61\x6d\145"]}", $subjectItem["\151\x74\x65\x6d"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto DBypV; o7wPf: $index++; goto tAzTj; syBWZ: $optionField = "\157\160\164\x69\x6f\x6e\137" . $index; goto ZJCkI; xWcQg: if ($formData["\164\x79\160\145"] == Defs::QUESTION_TEXT) { goto PGpSi; } goto rkiN7; rYqUN: g1YY6: goto T4y2d; y6oYh: $indexSanitized = 1; goto NbzH7; iH_uW: if (!empty($subject)) { goto BQNHd; } goto Nspht; cpc02: Db::table("\x73\x75\142\152\x65\x63\164\137\151\x74\145\x6d")->where(["\151\x64" => $itemId])->update($formOptionDataSanitized); goto Erk4a; LYnAi: $formOptionDataSanitized = []; goto xWcQg; YzWme: $formOptionDataSanitized["\151\155\141\x67\145\x5f" . $indexSanitized] = $formOptionData[$imageField]; goto vv25G; Erk4a: Db::table("\x73\165\142\x6a\145\143\x74")->where(["\x69\144" => $subjectId])->setInc("\x69\x74\145\155\137\x76\x65\x72\163\x69\157\x6e"); goto TD6HR; Nn0T6: SjWU6: goto WrGeq; sIvm7: goto AGJK2; goto qmi30; T4y2d: Lu8RZ: goto kbA1s; ZJCkI: $imageField = "\x69\x6d\141\x67\x65\x5f" . $index; goto klcye; cyv78: Db::table("\163\165\142\x6a\145\143\164")->where(["\151\x64" => $subjectId])->setInc("\x69\x74\x65\155\137\x76\x65\x72\163\151\157\x6e"); goto WTEOi; SYYYS: $formOptionDataSanitized["\157\x70\x74\151\157\156\x5f" . $index] = ''; goto ExlxJ; VnlNL: goto FMOZ4; goto XMvul; a7Z9u: $standardsDel = array_diff($standardIdsDb, $standardIds); goto yK0BH; WBvDA: } public function removeSubjectItem($subjectId, $itemId) { goto gQIQ8; NUmKe: Db::table("\x73\165\142\152\x65\x63\164")->where(["\151\x64" => $subjectId])->setInc("\151\x74\x65\155\137\x76\x65\162\163\151\157\156"); goto xcNUn; VrLEU: SqCHy: goto iy2vT; jWOkv: if (!empty($subject)) { goto IGg1h; } goto OpVeu; VzASL: OperationLogs::I()->subjectLog("\345\x88\240\351\231\244\xe9\x87\x8f\350\241\250\351\241\xb9\347\233\xae\40\x2d\40{$subject["\x6e\x61\x6d\x65"]}", $subjectItem["\x69\164\145\x6d"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto AO7cC; xcNUn: $this->updateSubjectStandardMinMax($subjectId); goto VzASL; r68M2: wexception("\xe6\x97\xa0\346\263\x95\xe6\211\276\345\210\260\345\257\xb9\xe5\272\x94\xe7\x9a\x84\351\207\x8f\xe8\241\250\xe9\241\xb9\xe7\x9b\xae"); goto VrLEU; OcxcE: Db::table("\163\x75\142\152\x65\143\164\137\x69\x74\145\155\137\x73\x74\141\x6e\x64\x61\x72\x64")->where(["\x69\164\x65\x6d\x5f\x69\x64" => $itemId])->delete(); goto NUmKe; OpVeu: wexception("\xe6\227\xa0\346\263\225\346\211\xbe\345\x88\260\xe5\257\271\xe5\xba\224\xe7\x9a\204\351\x87\217\xe8\xa1\xa8"); goto O6YhA; uEH_S: if (!empty($subjectItem)) { goto SqCHy; } goto r68M2; iy2vT: Db::table("\163\x75\x62\152\145\x63\x74\137\x69\x74\x65\155")->where(["\x69\144" => $itemId])->delete(); goto OcxcE; O6YhA: IGg1h: goto Ww3GT; gQIQ8: $subject = Db::table("\163\x75\x62\152\145\x63\x74")->where(["\x69\144" => $subjectId])->field("\156\141\155\145")->find(); goto jWOkv; Ww3GT: $subjectItem = Db::table("\163\165\142\x6a\145\x63\164\137\151\164\x65\x6d")->where(["\x69\144" => $itemId])->field(true)->find(); goto uEH_S; AO7cC: } public function addTagItem($subjectId, $tag) { goto mO_0I; no2FD: wexception("\x74\x61\147\xe5\x8f\x82\xe6\225\260\xe9\235\236\346\263\x95"); goto v2yxf; KO0me: $formData = ["\x73\x75\142\152\x65\x63\x74\x5f\151\x64" => $subjectId, "\151\x74\145\x6d" => "\346\202\250\347\232\204\345\271\264\xe9\276\204\77", "\x74\x79\x70\x65" => Defs::QUESTION_TEXT, "\x73\157\x72\164" => 0, "\x74\x61\147" => Defs::SUBJECT_ITEM_TAG_AGE]; goto GaXcp; v2yxf: WoUeh: goto kvmPj; kvmPj: $subject = Db::table("\163\165\142\152\145\143\164")->where(["\151\x64" => $subjectId])->field("\156\x61\155\145")->find(); goto WjQPM; WqXw0: $formData = ["\163\165\142\152\x65\143\164\137\x69\x64" => $subjectId, "\x69\164\x65\155" => "\xe6\x82\xa8\xe7\x9a\204\346\x80\247\xe5\x88\xab\77", "\164\x79\160\x65" => Defs::QUESTION_RADIO, "\157\x70\164\x69\x6f\156\x5f\61" => "\xe7\224\xb7", "\x6f\160\164\151\157\x6e\x5f\x32" => "\xe5\xa5\xb3", "\167\145\x69\147\150\164\x5f\x31" => 0, "\167\145\151\147\150\164\137\62" => 0, "\151\x6d\141\147\145\x5f\x31" => "\57\163\164\141\x74\x69\143\57\151\155\147\57\x6d\141\x6e\56\160\x6e\147", "\x69\155\x61\x67\x65\137\x32" => "\57\x73\x74\141\x74\x69\x63\x2f\x69\x6d\x67\x2f\x77\157\155\x61\156\x2e\x70\156\147", "\156\141\164\x75\x72\145\137\61" => 0, "\x6e\x61\x74\x75\x72\x65\137\x32" => 0, "\163\x6f\x72\164" => 0, "\164\141\147" => Defs::SUBJECT_ITEM_TAG_SEX]; goto r4ujp; FkFqv: wexception("\346\x97\240\346\xb3\225\xe6\211\xbe\345\210\xb0\xe5\257\xb9\xe5\272\224\xe7\232\204\xe9\x87\217\xe8\xa1\xa8"); goto elDv6; tdbUV: I6wbB: goto WqXw0; LEVNt: $this->updateSubjectStandardMinMax($subjectId); goto Yk4CY; A3r7k: Db::table("\x73\x75\142\152\145\x63\x74")->where(["\151\x64" => $subjectId])->setInc("\x69\x74\x65\x6d\137\166\x65\x72\x73\151\157\x6e"); goto LEVNt; WjkEo: goto HnGDp; goto tdbUV; r4ujp: HnGDp: goto WXTT1; PKVly: if (!($tag == Defs::SUBJECT_ITEM_TAG_AGE)) { goto vSQSk; } goto KO0me; mO_0I: if (isset(Defs::SUBJECT_ITEM_TAG_DEFS[$tag])) { goto WoUeh; } goto no2FD; Og6lh: if ($tag == Defs::SUBJECT_ITEM_TAG_SEX) { goto I6wbB; } goto PKVly; WXTT1: $itemId = Db::table("\x73\x75\142\x6a\145\x63\x74\137\x69\164\145\x6d")->insertGetId($formData); goto A3r7k; elDv6: P1dvf: goto Og6lh; GaXcp: vSQSk: goto WjkEo; Yk4CY: OperationLogs::I()->subjectLog("\345\242\236\xe5\212\xa0\351\x87\x8f\xe8\xa1\xa8\xe9\xa1\xb9\347\x9b\xae\x20\55\40{$subject["\x6e\141\155\x65"]}", $formData["\x69\x74\145\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto HI2sA; WjQPM: if (!empty($subject)) { goto P1dvf; } goto FkFqv; HI2sA: } protected function convertOriginalToStandard($statistic_weight_min, $statistic_weight_max, $standard_weight_min, $standard_weight_max, &$weight) { goto CrAwy; zyw1f: $weight = $weightStandard; goto FOKxe; FOKxe: return true; goto bBK5p; ZzlHQ: $weightStandard = $standard_weight_max; goto OHLja; LIqcC: if (!($weightStandard > $standard_weight_max)) { goto h4uWY; } goto ZzlHQ; HW64v: return false; goto KWD16; b0vLa: $weightStandard = round(($weight - $statistic_weight_min) * $scale + $standard_weight_min, 2); goto LIqcC; OHLja: h4uWY: goto zyw1f; CrAwy: if (!($standard_weight_min !== null && $standard_weight_max !== null && $statistic_weight_max && $standard_weight_max && $statistic_weight_max > $statistic_weight_min && $standard_weight_max > $standard_weight_min)) { goto scok0; } goto Z3zWj; bBK5p: scok0: goto HW64v; Z3zWj: $scale = ($standard_weight_max - $standard_weight_min) / ($statistic_weight_max - $statistic_weight_min); goto b0vLa; KWD16: } public function checkReportAlgo(&$subject) { goto HriEH; iXaKj: fDirI: goto tIqyH; gkHbt: return true; goto Mt6sW; th9cO: $downloadAlgo = false; goto ZX7T9; uaGZF: logEvent("\xe6\227\xa0\xe6\xb3\225\xe6\x89\xbe\xe5\x88\xb0\347\x94\237\xe6\x88\x90\346\x8a\xa5\345\x91\x8a\347\232\x84\xe7\xae\227\346\263\x95\xe6\226\207\344\xbb\xb6\x2c\40{$file}", EventLogsService::eSeverityError); goto NEri8; tIqyH: if (!$downloadAlgo) { goto D6dda; } goto uaGZF; LsJg3: D6dda: goto gkHbt; ZX7T9: foreach ($fields as $field) { goto SHQCV; gBydy: goto HJV4y; goto zt2M_; VWl2Z: list($class, $method) = explode("\x3a", $subject[$field]); goto bPCw5; fbMHk: hq577: goto D1S0U; lyTAE: $file = ROOT_PATH . "\162\x65\x70\x6f\x72\164" . DS . "\x61\x6c\147\x6f" . DS . basename($class) . "\56\x70\150\x70"; goto XFSWn; ZWYci: if (strpos($subject[$field], "\72") === false) { goto D4ihv; } goto VWl2Z; R93xg: $downloadAlgo = true; goto ni8wZ; XFSWn: HJV4y: goto vVTLn; ljoIY: Q1ng2: goto ZWYci; ydfAJ: wDbs5: goto pWEGY; Iaug6: $file = ROOT_PATH . "\162\x65\160\x6f\162\164" . DS . "\x74\x65\163\164" . DS . basename($class) . "\56\x70\150\160"; goto gBydy; ni8wZ: goto fDirI; goto phdTS; XVd7G: D4ihv: goto hspoW; SHQCV: if (!empty($subject[$field])) { goto Q1ng2; } goto hDgV_; D1S0U: if (file_exists($file)) { goto opbx9; } goto R93xg; bPCw5: if ($field == "\162\x65\x70\x6f\162\x74\x5f\x67\145\156\x65\x72\x61\x74\157\x72") { goto yMk5B; } goto Iaug6; zt2M_: yMk5B: goto lyTAE; hspoW: $file = ROOT_PATH . "\x72\145\x70\x6f\x72\164" . DS . "\x61\x6c\147\x6f" . DS . "\x41\x69\x2e\160\150\160"; goto fbMHk; vVTLn: goto hq577; goto XVd7G; phdTS: opbx9: goto ydfAJ; hDgV_: goto wDbs5; goto ljoIY; pWEGY: } goto iXaKj; HriEH: $fields = ["\x72\145\x70\x6f\x72\x74\x5f\x67\145\x6e\x65\162\x61\x74\157\162", "\143\x75\163\x74\x6f\x6d\137\164\x65\163\x74", "\143\165\x73\164\x6f\x6d\137\141\x6e\163\x77\145\162", "\143\165\163\x74\157\155\137\x61\x6e\x73\x77\x65\x72\137\x70\x72\x65\x76", "\143\x75\163\x74\157\155\137\162\145\x70\157\162\164"]; goto th9cO; NEri8: try { $this->downloadReportAlgo(); } catch (WException $e) { logEvent("\344\xb8\x8b\xe8\xbd\275\347\224\237\346\x88\220\xe6\x8a\xa5\xe5\221\x8a\347\x9a\x84\xe7\256\x97\346\xb3\x95\346\x96\207\xe4\273\266\345\xa4\xb1\350\xb4\xa5\x2c\40\145\170\143\145\160\164\x69\x6f\156\x3a\40" . $e->getMessage(), EventLogsService::eSeverityError); return false; } goto LsJg3; Mt6sW: } public function generateTestResult($subjectId, $itemOptions) { goto K4Zkk; biJP8: nVBe3: goto MY3ok; OxfEs: oajZJ: goto k54yk; prVbb: return $rows; goto fihwg; Eczcw: return []; goto eX5Wz; k54yk: $subject = Db::table("\163\x75\x62\x6a\x65\143\164")->where("\x69\x64", $subjectId)->field("\163\x6e\x2c\x20\163\x74\x61\164\x69\x73\164\151\143\x5f\x77\145\151\x67\150\164\x5f\x6d\151\156\54\40\x73\x74\x61\x74\151\x73\x74\151\143\137\x77\x65\x69\147\150\x74\x5f\155\141\x78\x2c\x20\x73\x74\x61\x6e\x64\141\162\144\x5f\167\145\151\147\150\x74\x5f\155\x69\156\x2c\x20\x73\164\x61\156\x64\141\162\144\x5f\x77\x65\x69\147\x68\164\x5f\155\141\170\54\x20\x72\145\160\x6f\162\164\137\x67\145\156\x65\162\141\x74\x6f\x72\54\40\x63\165\x73\164\157\155\x5f\x74\x65\x73\164\54\40\x63\165\163\x74\x6f\155\137\141\156\163\167\145\162\x2c\x20\143\165\x73\x74\x6f\155\x5f\141\x6e\163\x77\145\162\x5f\160\162\x65\x76\x2c\x20\x63\165\163\164\157\x6d\137\162\x65\160\x6f\162\x74")->find(); goto YmRQJ; GYgkE: list($class, $method) = explode("\x3a", $subject["\x72\145\x70\x6f\x72\x74\x5f\x67\x65\x6e\145\x72\141\164\157\x72"]); goto JRF2v; RXt47: foreach ($standards as $standard) { goto Cs7rI; GKgcF: $totalPositiveWeight = 0; goto QdUTZ; Vi4F2: $itemCount = 0; goto kujpa; PgmBb: if ($standardId == 0) { goto A1Bde; } goto dRlU3; kAbm4: if (!($itemCount > 0)) { goto IXkPE; } goto TfVCE; IZRYd: $positiveItemCount = 0; goto yrR9Y; dRlU3: $subjectItemIds = Db::table("\x73\x75\142\x6a\145\143\x74\137\x69\164\x65\x6d\x5f\x73\x74\x61\156\x64\141\162\x64")->where(["\163\165\x62\152\145\x63\x74\137\151\x64" => $subjectId, "\163\164\x61\156\144\141\x72\144\x5f\151\x64" => $standardId])->column("\151\x74\x65\155\x5f\x69\x64"); goto z30Ck; ksYeN: $averageWeightMinStandard = null; goto IZRYd; TfVCE: foreach ($latitudes as $latitude) { goto vNr4l; Q6zW2: $i = 0; goto wXHZM; wzAHB: $expression = str_replace("\44\173\101\127\x7d", "\x24\141\166\x65\162\x61\147\145\127\x65\x69\147\150\164", $expression); goto FsU1f; DQizO: goto iuCsX; goto m54PN; lrV7q: if (!($latitude["\167\x61\162\x6e\x69\x6e\x67\137\x6c\145\x76\x65\x6c"] > $warningLevel)) { goto lcdpF; } goto CPzAY; vNr4l: $weightType = $latitude["\x77\145\151\147\150\164\x5f\x74\x79\160\x65"]; goto xBQCn; cftlt: MOl2Z: goto IU2SZ; yTVy6: $expression = str_replace("\44\173\120\x49\x43\175", "\x24\x70\x6f\x73\x69\x74\151\x76\x65\111\164\145\155\103\x6f\x75\156\x74", $expression); goto fXHKI; EwT4D: $expression = str_replace("\x24\x7b\124\127\x7d", "\44\x74\157\x74\141\x6c\127\145\x69\x67\x68\x74\123\x74\x61\156\144\141\x72\144", $expression); goto kuJG9; BecKf: lcdpF: goto m7cCX; Tu_0q: $expression = preg_replace("\57\134\163\x2b\x2f", '', $expressionOriginal); goto XpBzN; yWshj: if (!$result) { goto idyql; } goto VWMv2; g86Su: try { $result = eval($expression); } catch (\ParseError $e) { $result = false; } goto yWshj; Ea_pJ: goto r8fwz; goto cftlt; DmXtr: if ($weightType == Defs::LATITUDE_MEASURE_WEIGHT_STANDARD) { goto EwXv_; } goto kaRt8; VWMv2: $matchedExpressions[] = $expressionOriginal; goto VjmFs; paGoK: if (!($i <= 6)) { goto MOl2Z; } goto zJ5GY; av_gd: $matched = true; goto gHis0; gHis0: idyql: goto OEUBS; wXHZM: r8fwz: goto paGoK; ikp0m: $expression = str_replace("\x24\x7b\120\101\x57\175", "\x24\160\x6f\x73\151\164\x69\166\145\101\166\x65\x72\x61\x67\x65\127\x65\151\x67\150\x74\123\x74\x61\156\x64\141\x72\x64", $expression); goto qd1F9; IU2SZ: upx3r: goto yTVy6; FsU1f: $expression = str_replace("\44\x7b\120\x41\127\x7d", "\x24\x70\x6f\x73\x69\x74\151\x76\145\101\166\145\x72\x61\x67\x65\x57\x65\151\147\150\x74", $expression); goto Q6zW2; Bvx3s: $matchedRemarks[] = $latitude["\162\145\x6d\x61\x72\153"]; goto k97I1; CPzAY: $warningLevel = $latitude["\167\x61\x72\x6e\x69\156\147\137\154\145\x76\145\154"]; goto BecKf; m54PN: EwXv_: goto EwT4D; qd1F9: iuCsX: goto IgQJa; gWoon: Log::notice("\x65\x78\x70\162\145\x73\163\151\157\x6e\72\x20{$expressionOriginal}\40\x2d\76\40{$expression}"); goto g86Su; k97I1: fg6Hy: goto av_gd; yv1OH: eBXYM: goto LWyME; kuJG9: $expression = str_replace("\44\173\x41\x57\175", "\44\x61\x76\x65\x72\141\147\145\127\145\x69\x67\x68\x74\123\x74\x61\156\x64\x61\162\144", $expression); goto ikp0m; XpBzN: if ($weightType == Defs::LATITUDE_MEASURE_WEIGHT_ORIGINAL) { goto CofsE; } goto DmXtr; kaRt8: goto PQOR2; goto DQizO; ZlZ7Z: goto PQOR2; goto yv1OH; HzH9k: CofsE: goto blTOD; zJ5GY: $expression = str_replace("\x24\x7b\127\104" . $i . "\x7d", "\x24\x77\x65\151\147\150\x74\x44\151\163\164\162\151\x62\165\164\151\x6f\x6e\133\x73\164\x72\x76\141\x6c\x28" . $i . "\x29\x5d", $expression); goto RnB9u; VjmFs: $matchedDescs[] = $latitude["\x73\164\141\156\144\137\x64\x65\163\143"]; goto lrV7q; blTOD: $expression = str_replace("\x24\x7b\x54\127\x7d", "\x24\x74\x6f\x74\x61\154\x57\x65\151\x67\x68\x74", $expression); goto wzAHB; m7cCX: if (!trim($latitude["\x72\145\155\x61\x72\x6b"])) { goto fg6Hy; } goto Bvx3s; RnB9u: $i++; goto Ea_pJ; o0P29: $expression = "\x72\x65\164\165\x72\156\x20" . $expression . "\73"; goto gWoon; IgQJa: goto upx3r; goto HzH9k; fXHKI: $expression = str_replace("\44\173\116\x49\x43\175", "\44\156\145\x67\141\164\x69\166\x65\111\164\145\155\103\157\x75\x6e\x74", $expression); goto o0P29; LWyME: $expressionOriginal = $latitude["\x65\x78\x70\x72\145\163\x73\x69\157\156"]; goto Tu_0q; xBQCn: if (!($weightType == Defs::LATITUDE_MEASURE_WEIGHT_STANDARD && $totalWeightStandard === null)) { goto eBXYM; } goto ZlZ7Z; OEUBS: PQOR2: goto mNr2R; mNr2R: } goto wHM9k; kycyx: if ($positiveItemCount) { goto oByTR; } goto x1zDV; ysnCF: $averageWeightMax = round($totalWeightMax / $itemCount, 2); goto W3tyX; A7UDZ: $totalWeight = 0; goto YMnOn; ClB_0: $totalWeightMin = 0; goto LtEpK; Ak8Uv: if (isset($weightDistribution[strval($i)])) { goto yv07s; } goto oxeLQ; MbMWu: rRpUY: goto zDeio; zDeio: goto YR4JA; goto AsN3E; fyItu: $totalWeightMin = $standard["\x73\164\x61\x74\151\163\x74\x69\x63\137\x77\x65\151\147\x68\x74\137\155\x69\156"]; goto Dv93Q; nfKCG: if (!($itemCount > 0)) { goto Ki2hN; } goto H3KNF; MvdSw: if ($convertedResult) { goto gOawa; } goto YdRXJ; yppbk: $convertedResult = $this->convertOriginalToStandard($standard["\x73\164\x61\x74\151\x73\x74\x69\x63\x5f\167\145\151\147\150\x74\x5f\x6d\x69\156"], $standard["\x73\164\x61\164\151\x73\164\151\x63\x5f\x77\145\151\x67\150\x74\137\x6d\x61\x78"], $standard["\x73\164\x61\x6e\x64\x61\162\144\x5f\167\145\x69\x67\150\164\137\155\151\156"], $standard["\163\164\141\x6e\x64\141\162\144\x5f\167\145\151\x67\x68\x74\x5f\155\x61\x78"], $tempWeight); goto Tj4Ud; yp5zL: $averageWeightStandard = null; goto hb_ZU; iP0CS: if (!($itemCount == 0)) { goto RHijh; } goto QlAL9; UkiOV: XxqrS: goto F9R0l; DYgQO: $rows[] = ["\163\x74\x61\x6e\144\x61\162\144\137\151\x64" => $standardId, "\x6c\x61\164\151\x74\x75\x64\x65" => $latitudeText, "\x74\x6f\x74\141\x6c\137\167\145\151\147\x68\164" => $totalWeight, "\164\157\x74\141\x6c\x5f\167\145\151\147\x68\x74\137\x6d\141\170" => $totalWeightMax, "\x74\157\164\141\154\137\167\x65\x69\147\x68\x74\x5f\x6d\x69\x6e" => $totalWeightMin, "\141\x76\145\162\x61\147\145\x5f\167\x65\x69\x67\150\x74" => $averageWeight, "\141\x76\x65\162\141\x67\145\137\167\x65\x69\147\150\164\x5f\x6d\141\x78" => $averageWeightMax, "\x61\x76\145\x72\141\x67\x65\x5f\167\x65\x69\x67\x68\164\x5f\155\151\156" => $averageWeightMin, "\160\157\163\x69\x74\x69\x76\x65\x5f\141\166\145\x72\141\147\145\137\x77\145\151\x67\x68\164" => $positiveAverageWeight, "\167\x65\151\147\x68\x74\x5f\x64\151\163\164\x72\x69\142\165\x74\151\157\x6e" => $weightDistribution, "\x74\x6f\164\141\x6c\137\167\145\151\x67\x68\x74\x5f\x73\164\141\x6e\144\x61\x72\144" => $totalWeightStandard, "\x74\157\x74\141\x6c\137\167\x65\151\x67\150\x74\137\155\x61\x78\x5f\163\164\141\156\144\141\162\x64" => $totalWeightMaxStandard, "\x74\x6f\x74\141\x6c\137\x77\145\x69\x67\150\164\137\155\151\156\137\163\x74\x61\x6e\144\141\162\x64" => $totalWeightMinStandard, "\x61\x76\x65\162\141\147\145\x5f\167\145\151\x67\150\164\137\163\164\141\x6e\144\x61\162\144" => $averageWeightStandard, "\x61\x76\x65\x72\x61\x67\145\x5f\x77\145\x69\147\150\x74\x5f\x6d\141\x78\137\x73\x74\x61\x6e\144\141\162\x64" => $averageWeightMaxStandard, "\x61\x76\x65\x72\x61\147\145\x5f\x77\145\151\x67\150\164\x5f\155\x69\x6e\x5f\x73\164\x61\156\x64\x61\x72\144" => $averageWeightMinStandard, "\x70\x6f\163\x69\164\151\166\145\x5f\141\166\145\162\141\147\145\137\x77\x65\x69\x67\150\164\137\x73\x74\141\x6e\x64\x61\162\144" => $positiveAverageWeightStandard, "\x69\164\x65\x6d\x5f\x63\x6f\x75\156\x74" => $itemCount, "\x70\x6f\163\151\x74\151\166\x65\137\x69\164\145\x6d\x5f\x63\x6f\165\x6e\x74" => $positiveItemCount, "\x6e\145\x67\141\x74\x69\166\145\x5f\x69\x74\145\x6d\137\143\157\x75\156\x74" => $negativeItemCount, "\155\x61\x74\x63\x68\x65\144" => $matched, "\155\141\164\143\x68\145\144\x5f\x65\170\x70\162\145\x73\x73\x69\x6f\x6e\163" => $matchedExpressions, "\155\x61\x74\143\x68\x65\x64\137\x64\145\163\x63\x73" => $matchedDescs, "\x6d\x61\x74\x63\x68\145\144\137\x72\x65\x6d\x61\x72\153\163" => $matchedRemarks, "\x77\x61\x72\156\151\x6e\147\x5f\x6c\145\166\x65\x6c" => $warningLevel]; goto Tzw8X; Bmisb: $matchedRemarks = []; goto RUNHJ; oxeLQ: $weightDistribution[strval($i)] = 0; goto eshQ4; BdrLb: YR4JA: goto Slng7; CgKOM: $matchedExpressions = []; goto bijc6; QdUTZ: $positiveAverageWeight = 0; goto qQZbR; GH3Q0: $positiveAverageWeightStandard = null; goto dGevP; q6Cmo: $totalWeightStandard = null; goto ZqUFb; z30Ck: if ($subjectItemIds) { goto rRpUY; } goto pfdBF; cBCdo: goto u3Z3J; goto IdcJJ; F9R0l: Ki2hN: goto CgKOM; H3KNF: $totalWeightMax = $standard["\x73\x74\x61\164\x69\x73\x74\x69\143\137\x77\145\x69\147\x68\164\x5f\155\x61\x78"]; goto fyItu; eshQ4: yv07s: goto QVR06; eazSK: $totalWeightMinStandard = null; goto yp5zL; IdcJJ: oByTR: goto plbda; Rq8rv: $averageWeightMaxStandard = round($totalWeightMaxStandard / $itemCount, 2); goto bGS_M; ZqUFb: $totalWeightMaxStandard = null; goto eazSK; REmxY: LzNZR: goto Vi4F2; Tj4Ud: if ($convertedResult) { goto ZqE4J; } goto XSepk; wHM9k: HRx24: goto u3EpH; W3tyX: $averageWeightMin = round($totalWeightMin / $itemCount, 2); goto iSgDt; yOmOy: $averageWeightMax = 0; goto jyBfB; dGevP: $weightDistribution = []; goto kFwtk; UOEjr: if ($positiveItemCount) { goto dqqR1; } goto TDXbP; uVmz_: u3Z3J: goto vH7VW; PK0YL: a1gpr: goto VlFPu; SAIkD: $tempWeight = $totalPositiveWeight; goto yppbk; yrR9Y: $negativeItemCount = 0; goto GKgcF; KCKQa: ZqE4J: goto kycyx; fsCrB: $totalWeightMinStandard = $standard["\163\x74\x61\x6e\x64\x61\162\144\137\x77\145\151\x67\x68\x74\x5f\x6d\x69\156"]; goto K4ojb; VTv1h: $matched = false; goto kAbm4; hACTK: goto wCHXw; goto GlkIe; x1zDV: $positiveAverageWeightStandard = 0; goto cBCdo; hb_ZU: $averageWeightMaxStandard = null; goto ksYeN; grTqh: gOawa: goto mwAZ1; bijc6: $matchedDescs = []; goto Bmisb; RUNHJ: $warningLevel = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto VTv1h; Tuf2N: wCHXw: goto eBFWB; Tk_Rg: $subjectItemIds = array_keys($subjectItems); goto BdrLb; YMnOn: $totalWeightMax = 0; goto ClB_0; Slng7: if (!empty($subjectItemIds)) { goto LzNZR; } goto REmxY; QlAL9: RHijh: goto nfKCG; u3EpH: IXkPE: goto DYgQO; LoLwv: iKrBI: goto UOEjr; YdRXJ: goto iKrBI; goto grTqh; vpQMM: EMuem: goto A7UDZ; Tzw8X: WFzif: goto qcAC8; LtEpK: $averageWeight = 0; goto yOmOy; AsN3E: A1Bde: goto Tk_Rg; K4ojb: $averageWeightStandard = round($totalWeightStandard / $itemCount, 2); goto Rq8rv; uvzxn: if (!(empty($latitudes) && $standardId == 0)) { goto EMuem; } goto RcyoF; kFwtk: $warningLevel = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto PgmBb; qQZbR: $totalPositiveWeightStandard = null; goto GH3Q0; kujpa: foreach ($itemOptions as $itemId => $itemOption) { goto C62FA; xOaGc: nAWGv: goto VJ_Ev; uDNFa: if (isset($weightDistribution[strval($itemWeight)])) { goto MF4Vd; } goto uuHnO; jg3cH: if (is_array($optionIndex)) { goto nAWGv; } goto txTtA; l5511: $totalWeight += $itemWeight; goto uDNFa; UKJaG: if (!($itemType == Defs::QUESTION_TEXT)) { goto oxpcl; } goto pU3UB; dNdqT: $totalWeight += $itemWeight; goto CmpbD; muJV7: goto wQWhA; goto AEkWq; Lqot0: goto JoPyr; goto zAI9D; IAtNc: MF4Vd: goto z81_D; KswpV: $negativeItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_NEGATIVE ? 1 : 0; goto Wp2Tr; FUozR: $positiveItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE ? 1 : 0; goto KswpV; sj8Zw: if (in_array($itemId, $subjectItemIds)) { goto aKGM0; } goto biWJt; uJEYv: AOe7d: goto dNdqT; wh3FN: $itemCount++; goto eZQkB; m64df: oCs7G: goto YjB4t; z81_D: $weightDistribution[strval($itemWeight)]++; goto m64df; fqwxU: if (!($subjectItems[$itemId]["\x74\141\x67"] != "\156\157\x6e\145")) { goto I92p9; } goto Lqot0; H16pS: $optionIndex = $itemOption["\166\141\x6c\165\x65"]; goto Sa4A2; tqXrK: goto JoPyr; goto c67JZ; SW2Sb: $weightDistribution[strval($itemWeight)]++; goto RdFYB; eZQkB: JoPyr: goto h_Pkh; biWJt: goto JoPyr; goto WecgA; Gokgl: goto cnYgG; goto xOaGc; jkP_g: foreach ($optionIndex as $optionIndexOne) { goto SEamA; MC3uB: $itemWeight += round($subjectItems[$itemId][$weightField] / 100, 2); goto cu3lU; cu3lU: Z3F_L: goto BimYh; SEamA: $weightField = "\167\x65\x69\147\x68\164\137" . $optionIndexOne; goto ptHFC; BimYh: y6jTo: goto UcMTK; ptHFC: if (!isset($subjectItems[$itemId][$weightField])) { goto Z3F_L; } goto MC3uB; UcMTK: } goto uJEYv; VJ_Ev: $itemWeight = 0; goto jkP_g; BezqW: goto oCs7G; goto IAtNc; AEkWq: xUVPS: goto SW2Sb; zAI9D: I92p9: goto sj8Zw; C62FA: $itemType = $itemOption["\x74\x79\160\x65"]; goto H16pS; Sa4A2: if (isset($subjectItems[$itemId])) { goto fu5jv; } goto tqXrK; pepkt: $weightDistribution[strval($itemWeight)] = 1; goto muJV7; EZ6YH: foreach ($optionIndex as $optionIndexOne) { goto pjFhP; vD8IU: $totalPositiveWeight += round($subjectItems[$itemId]["\x77\145\x69\x67\x68\x74\137" . $optionIndexOne] / 100, 2); goto LRCah; lu71o: if (isset($subjectItems[$itemId][$natureField])) { goto nxVc4; } goto epiGz; LRCah: gcDK8: goto tIWDC; Wh7SU: nxVc4: goto OW8gX; BmgcF: if (!($subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE)) { goto gcDK8; } goto vD8IU; pjFhP: $natureField = "\156\x61\x74\x75\x72\145\137" . $optionIndexOne; goto lu71o; tIWDC: fmz2b: goto TP2xE; OW8gX: $positiveItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE ? 1 : 0; goto dXvoG; dXvoG: $negativeItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_NEGATIVE ? 1 : 0; goto BmgcF; epiGz: goto fmz2b; goto Wh7SU; TP2xE: } goto Ej1AL; YjB4t: Ft2dQ: goto zC0TA; Ej1AL: Y57qo: goto nQwsu; c67JZ: fu5jv: goto fqwxU; txTtA: $weightField = "\167\x65\x69\x67\150\164\x5f" . $optionIndex; goto hpBdS; WecgA: aKGM0: goto UKJaG; zC0TA: $natureField = "\156\141\x74\x75\162\x65\137" . $optionIndex; goto ErpbY; e0jSA: $itemWeight = round($subjectItems[$itemId][$weightField] / 100, 2); goto l5511; nQwsu: cnYgG: goto wh3FN; RdFYB: wQWhA: goto EZ6YH; djM8J: $totalPositiveWeight += round($subjectItems[$itemId][$weightField] / 100, 2); goto a9f6R; rgrqa: YBu6S: goto Gokgl; pU3UB: goto JoPyr; goto K3g5_; Wp2Tr: if (!($subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE)) { goto dIdrt; } goto djM8J; uuHnO: $weightDistribution[strval($itemWeight)] = 1; goto BezqW; K3g5_: oxpcl: goto jg3cH; ErpbY: if (!isset($subjectItems[$itemId][$natureField])) { goto YBu6S; } goto FUozR; CmpbD: if (isset($weightDistribution[strval($itemWeight)])) { goto xUVPS; } goto pepkt; a9f6R: dIdrt: goto rgrqa; hpBdS: if (!isset($subjectItems[$itemId][$weightField])) { goto Ft2dQ; } goto e0jSA; h_Pkh: } goto PK0YL; jyBfB: $averageWeightMin = 0; goto q6Cmo; bGS_M: $averageWeightMinStandard = round($totalWeightMinStandard / $itemCount, 2); goto LoLwv; iSgDt: $tempWeight = $totalWeight; goto qFlb3; qFlb3: $convertedResult = $this->convertOriginalToStandard($standard["\x73\164\x61\x74\151\x73\x74\151\143\137\x77\145\x69\147\x68\x74\137\155\x69\156"], $standard["\x73\x74\141\x74\151\x73\x74\x69\143\137\x77\145\151\x67\150\x74\137\x6d\x61\170"], $standard["\x73\164\141\156\x64\x61\x72\144\137\167\145\151\147\x68\164\x5f\155\x69\x6e"], $standard["\163\x74\141\x6e\x64\141\x72\x64\x5f\167\x65\151\x67\150\x74\137\x6d\x61\x78"], $tempWeight); goto MvdSw; JSH1x: $latitudeText = $standard["\x6c\141\x74\151\x74\165\x64\x65"]; goto IyUaS; QVR06: $i++; goto hACTK; pfdBF: $subjectItemIds = []; goto MbMWu; plbda: $positiveAverageWeightStandard = round($tempWeight / $positiveItemCount, 2); goto uVmz_; oLSh8: $totalWeightMaxStandard = $standard["\163\x74\x61\x6e\x64\141\x72\x64\x5f\x77\145\151\x67\x68\164\137\155\141\x78"]; goto fsCrB; GlkIe: rdzoW: goto iP0CS; qNRnL: $positiveAverageWeight = round($totalPositiveWeight / $positiveItemCount, 2); goto SAIkD; Cs7rI: $standardId = $standard["\163\164\x61\x6e\144\141\x72\144\x5f\x69\144"]; goto JSH1x; RcyoF: goto WFzif; goto vpQMM; Dv93Q: $averageWeight = round($totalWeight / $itemCount, 2); goto ysnCF; mwAZ1: $totalWeightStandard = $tempWeight; goto oLSh8; jz5Lu: dqqR1: goto qNRnL; XSepk: goto jP3H1; goto KCKQa; vH7VW: jP3H1: goto UkiOV; VlFPu: $i = 0; goto Tuf2N; TDXbP: goto XxqrS; goto jz5Lu; IyUaS: $latitudes = Db::table("\x73\165\142\x6a\x65\x63\x74\137\163\164\141\156\144\141\x72\x64\137\x6c\141\x74\151\164\x75\x64\x65")->where(["\163\x75\x62\x6a\145\x63\164\x5f\151\144" => $subjectId, "\x73\164\x61\156\x64\x61\x72\x64\x5f\151\144" => $standardId])->field(true)->select(); goto uvzxn; eBFWB: if (!($i <= 6)) { goto rdzoW; } goto Ak8Uv; qcAC8: } goto oii1c; eTy6t: jCwm5: goto rdsId; YdcdH: $standards = []; goto u3_3n; LXOTr: NSTnS: goto eTy6t; LmOvZ: if (!empty($subjectItems)) { goto q26wD; } goto aetoS; JRF2v: return call_user_func([new $class(), $method], $subjectId, $itemOptions); goto XCL34; oii1c: Uz2t1: goto prVbb; u3_3n: $standards = Db::table("\x73\165\142\152\x65\x63\164\x5f\163\164\141\x6e\x64\141\162\144")->where("\x73\165\142\152\x65\143\164\137\x69\144", $subjectId)->field("\151\x64\x20\141\x73\40\163\x74\x61\x6e\144\141\x72\144\137\x69\x64\x2c\x20\x6c\x61\164\151\164\165\144\145\x2c\x20\15\12\x20\40\40\40\x20\40\40\x20\40\40\40\x20\x20\x20\x20\40\x73\164\141\x74\151\x73\164\x69\143\x5f\167\x65\x69\x67\150\x74\137\155\151\x6e\54\x20\163\164\x61\x74\151\163\164\x69\143\x5f\x77\x65\x69\147\150\x74\x5f\x6d\x61\x78\54\40\x73\x74\141\x6e\x64\141\162\144\x5f\167\145\x69\147\150\x74\137\x6d\151\x6e\54\x20\163\x74\x61\x6e\144\141\162\x64\x5f\167\x65\151\147\x68\x74\137\155\141\x78")->order("\163\157\x72\x74\x20\x61\163\143\54\40\x69\x64\x20\x61\x73\x63")->select(); goto Hl3Vb; CVuOi: return call_user_func([$reporter, $subject["\162\x65\x70\x6f\162\164\137\x67\145\156\145\x72\x61\x74\x6f\162"]], $subjectId, $itemOptions); goto LXOTr; UKIom: return []; goto RtHW4; rdsId: $subjectItems = Db::table("\163\165\x62\x6a\145\x63\164\x5f\x69\x74\145\155")->where("\163\x75\x62\x6a\x65\x63\x74\x5f\151\x64", $subjectId)->order("\x73\x6f\162\164\x20\141\163\x63")->column("\151\x64\54\40\xd\xa\40\40\40\40\x20\40\x20\x20\40\x20\x20\40\x20\x20\x20\40\164\171\160\x65\54\15\12\x20\x20\x20\40\x20\40\x20\x20\x20\40\40\x20\40\40\40\x20\167\145\151\147\x68\x74\137\61\x2c\xd\xa\40\40\x20\40\40\x20\x20\x20\40\40\x20\40\40\x20\x20\40\x77\145\151\147\x68\164\x5f\x32\x2c\15\12\40\x20\40\40\x20\40\x20\x20\40\x20\x20\x20\x20\40\40\x20\167\x65\x69\x67\x68\x74\137\63\54\xd\xa\x20\40\x20\40\x20\x20\x20\40\x20\x20\40\x20\x20\x20\40\x20\167\x65\x69\147\150\164\x5f\x34\x2c\15\xa\x20\40\x20\x20\x20\40\x20\x20\40\x20\x20\x20\40\x20\x20\x20\167\x65\151\x67\x68\164\x5f\65\x2c\xd\xa\x20\x20\x20\x20\x20\x20\x20\40\40\x20\40\x20\40\x20\x20\x20\x77\145\151\147\150\x74\x5f\66\54\15\12\x20\40\40\x20\x20\x20\40\x20\x20\x20\40\x20\40\x20\40\x20\167\x65\151\x67\150\164\x5f\x37\x2c\xd\12\40\x20\x20\x20\40\40\x20\x20\x20\40\40\x20\x20\x20\x20\x20\x77\x65\x69\147\150\164\137\70\x2c\15\12\40\x20\x20\x20\40\x20\40\40\x20\x20\x20\x20\x20\40\x20\40\x77\x65\151\147\150\164\x5f\x39\x2c\xd\xa\40\40\x20\x20\x20\x20\40\x20\x20\40\40\x20\40\40\40\x20\167\x65\151\147\150\x74\x5f\61\60\x2c\15\12\x20\40\40\40\40\x20\40\40\x20\x20\x20\40\40\40\40\40\167\x65\151\147\150\x74\x5f\61\x31\54\15\xa\x20\40\x20\40\x20\x20\40\x20\x20\40\x20\x20\x20\40\40\x20\167\145\151\147\150\164\x5f\61\x32\x2c\xd\12\x20\x20\40\x20\40\40\x20\40\x20\40\x20\40\40\40\40\40\x6e\x61\164\165\x72\145\x5f\x31\54\15\12\40\40\x20\40\x20\x20\40\x20\x20\40\40\x20\x20\40\40\40\x6e\x61\164\165\x72\x65\137\x32\54\15\12\x20\40\40\x20\x20\40\x20\x20\x20\40\x20\x20\x20\40\x20\x20\x6e\x61\164\x75\x72\145\x5f\63\x2c\15\xa\40\x20\40\40\40\x20\40\40\x20\40\40\40\x20\x20\40\40\x6e\x61\x74\x75\162\145\137\x34\54\15\xa\40\40\x20\x20\x20\40\40\x20\x20\40\40\40\x20\40\40\40\156\x61\164\x75\x72\x65\137\65\54\15\xa\40\40\40\40\40\x20\x20\40\x20\40\x20\40\40\x20\x20\40\156\x61\164\165\162\x65\137\66\x2c\xd\xa\40\x20\40\x20\40\x20\40\x20\x20\40\x20\x20\x20\40\40\x20\x6e\141\164\x75\x72\x65\x5f\67\x2c\15\xa\x20\40\40\40\x20\x20\40\x20\40\x20\x20\40\x20\40\x20\40\156\x61\164\x75\x72\x65\137\x38\54\15\12\x20\x20\x20\x20\x20\40\x20\x20\40\40\x20\x20\40\x20\x20\40\156\141\x74\165\162\145\x5f\x39\54\15\12\x20\x20\x20\x20\x20\x20\x20\40\x20\x20\x20\40\40\40\x20\x20\x6e\141\164\165\x72\x65\137\x31\60\54\xd\12\40\x20\x20\40\40\x20\40\x20\x20\40\40\x20\x20\40\40\40\x6e\141\164\x75\x72\145\x5f\x31\61\54\15\12\x20\x20\40\x20\x20\40\x20\40\x20\x20\x20\40\40\x20\40\40\156\141\164\165\x72\145\x5f\x31\62\54\xd\12\40\40\40\40\x20\x20\40\x20\x20\40\x20\40\x20\40\x20\40\x74\x61\x67"); goto LmOvZ; YaWN3: if (!$subject["\x72\145\160\x6f\162\164\137\x67\x65\156\x65\162\141\x74\157\162"]) { goto jCwm5; } goto qB90G; RtHW4: iZwpx: goto phUkW; qB90G: if (strpos($subject["\162\x65\160\157\162\x74\x5f\x67\145\x6e\145\162\141\x74\x6f\162"], "\x3a") === false) { goto nVBe3; } goto GYgkE; eX5Wz: qAL4k: goto YaWN3; K4Zkk: if (!empty($itemOptions)) { goto oajZJ; } goto HN22N; XCL34: goto NSTnS; goto biJP8; kft04: q26wD: goto YdcdH; YmRQJ: if (!empty($subject)) { goto iZwpx; } goto UKIom; MY3ok: $reporter = new AiAlgo(); goto CVuOi; HN22N: return []; goto OxfEs; phUkW: if ($this->checkReportAlgo($subject)) { goto qAL4k; } goto Eczcw; aetoS: return []; goto kft04; Hl3Vb: array_unshift($standards, ["\163\x74\x61\x6e\x64\141\x72\x64\x5f\x69\x64" => 0, "\x6c\141\164\151\164\x75\x64\145" => Defs::SUBJECT_WHOLE_STANDARD, "\x73\x74\x61\x74\151\x73\164\151\143\137\x77\x65\151\x67\x68\164\x5f\155\x69\x6e" => $subject["\x73\x74\x61\x74\151\163\x74\151\x63\137\x77\x65\151\x67\x68\164\x5f\x6d\x69\x6e"], "\x73\x74\x61\164\x69\x73\164\151\x63\137\167\145\151\147\150\164\x5f\x6d\x61\170" => $subject["\163\164\141\x74\x69\x73\164\151\143\137\x77\145\x69\x67\x68\x74\137\155\x61\170"], "\163\164\x61\156\x64\x61\162\144\137\167\x65\x69\147\150\x74\x5f\x6d\x69\156" => $subject["\x73\164\141\156\x64\141\x72\x64\x5f\x77\145\x69\x67\x68\164\x5f\x6d\151\x6e"], "\x73\x74\x61\156\144\141\x72\144\x5f\167\145\x69\x67\x68\x74\137\x6d\x61\x78" => $subject["\163\x74\141\x6e\144\141\162\144\x5f\167\145\x69\x67\x68\x74\x5f\155\x61\x78"]]); goto I4z9C; I4z9C: $rows = []; goto RXt47; fihwg: } public function downloadReportAlgo() { goto oTsKx; L4t1u: if ($zip->open($localSaveFile) === TRUE) { goto kAsqj; } goto z_Nbn; cV2jO: $localSaveFile = $reportLocation . DS . basename($downloadUrl); goto lAZHC; JAyZ3: $result = file_put_contents($localSaveFile, $content); goto vSbTy; b4QZ8: $downloadUrl = WzyerService::I()->apiFetchReportAlgo($number); goto FDW4F; jcXCc: $verInfo = (include_once $reportLocation . DS . "\x76\145\162\x2e\x70\x68\x70"); goto B4xdM; UKiCM: $zip = new \ZipArchive(); goto L4t1u; lAZHC: $content = file_get_contents($downloadUrl); goto fc7yr; fc7yr: if (!empty($content)) { goto SZ0hX; } goto C7G3d; hrOYb: $zip->close(); goto VQJDm; Vv41Q: VreZl: goto UKiCM; xCknN: wexception("\347\256\227\xe6\xb3\x95\xe6\x96\207\344\xbb\xb6\xe5\x86\x99\345\x85\xa5\345\244\xb1\xe8\xb4\xa5"); goto Vv41Q; oTsKx: $reportLocation = ROOT_PATH . DS . "\162\145\160\x6f\162\164"; goto VVF26; lOVms: cy4YK: goto DYZm1; FDW4F: if (!empty($downloadUrl)) { goto G6LOW; } goto agYx8; j5X_3: goto cy4YK; goto vghou; yqs6f: if (!file_exists($reportLocation . DS . "\x76\145\x72\56\x70\x68\x70")) { goto rI1Mr; } goto jcXCc; z_Nbn: wexception("\xe8\247\243\345\216\213\346\226\x87\344\273\xb6\345\xa4\261\350\xb4\xa5\54\x20{$localSaveFile}"); goto j5X_3; C7G3d: wexception("\344\270\213\xe8\275\xbd\347\xae\x97\346\263\225\xe6\x96\x87\xe4\xbb\xb6\xe5\xa4\xb1\xe8\xb4\245"); goto MhNYu; g8zkU: rI1Mr: goto b4QZ8; vghou: kAsqj: goto Zri6Z; s5T6d: G6LOW: goto cV2jO; vSbTy: if ($result) { goto VreZl; } goto xCknN; Zri6Z: $zip->extractTo($reportLocation . DS); goto hrOYb; MhNYu: SZ0hX: goto JAyZ3; VVF26: $number = ''; goto yqs6f; agYx8: return; goto s5T6d; B4xdM: $number = $verInfo["\156\165\155\x62\x65\162"]; goto g8zkU; VQJDm: unlink($localSaveFile); goto lOVms; DYZm1: } public function importSubject($subjectId) { goto F8Zqv; kCoTn: $subject["\x72\x65\160\x6f\162\164\x5f\x69\155\141\147\145\x35"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\145\x70\x6f\162\164\x5f\151\155\x61\147\x65\x35"])); goto xfFqm; un5CR: Zzv9r: goto Cr13L; We02v: Log::notice("\163\165\x62\152\145\x63\x74\x53\164\x61\156\x64\x61\x72\144\x73\x4e\145\x77\72\x20" . json_encode($subjectStandardsNew)); goto PWpAw; wKIxe: $subject["\163\165\x62\x6a\x65\x63\164\137\144\x65\163\143"] = htmlspecialchars_decode($subject["\x73\165\x62\x6a\x65\x63\x74\x5f\144\x65\x73\143"]); goto wJsG2; kZkjs: $subject = $subjctData["\x73\165\x62\152\x65\143\x74"]; goto uAdyH; v96ig: GU1l9: goto wKIxe; bjZ22: foreach ($images as $image) { goto j7yk8; PoP4U: $imagesLocal[] = $imageLocal; goto AT489; j7yk8: $imageLocal = downloadRemoteUploadFile(generateWzyerUploadFullUrl($image)); goto YM7Im; YM7Im: if (!$imageLocal) { goto m1QzL; } goto PoP4U; AT489: m1QzL: goto Ire55; Ire55: Lekk0: goto S5r5W; S5r5W: } goto Oo3KY; uAdyH: $subjectItems = $subjctData["\x73\x75\142\x6a\x65\x63\164\111\164\145\155\x73"]; goto z0hxF; I0Mqw: $subject["\151\x6d\x61\147\145\x5f\x75\162\x6c"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x69\155\141\x67\145\137\165\162\154"])); goto y58Dt; skr_2: unset($subject["\151\144"]); goto DhUj1; bZV8b: S8szK: goto We02v; ueUkM: $images = explode("\x2c", $subject["\x72\x65\160\157\162\164\x5f\x64\x65\155\x6f\x5f\x69\155\141\x67\145\163"]); goto T7229; cId17: $subjectItemsNew = []; goto hdr7R; Ce_IC: $subject["\x73\165\142\152\x65\x63\x74\137\x64\x65\163\x63"] = htmlspecialchars($subject["\x73\165\x62\152\x65\x63\x74\x5f\144\x65\163\143"]); goto skr_2; CZMRS: Cnixq: goto Ue9il; PWpAw: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto E0TOT; DXDxf: $subjectStandardLatitude["\163\164\141\x6e\144\141\x72\144\x5f\x69\144"] = $subjectStandardsNew[$subjectStandardLatitude["\163\164\x61\156\x64\x61\x72\x64\137\151\x64"]]["\151\144"]; goto rnZ39; rnZ39: hHFtM: goto azJCm; KrPNV: rM1B0: goto JrW85; azJCm: Db::table("\163\165\x62\152\x65\x63\164\137\163\x74\x61\156\x64\x61\162\x64\x5f\154\141\164\x69\x74\165\x64\x65")->insert($subjectStandardLatitude); goto KrPNV; vM83y: $subjectStandardLatitude["\x73\x75\142\152\x65\x63\x74\137\151\x64"] = $subjectIdNew; goto gi1lI; gi1lI: if (!$subjectStandardLatitude["\x73\x74\141\156\x64\141\162\144\137\151\144"]) { goto hHFtM; } goto DXDxf; E0TOT: unset($subjectStandardLatitude["\x69\x64"]); goto vM83y; JrW85: } goto un5CR; vqRG_: if (!$subject["\162\145\x70\x6f\x72\164\x5f\x64\x65\155\x6f\137\x69\155\x61\147\x65\x73"]) { goto GU1l9; } goto ueUkM; Oo3KY: IgTf2: goto reKHE; reKHE: $subject["\162\145\x70\x6f\x72\x74\x5f\144\x65\x6d\157\137\151\x6d\x61\147\x65\163"] = implode("\54", $imagesLocal); goto v96ig; y58Dt: $subject["\142\141\156\x6e\x65\x72\137\x69\155\x67"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\142\x61\156\x6e\145\162\x5f\151\155\x67"])); goto KkZF3; b21Ya: $subject["\141\x75\x64\151\x6f\x5f\165\x72\x6c"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x61\165\144\x69\x6f\x5f\165\162\154"])); goto vqRG_; NHHhE: $subject["\162\145\x70\157\162\164\137\151\155\141\147\145\x32"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x72\145\x70\157\162\164\137\151\155\141\147\145\x32"])); goto yjmz2; Cr13L: foreach ($subjectItemStandards as $subjectItemStandard) { goto YTzjq; rAdFF: $subjectItemStandard["\x73\164\x61\x6e\144\x61\x72\144\x5f\151\x64"] = $subjectStandardsNew[$subjectItemStandard["\x73\x74\x61\x6e\144\141\x72\x64\x5f\151\x64"]]["\x69\x64"]; goto DzLTz; YTzjq: unset($subjectItemStandard["\x69\144"]); goto UzdXf; EuA5p: vP5eR: goto JwMGu; DzLTz: Db::table("\163\165\x62\152\x65\143\164\137\x69\164\x65\x6d\x5f\x73\x74\x61\x6e\144\141\162\x64")->insert($subjectItemStandard); goto EuA5p; bMmac: $subjectItemStandard["\x69\x74\145\x6d\137\151\x64"] = $subjectItemsNew[$subjectItemStandard["\x69\164\145\x6d\137\151\x64"]]["\151\144"]; goto rAdFF; UzdXf: $subjectItemStandard["\x73\x75\142\152\145\143\x74\x5f\x69\144"] = $subjectIdNew; goto bMmac; JwMGu: } goto CZMRS; yjmz2: $subject["\162\x65\160\157\x72\x74\137\x69\155\x61\x67\x65\x33"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x72\145\x70\157\162\x74\137\x69\155\x61\147\x65\x33"])); goto XkTNV; mSMwn: $subjectStandardLatitudes = $subjctData["\x73\165\x62\x6a\145\143\x74\123\164\x61\156\x64\x61\162\x64\x4c\x61\x74\151\x74\x75\144\x65\163"]; goto q3hb5; FWagW: $subject["\166\151\144\145\x6f\137\165\162\154"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x76\151\x64\x65\157\137\165\x72\154"])); goto b21Ya; hdr7R: foreach ($subjectItems as $subjectItem) { goto qhr4Y; nGuqf: $subjectItem["\151\155\x61\x67\145"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subjectItem["\x69\x6d\x61\147\145"])); goto HbUEv; lk7WR: $subjectItemIdNew = Db::table("\x73\165\142\152\x65\143\x74\x5f\x69\x74\145\x6d")->insertGetId($subjectItem); goto NfctS; QLdDD: $i++; goto NXKWO; NfctS: $subjectItem["\151\144"] = $subjectItemIdNew; goto w8qt8; oAhQe: unset($subjectItem["\x69\x64"]); goto SeWMo; qhr4Y: $subjectItemId = $subjectItem["\x69\x64"]; goto oAhQe; SeWMo: $subjectItem["\163\x75\x62\x6a\x65\x63\x74\137\x69\144"] = $subjectIdNew; goto nGuqf; zq__D: $subjectItem["\151\155\x61\x67\145\137" . $i] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subjectItem["\151\x6d\x61\147\x65\137" . $i])); goto QLdDD; hf4R5: wxco0: goto y20fa; HbUEv: $i = 1; goto KAHyQ; W4vjy: if (!($i <= 12)) { goto neDob; } goto zq__D; NXKWO: goto T6Xl1; goto YPWan; KAHyQ: T6Xl1: goto W4vjy; YPWan: neDob: goto lk7WR; w8qt8: $subjectItemsNew[$subjectItemId] = $subjectItem; goto hf4R5; y20fa: } goto p0Ukg; T7229: $imagesLocal = []; goto bjZ22; XkTNV: $subject["\162\145\x70\x6f\x72\x74\137\x69\155\141\147\x65\x34"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\x65\x70\x6f\162\164\137\151\x6d\141\147\x65\x34"])); goto kCoTn; ESzMQ: $subjectStandardsNew = []; goto JbX0c; xfFqm: $subject["\162\x65\160\157\x72\164\x5f\x69\x6d\141\x67\145\66"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\145\160\x6f\162\x74\x5f\x69\155\141\x67\x65\66"])); goto FWagW; KkZF3: $subject["\162\x65\160\x6f\162\164\137\151\x6d\141\147\145\x31"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\x65\x70\157\162\164\x5f\151\155\141\147\145\61"])); goto NHHhE; Ue9il: OperationLogs::I()->subjectLog("\xe5\xaf\274\xe5\x85\245\xe9\x87\x8f\xe8\xa1\250\40\x2d\40{$subject["\x6e\x61\155\145"]}", beautifyLogArray($subject, [], "\x73\165\142\x6a\x65\143\x74"), OperationLogs::OPT_ADD_TYPE, $subjectIdNew); goto D0JSa; p0Ukg: YP01Z: goto IxOpM; z0hxF: $subjectStandards = $subjctData["\163\165\142\152\x65\143\164\123\164\x61\156\144\141\162\x64\x73"]; goto mSMwn; wJsG2: $subject["\163\165\142\152\145\143\164\x5f\x64\x65\x73\143"] = preg_replace("\57\x3c\133\x69\155\x67\174\111\x4d\x47\x5d\56\x2a\x3f\x73\x72\x63\x3d\x5b\x27\174\x5c\42\x5d\x28\x2e\x2a\x3f\x29\x5b\47\174\x5c\42\x5d\x2f", "\x3c\151\155\x67\x20\163\x72\143\75\42\x68\x74\164\160\x73\x3a\x2f\57\167\167\x77\56\x77\172\x79\x65\x72\x2e\x63\x6f\x6d\x24\173\x31\175\42", $subject["\163\165\142\x6a\x65\x63\x74\137\144\x65\163\x63"]); goto Ce_IC; q3hb5: $subjectItemStandards = $subjctData["\163\x75\x62\152\x65\x63\164\x49\164\145\x6d\123\x74\x61\156\x64\141\162\x64\163"]; goto I0Mqw; F8Zqv: $subjctData = WzyerService::I()->apiSubject($subjectId); goto kZkjs; DhUj1: $subjectIdNew = Db::table("\163\x75\x62\152\x65\x63\164")->insertGetId($subject); goto cId17; JbX0c: foreach ($subjectStandards as $subjectStandard) { goto xBBk9; BRX1U: $subjectStandard["\x69\x64"] = $subjectStandardIdNew; goto ZkzZ3; y_BpU: unset($subjectStandard["\151\144"]); goto t5ogS; ZkzZ3: $subjectStandardsNew[$subjectStandardId] = $subjectStandard; goto N5BUN; xBBk9: $subjectStandardId = $subjectStandard["\151\144"]; goto y_BpU; t5ogS: $subjectStandard["\163\165\142\152\145\143\x74\x5f\x69\144"] = $subjectIdNew; goto AnPHS; N5BUN: NkiKq: goto ZsTcn; AnPHS: $subjectStandardIdNew = Db::table("\x73\x75\x62\152\145\143\x74\137\163\164\141\x6e\x64\141\162\144")->insertGetId($subjectStandard); goto BRX1U; ZsTcn: } goto bZV8b; IxOpM: Log::notice("\163\165\x62\152\145\143\164\123\x74\141\x6e\x64\x61\162\144\x73\x3a\x20" . json_encode($subjectStandards)); goto ESzMQ; D0JSa: } public function duplicateSubject($subjectId) { goto Nlnx2; yiGos: OperationLogs::I()->subjectLog("\xe5\xa4\x8d\xe5\x88\xb6\351\207\x8f\xe8\241\xa8\x20\x2d\40{$subject["\156\141\x6d\145"]}", beautifyLogArray($subject, [], "\x73\x75\x62\152\x65\143\164"), OperationLogs::OPT_ADD_TYPE, $subjectIdNew); goto LnLBC; mqE9s: $subject["\x73\x74\x61\164\165\163"] = IndexDefs::ENTITY_DRAFT_STATUS; goto bQj1W; r7EaV: $subjectCategories = Db::table("\x73\165\142\x6a\x65\143\x74\137\x63\141\164\145\147\x6f\162\171\137\x72\145\154\x61\x74\x65")->where("\163\165\x62\152\x65\x63\x74\x5f\151\x64", $subjectId)->field("\x2a")->select(); goto Vgjjr; z_IiE: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto YazFB; FXXDS: $subjectStandardLatitude["\163\165\x62\x6a\x65\x63\x74\x5f\x69\144"] = $subjectIdNew; goto rJCyk; YazFB: unset($subjectStandardLatitude["\x69\144"]); goto FXXDS; rJCyk: $subjectStandardLatitude["\163\x74\x61\x6e\x64\x61\x72\144\137\151\144"] = 0; goto Tt0IO; FpYC7: biAwA: goto TUnvT; Tt0IO: Db::table("\163\x75\x62\152\x65\143\164\137\163\x74\x61\x6e\x64\x61\162\x64\137\x6c\x61\x74\151\x74\x75\x64\145")->insert($subjectStandardLatitude); goto FpYC7; TUnvT: } goto oA6tA; wQ2JW: unset($subject["\155\x6f\144\x69\x66\x79\x5f\x74\151\155\x65"]); goto mqE9s; DT7sH: unset($subject["\151\x64"]); goto uj28a; ZlULS: if (!empty($subject)) { goto dd0DQ; } goto Piv22; WS1tM: $subject["\x70\x61\x72\x74\151\143\151\x70\141\156\164\x73"] = 0; goto FUVNc; Il1y5: $subjectItemStandards = Db::table("\x73\x75\142\x6a\x65\x63\164\x5f\151\x74\145\x6d\x5f\163\164\x61\x6e\x64\x61\162\144")->where("\163\x75\142\x6a\x65\x63\x74\x5f\x69\144", $subjectId)->field("\x2a")->select(); goto ukVES; Bljeg: unset($subject["\143\162\145\x61\164\145\137\x74\151\155\145"]); goto wQ2JW; DrMR0: $subjectItems = Db::table("\163\165\x62\x6a\145\143\x74\x5f\x69\x74\x65\155")->where("\x73\x75\142\x6a\145\143\164\x5f\151\x64", $subjectId)->field("\52")->select(); goto HH4vl; FUVNc: $subject["\160\x61\162\164\x69\143\x69\x70\x61\156\164\x73\x5f\x73\150\x6f\x77"] = 0; goto U3E59; nL6zL: $subjectStandards = Db::table("\163\165\142\152\x65\x63\164\137\x73\x74\141\x6e\144\141\162\x64")->where("\163\165\142\x6a\145\x63\x74\x5f\x69\x64", $subjectId)->field("\x2a")->select(); goto ZAbRg; tgEG7: $subjectItemsNew = []; goto DrMR0; SvaeK: dd0DQ: goto DT7sH; DIDa_: foreach ($subjectStandardsNew as $subjectStandardId => $subjectStandardNew) { goto x0wEN; Dyt7y: W3vz7: goto GzJmK; DZ9YZ: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto VjxGs; odRWF: $subjectStandardLatitude["\x73\164\x61\x6e\144\141\162\144\x5f\x69\x64"] = $subjectStandardNew["\151\144"]; goto A2nct; A2nct: Db::table("\x73\165\142\x6a\145\x63\x74\137\x73\x74\x61\x6e\144\x61\x72\144\137\154\141\164\x69\x74\165\144\145")->insert($subjectStandardLatitude); goto alJ1O; sBT77: $subjectStandardLatitude["\163\165\x62\x6a\145\x63\x74\137\151\144"] = $subjectIdNew; goto odRWF; VjxGs: unset($subjectStandardLatitude["\x69\x64"]); goto sBT77; alJ1O: JrfFS: goto d2ltF; d2ltF: } goto i1WCH; i1WCH: MT0gS: goto Dyt7y; x0wEN: $subjectStandardLatitudes = Db::table("\163\x75\x62\152\145\143\164\x5f\163\164\x61\156\x64\141\x72\144\x5f\x6c\141\164\151\164\x75\x64\145")->where(["\163\x75\142\152\145\143\164\137\151\144" => $subjectId, "\163\164\x61\156\x64\x61\162\144\x5f\151\x64" => $subjectStandardId])->field("\x2a")->select(); goto DZ9YZ; GzJmK: } goto PMFRj; oXECS: $subject["\x71\x72\x63\x6f\x64\x65"] = ''; goto BQks7; KTUX8: $subjectStandardsNew = []; goto nL6zL; HOkx6: GiPyN: goto yiGos; HH4vl: foreach ($subjectItems as $subjectItem) { goto pJ2uh; fuLph: $subjectItem["\151\x64"] = $subjectItemIdNew; goto wQCdm; WHFR_: $subjectItem["\163\x75\x62\152\x65\143\x74\137\151\x64"] = $subjectIdNew; goto fdVUf; wQCdm: $subjectItemsNew[$subjectItemId] = $subjectItem; goto C1A2J; fdVUf: $subjectItemIdNew = Db::table("\x73\165\142\152\x65\143\164\x5f\151\x74\x65\x6d")->insertGetId($subjectItem); goto fuLph; pJ2uh: $subjectItemId = $subjectItem["\151\144"]; goto nQnq4; nQnq4: unset($subjectItem["\x69\144"]); goto WHFR_; C1A2J: cotlT: goto D4LE3; D4LE3: } goto sgxOt; bQj1W: $subject["\x6c\141\142\145\x6c"] = ''; goto WS1tM; ukVES: foreach ($subjectItemStandards as $subjectItemStandard) { goto oV_CO; oV_CO: unset($subjectItemStandard["\x69\144"]); goto G8Z6I; Qdh2p: $subjectItemStandard["\x73\164\x61\x6e\x64\141\162\x64\137\151\144"] = $subjectStandardsNew[$subjectItemStandard["\163\x74\141\156\x64\x61\162\x64\137\151\144"]]["\151\x64"]; goto Wrc26; Wrc26: Db::table("\x73\165\x62\152\x65\x63\164\137\151\x74\x65\155\x5f\163\164\141\x6e\144\141\x72\144")->insert($subjectItemStandard); goto uWSV9; uWSV9: J9lC8: goto njDB3; sfAqv: $subjectItemStandard["\x69\x74\145\x6d\x5f\151\x64"] = $subjectItemsNew[$subjectItemStandard["\151\164\145\x6d\x5f\151\144"]]["\x69\144"]; goto Qdh2p; G8Z6I: $subjectItemStandard["\x73\x75\x62\152\145\x63\x74\137\151\x64"] = $subjectIdNew; goto sfAqv; njDB3: } goto XDdCF; tBSSb: $subject["\143\x75\x72\x72\x65\156\x74\x5f\160\x72\151\x63\x65"] = 0; goto ZVEJi; sgxOt: MHSCj: goto KTUX8; pKh_b: cQSfG: goto D2mIN; D2mIN: $subjectStandardLatitudes = Db::table("\163\165\x62\152\x65\143\164\x5f\x73\164\x61\x6e\x64\x61\x72\144\137\154\x61\x74\151\x74\165\x64\145")->where(["\163\165\142\152\145\x63\164\137\151\x64" => $subjectId, "\163\164\x61\156\144\x61\x72\x64\137\x69\x64" => 0])->field("\x2a")->select(); goto z_IiE; BQks7: $subject["\x75\x6e\151\137\x61\160\160"] = 0; goto vCgM7; Vgjjr: foreach ($subjectCategories as $subjectCategory) { goto ralXC; ralXC: $subjectCategory["\x73\x75\142\x6a\x65\x63\x74\137\x69\144"] = $subjectIdNew; goto yjPel; NCFMK: uo2OF: goto EJ50z; yjPel: Db::table("\x73\165\x62\x6a\x65\x63\x74\x5f\143\x61\164\145\147\x6f\162\171\137\162\145\154\141\164\145")->insert($subjectCategory); goto NCFMK; EJ50z: } goto HOkx6; PMFRj: a5Wv3: goto Il1y5; U3E59: $subject["\164\157\164\x61\154\x5f\141\x6d\x6f\x75\x6e\x74"] = 0; goto sOT_O; vCgM7: $subjectIdNew = Db::table("\x73\x75\142\152\145\143\164")->insertGetId($subject); goto tgEG7; oA6tA: UGnw1: goto DIDa_; ZAbRg: foreach ($subjectStandards as $subjectStandard) { goto Th6SR; fJWW7: $subjectStandardsNew[$subjectStandardId] = $subjectStandard; goto SNZkf; F07UT: $subjectStandard["\151\144"] = $subjectStandardIdNew; goto fJWW7; GXqBR: $subjectStandard["\x73\x75\x62\x6a\x65\143\x74\x5f\151\144"] = $subjectIdNew; goto EAV53; SNZkf: Zlo7d: goto wPmI_; EAV53: $subjectStandardIdNew = Db::table("\x73\x75\x62\152\145\x63\164\x5f\x73\164\x61\x6e\144\141\162\144")->insertGetId($subjectStandard); goto F07UT; Th6SR: $subjectStandardId = $subjectStandard["\151\x64"]; goto oXa1I; oXa1I: unset($subjectStandard["\x69\144"]); goto GXqBR; wPmI_: } goto pKh_b; ZVEJi: $subject["\x73\157\x72\164"] = 1000; goto Bljeg; sOT_O: $subject["\144\145\x6c\x65\164\145\137\x66\154\x61\147"] = 0; goto oXECS; Piv22: exception("\xe6\x97\xa0\xe6\263\225\346\211\xbe\xe5\x88\xb0\xe9\207\217\350\xa1\250"); goto SvaeK; XDdCF: F4Tc8: goto r7EaV; Nlnx2: $subject = Db::table("\x73\x75\142\152\145\143\164")->where("\x69\x64", $subjectId)->field("\52")->find(); goto ZlULS; uj28a: $subject["\163\x6e"] = generateSubjectSn(); goto tBSSb; LnLBC: } }
