<?php
 namespace app\index\logic; use think\Db; use think\Log; use app\Defs; use app\index\service\RequestContext; class SurveyOrganization extends Base { public function loadTreeDatas($surveyId) { goto bIgB7; DBdU2: $treeDatas[] = $this->loadTreeDataRecursively($surveyId, 0); goto JPw6x; bIgB7: $treeDatas = []; goto DBdU2; JPw6x: return $treeDatas; goto Z6ymu; Z6ymu: } protected function loadTreeDataRecursively($surveyId, $id = 0, $parentId = 0, $breadcrumbParent = '') { goto LndKn; LndKn: if ($id == 0) { goto NLqSa; } goto Rmo_i; NxtFl: goto iBcpN; goto kGJtv; Rmo_i: $text = Db::table("\x73\165\x72\166\145\x79\137\157\x72\147\x61\x6e\151\172\141\164\x69\157\156")->where(["\x69\x64" => $id])->value("\x6e\141\155\145"); goto thOfa; kGJtv: NLqSa: goto TE_i9; L_cKu: d2be_: goto qMNWV; qMNWV: $breadcrumb = empty($breadcrumbParent) ? $text : $breadcrumbParent . "\x20\46\x67\164\x3b\x20" . $text; goto DJCFA; Uw9nc: iBcpN: goto aD1Tz; ClS4f: foreach ($childOrganizations as $childOrganization) { goto pJDNm; YlKyY: PB2Qy: goto laUc0; pJDNm: $childNodeDatas = $this->loadTreeDataRecursively($surveyId, $childOrganization["\151\x64"], $id, $breadcrumb); goto LL8yo; LL8yo: if (!$childNodeDatas) { goto PB2Qy; } goto NC0oC; NC0oC: $treeNodeDatas["\x63\x68\x69\x6c\144\162\x65\156"][] = $childNodeDatas; goto YlKyY; laUc0: e0bTK: goto ereRu; ereRu: } goto SbQly; sWs3e: $breadcrumb = empty($breadcrumbParent) ? $text : $breadcrumbParent . "\40\46\147\x74\x3b\40" . $text; goto OBEer; TE_i9: $text = "\xe6\231\256\xe6\237\xa5\347\273\x84\347\273\x87"; goto sWs3e; kZrky: return null; goto L_cKu; OBEer: $treeNodeDatas = ["\x69\144" => 0, "\x70\x61\162\x65\x6e\164\137\151\144" => 0, "\x74\x65\x78\x74" => $text, "\151\143\x6f\156\x43\154\x73" => "\146\141\40\x66\x61\55\x63\151\162\x63\154\x65", "\163\164\141\164\145" => "\x6f\160\145\156", "\x63\150\x69\154\144\162\145\156" => [], "\142\x72\x65\x61\x64\x63\162\x75\155\x62" => $breadcrumb]; goto Uw9nc; thOfa: if (!($text === null)) { goto d2be_; } goto kZrky; KF1u0: return $treeNodeDatas; goto jjb6m; aD1Tz: $childOrganizations = Db::table("\163\165\162\166\145\x79\x5f\x6f\162\147\141\156\151\172\141\x74\x69\x6f\156")->where(["\x70\141\x72\x65\x6e\164\x5f\151\x64" => $id, "\163\x75\162\166\145\171\137\151\x64" => $surveyId])->field("\x69\x64\54\x6e\141\x6d\145\54\160\141\x72\145\156\x74\x5f\x69\144")->order("\157\162\x64\145\x72\40\141\163\143\x2c\x20\x69\144\x20\141\x73\143")->select(); goto ClS4f; SbQly: eluXJ: goto KF1u0; DJCFA: $treeNodeDatas = ["\151\x64" => $id, "\x70\141\162\x65\156\x74\x5f\151\144" => $parentId, "\x74\145\x78\x74" => $text, "\x69\x63\x6f\x6e\103\x6c\163" => "\151\x63\x6f\156\x73\x2d\160\x6f\x69\x6e\x74", "\x73\x74\x61\x74\145" => "\157\x70\x65\x6e", "\x63\x68\151\x6c\x64\x72\x65\x6e" => [], "\142\162\145\x61\144\143\x72\165\155\x62" => $breadcrumb]; goto NxtFl; jjb6m: } public function loadComboDatas($surveyId, $id = 0, $prefix = '', $datas = array()) { goto iPxyy; rVaVB: foreach ($childOrganizations as $childOrganization) { $datas = $this->loadComboDatas($surveyId, $childOrganization["\151\144"], $nextPrefix, $datas); qPKrt: } goto Au3Y2; EYdFI: uGaUu: goto FC_mN; VCFGP: return $datas; goto gtPl9; iPxyy: if ($id == 0) { goto uGaUu; } goto c_zfF; y4qQ3: $prefix .= "\76"; goto ZTjib; cpC7i: if (!$prefix) { goto mQIM6; } goto y4qQ3; XXNSp: goto N6hsQ; goto EYdFI; ZTjib: mQIM6: goto UIZ8D; FC_mN: $datas[$id] = "\x2d\350\257\xb7\351\200\x89\xe6\213\xa9\55"; goto Tk2Nd; oB9FF: N6hsQ: goto Jp7Qo; Tk2Nd: $nextPrefix = ''; goto oB9FF; Jp7Qo: $childOrganizations = Db::table("\163\x75\x72\166\x65\x79\137\x6f\x72\147\141\156\151\172\141\x74\x69\157\x6e")->where(["\x70\141\162\145\156\x74\137\151\144" => $id, "\x73\165\x72\x76\145\171\x5f\151\x64" => $surveyId])->field("\x69\x64\x2c\156\x61\x6d\x65\x2c\x70\x61\x72\x65\156\x74\137\151\x64")->order("\157\162\144\145\x72\40\141\163\x63\x2c\x20\151\144\40\x61\x73\143")->select(); goto rVaVB; c_zfF: $text = Db::table("\x73\165\x72\x76\145\x79\x5f\x6f\x72\x67\141\x6e\x69\172\141\164\151\x6f\x6e")->where(["\151\x64" => $id])->value("\156\x61\155\145"); goto cpC7i; CCTSR: $nextPrefix = $prefix . $text; goto XXNSp; UIZ8D: $datas[$id] = $prefix . $text; goto CCTSR; Au3Y2: qMGtK: goto VCFGP; gtPl9: } public function loadComboDatasLeaf($surveyId, $id = 0, $prefix = '', $datas = array()) { goto LifD9; IcPoM: $datas[$id] = "\55\350\xaf\xb7\351\200\x89\346\213\xa9\55"; goto mtWq0; IA7X0: foreach ($childOrganizations as $childOrganization) { $datas = $this->loadComboDatasLeaf($surveyId, $childOrganization["\x69\144"], $nextPrefix, $datas); PYW0u: } goto cBxGa; JaHDO: return $datas; goto e19mF; cBxGa: f7qS6: goto JaHDO; EP3U7: $childOrganizations = Db::table("\163\165\162\x76\x65\171\x5f\x6f\x72\x67\x61\x6e\151\x7a\141\x74\x69\157\x6e")->where(["\160\x61\162\145\x6e\164\137\151\x64" => $id, "\163\165\162\x76\145\x79\x5f\151\144" => $surveyId])->field("\x69\144\x2c\156\141\x6d\x65\54\160\141\162\145\156\164\137\x69\x64")->order("\157\162\x64\145\x72\40\x61\x73\143\54\x20\x69\x64\40\141\163\143")->select(); goto IA7X0; pYmiO: if (!($childCount == 0)) { goto npZWG; } goto Fk5Ty; bVFcK: $text = Db::table("\163\x75\x72\166\145\171\x5f\x6f\162\x67\141\x6e\x69\172\141\x74\151\x6f\156")->where(["\x69\144" => $id])->value("\156\141\x6d\145"); goto SAWtk; HTxuH: $nextPrefix = $prefix . $text; goto BlSUu; gSGwR: kE0n6: goto iMMEy; pEdJW: x7pXR: goto EP3U7; SAWtk: if (!$prefix) { goto kE0n6; } goto CUS9Q; CUS9Q: $prefix .= "\x3e"; goto gSGwR; LifD9: if ($id == 0) { goto JS0nA; } goto bVFcK; ZlOoQ: npZWG: goto HTxuH; Fk5Ty: $datas[$id] = $prefix . $text; goto ZlOoQ; iMMEy: $childCount = Db::table("\x73\165\x72\166\x65\x79\137\157\162\x67\141\156\x69\x7a\141\x74\151\157\x6e")->where(["\x70\x61\x72\x65\156\x74\137\151\144" => $id, "\x73\165\x72\166\x65\171\137\151\x64" => $surveyId])->count(); goto pYmiO; mtWq0: $nextPrefix = ''; goto pEdJW; BlSUu: goto x7pXR; goto nOlFH; nOlFH: JS0nA: goto IcPoM; e19mF: } public function loadFullText($id, $suffix = '') { goto w3dMX; p05Ls: R1EcS: goto q3BjM; q3BjM: $organization = Db::table("\x73\x75\x72\166\x65\171\137\157\x72\147\141\x6e\x69\172\x61\x74\x69\x6f\156")->where(["\151\x64" => $id])->field("\x6e\141\155\145\x2c\40\160\141\162\x65\156\164\137\151\x64")->find(); goto vZz3h; ph70C: N_VQ1: goto mhfGC; mhfGC: $fullText = $this->loadFullText($organization["\x70\x61\x72\x65\x6e\x74\137\151\144"], $fullText); goto lKpQk; UTsP5: $fullText .= "\x20\46\x67\x74\73\x20" . $suffix; goto ph70C; w3dMX: if (!($id == 0)) { goto R1EcS; } goto jmUtV; lKpQk: return $fullText; goto n4Z02; TwzSp: return $suffix; goto RUY42; ythe0: if (!$suffix) { goto N_VQ1; } goto UTsP5; jmUtV: return $suffix; goto p05Ls; RUY42: WgWD9: goto cvXu0; vZz3h: if (!empty($organization)) { goto WgWD9; } goto TwzSp; cvXu0: $fullText = $organization["\x6e\x61\x6d\x65"]; goto ythe0; n4Z02: } public function isEmpty($surveyId) { $count = Db::table("\163\165\x72\x76\x65\171\137\157\162\x67\141\156\x69\172\141\x74\151\x6f\x6e")->where(["\160\x61\x72\145\156\164\137\x69\144" => 0, "\x73\x75\162\x76\145\171\x5f\x69\144" => $surveyId])->count(); return $count ? false : true; } public function add($surveyId, $name, $parentId) { goto ST29m; SkZ2M: Db::table("\x73\x75\162\x76\x65\x79\x5f\157\162\x67\x61\x6e\x69\172\141\x74\151\157\156")->where(["\x69\144" => $id])->setField("\x6f\162\144\145\x72", $id); goto aKTy7; wKr96: $id = Db::table("\x73\x75\x72\166\145\171\137\x6f\162\x67\x61\156\x69\172\x61\164\x69\157\156")->insertGetId($data); goto SkZ2M; aKTy7: return true; goto w2QeG; ST29m: $data = array("\163\165\x72\x76\145\171\x5f\151\x64" => $surveyId, "\x6e\x61\155\145" => $name, "\160\141\x72\x65\x6e\164\x5f\x69\144" => $parentId); goto wKr96; w2QeG: } public function update($id, $name) { goto LNbUs; UJbVR: return true; goto b_LHO; bXefD: Db::table("\x73\165\162\x76\x65\x79\137\157\162\147\141\x6e\x69\x7a\x61\x74\x69\157\156")->where("\x69\144", $id)->update($data); goto UJbVR; LNbUs: $data = array("\x6e\141\x6d\x65" => $name); goto bXefD; b_LHO: } public function delete($surveyId, $id) { goto aZ0_f; aZ0_f: $orders = Db::table("\163\165\x72\166\145\171\137\157\x72\144\x65\162")->where(["\x73\x75\162\x76\145\x79\137\x69\144" => $surveyId, "\x73\165\x72\166\145\x79\x5f\157\162\147\x61\x6e\151\x7a\141\x74\151\x6f\x6e\x5f\151\144" => $id])->field("\x69\x64\54\x20\160\145\162\x73\x6f\x6e\141\154\x5f\144\x61\x74\141")->select(); goto reb5v; ua8cF: $result = Db::table("\163\x75\x72\x76\x65\x79\137\157\162\x67\141\x6e\151\x7a\x61\164\x69\x6f\156")->where("\x69\x64", $id)->delete(); goto YWCBC; pFx3D: ZW3xE: goto c4QT4; YWCBC: return $result != 1 ? false : true; goto Zifly; reb5v: foreach ($orders as $order) { goto I5y1g; pusI0: TTLai: goto fqihW; R0Rh3: Db::table("\163\x75\162\x76\x65\171\137\157\x72\x64\145\162")->where("\151\x64", $orderId)->setField("\x70\145\162\163\157\x6e\141\x6c\137\144\x61\x74\141", json_encode($personalData)); goto pusI0; F4ct5: $personalData = json_decode($order["\x70\145\162\x73\157\x6e\141\x6c\137\144\141\164\141"], true); goto qXZWU; dqFHE: dTI_E: goto R0Rh3; I5y1g: $orderId = $order["\151\x64"]; goto F4ct5; qXZWU: if (!isset($personalData["\157\162\147\141\156\x69\x7a\141\164\151\157\156"])) { goto dTI_E; } goto KFDRJ; KFDRJ: $personalData["\157\x72\x67\141\156\151\x7a\141\x74\x69\x6f\156"] = 0; goto dqFHE; fqihW: } goto pFx3D; c4QT4: Db::table("\163\x75\162\x76\x65\x79\137\x6f\162\x64\x65\162")->where(["\x73\x75\x72\166\145\x79\137\x69\x64" => $surveyId, "\163\x75\x72\x76\145\x79\137\157\x72\x67\141\x6e\x69\172\x61\164\151\157\156\137\151\144" => $id])->setField("\163\x75\162\166\145\x79\x5f\157\x72\147\141\x6e\151\172\141\x74\x69\x6f\x6e\x5f\151\x64", 0); goto ua8cF; Zifly: } public function up($id) { goto ua5da; NnnnX: $i = 0; goto Nuag_; PjE_1: Mw_vD: goto SxAc6; SFhZP: return; goto WQTJe; njNqF: if ($i < count($siblingOrganizations)) { goto t3srV; } goto xjwfG; xjwfG: SR717: goto SK4bH; CSIHZ: if (!empty($siblingOrganizations)) { goto Ds_wW; } goto SFhZP; ua5da: $parentId = Db::table("\x73\x75\162\x76\x65\x79\137\x6f\x72\147\x61\x6e\x69\172\141\x74\151\157\156")->where(["\x69\x64" => $id])->value("\x70\141\162\145\x6e\164\137\151\x64"); goto FCdR3; Vz5ML: $orderPre = $siblingOrganizations[$i - 1]["\x6f\x72\x64\x65\162"]; goto LCD4G; ieQVU: return; goto JyXfR; LCD4G: Db::table("\x73\165\162\x76\x65\171\x5f\157\162\x67\141\x6e\151\172\141\x74\151\157\x6e")->where(["\x69\x64" => $id])->setField("\x6f\162\x64\145\162", $orderPre); goto z1X3Z; JyXfR: PrLzJ: goto NnnnX; NxLuo: if (!($i == 0)) { goto Mw_vD; } goto TeXj3; SxAc6: $order = $siblingOrganizations[$i]["\x6f\x72\x64\x65\162"]; goto Vz5ML; w0Jqe: if (!($siblingOrganizations[$i]["\x69\144"] == $id)) { goto kDr31; } goto NxLuo; Gjdef: $i++; goto njNqF; z1X3Z: Db::table("\x73\x75\x72\166\145\171\x5f\157\162\147\x61\x6e\151\172\x61\x74\x69\x6f\156")->where(["\x69\144" => $siblingOrganizations[$i - 1]["\151\x64"]])->setField("\x6f\162\144\145\162", $order); goto BKQrv; BKQrv: kDr31: goto Gjdef; WQTJe: Ds_wW: goto bZOSI; FCdR3: $siblingOrganizations = Db::table("\x73\x75\162\x76\145\x79\x5f\157\162\x67\141\156\151\172\x61\164\151\157\x6e")->where(["\160\141\162\145\x6e\x74\137\151\x64" => $parentId])->field("\151\144\54\x6e\x61\x6d\x65\54\160\x61\x72\145\x6e\x74\x5f\x69\144\54\x6f\162\144\x65\x72")->order("\x6f\x72\144\x65\162\40\x61\163\x63\x2c\40\x69\144\40\141\x73\x63")->select(); goto CSIHZ; Nuag_: t3srV: goto w0Jqe; bZOSI: if (!(count($siblingOrganizations) <= 1)) { goto PrLzJ; } goto ieQVU; TeXj3: goto SR717; goto PjE_1; SK4bH: } public function down($id) { goto q_26h; UoPUK: goto C58dt; goto Wvq49; JMDgd: Db::table("\163\x75\162\166\x65\x79\x5f\x6f\162\x67\141\156\151\x7a\x61\x74\x69\157\x6e")->where(["\x69\x64" => $id])->setField("\x6f\162\x64\x65\x72", $orderNext); goto qmO3a; hhvmc: if (!($i == count($siblingOrganizations) - 1)) { goto RWJK1; } goto UoPUK; SSGWu: return; goto CFKB5; LY1g3: return; goto TQ1B4; myBWC: if (!(count($siblingOrganizations) <= 1)) { goto nL70t; } goto LY1g3; q_26h: $parentId = Db::table("\x73\x75\x72\166\x65\x79\x5f\x6f\x72\147\141\156\x69\x7a\x61\x74\x69\157\156")->where(["\x69\144" => $id])->value("\x70\x61\x72\145\x6e\164\137\x69\x64"); goto k5tMd; P7TCB: if (!empty($siblingOrganizations)) { goto ESjP1; } goto SSGWu; vCgM0: if ($i < count($siblingOrganizations)) { goto jF0nY; } goto CB37B; ckiaA: jF0nY: goto QmiUX; O45gC: $i = 0; goto ckiaA; QmiUX: if (!($siblingOrganizations[$i]["\x69\x64"] == $id)) { goto HUCQ_; } goto hhvmc; TQ1B4: nL70t: goto O45gC; ckQK6: $order = $siblingOrganizations[$i]["\x6f\x72\x64\145\162"]; goto aMila; VfuXt: HUCQ_: goto Kcz2F; CB37B: C58dt: goto GFBNN; qmO3a: Db::table("\x73\x75\x72\166\x65\x79\137\157\162\147\x61\x6e\151\x7a\x61\164\x69\157\156")->where(["\151\144" => $siblingOrganizations[$i + 1]["\x69\144"]])->setField("\157\162\144\x65\x72", $order); goto VfuXt; CFKB5: ESjP1: goto myBWC; aMila: $orderNext = $siblingOrganizations[$i + 1]["\x6f\162\x64\x65\x72"]; goto JMDgd; Wvq49: RWJK1: goto ckQK6; Kcz2F: $i++; goto vCgM0; k5tMd: $siblingOrganizations = Db::table("\163\x75\162\x76\145\x79\137\157\x72\x67\x61\x6e\x69\x7a\x61\164\x69\157\156")->where(["\x70\141\x72\145\x6e\x74\x5f\151\x64" => $parentId])->field("\x69\x64\x2c\156\141\155\145\54\160\141\162\x65\x6e\164\137\x69\144\x2c\157\162\x64\145\162")->order("\x6f\x72\x64\x65\x72\x20\141\x73\x63\x2c\x20\x69\144\40\141\163\143")->select(); goto P7TCB; GFBNN: } public function changeLevel($id, $parentId) { Db::table("\x73\165\x72\166\x65\x79\137\x6f\162\147\141\x6e\x69\x7a\141\164\x69\157\x6e")->where("\x69\x64", $id)->setField("\x70\x61\x72\145\156\164\x5f\151\144", $parentId); return true; } }
