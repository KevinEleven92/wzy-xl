<?php
 namespace app\index\logic; use app\index\model\AdminRole as AdminRoleModel; use think\Log; use think\Db; use app\index\service\RequestContext; use app\index\logic\Defs as IndexDefs; use app\index\service\OperationLogs; class AdminRole extends Base { public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto sJNke; LRS7c: $conditions = []; goto tiIRJ; tiIRJ: if (emptyInArray($search, "\x72\157\154\x65\137\x6e\141\155\x65")) { goto p2kF4; } goto KCmrm; KzInv: foreach ($records as &$record) { $record["\160\162\x69\166\x69\154\145\147\x65\163"] = $this->getAuthText($record["\162\157\x6c\145\x5f\151\144"]); GKIFL: } goto aLbcI; aYMW4: $order = "\162\157\154\x65\x5f\151\144\40\141\163\x63"; goto MMbYo; K_aKu: return ["\164\157\x74\141\x6c" => $totalCount, "\x72\157\x77\x73" => $records]; goto iKJUM; mzT_m: h5wCH: goto LRS7c; WIvIp: $totalCount = Db::table("\141\144\155\x69\156\x5f\x72\157\154\x65")->where($conditions)->count(); goto Z1uUp; aLbcI: czsr7: goto K_aKu; pGkYr: dx3Nb: goto aG5Wa; sJNke: if ($sort == "\162\157\154\145\137\x69\x64") { goto dx3Nb; } goto aYMW4; MMbYo: goto h5wCH; goto pGkYr; KCmrm: $conditions["\x72\x6f\x6c\x65\137\156\x61\155\145"] = ["\154\151\x6b\145", "\45" . $search["\162\157\x6c\145\x5f\156\141\155\145"] . "\x25"]; goto xiTpX; Z1uUp: $records = Db::table("\141\144\x6d\x69\156\x5f\x72\x6f\154\x65")->where($conditions)->page($page, $rows)->order($order)->field(true)->select(); goto KzInv; xiTpX: p2kF4: goto WIvIp; aG5Wa: $order = "\x72\x6f\154\x65\x5f\x69\144\x20" . $order; goto mzT_m; iKJUM: } public function save($roleId, $infos) { goto yFkT6; MFFBr: $model->data($infos); goto yUX0C; sx61r: if ($model) { goto eebmF; } goto KtilT; zUMXE: GBaAK: goto Btd7I; r67CZ: ZCi3Z: goto C_kty; yFkT6: if (!$roleId) { goto et0HA; } goto geXT3; y_LLD: $model = new AdminRoleModel(); goto hnArl; AOGd7: et0HA: goto y_LLD; tvaiZ: OperationLogs::I()->systemLog("\344\xbf\256\346\224\xb9\347\256\xa1\xe7\x90\206\345\x91\x98\xe8\247\x92\xe8\x89\262", beautifyLogArray($infos, [], $adminsRoleTable), OperationLogs::OPT_UPDATE_TYPE, $roleId); goto r67CZ; hnArl: $adminsRoleTable = "\x61\x64\155\x69\156\137\162\157\154\x65"; goto MFFBr; yUX0C: $model->allowField(true)->save(); goto RJB1b; geXT3: $model = AdminRoleModel::get($roleId); goto TOk13; GtoYD: $result = $model->allowField(true)->save($infos); goto C41Z3; C_kty: goto GBaAK; goto AOGd7; C41Z3: if (!$result) { goto ZCi3Z; } goto tvaiZ; HQDrz: eebmF: goto GtoYD; RJB1b: OperationLogs::I()->systemLog("\346\226\260\xe5\xa2\236\347\256\241\xe7\x90\206\345\x91\x98\350\247\x92\xe8\x89\xb2", beautifyLogArray($infos, [], $adminsRoleTable), OperationLogs::OPT_ADD_TYPE, $model->role_id); goto zUMXE; TOk13: $adminsRoleTable = "\141\x64\x6d\151\156\x5f\162\157\154\x65"; goto sx61r; KtilT: exception("\xe6\x97\xa0\346\xb3\225\346\211\276\xe5\210\260\xe8\xaf\xa5\xe8\xa7\222\xe8\211\262"); goto HQDrz; Btd7I: } public function delete($roleId) { goto ehbNt; ruAkR: EWCkM: goto bd58Q; ehbNt: $model = AdminRoleModel::get($roleId); goto prKur; z3spg: Db::table("\141\144\x6d\x69\x6e\137\162\x6f\154\145\137\x6d\145\x6e\165")->where("\162\157\154\x65\x5f\x69\144", $roleId)->delete(); goto kK6Gv; prKur: if ($model) { goto EWCkM; } goto AjCVD; kK6Gv: OperationLogs::I()->systemLog("\345\210\xa0\xe9\x99\xa4\xe7\xae\xa1\347\220\x86\xe5\x91\x98\xe8\xa7\x92\350\211\xb2", $model->role_name, OperationLogs::OPT_DELETE_TYPE, $roleId); goto IJflQ; bd58Q: AdminRoleModel::destroy($roleId); goto ndafJ; ndafJ: Db::table("\x61\x64\155\x69\x6e\x73")->where("\x72\x6f\x6c\x65\x5f\x69\144", $roleId)->setField("\162\x6f\154\145\x5f\x69\x64", 0); goto z3spg; AjCVD: exception("\xe6\227\240\346\xb3\225\346\211\276\xe5\x88\260\350\xaf\245\350\247\222\350\x89\xb2"); goto ruAkR; IJflQ: } public function get($roleId) { goto e2kr7; wQse4: return $record; goto Yi644; thmxJ: MGpdo: goto wQse4; Qyahg: return null; goto thmxJ; flY_e: if ($record) { goto MGpdo; } goto Qyahg; e2kr7: $record = Db::table("\x61\x64\x6d\x69\x6e\x5f\162\x6f\x6c\145")->where("\162\157\154\x65\137\x69\x64", $roleId)->field(true)->find(); goto flY_e; Yi644: } public function getDefault() { return ["\x72\157\154\x65\137\x6e\141\155\145" => '', "\x64\145\x73\143\162\151\x70\x74\x69\x6f\156" => '']; } protected function getAuthText($roleId) { goto wHqd8; wHqd8: $texts = []; goto uiUK2; cS3fB: n9PRD: goto F641e; F641e: return implode("\73\x20", $texts); goto Cjfqe; vuuOH: $rows = Db::table($adminRoleMenuTable)->where(array("\162\x6f\154\145\137\x69\x64" => $roleId))->field("\155\x65\x6e\165\137\151\x64\x2c\40\x74\171\160\x65")->select(); goto ZyslN; uiUK2: $menuTable = "\155\x65\x6e\x75"; goto iY1NC; ZyslN: foreach ($rows as $row) { goto LJyOD; XGGvp: goto Dodh0; goto PVAgz; KQYdz: $menuId = $row["\x6d\145\x6e\165\x5f\x69\x64"]; goto iu45l; TTOuN: $text = "\74\163\x74\x72\157\x6e\x67\40\x63\x6c\x61\x73\x73\75\x22\164\145\170\x74\55\163\145\x63\157\156\144\x61\162\x79\x20\x66\x6f\x6e\x74\x2d\x69\x74\x61\x6c\x69\x63\x22\76" . $menuName . "\x28" . IndexDefs::AUTHORIZE_TYPE_DEFS[$type] . "\51\74\57\x73\x74\162\157\x6e\x67\x3e"; goto YooHp; MHARU: if (!empty($menu)) { goto EVhzM; } goto Tavqu; YooHp: Cg29H: goto YfVaO; GonkV: $pid = $menu["\160\x69\x64"]; goto TTOuN; WtsgY: $text = $menuName . "\76" . $text; goto QvilS; u4g2Z: $texts[] = $text; goto YSO22; UbQms: PVWzu: goto WNXoG; WNXoG: if (!$text) { goto PGQaZ; } goto u4g2Z; s9ox9: $menu = Db::table($menuTable)->where(array("\x69\x64" => $pid))->field("\x69\x64\54\x20\160\151\x64\54\x20\x6e\141\155\145")->find(); goto MHARU; J8l9V: $pid = $menu["\160\x69\144"]; goto WtsgY; LJyOD: $text = ''; goto KQYdz; ncLNm: $menuName = $menu["\156\x61\155\145"]; goto GonkV; QvilS: goto Cg29H; goto UbQms; Tavqu: goto PVWzu; goto TuKM1; VSQcB: if (!empty($menu)) { goto HQazd; } goto XGGvp; TuKM1: EVhzM: goto TSyoP; H5I1b: $menu = Db::table($menuTable)->where(array("\151\144" => $menuId))->field("\x69\144\54\40\160\151\x64\x2c\x20\x6e\x61\x6d\x65")->find(); goto VSQcB; YSO22: PGQaZ: goto embXS; PVAgz: HQazd: goto ncLNm; iu45l: $type = $row["\164\x79\x70\145"]; goto H5I1b; TSyoP: $menuName = $menu["\x6e\141\155\145"]; goto J8l9V; embXS: Dodh0: goto mfvY7; YfVaO: if (!$pid) { goto PVWzu; } goto s9ox9; mfvY7: } goto cS3fB; iY1NC: $adminRoleMenuTable = "\x61\144\155\151\156\x5f\162\157\x6c\x65\x5f\155\x65\x6e\165"; goto vuuOH; Cjfqe: } }
