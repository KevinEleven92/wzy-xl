<?php
 namespace app\index\logic; use app\index\model\AdminRole as AdminRoleModel; use think\Log; use think\Db; use app\index\service\RequestContext; use app\index\logic\Defs as IndexDefs; use app\index\service\OperationLogs; class AdminRole extends Base { public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto neM2J; FXr1r: Ndl0Y: goto KT89J; e94aA: if (emptyInArray($search, "\x72\x6f\154\x65\137\x6e\x61\155\x65")) { goto YrHe1; } goto rXcbX; pWXVv: foreach ($records as &$record) { $record["\160\x72\151\166\151\154\145\x67\145\x73"] = $this->getAuthText($record["\x72\157\x6c\145\137\x69\x64"]); o5b9N: } goto bk9y2; neM2J: if ($sort == "\162\157\154\145\x5f\151\144") { goto TM80O; } goto SeQQy; Dyfcz: YrHe1: goto uvWk0; tm3Ex: return ["\x74\157\164\x61\154" => $totalCount, "\x72\x6f\x77\x73" => $records]; goto JHBAD; SlZ0w: goto Ndl0Y; goto n7UkE; uvWk0: $totalCount = Db::table("\x61\144\155\x69\x6e\x5f\x72\x6f\154\x65")->where($conditions)->count(); goto fB9NO; mmfDp: $order = "\x72\157\154\x65\x5f\151\144\x20" . $order; goto FXr1r; SeQQy: $order = "\162\157\154\x65\137\x69\x64\40\x61\163\x63"; goto SlZ0w; fB9NO: $records = Db::table("\141\144\x6d\151\x6e\137\162\x6f\154\x65")->where($conditions)->page($page, $rows)->order($order)->field(true)->select(); goto pWXVv; KT89J: $conditions = []; goto e94aA; n7UkE: TM80O: goto mmfDp; bk9y2: PmPTK: goto tm3Ex; rXcbX: $conditions["\x72\157\x6c\145\137\156\141\x6d\145"] = ["\154\x69\x6b\x65", "\x25" . $search["\x72\157\x6c\x65\x5f\x6e\x61\x6d\145"] . "\45"]; goto Dyfcz; JHBAD: } public function save($roleId, $infos) { goto X6_7P; epUPG: $model = AdminRoleModel::get($roleId); goto Jo0n7; axgdq: OperationLogs::I()->systemLog("\346\226\260\xe5\xa2\236\347\256\xa1\xe7\x90\x86\xe5\221\x98\xe8\xa7\x92\350\211\262", beautifyLogArray($infos, [], $adminsRoleTable), OperationLogs::OPT_ADD_TYPE, $model->role_id); goto Wlxz4; v4Vom: goto OfyNz; goto gjXu1; ue24l: VASPG: goto v4Vom; TJd7Q: $model->allowField(true)->save(); goto axgdq; X6_7P: if (!$roleId) { goto E0aF4; } goto epUPG; t48e2: exception("\346\227\240\346\xb3\225\346\x89\276\345\210\260\350\257\245\xe8\xa7\x92\350\211\262"); goto vwXn_; gjXu1: E0aF4: goto q0XgB; epKQ_: if ($model) { goto QVusG; } goto t48e2; vwXn_: QVusG: goto RZ5m9; B1oE6: $model->data($infos); goto TJd7Q; Jo0n7: $adminsRoleTable = "\141\144\x6d\x69\156\x5f\162\x6f\154\x65"; goto epKQ_; W3Jbr: $adminsRoleTable = "\x61\x64\x6d\151\156\137\162\157\x6c\x65"; goto B1oE6; RZ5m9: $result = $model->allowField(true)->save($infos); goto UCTrV; UCTrV: if (!$result) { goto VASPG; } goto e2s4k; q0XgB: $model = new AdminRoleModel(); goto W3Jbr; Wlxz4: OfyNz: goto td7eu; e2s4k: OperationLogs::I()->systemLog("\344\277\256\346\224\271\347\xae\241\347\220\206\xe5\x91\x98\xe8\247\x92\xe8\211\xb2", beautifyLogArray($infos, [], $adminsRoleTable), OperationLogs::OPT_UPDATE_TYPE, $roleId); goto ue24l; td7eu: } public function delete($roleId) { goto HzQJG; HzQJG: $model = AdminRoleModel::get($roleId); goto QipYG; Vga80: OperationLogs::I()->systemLog("\xe5\x88\240\351\231\xa4\xe7\256\xa1\347\220\x86\345\221\x98\350\247\222\xe8\211\262", $model->role_name, OperationLogs::OPT_DELETE_TYPE, $roleId); goto eH1mh; AM4F1: Db::table("\x61\x64\x6d\151\x6e\163")->where("\162\157\154\145\137\x69\144", $roleId)->setField("\162\157\154\x65\x5f\151\x64", 0); goto qRIir; ulbaj: Xn4AY: goto AnYJe; AnYJe: AdminRoleModel::destroy($roleId); goto AM4F1; QipYG: if ($model) { goto Xn4AY; } goto gkGgh; qRIir: Db::table("\141\x64\x6d\x69\156\x5f\162\157\154\145\137\x6d\145\156\x75")->where("\x72\x6f\154\145\137\151\144", $roleId)->delete(); goto Vga80; gkGgh: exception("\346\227\xa0\xe6\xb3\225\346\x89\xbe\xe5\x88\260\xe8\257\xa5\350\247\222\350\211\xb2"); goto ulbaj; eH1mh: } public function get($roleId) { goto TvvTd; TvvTd: $record = Db::table("\x61\144\x6d\x69\x6e\137\162\x6f\x6c\x65")->where("\162\157\x6c\145\x5f\151\x64", $roleId)->field(true)->find(); goto dktmR; oSKb8: return $record; goto s_Nks; j0rxJ: GC3gN: goto oSKb8; dktmR: if ($record) { goto GC3gN; } goto yPgwf; yPgwf: return null; goto j0rxJ; s_Nks: } public function getDefault() { return ["\162\x6f\154\x65\x5f\x6e\x61\155\145" => '', "\x64\145\163\x63\162\x69\160\164\151\157\156" => '']; } protected function getAuthText($roleId) { goto sGPQc; zAqzY: $adminRoleMenuTable = "\x61\144\155\151\x6e\x5f\x72\x6f\x6c\x65\137\155\145\x6e\x75"; goto l0Iw9; FcWY5: pKNgX: goto KQBUN; acjfN: $menuTable = "\155\x65\156\165"; goto zAqzY; KQBUN: return implode("\73\40", $texts); goto yDKue; l0Iw9: $rows = Db::table($adminRoleMenuTable)->where(array("\162\x6f\154\x65\x5f\151\144" => $roleId))->field("\x6d\145\156\165\137\151\144\x2c\x20\164\171\160\145")->select(); goto belBt; belBt: foreach ($rows as $row) { goto W_FfM; lPXno: $texts[] = $text; goto aXOIy; g_XlQ: goto cFjwz; goto V6auE; lBtAr: if (!empty($menu)) { goto pYhq1; } goto VR_3S; pK3Nw: iGNGN: goto LnR4R; aXOIy: xBlKw: goto mnA5m; wpRGv: $pid = $menu["\160\x69\144"]; goto spjrH; vktUz: if (!empty($menu)) { goto euilw; } goto g_XlQ; C5Oiz: if (!$pid) { goto iGNGN; } goto QMzCk; Q4mVD: O8qmE: goto C5Oiz; BHVLZ: $menuId = $row["\x6d\145\x6e\x75\137\x69\x64"]; goto MYLL_; V6auE: euilw: goto p32P0; MYLL_: $type = $row["\x74\x79\x70\x65"]; goto qQacn; QMzCk: $menu = Db::table($menuTable)->where(array("\151\144" => $pid))->field("\151\x64\x2c\x20\x70\x69\144\x2c\40\156\141\x6d\145")->find(); goto lBtAr; a_FDj: pYhq1: goto yo8W_; yo8W_: $menuName = $menu["\x6e\x61\x6d\x65"]; goto bJdlc; VR_3S: goto iGNGN; goto a_FDj; qQacn: $menu = Db::table($menuTable)->where(array("\151\x64" => $menuId))->field("\x69\x64\x2c\40\x70\x69\144\54\x20\156\x61\155\145")->find(); goto vktUz; spjrH: $text = "\74\x73\x74\162\x6f\x6e\147\x20\143\x6c\141\163\163\75\x22\164\145\x78\164\55\163\145\143\x6f\x6e\x64\141\x72\171\x20\x66\157\x6e\164\x2d\x69\164\141\x6c\x69\x63\42\76" . $menuName . "\50" . IndexDefs::AUTHORIZE_TYPE_DEFS[$type] . "\x29\x3c\57\x73\x74\x72\157\156\x67\x3e"; goto Q4mVD; mnA5m: cFjwz: goto EDFx2; s3aX7: goto O8qmE; goto pK3Nw; p32P0: $menuName = $menu["\x6e\141\x6d\145"]; goto wpRGv; bJdlc: $pid = $menu["\160\151\144"]; goto QILEg; W_FfM: $text = ''; goto BHVLZ; QILEg: $text = $menuName . "\76" . $text; goto s3aX7; LnR4R: if (!$text) { goto xBlKw; } goto lPXno; EDFx2: } goto FcWY5; sGPQc: $texts = []; goto acjfN; yDKue: } }
