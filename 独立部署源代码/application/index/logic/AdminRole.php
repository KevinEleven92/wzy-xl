<?php
 namespace app\index\logic; use app\index\model\AdminRole as AdminRoleModel; use think\Log; use think\Db; use app\index\service\RequestContext; use app\index\logic\Defs as IndexDefs; use app\index\service\OperationLogs; class AdminRole extends Base { public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto z2C2f; d4uLY: foreach ($records as &$record) { $record["\160\162\x69\166\151\154\x65\147\145\x73"] = $this->getAuthText($record["\x72\157\154\145\x5f\151\x64"]); wx4kF: } goto VMJUY; PMf8Q: $records = Db::table("\x61\144\x6d\x69\x6e\x5f\x72\x6f\154\145")->where($conditions)->page($page, $rows)->order($order)->field(true)->select(); goto d4uLY; z2C2f: if ($sort == "\162\157\154\145\x5f\151\x64") { goto WOs8Y; } goto OmyNt; FJ3dC: $order = "\162\x6f\x6c\145\137\x69\x64\40" . $order; goto p3xkN; KMtL1: goto oV791; goto nB3K0; p3xkN: oV791: goto q1yDD; PqAW6: if (emptyInArray($search, "\162\x6f\154\x65\137\x6e\x61\155\x65")) { goto eLajm; } goto erejV; xswt5: return ["\164\157\x74\x61\154" => $totalCount, "\162\157\167\x73" => $records]; goto uZnWx; VMJUY: hiFFj: goto xswt5; U8kzA: $totalCount = Db::table("\x61\x64\x6d\151\x6e\x5f\162\x6f\154\145")->where($conditions)->count(); goto PMf8Q; erejV: $conditions["\x72\x6f\x6c\145\x5f\156\x61\155\145"] = ["\x6c\151\153\x65", "\45" . $search["\x72\x6f\x6c\x65\137\x6e\141\155\145"] . "\x25"]; goto h0o34; nB3K0: WOs8Y: goto FJ3dC; q1yDD: $conditions = []; goto PqAW6; OmyNt: $order = "\x72\x6f\154\x65\x5f\x69\144\x20\x61\x73\143"; goto KMtL1; h0o34: eLajm: goto U8kzA; uZnWx: } public function save($roleId, $infos) { goto fJZPH; Kx3Za: goto l9xBn; goto nV6wU; M74DN: if (!$result) { goto tWY4t; } goto ZqMZu; qUt00: $model = new AdminRoleModel(); goto CIom2; MSBd8: $result = $model->allowField(true)->save($infos); goto M74DN; zyRmg: OperationLogs::I()->systemLog("\xe6\x96\xb0\345\242\x9e\347\xae\241\xe7\x90\206\xe5\221\x98\350\xa7\222\350\x89\262", beautifyLogArray($infos, [], $adminsRoleTable), OperationLogs::OPT_ADD_TYPE, $model->role_id); goto vq166; ZqMZu: OperationLogs::I()->systemLog("\xe4\xbf\xae\346\224\xb9\xe7\xae\xa1\xe7\220\206\345\221\x98\xe8\xa7\x92\350\x89\xb2", beautifyLogArray($infos, [], $adminsRoleTable), OperationLogs::OPT_UPDATE_TYPE, $roleId); goto f7nMq; RdVrw: if ($model) { goto HzIA7; } goto iYTQf; nV6wU: pZzRU: goto qUt00; f7nMq: tWY4t: goto Kx3Za; CIom2: $adminsRoleTable = "\x61\144\x6d\151\156\137\162\157\154\x65"; goto yn2lV; BR5dV: $model = AdminRoleModel::get($roleId); goto CHpht; vq166: l9xBn: goto COVIi; K6yhJ: $model->allowField(true)->save(); goto zyRmg; fJZPH: if (!$roleId) { goto pZzRU; } goto BR5dV; iYTQf: exception("\xe6\227\xa0\346\xb3\x95\xe6\x89\276\345\x88\260\350\257\xa5\xe8\xa7\x92\xe8\x89\262"); goto hyjDA; yn2lV: $model->data($infos); goto K6yhJ; hyjDA: HzIA7: goto MSBd8; CHpht: $adminsRoleTable = "\x61\x64\155\151\156\x5f\x72\x6f\x6c\x65"; goto RdVrw; COVIi: } public function delete($roleId) { goto K21F2; RMF2Q: OperationLogs::I()->systemLog("\xe5\x88\xa0\351\x99\244\xe7\256\241\xe7\220\x86\345\221\x98\xe8\247\x92\350\x89\262", $model->role_name, OperationLogs::OPT_DELETE_TYPE, $roleId); goto SVswt; y2rIe: exception("\xe6\227\xa0\346\xb3\225\346\211\xbe\xe5\210\xb0\xe8\xaf\245\xe8\247\x92\xe8\211\xb2"); goto kn0O2; kn0O2: b1EAr: goto CZ6Pe; GLM3v: Db::table("\141\144\155\x69\x6e\x73")->where("\x72\x6f\x6c\145\137\151\144", $roleId)->setField("\x72\x6f\x6c\x65\x5f\x69\144", 0); goto TVDce; VEj5U: if ($model) { goto b1EAr; } goto y2rIe; K21F2: $model = AdminRoleModel::get($roleId); goto VEj5U; CZ6Pe: AdminRoleModel::destroy($roleId); goto GLM3v; TVDce: Db::table("\x61\x64\155\151\156\137\162\157\154\145\137\x6d\145\156\x75")->where("\162\x6f\x6c\x65\x5f\151\x64", $roleId)->delete(); goto RMF2Q; SVswt: } public function get($roleId) { goto sWsnY; AwQxh: if ($record) { goto sp3Ea; } goto RTxJ2; nhejv: return $record; goto syZcy; sWsnY: $record = Db::table("\x61\144\155\x69\x6e\137\x72\x6f\x6c\x65")->where("\x72\x6f\x6c\x65\x5f\x69\144", $roleId)->field(true)->find(); goto AwQxh; NVtS7: sp3Ea: goto nhejv; RTxJ2: return null; goto NVtS7; syZcy: } public function getDefault() { return ["\x72\157\154\145\137\x6e\141\155\145" => '', "\144\x65\163\143\162\151\x70\164\x69\157\156" => '']; } protected function getAuthText($roleId) { goto ZOQ35; u0ir9: return implode("\73\x20", $texts); goto A8zqK; tsOOB: foreach ($rows as $row) { goto lgl8i; OLZCa: pI1Oi: goto KDqgV; KDqgV: $menuName = $menu["\x6e\x61\x6d\x65"]; goto cxJdY; g_qW2: y6NPz: goto x7Qm8; oqwYl: $text = "\74\x73\164\162\157\x6e\147\x20\143\154\x61\x73\163\75\42\164\145\170\x74\x2d\x73\145\x63\157\156\x64\x61\162\x79\40\146\157\x6e\164\55\x69\x74\141\x6c\x69\143\42\x3e" . $menuName . "\50" . IndexDefs::AUTHORIZE_TYPE_DEFS[$type] . "\51\x3c\x2f\163\164\x72\x6f\x6e\147\76"; goto g_qW2; TfYnc: goto y6NPz; goto qYeXN; Pd63I: lTDdp: goto OgVMJ; BBSmo: if (!$text) { goto lTDdp; } goto FlgPV; FlgPV: $texts[] = $text; goto Pd63I; PVlE0: goto advfj; goto gEQmF; qUllr: $menu = Db::table($menuTable)->where(array("\x69\x64" => $pid))->field("\x69\x64\54\x20\x70\x69\x64\54\40\x6e\141\155\145")->find(); goto XY4TV; Hbp2V: $text = $menuName . "\x3e" . $text; goto TfYnc; cxJdY: $pid = $menu["\160\151\x64"]; goto Hbp2V; ZFsBy: $pid = $menu["\160\x69\144"]; goto oqwYl; XdNCJ: $menuId = $row["\155\x65\156\x75\x5f\151\x64"]; goto TlJzS; OgVMJ: advfj: goto FfxmU; TlJzS: $type = $row["\x74\x79\x70\145"]; goto DdayC; DdayC: $menu = Db::table($menuTable)->where(array("\x69\144" => $menuId))->field("\151\144\54\40\160\151\x64\x2c\40\x6e\x61\155\x65")->find(); goto lVUXU; lgl8i: $text = ''; goto XdNCJ; gEQmF: KYWNv: goto aecLb; aC77W: goto EOHwq; goto OLZCa; aecLb: $menuName = $menu["\x6e\x61\x6d\145"]; goto ZFsBy; lVUXU: if (!empty($menu)) { goto KYWNv; } goto PVlE0; x7Qm8: if (!$pid) { goto EOHwq; } goto qUllr; XY4TV: if (!empty($menu)) { goto pI1Oi; } goto aC77W; qYeXN: EOHwq: goto BBSmo; FfxmU: } goto LmtQl; xTmGE: $menuTable = "\x6d\145\x6e\165"; goto izwIt; LmtQl: EvWZ2: goto u0ir9; izwIt: $adminRoleMenuTable = "\141\x64\x6d\151\156\137\162\157\154\x65\x5f\155\x65\156\x75"; goto BF6Ws; ZOQ35: $texts = []; goto xTmGE; BF6Ws: $rows = Db::table($adminRoleMenuTable)->where(array("\x72\157\154\x65\x5f\151\144" => $roleId))->field("\x6d\145\x6e\165\x5f\151\144\x2c\40\164\171\160\145")->select(); goto tsOOB; A8zqK: } }
