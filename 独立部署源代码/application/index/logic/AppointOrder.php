<?php
 namespace app\index\logic; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\Defs; use app\index\logic\Defs as IndexDefs; use app\index\service\EventLogs as EventLogsService; use app\index\model\AppointOrder as AppointOrderModel; use EasyWeChat\Factory; use app\index\service\RequestContext; use app\index\service\OperationLogs as OperationLogsService; class AppointOrder extends Base { protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto EPLzJ; hJLDL: foreach ($records as &$record) { goto ly8wa; ly8wa: $showTime = convertAppointTimesToShow($record["\141\160\x70\x6f\x69\x6e\x74\137\x74\151\155\145"]); goto nB7sd; Pi956: b4j3q: goto NAbPE; nB7sd: $record["\x61\x70\x70\x6f\x69\x6e\164\x5f\x74\x69\x6d\x65\x5f\146\x75\x6c\154"] = $record["\141\x70\160\x6f\x69\156\x74\x5f\144\141\164\x65"] . "\40" . $showTime . "\50" . $record["\x61\x70\x70\x6f\x69\x6e\x74\x5f\x64\165\x72\141\x74\x69\x6f\156"] . "\345\x88\x86\xe9\222\237\51"; goto Pi956; NAbPE: } goto ewpY3; OvjSF: BqdwG: goto wxdm_; O45jd: if (emptyInArray($search, "\157\x72\144\145\x72\137\x6e\157")) { goto AsOkC; } goto XVbqj; yGs2l: $conditions["\x4f\56\x63\x65\x6c\154\x70\150\157\156\145"] = ["\154\x69\153\145", "\x25" . $search["\143\x65\x6c\154\160\150\157\156\x65"] . "\45"]; goto OvjSF; PZ9mQ: WCl5C: goto pndfZ; U40vv: $conditions = []; goto O45jd; bdKQx: SH7P_: goto s6eWu; W3D4m: if (emptyInArray($search, "\x65\x78\160\x65\x72\164\137\151\x64")) { goto wT_Lq; } goto N7SdZ; WZ0cW: R2l7j: goto U40vv; Ny_3c: if ($sort == "\x61\x70\160\x6f\151\x6e\164\137\x74\151\x6d\x65\x5f\x66\165\154\x6c") { goto wHICP; } goto fI5tY; wxdm_: if (!(isset($search["\163\x74\141\x74\x75\x73"]) && $search["\x73\x74\x61\164\165\x73"])) { goto jspZw; } goto QHzL3; JDExK: return ["\x74\157\x74\x61\x6c" => $totalCount, "\x72\x6f\167\x73" => $records]; goto rLkQE; IDg4O: xqwkG: goto W3D4m; HSAa2: $conditions["\117\x2e\x63\x75\x73\x74\157\155\145\162\x5f\151\x64"] = $search["\143\165\x73\164\157\x6d\x65\x72\137\151\144"]; goto rxR27; pndfZ: if (emptyInArray($search, "\143\145\x6c\x6c\x70\x68\157\156\145")) { goto BqdwG; } goto yGs2l; ewpY3: wIdQj: goto JDExK; XVbqj: $conditions["\117\x2e\x6f\162\x64\x65\162\x5f\156\x6f"] = $search["\x6f\x72\x64\145\162\137\156\157"]; goto TeSpD; Mcbwu: c2h3r: goto juw0I; s6eWu: $totalCount = Db::table("\145\170\x70\145\162\x74\137\157\162\144\145\162")->alias("\x4f")->join("\145\170\160\x65\162\x74\x20\x45", "\117\56\x65\x78\160\x65\x72\x74\x5f\151\144\x3d\x45\x2e\x69\x64")->join("\x63\165\x73\164\x6f\155\x65\x72\x20\x43", "\117\x2e\x63\x75\x73\x74\157\155\x65\162\x5f\x69\x64\x3d\x43\x2e\151\x64")->where($conditions)->count(); goto hslaV; N7SdZ: $conditions["\x4f\x2e\145\x78\x70\145\x72\x74\x5f\x69\144"] = $search["\145\x78\160\145\x72\x74\137\x69\x64"]; goto aIvjM; C0Fuu: $order = "\x4f\x2e\x6f\x72\144\145\162\x5f\x74\x69\155\x65\x20" . $order; goto WZ0cW; jJeHA: goto c2h3r; goto DOX22; ZCbqN: if (emptyInArray($search, "\143\x75\x73\164\x6f\155\145\x72\137\x69\144")) { goto neONu; } goto HSAa2; juw0I: goto R2l7j; goto nwMAS; IDwUB: if (emptyInArray($search, "\x6e\x69\143\153\x6e\x61\x6d\x65")) { goto rqT2m; } goto CJ6cf; CJ6cf: $conditions["\x43\x2e\x6e\151\x63\x6b\x6e\x61\155\x65"] = ["\154\151\x6b\x65", "\x25" . $search["\x6e\151\x63\153\156\x61\x6d\x65"] . "\45"]; goto QqyZa; iTqhU: if (!(isset($search["\x70\x61\171\137\x73\x74\141\164\165\163"]) && $search["\160\141\171\137\163\164\141\164\x75\x73"])) { goto SH7P_; } goto RXFW1; RXFW1: $conditions["\x4f\x2e\160\x61\x79\x5f\163\164\x61\x74\165\163"] = $search["\160\x61\x79\x5f\x73\x74\141\164\x75\x73"]; goto bdKQx; EPLzJ: if ($sort == "\x6f\x72\x64\x65\162\x5f\164\x69\155\x65") { goto k_j74; } goto Ny_3c; hslaV: $records = Db::table("\145\x78\160\145\x72\x74\x5f\x6f\x72\144\x65\162")->alias("\117")->join("\145\x78\160\145\x72\x74\40\105", "\117\56\x65\170\160\145\x72\x74\137\x69\x64\x3d\x45\x2e\x69\x64")->join("\143\x75\x73\164\157\x6d\145\162\40\103", "\117\x2e\143\165\163\164\157\155\x65\162\137\x69\144\75\x43\x2e\x69\x64")->where($conditions)->page($page, $rows)->order($order)->field("\117\x2e\x2a\x2c\x20\105\56\x72\x65\x61\x6c\137\156\x61\155\145\x20\x61\163\x20\x65\170\160\x65\x72\164\137\x72\x65\x61\x6c\137\x6e\141\155\x65\54\40\105\x2e\143\x65\x6c\x6c\160\x68\x6f\156\x65\40\x61\163\40\145\170\160\145\x72\164\137\x63\x65\x6c\x6c\x70\150\157\156\145\x2c\x20\103\56\x6e\151\143\x6b\x6e\x61\x6d\145\x2c\x20\143\157\156\x63\141\x74\x28\117\x2e\x61\x70\160\x6f\151\x6e\x74\137\x64\141\164\145\x2c\x20\47\40\47\x2c\40\117\x2e\141\x70\160\157\151\x6e\164\x5f\x74\151\155\145\54\x20\x27\x28\47\54\x20\117\x2e\141\x70\160\x6f\151\x6e\164\137\144\165\162\x61\164\151\157\x6e\54\x20\47\x29\47\51\x20\x61\163\x20\141\x70\x70\157\x69\x6e\x74\x5f\x64\141\x74\145\137\164\x69\x6d\x65")->select(); goto hJLDL; fI5tY: $order = "\117\56\x6f\x72\x64\145\x72\x5f\x74\151\x6d\145\40\x64\145\x73\x63"; goto jJeHA; gP40L: $conditions["\x4f\56\x6c\151\156\x6b\155\x61\x6e"] = ["\x6c\151\153\145", "\45" . $search["\x6c\151\156\x6b\x6d\141\x6e"] . "\45"]; goto PZ9mQ; mZDwN: $order = "\x4f\x2e\141\x70\160\157\151\x6e\x74\137\144\141\164\145\40" . $order . "\54\40\117\56\x61\x70\x70\x6f\x69\x6e\x74\x5f\x74\151\x6d\145\40" . $order; goto Mcbwu; BQYYL: if (emptyInArray($search, "\x72\x65\141\x6c\x5f\156\141\x6d\145")) { goto xqwkG; } goto mis5L; TeSpD: AsOkC: goto IDwUB; uAEIH: if (emptyInArray($search, "\x6c\151\156\153\155\x61\156")) { goto WCl5C; } goto gP40L; aIvjM: wT_Lq: goto ZCbqN; rxR27: neONu: goto uAEIH; nwMAS: k_j74: goto C0Fuu; QqyZa: rqT2m: goto BQYYL; lHnhQ: jspZw: goto iTqhU; QHzL3: $conditions["\x4f\56\163\164\x61\x74\x75\x73"] = $search["\x73\x74\141\x74\x75\x73"]; goto lHnhQ; DOX22: wHICP: goto mZDwN; mis5L: $conditions["\105\x2e\162\x65\x61\x6c\137\156\x61\x6d\145"] = ["\x6c\x69\153\145", "\45" . $search["\x72\x65\x61\154\x5f\x6e\x61\155\x65"] . "\x25"]; goto IDg4O; rLkQE: } public function getInfos($orderNo) { goto Y61CL; R80eR: $showTime = convertAppointTimesToShow($infos["\141\x70\x70\x6f\151\x6e\x74\137\x74\151\155\x65"]); goto MqcJw; NjaSU: return null; goto HC353; MqcJw: $infos["\x61\160\160\x6f\x69\x6e\x74\137\x74\151\x6d\x65\x5f\146\x75\154\154"] = $infos["\141\x70\160\157\x69\156\x74\x5f\x64\141\x74\x65"] . "\40" . $showTime . "\x28" . $infos["\x61\160\x70\x6f\x69\x6e\x74\137\144\165\x72\x61\164\151\157\x6e"] . "\xe5\x88\206\351\x92\x9f\51"; goto GvXLD; Y61CL: $infos = Db::table("\x65\x78\x70\145\x72\x74\x5f\x6f\x72\x64\145\x72")->where("\x6f\162\x64\145\x72\x5f\156\157", $orderNo)->field(true)->find(); goto EhZj0; GvXLD: return $infos; goto vdO4D; HC353: HD5kG: goto R80eR; EhZj0: if ($infos) { goto HD5kG; } goto NjaSU; vdO4D: } public function getOrderInfos($customerId, $orderNo) { goto KpUxi; KpUxi: $infos = Db::table("\145\x78\x70\x65\x72\x74\x5f\x6f\x72\144\x65\x72")->where(["\x63\165\163\164\157\x6d\x65\x72\137\151\x64" => $customerId, "\x6f\x72\144\145\x72\137\156\157" => $orderNo])->field(true)->find(); goto KXF_y; lOjXs: $infos["\141\160\160\157\151\156\x74\137\164\151\155\x65\137\146\165\x6c\x6c"] = $infos["\x61\160\x70\x6f\151\156\x74\137\x64\x61\164\145"] . "\x20" . $showTime . "\x28" . $infos["\141\160\x70\x6f\x69\156\x74\x5f\x64\165\162\141\164\x69\157\x6e"] . "\xe5\x88\206\351\x92\237\x29"; goto zVKLX; INrWF: return null; goto W2Zh2; zVKLX: return $infos; goto pJYK1; KXF_y: if ($infos) { goto a6rgn; } goto INrWF; ecYYw: $showTime = convertAppointTimesToShow($infos["\141\x70\x70\157\151\156\x74\137\x74\x69\155\145"]); goto lOjXs; W2Zh2: a6rgn: goto ecYYw; pJYK1: } public function getOrderInfosById($id) { goto cHOqO; Tsfk_: $infos["\141\160\x70\157\x69\x6e\164\x5f\164\151\x6d\x65\137\x66\165\154\x6c"] = $infos["\141\160\x70\157\x69\x6e\164\137\144\x61\164\145"] . "\40" . $showTime . "\x28" . $infos["\141\160\160\157\151\x6e\x74\x5f\144\x75\x72\x61\x74\151\x6f\156"] . "\xe5\x88\206\xe9\x92\x9f\x29"; goto qfziB; TunCQ: $showTime = convertAppointTimesToShow($infos["\x61\x70\x70\157\151\x6e\x74\x5f\164\151\x6d\x65"]); goto Tsfk_; e466Z: return null; goto DoZSF; cHOqO: $infos = Db::table("\145\x78\160\x65\x72\x74\x5f\157\162\144\145\162")->where(["\x69\144" => $id])->field(true)->find(); goto jvjss; qfziB: return $infos; goto C9T09; jvjss: if ($infos) { goto uYDBF; } goto e466Z; DoZSF: uYDBF: goto TunCQ; C9T09: } public function refreshOrderNo($customerId, $orderNo) { goto HbrH3; fk1jt: Dgf68: goto c4ijo; DvCvt: return $orderNoNew; goto qy9nR; EMMPx: return false; goto fk1jt; BvHN4: if ($infos) { goto Dgf68; } goto EMMPx; vITRd: Db::table("\x65\x78\160\145\x72\164\x5f\157\x72\144\x65\x72")->where(["\x63\165\x73\x74\157\x6d\x65\162\x5f\x69\144" => $customerId, "\157\162\x64\x65\162\137\156\x6f" => $orderNo])->setField("\x6f\162\144\x65\x72\137\156\x6f", $orderNoNew); goto DvCvt; c4ijo: $orderNoNew = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\x45"); goto vITRd; HbrH3: $infos = Db::table("\145\170\160\145\x72\x74\x5f\x6f\162\144\145\162")->where(["\143\165\163\164\157\x6d\145\162\137\x69\x64" => $customerId, "\157\162\x64\145\162\x5f\x6e\x6f" => $orderNo])->field(true)->find(); goto BvHN4; qy9nR: } public function refreshOrderNoById($customerId, $id) { goto LL2A0; gd4N9: $orderNoNew = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\105"); goto qjf_C; ZFBMh: return $orderNoNew; goto Eqqeg; uhs1r: lPx52: goto gd4N9; qjf_C: Db::table("\x65\x78\x70\145\162\164\137\x6f\162\x64\145\x72")->where(["\x69\x64" => $id])->setField("\x6f\162\x64\x65\162\x5f\x6e\x6f", $orderNoNew); goto ZFBMh; h38BL: return false; goto uhs1r; y3JsJ: if ($infos) { goto lPx52; } goto h38BL; LL2A0: $infos = Db::table("\x65\170\160\145\162\x74\x5f\157\162\x64\145\162")->where(["\151\x64" => $id])->field(true)->find(); goto y3JsJ; Eqqeg: } public function getLinkmen($customerId) { $records = Db::table("\145\x78\x70\x65\162\x74\137\x6f\162\x64\145\162")->distinct(true)->where(["\143\165\x73\x74\157\155\145\x72\137\x69\x64" => $customerId])->field("\154\x69\x6e\153\x6d\141\x6e\54\x20\143\145\x6c\154\x70\x68\157\156\145")->order("\157\162\144\x65\x72\x5f\164\151\155\x65\x20\x64\145\x73\143")->select(); return $records; } public function finish($orderNo) { goto nQitK; zckXX: $id = 0; goto pnJKI; fgMRh: if (!empty($id)) { goto J4KeC; } goto zckXX; nQitK: Db::table("\x65\170\x70\x65\x72\164\137\157\x72\144\145\x72")->where("\157\x72\x64\145\x72\x5f\x6e\157", $orderNo)->update(["\x66\x69\x6e\151\163\150\137\164\151\x6d\x65" => Db::raw("\x6e\x6f\167\50\x29"), "\163\x74\141\x74\165\163" => IndexDefs::ORDER_FINISH_STATUS]); goto scLZD; tBv8t: OperationLogsService::I()->orderLog("\xe9\xa2\x84\xe7\272\xa6\350\256\xa2\xe5\x8d\x95\xe5\xae\214\346\210\220", "\xe8\256\xa2\345\215\225\xe5\217\267\72\40" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto A10XM; A10XM: return true; goto K7Ceh; scLZD: $id = Db::table("\145\170\160\x65\x72\x74\x5f\157\162\144\x65\x72")->where("\x6f\x72\x64\145\x72\x5f\x6e\x6f", $orderNo)->value("\151\144"); goto fgMRh; pnJKI: J4KeC: goto tBv8t; K7Ceh: } public function cancel($orderNo) { goto CDZyH; ghmEz: $id = 0; goto cjo2G; j1Wvs: OperationLogsService::I()->orderLog("\xe9\xa2\204\xe7\xba\xa6\xe8\xae\242\345\x8d\x95\345\x8f\226\xe6\266\210", "\xe8\xae\xa2\345\x8d\x95\xe5\217\267\x3a\40" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto abeCF; vba76: if (!empty($id)) { goto v7SdX; } goto ghmEz; abeCF: return true; goto zdHWv; cjo2G: v7SdX: goto j1Wvs; CDZyH: Db::table("\x65\170\x70\x65\162\164\x5f\x6f\x72\x64\145\x72")->where("\x6f\x72\144\x65\x72\137\156\157", $orderNo)->update(["\163\164\141\164\x75\x73" => IndexDefs::ORDER_CANCELLED_STATUS]); goto rwg7k; rwg7k: $id = Db::table("\145\170\160\x65\162\x74\137\x6f\x72\144\145\162")->where("\157\162\144\x65\162\x5f\156\x6f", $orderNo)->value("\151\144"); goto vba76; zdHWv: } public function refund($orderNo) { goto imiA_; Lufq9: if (!empty($id)) { goto RL1BS; } goto pVkCz; cSQSj: RL1BS: goto dLfjf; ur2kw: Log::notice("\351\242\204\347\xba\246\351\x80\x80\xe6\xac\276\xe6\210\x90\345\212\x9f\x3a\x20" . var_export($result, true)); goto gxZO4; dLfjf: OperationLogsService::I()->orderLog("\351\242\204\xe7\272\xa6\350\256\xa2\xe5\215\x95\351\x80\x80\346\254\xbe", "\xe8\xae\242\345\x8d\x95\xe5\x8f\267\x3a\x20" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto QrfIz; pVkCz: $id = 0; goto cSQSj; gxZO4: Db::table("\145\170\x70\145\x72\x74\137\x6f\x72\x64\x65\x72")->where("\157\162\144\145\162\137\156\157", $orderNo)->update(["\162\x65\146\165\156\x64\x5f\157\162\x64\x65\x72\137\156\157" => $refundOrderNo, "\x72\145\146\165\x6e\144\137\141\155\x6f\x75\156\164" => $orderAmount, "\162\x65\146\165\x6e\144\137\164\x69\155\x65" => date("\x59\55\x6d\55\144\x20\x48\x3a\x69\x3a\x73"), "\x70\x61\171\137\x73\x74\141\x74\x75\163" => Defs::PAY_REFUND]); goto ivFZP; eCX_f: $app = Factory::payment(config("\x77\170\56\x70\141\171\155\145\156\164")); goto LOOnR; oIJ3F: if (!empty($order)) { goto x40f7; } goto LeIs8; QrfIz: return true; goto M1wk4; qa1C7: $result = $app->refund->byOutTradeNumber($orderNo, $refundOrderNo, $orderAmount * 100, $orderAmount * 100); goto MMbkn; P0zYm: $order = Db::table("\145\170\x70\x65\x72\x74\x5f\x6f\162\144\x65\x72")->where("\x6f\162\144\x65\x72\x5f\x6e\x6f", $orderNo)->field(true)->find(); goto oIJ3F; imiA_: exception("\345\212\x9f\xe8\203\xbd\347\246\x81\xe7\224\250"); goto P0zYm; f1_co: x40f7: goto x_acr; BA0lU: wxPaySetting(); goto eCX_f; fWPx3: UuO_x: goto ur2kw; x_acr: $orderAmount = $order["\157\162\144\x65\x72\137\x61\155\x6f\x75\x6e\164"]; goto BA0lU; LeIs8: exception("\xe6\227\240\xe6\xb3\225\346\211\276\xe5\210\260\350\257\245\350\xae\xa2\345\215\225"); goto f1_co; ivFZP: $id = $order["\151\x64"]; goto Lufq9; wGWqP: logEvent("\345\222\xa8\350\xaf\xa2\351\242\204\347\272\246\xe8\xae\242\345\215\225{$orderNo}\351\x80\x80\xe6\xac\276\345\xa4\261\xe8\264\245", EventLogsService::eSeverityWarning); goto y3ZOc; y3ZOc: exception("\351\200\200\346\xac\xbe\345\xa4\261\350\xb4\245\72\x20" . var_export($result, true)); goto fWPx3; MMbkn: if (!empty($result)) { goto UuO_x; } goto wGWqP; LOOnR: $refundOrderNo = generateSequenceNo($order["\143\x75\x73\164\x6f\x6d\145\x72\137\151\x64"], Defs::APPOINT_ORDER_REFUND_NO_SEQ_NUM_KEY, "\x45\x52"); goto qa1C7; M1wk4: } public function changeTime($orderNo, $appointDate, $appointTime) { goto iGKPb; iGKPb: Db::table("\x65\x78\x70\145\162\164\137\x6f\x72\x64\x65\x72")->where("\x6f\162\x64\x65\162\137\156\157", $orderNo)->update(["\x61\160\x70\x6f\x69\x6e\164\137\x64\141\164\x65" => $appointDate, "\141\160\160\157\151\x6e\x74\137\x74\x69\x6d\x65" => $appointTime]); goto Jq_hZ; Hpjej: return true; goto HXOCU; EUaJ2: $id = 0; goto ng103; ng103: FQgZ2: goto D1twm; VHE1X: if (!empty($id)) { goto FQgZ2; } goto EUaJ2; Jq_hZ: $id = Db::table("\x65\170\x70\x65\162\164\x5f\157\162\x64\145\162")->where("\157\x72\144\145\x72\137\156\x6f", $orderNo)->value("\151\144"); goto VHE1X; D1twm: OperationLogsService::I()->orderLog("\351\242\x84\347\xba\246\350\256\xa2\345\215\225\xe6\x9b\264\xe6\x94\271\346\x97\266\351\227\264", "\350\256\242\xe5\215\225\345\217\xb7\x3a\40{$orderNo}\40\346\233\xb4\346\226\260\xe5\220\x8e\x20{$appointDate}\x20{$appointTime}", OperationLogsService::OPT_UPDATE_TYPE, $id); goto Hpjej; HXOCU: } public function generateOrder($customerId, $expertId, $orderAmount, $appointDate, $appointTime, $appointDuration, $appointMode, $payStatus) { goto PGxvP; sVJtx: $orderNo = $existOrder["\x6f\162\x64\145\x72\137\156\x6f"]; goto Z0rkD; wlQSb: CeCga: goto F81qN; AePAo: Db::table("\145\x78\x70\145\x72\x74\137\157\162\144\x65\162")->insert(["\157\x72\144\x65\x72\137\x6e\157" => $orderNo, "\143\x75\163\164\157\x6d\145\x72\137\x69\x64" => $customerId, "\145\170\160\145\x72\164\x5f\151\144" => $expertId, "\x6f\x72\144\x65\x72\137\x61\155\157\x75\156\x74" => $orderAmount, "\x6f\x72\x64\145\162\137\x74\151\x6d\145" => date("\131\x2d\x6d\55\x64\x20\110\x3a\151\x3a\163"), "\x61\160\160\x6f\151\156\164\137\144\x61\164\145" => $appointDate, "\141\x70\160\x6f\x69\156\x74\137\x74\151\155\145" => $appointTime, "\141\160\160\157\151\x6e\164\137\144\165\162\x61\164\x69\x6f\x6e" => $appointDuration, "\x61\x70\160\x6f\151\156\x74\137\155\x6f\144\x65" => $appointMode, "\163\164\x61\x74\x75\x73" => IndexDefs::ORDER_PENDING_STATUS, "\x70\x61\x79\x5f\x73\164\141\x74\x75\x73" => $payStatus]); goto tlJ2i; I9VSf: u1uL2: goto sVJtx; Z0rkD: Db::table("\145\x78\x70\145\162\x74\x5f\x6f\x72\x64\x65\x72")->where(["\157\162\x64\x65\x72\137\156\157" => $orderNo])->update(["\157\x72\x64\145\162\137\141\155\157\165\156\164" => $orderAmount, "\157\162\x64\145\162\137\x74\x69\x6d\x65" => date("\x59\55\x6d\x2d\x64\40\110\72\151\x3a\x73"), "\x61\x70\160\x6f\x69\x6e\164\x5f\x64\165\x72\141\x74\x69\x6f\x6e" => $appointDuration, "\141\x70\x70\157\x69\x6e\164\137\155\157\144\x65" => $appointMode]); goto wlQSb; tlJ2i: goto CeCga; goto I9VSf; F81qN: return $orderNo; goto MV2wE; GaWum: $orderNo = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\x45"); goto AePAo; PGxvP: $existOrder = Db::table("\145\x78\160\145\162\164\x5f\x6f\x72\x64\x65\162")->where(["\x63\165\163\164\x6f\155\x65\162\137\x69\144" => $customerId, "\145\x78\160\x65\162\x74\x5f\151\144" => $expertId, "\141\160\x70\x6f\151\156\164\x5f\x64\x61\x74\x65" => $appointDate, "\141\x70\x70\x6f\x69\x6e\164\x5f\x74\151\155\x65" => $appointTime])->find(); goto vmbaZ; vmbaZ: if ($existOrder) { goto u1uL2; } goto GaWum; MV2wE: } public function getOrders($customerId, $status = 0) { goto fHCnU; gU2wi: P8t2n: goto YzPu0; Mz1Os: return $records; goto EvchR; YzPu0: $records = Db::table("\145\x78\160\145\162\164\137\157\x72\x64\x65\x72")->alias("\x45\117")->join("\x65\170\160\x65\x72\x74\40\x45", "\x45\x4f\56\x65\170\x70\145\x72\x74\137\x69\x64\75\x45\x2e\x69\144")->where($conditions)->field("\x45\x4f\56\x2a\x2c\40\105\x2e\x72\x65\x61\x6c\x5f\156\141\155\145\x20\x61\x73\40\145\170\x70\145\162\x74\x5f\x6e\141\x6d\x65\54\40\105\56\167\157\162\x6b\x69\x6d\x67\137\x75\x72\154\54\40\x45\56\143\145\154\154\x70\x68\157\156\145\40\141\x73\40\x65\x78\x70\145\x72\x74\137\x63\x65\x6c\x6c\160\150\x6f\156\x65\54\x20\x63\x6f\x6e\143\141\164\50\x45\117\x2e\141\x70\160\x6f\151\x6e\164\137\x64\141\164\x65\54\40\47\40\x27\x2c\40\105\x4f\x2e\141\160\160\157\x69\x6e\x74\x5f\164\151\155\x65\54\40\47\x28\x27\x2c\x20\x45\x4f\56\x61\x70\160\x6f\151\x6e\164\137\x64\165\x72\x61\164\151\157\156\x2c\x20\47\51\x27\x29\40\x61\x73\40\141\160\x70\x6f\151\156\x74\137\144\141\164\145\137\164\x69\155\x65")->order("\x45\117\56\x6f\162\x64\x65\x72\x5f\164\151\155\145\x20\144\145\x73\143")->select(); goto LTDPR; LTDPR: foreach ($records as &$record) { $record["\163\x74\x61\164\165\x73\x5f\x74\x65\170\164"] = IndexDefs::$orderStatusDefs[$record["\x73\x74\x61\x74\165\163"]]; z7xmL: } goto c12eY; c12eY: Jm8QJ: goto Mz1Os; HNDRS: $conditions["\105\x4f\x2e\x73\x74\x61\164\165\x73"] = $status; goto gU2wi; Eh7R3: if (!$status) { goto P8t2n; } goto HNDRS; fHCnU: $conditions = ["\x45\117\x2e\x63\x75\x73\164\157\155\145\x72\137\x69\x64" => $customerId]; goto Eh7R3; EvchR: } public function cancelOrder($id) { Db::table("\x65\170\x70\x65\162\x74\137\157\162\144\145\162")->where("\151\x64", $id)->update(["\163\164\141\164\x75\x73" => IndexDefs::ORDER_CANCELLED_STATUS]); return true; } }
