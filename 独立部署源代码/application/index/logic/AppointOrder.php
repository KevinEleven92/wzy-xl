<?php
 namespace app\index\logic; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\Defs; use app\index\logic\Defs as IndexDefs; use app\index\service\EventLogs as EventLogsService; use app\index\model\AppointOrder as AppointOrderModel; use EasyWeChat\Factory; use app\index\service\RequestContext; use app\index\service\OperationLogs as OperationLogsService; class AppointOrder extends Base { protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto GJ7yv; vKkra: $conditions["\117\x2e\143\x65\x6c\x6c\160\150\x6f\156\145"] = ["\154\151\x6b\x65", "\45" . $search["\x63\x65\x6c\x6c\160\x68\157\156\145"] . "\45"]; goto URLKx; gOg_u: if (!(isset($search["\x70\141\171\x5f\x73\164\141\164\x75\x73"]) && $search["\160\141\x79\x5f\x73\x74\141\164\165\163"])) { goto oTCHO; } goto N257J; Nz3s4: if (emptyInArray($search, "\143\145\154\x6c\160\150\x6f\x6e\x65")) { goto ZkP6H; } goto vKkra; n_6xM: $conditions["\117\x2e\154\x69\x6e\x6b\155\x61\156"] = ["\154\x69\153\145", "\45" . $search["\154\x69\156\153\x6d\x61\x6e"] . "\x25"]; goto Nb8Dt; pG0yJ: $conditions["\103\x2e\x6e\151\143\153\x6e\141\x6d\145"] = ["\x6c\151\x6b\145", "\x25" . $search["\x6e\x69\x63\x6b\x6e\x61\155\x65"] . "\x25"]; goto VW3Db; lZrS2: goto SdGKY; goto AoZFC; edKgM: Y_tsk: goto wfD_P; El1q8: goto HL8RY; goto d9Csr; zGmib: if (emptyInArray($search, "\x63\x75\163\164\157\155\x65\x72\x5f\x69\x64")) { goto WBOs6; } goto jYW6_; U8oav: $records = Db::table("\145\170\160\145\162\164\137\x6f\162\x64\145\x72")->alias("\117")->join("\x65\x78\x70\x65\162\164\x20\105", "\117\x2e\145\x78\x70\145\x72\x74\137\x69\x64\75\105\56\x69\x64")->join("\143\165\x73\164\x6f\155\145\x72\40\x43", "\x4f\x2e\143\x75\163\x74\157\155\145\x72\137\151\144\75\x43\56\x69\x64")->where($conditions)->page($page, $rows)->order($order)->field("\x4f\x2e\52\x2c\x20\105\x2e\162\145\x61\154\137\x6e\141\155\x65\40\x61\163\40\x65\170\x70\x65\162\x74\137\162\x65\x61\x6c\x5f\156\141\155\145\54\x20\105\x2e\x63\145\x6c\x6c\160\150\157\x6e\145\x20\x61\x73\40\145\x78\160\x65\x72\x74\x5f\x63\145\154\154\160\150\157\x6e\x65\x2c\x20\103\x2e\156\x69\x63\153\156\141\155\145\x2c\40\x63\157\156\x63\x61\164\x28\117\56\x61\160\160\x6f\151\156\164\x5f\x64\x61\x74\x65\54\x20\47\40\x27\x2c\40\x4f\56\141\x70\x70\157\x69\156\x74\137\164\151\155\x65\x2c\x20\x27\x28\x27\x2c\x20\117\56\141\160\x70\x6f\x69\x6e\x74\x5f\x64\165\162\141\x74\151\157\x6e\x2c\40\x27\51\x27\51\x20\141\163\40\141\x70\160\x6f\151\x6e\164\x5f\x64\x61\164\x65\x5f\x74\x69\x6d\145")->select(); goto TLYvP; VW3Db: pFms0: goto pJhJ9; X7Y4Y: oTCHO: goto cNtoe; N257J: $conditions["\x4f\x2e\160\141\x79\x5f\163\x74\141\164\165\x73"] = $search["\160\141\x79\x5f\163\164\141\x74\165\163"]; goto X7Y4Y; Un6x_: return ["\x74\157\164\141\x6c" => $totalCount, "\162\x6f\x77\x73" => $records]; goto ypxs2; GJ7yv: if ($sort == "\x6f\x72\144\x65\162\x5f\x74\151\155\x65") { goto sGh9C; } goto lHrad; e2hkJ: if (emptyInArray($search, "\154\x69\x6e\x6b\155\141\156")) { goto Svy0g; } goto n_6xM; wfD_P: if (emptyInArray($search, "\156\151\x63\153\x6e\x61\x6d\145")) { goto pFms0; } goto pG0yJ; cNtoe: $totalCount = Db::table("\x65\x78\160\145\162\x74\x5f\x6f\x72\x64\145\x72")->alias("\117")->join("\x65\170\160\x65\162\x74\x20\x45", "\x4f\x2e\x65\170\160\145\x72\164\137\x69\x64\x3d\105\x2e\151\144")->join("\x63\165\163\x74\157\155\145\x72\x20\x43", "\117\56\x63\x75\163\164\157\155\x65\162\x5f\x69\144\x3d\x43\x2e\151\144")->where($conditions)->count(); goto U8oav; TLYvP: foreach ($records as &$record) { goto A1sw_; A1sw_: $showTime = convertAppointTimesToShow($record["\141\x70\x70\x6f\x69\x6e\x74\x5f\164\x69\155\x65"]); goto xsKj3; xsKj3: $record["\x61\160\x70\157\151\x6e\164\137\x74\x69\x6d\x65\x5f\x66\165\154\x6c"] = $record["\141\160\x70\157\151\156\164\x5f\144\141\x74\x65"] . "\x20" . $showTime . "\50" . $record["\x61\160\x70\x6f\151\156\164\x5f\144\x75\x72\141\164\x69\x6f\x6e"] . "\345\x88\206\351\x92\237\x29"; goto qyVLA; qyVLA: YWOkY: goto S4ltL; S4ltL: } goto JPqWF; jYW6_: $conditions["\117\x2e\143\165\163\164\x6f\x6d\145\162\x5f\151\144"] = $search["\143\x75\x73\164\157\x6d\145\162\x5f\151\x64"]; goto tSNdP; vyFXs: $conditions["\117\56\163\164\141\x74\165\x73"] = $search["\x73\164\x61\164\x75\163"]; goto pS_j7; lHrad: if ($sort == "\x61\x70\160\x6f\x69\x6e\164\137\x74\x69\x6d\x65\137\x66\x75\154\154") { goto eueNy; } goto qv87I; Nb8Dt: Svy0g: goto Nz3s4; Vynun: $conditions["\105\x2e\x72\145\141\154\x5f\156\141\x6d\x65"] = ["\x6c\x69\153\145", "\x25" . $search["\162\145\x61\154\x5f\156\x61\x6d\145"] . "\45"]; goto FiUvz; cIw9X: SdGKY: goto pS9WW; ufTMf: $conditions["\117\x2e\145\170\x70\145\x72\x74\x5f\151\144"] = $search["\145\x78\160\145\162\x74\137\151\x64"]; goto xWS60; h7gKf: $order = "\117\56\x6f\x72\x64\x65\162\137\x74\x69\x6d\145\x20" . $order; goto cIw9X; d2apf: if (emptyInArray($search, "\157\162\x64\145\x72\x5f\156\x6f")) { goto Y_tsk; } goto Aruta; pS_j7: SiznI: goto gOg_u; pJhJ9: if (emptyInArray($search, "\162\145\141\x6c\137\x6e\x61\x6d\x65")) { goto F8MX_; } goto Vynun; UX3BI: if (!(isset($search["\163\164\141\x74\165\x73"]) && $search["\x73\x74\x61\x74\x75\x73"])) { goto SiznI; } goto vyFXs; URLKx: ZkP6H: goto UX3BI; pS9WW: $conditions = []; goto d2apf; Aruta: $conditions["\117\x2e\157\162\144\145\162\x5f\x6e\x6f"] = $search["\x6f\x72\144\x65\162\137\x6e\x6f"]; goto edKgM; GTZsW: $order = "\117\56\141\x70\160\x6f\151\156\x74\x5f\144\x61\164\x65\x20" . $order . "\54\40\117\56\x61\160\160\157\x69\156\164\x5f\164\x69\155\x65\x20" . $order; goto yRiaw; xWS60: SxBK5: goto zGmib; FiUvz: F8MX_: goto HF2KG; qv87I: $order = "\x4f\56\157\162\x64\145\162\x5f\164\151\x6d\x65\40\144\x65\163\143"; goto El1q8; AoZFC: sGh9C: goto h7gKf; tSNdP: WBOs6: goto e2hkJ; JPqWF: dtE1v: goto Un6x_; HF2KG: if (emptyInArray($search, "\145\x78\x70\x65\x72\164\x5f\151\144")) { goto SxBK5; } goto ufTMf; d9Csr: eueNy: goto GTZsW; yRiaw: HL8RY: goto lZrS2; ypxs2: } public function getInfos($orderNo) { goto EdTEg; athBD: $showTime = convertAppointTimesToShow($infos["\141\x70\x70\x6f\x69\x6e\x74\x5f\164\151\x6d\145"]); goto zs2RP; fYysw: JD7iy: goto athBD; zs2RP: $infos["\x61\160\x70\x6f\x69\x6e\x74\x5f\x74\x69\x6d\x65\137\x66\165\154\x6c"] = $infos["\x61\160\x70\157\x69\156\x74\137\144\x61\164\x65"] . "\x20" . $showTime . "\x28" . $infos["\141\160\x70\157\x69\x6e\x74\137\x64\x75\x72\141\x74\151\x6f\156"] . "\xe5\210\206\351\222\237\51"; goto GdkAi; MdS5s: if ($infos) { goto JD7iy; } goto fSfPK; GdkAi: return $infos; goto XN6FK; EdTEg: $infos = Db::table("\145\x78\x70\x65\162\164\x5f\x6f\162\x64\x65\162")->where("\157\x72\x64\x65\162\137\x6e\157", $orderNo)->field(true)->find(); goto MdS5s; fSfPK: return null; goto fYysw; XN6FK: } public function getOrderInfos($customerId, $orderNo) { goto KeBxc; tTCTB: return null; goto vAAEf; BogJa: $showTime = convertAppointTimesToShow($infos["\x61\x70\160\x6f\151\156\164\x5f\x74\151\x6d\x65"]); goto d10h0; bVjOi: if ($infos) { goto jzIh8; } goto tTCTB; vAAEf: jzIh8: goto BogJa; NOn5y: return $infos; goto nRIVg; KeBxc: $infos = Db::table("\x65\x78\160\145\162\x74\137\157\162\x64\x65\x72")->where(["\143\165\163\164\x6f\x6d\x65\162\x5f\151\144" => $customerId, "\157\162\144\x65\162\137\156\x6f" => $orderNo])->field(true)->find(); goto bVjOi; d10h0: $infos["\141\x70\x70\x6f\151\x6e\164\x5f\x74\151\155\145\137\146\x75\x6c\x6c"] = $infos["\x61\x70\x70\x6f\x69\x6e\164\x5f\144\141\x74\145"] . "\x20" . $showTime . "\x28" . $infos["\x61\160\x70\157\151\156\x74\x5f\144\x75\x72\141\x74\x69\x6f\156"] . "\345\210\x86\xe9\x92\237\51"; goto NOn5y; nRIVg: } public function getOrderInfosById($id) { goto GzRCs; CoWCJ: $infos["\141\x70\x70\157\x69\156\164\x5f\x74\x69\155\145\x5f\x66\165\154\x6c"] = $infos["\141\x70\160\x6f\x69\156\164\x5f\144\141\x74\x65"] . "\40" . $showTime . "\50" . $infos["\x61\x70\x70\157\x69\156\164\x5f\x64\165\x72\x61\x74\151\157\156"] . "\xe5\x88\x86\xe9\x92\x9f\x29"; goto oqOBU; oqOBU: return $infos; goto Tcsnb; GzRCs: $infos = Db::table("\x65\x78\160\x65\162\164\x5f\157\162\x64\x65\162")->where(["\x69\144" => $id])->field(true)->find(); goto UWnSA; YVScB: B51lS: goto BUbdJ; Djm68: return null; goto YVScB; BUbdJ: $showTime = convertAppointTimesToShow($infos["\x61\x70\160\157\151\156\164\x5f\164\151\x6d\x65"]); goto CoWCJ; UWnSA: if ($infos) { goto B51lS; } goto Djm68; Tcsnb: } public function refreshOrderNo($customerId, $orderNo) { goto fFujz; qrH1Q: $orderNoNew = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\x45"); goto B11kw; Q1o5M: return false; goto ZcL4h; DDIg7: if ($infos) { goto B1_tI; } goto Q1o5M; SVC62: return $orderNoNew; goto TZZcy; fFujz: $infos = Db::table("\145\170\x70\145\x72\164\x5f\x6f\162\144\145\162")->where(["\x63\x75\163\x74\x6f\x6d\145\x72\x5f\151\144" => $customerId, "\x6f\162\x64\145\x72\x5f\156\x6f" => $orderNo])->field(true)->find(); goto DDIg7; B11kw: Db::table("\x65\170\160\x65\162\x74\x5f\x6f\162\x64\145\x72")->where(["\143\165\163\x74\157\x6d\x65\162\x5f\x69\144" => $customerId, "\x6f\x72\144\x65\x72\x5f\x6e\157" => $orderNo])->setField("\x6f\162\144\145\x72\x5f\156\157", $orderNoNew); goto SVC62; ZcL4h: B1_tI: goto qrH1Q; TZZcy: } public function refreshOrderNoById($customerId, $id) { goto HtleV; GPpAs: Db::table("\x65\x78\x70\145\162\x74\137\157\x72\x64\x65\162")->where(["\x69\144" => $id])->setField("\157\x72\144\145\162\137\x6e\157", $orderNoNew); goto GT_uv; GT_uv: return $orderNoNew; goto W2U4R; bEymn: return false; goto R51AP; R51AP: y0e1X: goto zOWiW; Cmx8R: if ($infos) { goto y0e1X; } goto bEymn; zOWiW: $orderNoNew = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\105"); goto GPpAs; HtleV: $infos = Db::table("\x65\x78\160\145\162\x74\x5f\157\x72\x64\145\x72")->where(["\151\144" => $id])->field(true)->find(); goto Cmx8R; W2U4R: } public function getLinkmen($customerId) { $records = Db::table("\145\170\x70\x65\162\x74\x5f\x6f\x72\144\x65\162")->distinct(true)->where(["\143\x75\163\164\x6f\155\x65\x72\137\151\x64" => $customerId])->field("\154\151\x6e\153\x6d\x61\156\54\x20\143\145\154\x6c\x70\x68\x6f\x6e\x65")->order("\157\x72\x64\145\162\137\x74\151\155\145\x20\x64\145\x73\x63")->select(); return $records; } public function finish($orderNo) { goto SFPBo; u4rCU: return true; goto AtW9p; LB2Q0: F8aMn: goto ooK3A; MA1t6: if (!empty($id)) { goto F8aMn; } goto GTJ9V; SFPBo: Db::table("\145\170\x70\x65\162\164\137\x6f\162\144\145\x72")->where("\x6f\x72\x64\x65\x72\137\156\157", $orderNo)->update(["\146\x69\156\151\x73\150\x5f\164\x69\155\x65" => Db::raw("\x6e\x6f\167\x28\51"), "\x73\x74\x61\164\x75\x73" => IndexDefs::ORDER_FINISH_STATUS]); goto iyPrI; ooK3A: OperationLogsService::I()->orderLog("\xe9\xa2\x84\347\xba\246\xe8\256\xa2\xe5\x8d\225\xe5\xae\214\346\210\220", "\xe8\xae\xa2\345\x8d\x95\xe5\x8f\xb7\72\40" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto u4rCU; iyPrI: $id = Db::table("\145\x78\x70\145\162\164\x5f\x6f\x72\144\145\x72")->where("\157\162\144\145\x72\x5f\x6e\x6f", $orderNo)->value("\x69\144"); goto MA1t6; GTJ9V: $id = 0; goto LB2Q0; AtW9p: } public function cancel($orderNo) { goto Y7gm2; C2tEW: return true; goto Akg_C; bGtNo: $id = 0; goto hlfDY; lpceY: $id = Db::table("\x65\170\x70\145\162\x74\x5f\x6f\x72\144\145\162")->where("\x6f\162\144\x65\162\137\x6e\157", $orderNo)->value("\x69\x64"); goto l1xYx; X_7Xw: OperationLogsService::I()->orderLog("\351\242\x84\347\272\246\xe8\256\xa2\345\x8d\225\xe5\217\226\346\266\210", "\xe8\xae\242\xe5\x8d\x95\xe5\x8f\267\x3a\40" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto C2tEW; hlfDY: u_vhH: goto X_7Xw; Y7gm2: Db::table("\145\170\x70\x65\162\x74\x5f\x6f\x72\x64\x65\x72")->where("\157\162\144\145\162\x5f\x6e\157", $orderNo)->update(["\163\x74\x61\x74\x75\163" => IndexDefs::ORDER_CANCELLED_STATUS]); goto lpceY; l1xYx: if (!empty($id)) { goto u_vhH; } goto bGtNo; Akg_C: } public function refund($orderNo) { goto XeYo5; nyGXR: if (!empty($id)) { goto XtbVY; } goto qXD7H; HimRX: exception("\351\200\x80\346\254\xbe\345\xa4\261\350\xb4\245\x3a\x20" . var_export($result, true)); goto ef27a; eL0Iy: if (!empty($result)) { goto cUUpU; } goto Il3V4; QptLc: $result = $app->refund->byOutTradeNumber($orderNo, $refundOrderNo, $orderAmount * 100, $orderAmount * 100); goto eL0Iy; vD9wB: wxPaySetting(); goto mjGqb; bE7RW: $id = $order["\151\x64"]; goto nyGXR; x3dlH: Db::table("\x65\170\160\x65\x72\164\137\157\162\144\145\162")->where("\157\x72\x64\145\162\x5f\x6e\157", $orderNo)->update(["\x72\145\x66\x75\x6e\x64\x5f\157\162\x64\x65\x72\x5f\156\157" => $refundOrderNo, "\x72\x65\x66\165\156\144\x5f\x61\x6d\x6f\165\x6e\x74" => $orderAmount, "\162\x65\x66\165\x6e\x64\137\x74\151\x6d\145" => date("\x59\x2d\155\55\144\40\x48\x3a\x69\72\163"), "\x70\141\171\137\x73\164\x61\164\x75\163" => Defs::PAY_REFUND]); goto bE7RW; XeYo5: exception("\345\x8a\x9f\350\x83\xbd\347\xa6\201\xe7\224\250"); goto LYW2U; kA2la: return true; goto xr0jQ; wJqLF: Log::notice("\xe9\242\x84\xe7\272\246\351\x80\200\xe6\xac\xbe\346\x88\220\xe5\212\x9f\x3a\x20" . var_export($result, true)); goto x3dlH; ef27a: cUUpU: goto wJqLF; w4yzz: $refundOrderNo = generateSequenceNo($order["\x63\165\163\x74\157\155\x65\x72\137\151\144"], Defs::APPOINT_ORDER_REFUND_NO_SEQ_NUM_KEY, "\105\122"); goto QptLc; mjGqb: $app = Factory::payment(config("\x77\170\x2e\x70\x61\171\x6d\145\x6e\x74")); goto w4yzz; EFAyp: $orderAmount = $order["\157\162\144\145\x72\x5f\x61\x6d\157\x75\156\164"]; goto vD9wB; vuQFG: if (!empty($order)) { goto WN5HB; } goto sZnsE; qXD7H: $id = 0; goto Cxz1c; Cxz1c: XtbVY: goto Wft4c; LYW2U: $order = Db::table("\x65\170\160\x65\162\x74\137\157\x72\x64\x65\x72")->where("\x6f\x72\144\x65\x72\x5f\x6e\x6f", $orderNo)->field(true)->find(); goto vuQFG; QlGFs: WN5HB: goto EFAyp; sZnsE: exception("\xe6\227\xa0\xe6\xb3\x95\346\211\276\xe5\x88\xb0\xe8\xaf\xa5\xe8\256\xa2\xe5\215\225"); goto QlGFs; Il3V4: logEvent("\345\222\xa8\xe8\257\xa2\351\242\x84\347\xba\xa6\350\xae\xa2\345\215\225{$orderNo}\351\200\x80\346\254\276\xe5\244\261\350\xb4\245", EventLogsService::eSeverityWarning); goto HimRX; Wft4c: OperationLogsService::I()->orderLog("\351\xa2\x84\xe7\272\xa6\350\xae\242\345\215\x95\351\200\200\xe6\254\276", "\xe8\xae\242\xe5\215\x95\345\x8f\267\x3a\40" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto kA2la; xr0jQ: } public function changeTime($orderNo, $appointDate, $appointTime) { goto lvwR5; yqhxG: $id = 0; goto XxHN0; aYSKA: OperationLogsService::I()->orderLog("\351\242\x84\xe7\xba\246\xe8\xae\xa2\xe5\x8d\x95\346\233\264\xe6\x94\xb9\346\227\xb6\xe9\227\264", "\xe8\256\xa2\xe5\215\225\xe5\217\xb7\x3a\x20{$orderNo}\x20\346\x9b\264\346\x96\260\345\x90\216\x20{$appointDate}\40{$appointTime}", OperationLogsService::OPT_UPDATE_TYPE, $id); goto lWlSl; lWlSl: return true; goto ub0Bp; k7quR: if (!empty($id)) { goto LXi_t; } goto yqhxG; XxHN0: LXi_t: goto aYSKA; qaotK: $id = Db::table("\145\170\x70\x65\x72\x74\137\157\x72\144\x65\162")->where("\157\x72\x64\x65\162\137\x6e\157", $orderNo)->value("\151\x64"); goto k7quR; lvwR5: Db::table("\x65\170\160\145\162\164\137\x6f\x72\x64\145\162")->where("\157\162\x64\145\162\137\x6e\x6f", $orderNo)->update(["\141\160\160\157\151\156\x74\x5f\144\x61\x74\145" => $appointDate, "\x61\x70\x70\x6f\151\156\x74\137\164\151\x6d\x65" => $appointTime]); goto qaotK; ub0Bp: } public function generateOrder($customerId, $expertId, $orderAmount, $appointDate, $appointTime, $appointDuration, $appointMode, $payStatus) { goto XnV_2; JGlg5: if ($existOrder) { goto sdBl5; } goto r7Rhk; Kjn_B: Db::table("\x65\x78\x70\x65\162\164\x5f\x6f\x72\144\x65\162")->insert(["\x6f\162\144\145\162\x5f\156\x6f" => $orderNo, "\143\165\x73\x74\157\155\x65\162\137\151\144" => $customerId, "\145\x78\x70\145\162\164\x5f\151\x64" => $expertId, "\157\x72\144\145\x72\137\141\x6d\x6f\165\x6e\x74" => $orderAmount, "\157\162\144\x65\x72\137\x74\151\x6d\145" => date("\x59\x2d\x6d\x2d\144\40\110\72\151\72\163"), "\x61\x70\x70\157\x69\156\x74\137\144\x61\164\145" => $appointDate, "\141\160\x70\157\x69\x6e\x74\x5f\164\151\155\145" => $appointTime, "\x61\160\x70\x6f\151\x6e\164\x5f\x64\x75\162\141\164\x69\x6f\156" => $appointDuration, "\x61\x70\x70\x6f\151\x6e\x74\137\155\x6f\x64\145" => $appointMode, "\163\164\x61\x74\x75\163" => IndexDefs::ORDER_PENDING_STATUS, "\x70\x61\x79\137\163\x74\141\x74\x75\163" => $payStatus]); goto P8cSc; bcpC2: sdBl5: goto tHpJP; r7Rhk: $orderNo = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\x45"); goto Kjn_B; VnQ5U: return $orderNo; goto gjktQ; fAtdH: Db::table("\x65\170\160\x65\x72\164\x5f\157\x72\144\145\162")->where(["\157\x72\144\145\x72\137\x6e\157" => $orderNo])->update(["\157\x72\x64\145\162\137\x61\x6d\157\165\156\x74" => $orderAmount, "\157\x72\x64\x65\x72\137\x74\x69\155\145" => date("\131\55\155\55\144\40\110\72\151\x3a\163"), "\x61\x70\160\157\x69\156\x74\x5f\144\165\162\141\164\151\157\x6e" => $appointDuration, "\141\x70\160\157\151\156\164\137\155\157\x64\145" => $appointMode]); goto H2_WC; P8cSc: goto RCPcx; goto bcpC2; tHpJP: $orderNo = $existOrder["\157\162\x64\x65\x72\137\156\157"]; goto fAtdH; XnV_2: $existOrder = Db::table("\x65\x78\x70\145\162\x74\137\157\162\x64\x65\162")->where(["\143\165\163\x74\x6f\155\145\162\137\151\144" => $customerId, "\145\170\x70\x65\162\164\x5f\151\144" => $expertId, "\141\160\x70\x6f\x69\156\164\x5f\144\x61\x74\x65" => $appointDate, "\x61\160\x70\157\x69\x6e\164\x5f\x74\x69\x6d\145" => $appointTime])->find(); goto JGlg5; H2_WC: RCPcx: goto VnQ5U; gjktQ: } public function getOrders($customerId, $status = 0) { goto Qj07x; Zdja6: return $records; goto hFyoG; AOYrl: foreach ($records as &$record) { $record["\x73\164\141\x74\x75\x73\x5f\x74\x65\x78\x74"] = IndexDefs::$orderStatusDefs[$record["\x73\164\141\164\x75\x73"]]; NjDrF: } goto InZ3h; T3Z4A: $conditions["\x45\117\56\x73\x74\141\x74\x75\163"] = $status; goto oiqL8; Qj07x: $conditions = ["\x45\x4f\56\x63\165\163\164\x6f\155\x65\x72\137\151\144" => $customerId]; goto XRakL; InZ3h: QMZwz: goto Zdja6; eUTp7: $records = Db::table("\x65\x78\160\145\x72\x74\137\x6f\x72\144\x65\x72")->alias("\x45\117")->join("\145\x78\x70\145\x72\164\40\x45", "\105\x4f\56\x65\170\x70\x65\x72\x74\x5f\x69\x64\75\105\x2e\x69\144")->where($conditions)->field("\x45\x4f\x2e\x2a\x2c\40\x45\x2e\x72\145\141\x6c\137\156\x61\x6d\145\40\x61\163\40\x65\x78\160\145\x72\164\137\156\141\155\145\x2c\40\x45\56\167\157\162\153\151\x6d\147\x5f\x75\x72\x6c\54\40\x45\56\x63\145\154\x6c\160\x68\x6f\x6e\145\40\x61\x73\x20\145\170\x70\145\162\164\137\143\145\154\154\x70\150\x6f\156\x65\x2c\x20\x63\157\x6e\x63\141\x74\50\x45\x4f\x2e\141\x70\x70\157\151\156\x74\137\x64\141\x74\x65\54\40\47\40\47\54\x20\x45\117\x2e\x61\160\x70\157\151\156\164\137\164\151\x6d\145\54\40\x27\50\x27\54\x20\105\x4f\56\141\x70\x70\x6f\151\x6e\x74\x5f\x64\x75\162\141\x74\151\x6f\156\x2c\40\47\51\x27\51\x20\141\163\40\141\x70\160\x6f\151\156\164\x5f\x64\141\x74\145\137\x74\151\155\x65")->order("\105\117\x2e\x6f\x72\x64\145\x72\x5f\164\151\x6d\145\40\x64\145\x73\x63")->select(); goto AOYrl; XRakL: if (!$status) { goto kLdjm; } goto T3Z4A; oiqL8: kLdjm: goto eUTp7; hFyoG: } public function cancelOrder($id) { Db::table("\x65\x78\160\x65\x72\x74\137\x6f\162\x64\145\162")->where("\x69\144", $id)->update(["\163\164\x61\x74\165\x73" => IndexDefs::ORDER_CANCELLED_STATUS]); return true; } }
