<?php
 namespace app\index\logic; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\Defs; use app\index\logic\Defs as IndexDefs; use app\index\service\EventLogs as EventLogsService; use app\index\model\AppointOrder as AppointOrderModel; use EasyWeChat\Factory; use app\index\service\RequestContext; use app\index\service\OperationLogs as OperationLogsService; class AppointOrder extends Base { protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto oy544; zksf5: foreach ($records as &$record) { goto fe1Dd; UG2Mm: $record["\x61\160\160\x6f\x69\156\164\x5f\164\x69\x6d\145\137\x66\165\x6c\154"] = $record["\x61\160\160\x6f\151\x6e\x74\x5f\144\x61\164\145"] . "\x20" . $showTime . "\50" . $record["\x61\x70\160\x6f\x69\x6e\164\x5f\144\165\x72\141\x74\x69\157\156"] . "\345\210\206\xe9\x92\237\x29"; goto jA_Wp; jA_Wp: xBz20: goto OAAEa; fe1Dd: $showTime = convertAppointTimesToShow($record["\141\160\160\x6f\x69\156\x74\x5f\164\x69\155\145"]); goto UG2Mm; OAAEa: } goto O5SoX; HUgnk: $conditions["\117\x2e\x73\x74\x61\164\165\163"] = $search["\x73\x74\141\x74\x75\x73"]; goto JU6hM; JU6hM: ed6ix: goto aXXFP; sJ1y7: if (!(isset($search["\x73\x74\x61\x74\165\x73"]) && $search["\163\x74\141\164\165\x73"])) { goto ed6ix; } goto HUgnk; V3w2U: ujCmZ: goto mtVz2; vrnO2: UGlIR: goto pe29B; p7qCZ: $conditions["\x43\56\x6e\151\x63\153\x6e\141\155\145"] = ["\x6c\x69\153\x65", "\x25" . $search["\x6e\151\x63\x6b\x6e\x61\155\145"] . "\x25"]; goto l3Nir; TOZLq: goto UGlIR; goto WwRNA; F6Qd1: if (emptyInArray($search, "\145\x78\160\x65\162\164\137\151\x64")) { goto rCG6D; } goto UlZIH; UlZIH: $conditions["\117\x2e\145\170\x70\x65\162\164\137\151\x64"] = $search["\145\170\160\x65\x72\x74\x5f\x69\x64"]; goto l6aRT; O5SoX: gZ4RG: goto NiamB; D08H9: $conditions["\117\x2e\157\x72\x64\145\x72\137\x6e\157"] = $search["\157\x72\x64\x65\x72\x5f\156\x6f"]; goto qzn9g; rllur: $conditions["\x4f\x2e\154\151\156\153\155\141\156"] = ["\154\151\153\145", "\45" . $search["\154\151\156\x6b\155\141\x6e"] . "\45"]; goto Mweb7; aXXFP: if (!(isset($search["\160\141\171\x5f\163\164\x61\x74\x75\163"]) && $search["\x70\141\x79\x5f\x73\x74\141\x74\x75\x73"])) { goto tiV_e; } goto BY5wQ; kqCPi: tiV_e: goto KqBLu; l3Nir: wQXVS: goto ya0Ta; WwRNA: cjM9A: goto Orihx; jwUg0: $order = "\117\56\x6f\162\x64\145\x72\137\164\x69\x6d\x65\x20" . $order; goto Hy4W1; a3UoQ: $conditions = []; goto rU2oZ; oU7WG: $records = Db::table("\x65\170\160\x65\162\x74\137\157\162\x64\x65\162")->alias("\x4f")->join("\145\170\x70\x65\162\x74\x20\105", "\x4f\56\x65\170\160\145\162\x74\137\x69\x64\x3d\105\x2e\x69\144")->join("\x63\165\x73\x74\157\x6d\145\162\40\103", "\117\56\143\165\163\164\x6f\155\x65\x72\137\x69\144\x3d\103\56\x69\x64")->where($conditions)->page($page, $rows)->order($order)->field("\117\x2e\52\54\40\105\x2e\x72\x65\x61\x6c\x5f\156\x61\155\x65\x20\x61\163\x20\145\170\160\145\162\x74\x5f\162\x65\141\x6c\137\156\x61\x6d\145\x2c\x20\x45\x2e\x63\145\x6c\154\160\150\157\156\145\x20\x61\163\40\145\x78\x70\x65\162\x74\x5f\x63\145\154\x6c\160\150\x6f\x6e\145\54\40\x43\56\x6e\x69\143\153\x6e\x61\155\x65\54\40\x63\157\x6e\143\141\164\x28\x4f\56\x61\x70\x70\157\151\156\x74\137\x64\141\164\x65\54\x20\47\40\x27\x2c\x20\117\x2e\x61\x70\160\157\151\156\x74\x5f\164\x69\x6d\145\x2c\x20\x27\50\47\x2c\40\x4f\56\141\160\160\157\x69\156\x74\137\x64\x75\x72\141\x74\x69\x6f\156\54\40\x27\x29\47\x29\40\141\x73\x20\141\160\160\x6f\151\x6e\164\x5f\x64\141\x74\x65\x5f\164\x69\x6d\145")->select(); goto zksf5; qjLhl: $order = "\117\x2e\157\x72\x64\x65\x72\137\164\x69\x6d\x65\40\144\x65\x73\x63"; goto TOZLq; Mweb7: I4Ica: goto NIpb4; OqBpK: if (emptyInArray($search, "\x63\x75\163\164\x6f\x6d\145\x72\x5f\x69\144")) { goto ujCmZ; } goto Xt6fq; rU2oZ: if (emptyInArray($search, "\157\162\144\x65\162\137\156\x6f")) { goto koaHh; } goto D08H9; NIpb4: if (emptyInArray($search, "\x63\x65\x6c\x6c\x70\150\157\x6e\145")) { goto OgHmt; } goto r4QOs; Xt6fq: $conditions["\x4f\56\x63\x75\163\x74\157\x6d\x65\162\x5f\x69\144"] = $search["\x63\165\x73\164\157\x6d\145\x72\x5f\x69\x64"]; goto V3w2U; KDfao: if (emptyInArray($search, "\x6e\x69\x63\x6b\156\141\155\145")) { goto wQXVS; } goto p7qCZ; kjZhG: $conditions["\105\x2e\162\145\141\x6c\137\x6e\x61\155\x65"] = ["\x6c\151\x6b\145", "\x25" . $search["\x72\x65\141\154\137\x6e\x61\x6d\145"] . "\45"]; goto q_tHR; NiamB: return ["\164\157\x74\141\154" => $totalCount, "\x72\x6f\x77\163" => $records]; goto mUA_Y; Hy4W1: GL1k_: goto a3UoQ; l6aRT: rCG6D: goto OqBpK; Orihx: $order = "\117\56\141\x70\x70\x6f\151\x6e\x74\x5f\144\141\164\145\x20" . $order . "\x2c\40\117\x2e\141\x70\160\x6f\x69\156\x74\x5f\164\x69\155\x65\x20" . $order; goto vrnO2; r4QOs: $conditions["\117\56\x63\145\x6c\154\160\x68\157\156\x65"] = ["\154\151\153\145", "\45" . $search["\143\145\154\x6c\x70\x68\x6f\156\x65"] . "\x25"]; goto aKF8N; aKF8N: OgHmt: goto sJ1y7; BY5wQ: $conditions["\117\56\160\141\171\137\x73\x74\x61\164\165\163"] = $search["\160\141\171\x5f\163\164\x61\x74\165\163"]; goto kqCPi; q_tHR: M0ozM: goto F6Qd1; KqBLu: $totalCount = Db::table("\145\170\160\x65\x72\x74\137\x6f\162\144\145\x72")->alias("\x4f")->join("\145\170\160\x65\x72\x74\x20\x45", "\x4f\56\x65\170\160\x65\162\164\x5f\151\144\x3d\x45\x2e\x69\144")->join("\x63\x75\163\x74\x6f\155\x65\162\x20\103", "\117\56\x63\x75\x73\164\157\x6d\145\x72\137\151\x64\x3d\x43\56\151\x64")->where($conditions)->count(); goto oU7WG; mtVz2: if (emptyInArray($search, "\x6c\x69\x6e\153\x6d\x61\156")) { goto I4Ica; } goto rllur; ya0Ta: if (emptyInArray($search, "\x72\145\x61\x6c\137\x6e\141\x6d\145")) { goto M0ozM; } goto kjZhG; DaB_H: if ($sort == "\141\160\x70\x6f\x69\x6e\x74\x5f\x74\151\155\x65\137\146\x75\x6c\x6c") { goto cjM9A; } goto qjLhl; qzn9g: koaHh: goto KDfao; Gs5Tn: JU9dx: goto jwUg0; pe29B: goto GL1k_; goto Gs5Tn; oy544: if ($sort == "\x6f\162\144\145\162\137\x74\151\155\145") { goto JU9dx; } goto DaB_H; mUA_Y: } public function getInfos($orderNo) { goto OFOdV; m5ZkU: $showTime = convertAppointTimesToShow($infos["\141\x70\160\157\x69\156\164\137\164\x69\x6d\x65"]); goto j2JvS; vd0cc: if ($infos) { goto DVzvx; } goto cMAKW; UACVE: DVzvx: goto m5ZkU; j2JvS: $infos["\141\x70\160\157\x69\156\164\137\x74\x69\155\x65\x5f\x66\165\154\154"] = $infos["\141\x70\x70\157\x69\156\164\137\x64\x61\x74\x65"] . "\40" . $showTime . "\50" . $infos["\141\x70\160\157\x69\156\x74\137\x64\165\162\x61\x74\151\157\x6e"] . "\345\x88\206\xe9\x92\237\x29"; goto HhK0d; OFOdV: $infos = Db::table("\x65\x78\x70\x65\162\x74\137\157\x72\144\x65\x72")->where("\x6f\162\144\x65\162\x5f\156\157", $orderNo)->field(true)->find(); goto vd0cc; cMAKW: return null; goto UACVE; HhK0d: return $infos; goto AwLo6; AwLo6: } public function getOrderInfos($customerId, $orderNo) { goto sprYx; k6Ipg: cuyMn: goto No5Fg; GvS3z: if ($infos) { goto cuyMn; } goto XCP4T; sprYx: $infos = Db::table("\145\170\160\145\162\164\x5f\157\162\x64\145\x72")->where(["\x63\x75\163\x74\157\x6d\145\162\x5f\x69\144" => $customerId, "\157\x72\x64\x65\162\x5f\156\x6f" => $orderNo])->field(true)->find(); goto GvS3z; No5Fg: $showTime = convertAppointTimesToShow($infos["\x61\160\160\x6f\x69\156\x74\x5f\x74\x69\155\x65"]); goto jJODg; XCP4T: return null; goto k6Ipg; jJODg: $infos["\x61\160\x70\x6f\151\156\164\x5f\164\151\155\145\x5f\146\165\154\154"] = $infos["\x61\160\160\157\151\156\164\x5f\144\141\164\145"] . "\40" . $showTime . "\50" . $infos["\x61\x70\160\157\151\x6e\x74\137\x64\165\x72\141\x74\151\x6f\x6e"] . "\345\x88\x86\xe9\222\237\51"; goto Zt8U1; Zt8U1: return $infos; goto oCVM5; oCVM5: } public function getOrderInfosById($id) { goto wXcTN; etobs: if ($infos) { goto Cw2V4; } goto wugou; AX87v: return $infos; goto M50Nc; l748J: Cw2V4: goto qViLj; wXcTN: $infos = Db::table("\145\x78\160\145\162\164\x5f\157\162\144\x65\162")->where(["\151\x64" => $id])->field(true)->find(); goto etobs; wugou: return null; goto l748J; VKdI8: $infos["\141\160\160\x6f\x69\x6e\x74\137\164\151\x6d\145\x5f\146\x75\x6c\x6c"] = $infos["\141\160\160\157\151\x6e\x74\x5f\144\x61\x74\145"] . "\x20" . $showTime . "\x28" . $infos["\x61\160\160\x6f\151\x6e\x74\137\144\165\162\x61\x74\x69\x6f\156"] . "\345\210\206\351\x92\237\51"; goto AX87v; qViLj: $showTime = convertAppointTimesToShow($infos["\x61\160\x70\x6f\151\x6e\164\137\x74\151\155\145"]); goto VKdI8; M50Nc: } public function refreshOrderNo($customerId, $orderNo) { goto p3Upu; p3Upu: $infos = Db::table("\145\170\160\x65\162\164\x5f\157\x72\x64\x65\x72")->where(["\143\165\x73\x74\157\x6d\x65\162\x5f\151\144" => $customerId, "\x6f\x72\144\145\162\x5f\x6e\x6f" => $orderNo])->field(true)->find(); goto yg0pN; UwHL3: Db::table("\x65\170\160\145\x72\164\x5f\x6f\x72\144\x65\x72")->where(["\x63\165\163\x74\157\155\145\x72\137\151\x64" => $customerId, "\157\162\144\x65\162\137\x6e\157" => $orderNo])->setField("\x6f\x72\x64\x65\162\x5f\x6e\x6f", $orderNoNew); goto ImWJn; sqQXG: dLxjf: goto xtazD; ImWJn: return $orderNoNew; goto lyait; yg0pN: if ($infos) { goto dLxjf; } goto qWJ3N; qWJ3N: return false; goto sqQXG; xtazD: $orderNoNew = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\x45"); goto UwHL3; lyait: } public function refreshOrderNoById($customerId, $id) { goto IpND3; vsUVf: LKrZx: goto TYyFa; Nh1FJ: Db::table("\145\170\x70\145\162\164\x5f\157\162\144\145\x72")->where(["\x69\x64" => $id])->setField("\x6f\162\144\145\162\x5f\x6e\x6f", $orderNoNew); goto lAtlH; XZ531: if ($infos) { goto LKrZx; } goto WGvAj; IpND3: $infos = Db::table("\145\x78\160\x65\162\164\137\157\x72\144\x65\162")->where(["\x69\144" => $id])->field(true)->find(); goto XZ531; lAtlH: return $orderNoNew; goto YV7Ep; TYyFa: $orderNoNew = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\105"); goto Nh1FJ; WGvAj: return false; goto vsUVf; YV7Ep: } public function getLinkmen($customerId) { $records = Db::table("\145\170\x70\x65\162\164\137\x6f\162\x64\145\162")->distinct(true)->where(["\143\x75\163\164\x6f\x6d\x65\162\x5f\x69\x64" => $customerId])->field("\x6c\151\156\x6b\155\x61\156\x2c\40\143\x65\154\154\160\x68\x6f\x6e\x65")->order("\157\162\x64\x65\x72\x5f\x74\151\155\145\x20\144\x65\163\x63")->select(); return $records; } public function finish($orderNo) { goto NvONt; qnIDP: $id = Db::table("\x65\x78\160\x65\x72\164\137\x6f\162\x64\x65\x72")->where("\x6f\x72\144\145\162\137\x6e\x6f", $orderNo)->value("\x69\144"); goto ndMnE; ndMnE: if (!empty($id)) { goto Z2Ak2; } goto gBlS4; wTmVx: return true; goto BvAze; NvONt: Db::table("\145\x78\x70\x65\x72\x74\x5f\x6f\x72\x64\145\x72")->where("\157\162\144\x65\x72\x5f\x6e\157", $orderNo)->update(["\x66\x69\x6e\151\163\150\137\x74\151\155\145" => Db::raw("\x6e\157\167\50\x29"), "\x73\x74\141\164\x75\x73" => IndexDefs::ORDER_FINISH_STATUS]); goto qnIDP; Af6Sj: Z2Ak2: goto amx5F; gBlS4: $id = 0; goto Af6Sj; amx5F: OperationLogsService::I()->orderLog("\xe9\xa2\x84\347\272\xa6\350\256\242\345\215\225\345\256\214\xe6\x88\x90", "\xe8\xae\242\345\x8d\225\345\217\xb7\72\x20" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto wTmVx; BvAze: } public function cancel($orderNo) { goto MUE10; je_en: return true; goto u8p8v; spt4H: if (!empty($id)) { goto f_L47; } goto YOhki; bFIuQ: $id = Db::table("\145\170\160\145\x72\x74\x5f\157\x72\144\x65\x72")->where("\x6f\x72\144\x65\162\x5f\x6e\x6f", $orderNo)->value("\151\x64"); goto spt4H; YOhki: $id = 0; goto EMZqO; Ecq5V: OperationLogsService::I()->orderLog("\351\242\x84\347\xba\xa6\350\256\xa2\345\x8d\x95\345\217\226\346\xb6\210", "\350\256\242\345\215\x95\345\217\xb7\x3a\40" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto je_en; MUE10: Db::table("\x65\x78\160\145\x72\164\x5f\157\162\144\x65\162")->where("\x6f\162\144\145\162\137\156\157", $orderNo)->update(["\163\164\x61\x74\165\163" => IndexDefs::ORDER_CANCELLED_STATUS]); goto bFIuQ; EMZqO: f_L47: goto Ecq5V; u8p8v: } public function refund($orderNo) { goto BCn7R; QW43r: $orderAmount = $order["\x6f\162\144\x65\162\137\x61\x6d\157\165\x6e\164"]; goto GEoeF; ZNBv_: d19MF: goto bMeru; jEFy4: exception("\xe6\227\xa0\xe6\xb3\225\346\x89\276\345\x88\260\xe8\xaf\xa5\350\xae\242\345\x8d\225"); goto ArH1M; w1H4f: $id = $order["\x69\x64"]; goto I8KRg; BCn7R: exception("\xe5\x8a\237\350\203\275\xe7\246\x81\347\x94\250"); goto oUWqP; QjLwO: W1abn: goto TKel7; lU_Qn: $id = 0; goto QjLwO; I8KRg: if (!empty($id)) { goto W1abn; } goto lU_Qn; gGrq6: if (!empty($order)) { goto h6QU3; } goto jEFy4; GEoeF: wxPaySetting(); goto H1PfH; Ke0NP: exception("\351\200\x80\xe6\254\xbe\345\244\261\350\xb4\xa5\x3a\x20" . var_export($result, true)); goto ZNBv_; ArH1M: h6QU3: goto QW43r; bMeru: Log::notice("\xe9\242\x84\xe7\272\xa6\xe9\200\200\346\xac\xbe\346\210\220\xe5\x8a\237\x3a\x20" . var_export($result, true)); goto VTUAZ; NCl0O: logEvent("\345\x92\250\xe8\257\xa2\xe9\xa2\x84\xe7\xba\xa6\xe8\256\xa2\345\215\225{$orderNo}\xe9\200\x80\xe6\xac\xbe\345\244\xb1\xe8\xb4\245", EventLogsService::eSeverityWarning); goto Ke0NP; it8aM: $result = $app->refund->byOutTradeNumber($orderNo, $refundOrderNo, $orderAmount * 100, $orderAmount * 100); goto i0d4Z; H1PfH: $app = Factory::payment(config("\167\x78\x2e\160\141\x79\155\x65\x6e\x74")); goto PK4ZO; PK4ZO: $refundOrderNo = generateSequenceNo($order["\x63\x75\163\164\x6f\155\145\x72\x5f\151\x64"], Defs::APPOINT_ORDER_REFUND_NO_SEQ_NUM_KEY, "\105\x52"); goto it8aM; TKel7: OperationLogsService::I()->orderLog("\xe9\242\x84\347\xba\xa6\xe8\256\xa2\345\x8d\225\xe9\x80\x80\xe6\xac\276", "\xe8\256\242\xe5\x8d\x95\345\x8f\xb7\x3a\40" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto xYGlo; xYGlo: return true; goto Z0cn0; VTUAZ: Db::table("\145\170\160\x65\x72\x74\x5f\157\x72\144\x65\162")->where("\x6f\162\144\145\x72\x5f\156\157", $orderNo)->update(["\x72\145\146\x75\156\144\137\x6f\x72\144\x65\x72\137\156\x6f" => $refundOrderNo, "\x72\145\x66\165\156\x64\137\141\x6d\157\x75\x6e\x74" => $orderAmount, "\162\x65\146\x75\x6e\144\137\164\x69\155\145" => date("\x59\x2d\155\x2d\144\x20\x48\x3a\151\x3a\x73"), "\160\141\x79\x5f\163\164\141\x74\x75\x73" => Defs::PAY_REFUND]); goto w1H4f; oUWqP: $order = Db::table("\x65\170\160\145\162\164\137\157\162\144\x65\x72")->where("\157\x72\x64\145\x72\x5f\156\x6f", $orderNo)->field(true)->find(); goto gGrq6; i0d4Z: if (!empty($result)) { goto d19MF; } goto NCl0O; Z0cn0: } public function changeTime($orderNo, $appointDate, $appointTime) { goto z2JT0; tX70I: h1WIi: goto cnSzx; x2rKz: $id = Db::table("\145\170\160\x65\162\164\137\x6f\162\144\x65\x72")->where("\x6f\x72\x64\x65\162\137\x6e\x6f", $orderNo)->value("\x69\x64"); goto Y9t4k; Z8H4A: return true; goto YsUgm; lxrHg: $id = 0; goto tX70I; z2JT0: Db::table("\x65\170\x70\x65\162\164\x5f\157\x72\144\145\162")->where("\x6f\x72\x64\x65\x72\137\x6e\x6f", $orderNo)->update(["\141\x70\x70\x6f\151\x6e\164\137\x64\141\164\145" => $appointDate, "\x61\160\160\x6f\x69\x6e\164\137\164\151\x6d\145" => $appointTime]); goto x2rKz; cnSzx: OperationLogsService::I()->orderLog("\xe9\242\204\347\xba\xa6\350\256\xa2\xe5\215\x95\xe6\x9b\264\346\x94\xb9\xe6\227\266\xe9\227\xb4", "\350\256\xa2\345\x8d\225\345\x8f\267\x3a\40{$orderNo}\40\346\x9b\264\346\x96\260\345\x90\216\40{$appointDate}\x20{$appointTime}", OperationLogsService::OPT_UPDATE_TYPE, $id); goto Z8H4A; Y9t4k: if (!empty($id)) { goto h1WIi; } goto lxrHg; YsUgm: } public function generateOrder($customerId, $expertId, $orderAmount, $appointDate, $appointTime, $appointDuration, $appointMode, $payStatus) { goto guoB3; SWZzx: DZLSc: goto mxb60; R5uoP: Db::table("\x65\x78\x70\x65\x72\164\x5f\x6f\x72\144\x65\x72")->insert(["\157\162\144\145\x72\x5f\156\x6f" => $orderNo, "\143\x75\163\164\x6f\x6d\145\162\137\151\x64" => $customerId, "\x65\170\x70\145\162\164\x5f\151\x64" => $expertId, "\x6f\x72\x64\x65\162\137\141\155\x6f\165\x6e\x74" => $orderAmount, "\x6f\162\144\145\162\x5f\x74\x69\x6d\145" => date("\x59\x2d\x6d\55\x64\40\110\x3a\x69\x3a\163"), "\x61\160\160\157\151\156\x74\x5f\x64\141\164\145" => $appointDate, "\x61\x70\160\x6f\151\156\x74\137\x74\x69\155\x65" => $appointTime, "\141\x70\160\x6f\151\156\164\137\144\x75\162\141\164\x69\x6f\x6e" => $appointDuration, "\141\x70\160\x6f\151\156\x74\137\155\x6f\144\145" => $appointMode, "\163\x74\x61\164\x75\163" => IndexDefs::ORDER_PENDING_STATUS, "\x70\x61\x79\x5f\163\x74\x61\x74\165\163" => $payStatus]); goto mRhQk; guoB3: $existOrder = Db::table("\145\170\160\x65\162\x74\x5f\x6f\x72\144\x65\x72")->where(["\143\x75\163\164\x6f\155\x65\x72\137\151\144" => $customerId, "\x65\x78\x70\145\x72\164\137\151\x64" => $expertId, "\x61\160\160\157\x69\x6e\164\137\x64\x61\164\x65" => $appointDate, "\x61\x70\160\x6f\x69\156\x74\x5f\164\151\x6d\x65" => $appointTime])->find(); goto JBMf2; xnR4Y: $orderNo = $existOrder["\157\x72\x64\145\162\137\156\157"]; goto HAbJX; mxb60: return $orderNo; goto F31XJ; Pegt1: $orderNo = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\x45"); goto R5uoP; JBMf2: if ($existOrder) { goto SxkOk; } goto Pegt1; HAbJX: Db::table("\145\x78\x70\x65\x72\x74\x5f\x6f\x72\144\145\162")->where(["\x6f\162\x64\145\x72\137\156\x6f" => $orderNo])->update(["\x6f\x72\144\145\162\137\141\x6d\x6f\165\x6e\164" => $orderAmount, "\157\162\144\145\x72\137\x74\151\x6d\145" => date("\131\x2d\x6d\55\144\x20\110\72\151\x3a\x73"), "\x61\x70\x70\x6f\151\156\164\137\x64\165\162\x61\x74\151\x6f\156" => $appointDuration, "\x61\160\160\x6f\x69\x6e\x74\x5f\x6d\x6f\x64\145" => $appointMode]); goto SWZzx; mRhQk: goto DZLSc; goto dNdFI; dNdFI: SxkOk: goto xnR4Y; F31XJ: } public function getOrders($customerId, $status = 0) { goto DRn3K; c2dYw: $conditions["\105\x4f\56\163\164\141\x74\x75\x73"] = $status; goto T8PBD; DRn3K: $conditions = ["\x45\x4f\56\x63\165\x73\x74\x6f\155\x65\x72\137\151\x64" => $customerId]; goto PcII8; PcII8: if (!$status) { goto jV5O2; } goto c2dYw; kE1Mt: return $records; goto FYoQy; FDNhS: foreach ($records as &$record) { $record["\163\164\x61\164\x75\x73\x5f\x74\x65\170\164"] = IndexDefs::$orderStatusDefs[$record["\163\x74\141\x74\x75\x73"]]; DOq5n: } goto enrnX; enrnX: C02VS: goto kE1Mt; T8PBD: jV5O2: goto iF7cV; iF7cV: $records = Db::table("\x65\x78\160\x65\x72\164\x5f\157\x72\x64\145\162")->alias("\105\117")->join("\145\x78\160\145\x72\164\40\x45", "\105\117\x2e\x65\x78\x70\x65\x72\164\137\x69\x64\x3d\105\x2e\151\x64")->where($conditions)->field("\105\x4f\x2e\52\x2c\x20\105\56\162\x65\x61\154\137\x6e\141\x6d\145\x20\x61\163\x20\145\170\160\x65\162\164\x5f\156\x61\155\145\x2c\x20\105\56\167\157\x72\x6b\x69\x6d\147\137\165\162\154\54\x20\x45\x2e\143\145\154\154\x70\150\x6f\x6e\145\40\x61\x73\40\145\170\160\x65\162\164\x5f\143\145\154\154\x70\x68\157\156\145\x2c\40\143\x6f\156\143\x61\164\x28\105\x4f\x2e\141\x70\x70\x6f\151\x6e\164\137\144\141\164\145\x2c\40\x27\40\x27\54\40\105\x4f\x2e\141\x70\160\x6f\151\x6e\x74\x5f\x74\x69\155\145\x2c\40\47\50\47\x2c\40\105\x4f\x2e\141\x70\x70\x6f\x69\x6e\164\137\x64\165\x72\141\164\x69\157\156\x2c\40\47\51\47\x29\x20\x61\x73\40\x61\160\x70\157\x69\156\164\x5f\x64\x61\x74\x65\137\x74\151\155\x65")->order("\x45\x4f\x2e\157\162\x64\x65\x72\137\x74\x69\x6d\x65\40\144\x65\x73\143")->select(); goto FDNhS; FYoQy: } public function cancelOrder($id) { Db::table("\x65\x78\160\145\x72\164\137\157\x72\144\x65\162")->where("\151\144", $id)->update(["\163\164\141\164\165\x73" => IndexDefs::ORDER_CANCELLED_STATUS]); return true; } }
