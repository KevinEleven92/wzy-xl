<?php
 namespace app\index\logic; use app\index\logic\Defs as IndexDefs; use app\index\model\Setting; use think\Cache; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs; use app\index\service\EventLogs; use app\index\model\Expert as ExpertModel; use app\index\service\RequestContext; use app\index\service\OperationLogs; class Expert extends Base { const AVATAR_DEFAULT_IMAGE = "\x2f\163\164\141\x74\x69\143\57\151\x6d\x67\57\x69\155\141\147\145\x5f\x75\160\x6c\x6f\x61\144\x2e\160\156\147"; protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto GWiqT; VTQ7W: foreach ($records as &$record) { goto Agkbb; LnCi2: figHS: goto usNd4; Agkbb: $record["\x77\x6f\162\153\151\x6d\147\x5f\x75\162\154"] = generateThumbnailUrl($record["\x77\157\162\x6b\x69\155\147\x5f\165\162\x6c"], 100); goto UG2aU; UG2aU: $record["\146\x69\x65\x6c\144\137\x69\x74\x65\155\163"] = implode("\54", Db::table("\x65\170\160\x65\x72\x74\x5f\x66\151\145\154\x64\x5f\162\x65\154\x61\164\x65")->alias("\x45\x46\122")->join("\145\170\x70\x65\x72\x74\137\146\x69\145\x6c\144\x5f\x69\164\x65\155\x20\x45\x46\111", "\105\x46\122\x2e\x66\151\145\154\x64\x5f\x69\x74\145\155\137\151\144\75\x45\x46\x49\56\x69\x64")->where("\105\x46\x52\56\x65\170\x70\145\162\164\x5f\x69\144", $record["\151\144"])->column("\105\x46\111\56\x66\x69\x65\x6c\144\137\x69\164\145\155")); goto LnCi2; usNd4: } goto ZIhgZ; rMxFO: $conditions["\163\164\141\x74\165\163"] = $search["\x73\x74\x61\x74\165\x73"]; goto vnAS5; rk0nw: if (emptyInArray($search, "\x64\x65\x6c\x65\164\x65\x5f\146\154\141\147")) { goto rgr6u; } goto biGRZ; CTDwr: rAtJX: goto hLQQU; ZoqGw: IDmEO: goto FN6cA; FTwfQ: naGkE: goto Y9h5Z; TN04y: if (emptyInArray($search, "\145\170\160\x65\x72\164\x5f\151\x64")) { goto apdmz; } goto wiSj0; jhmnr: if (emptyInArray($search, "\162\145\141\154\137\156\141\155\145")) { goto IDmEO; } goto tPqhu; XgMmM: $order = "\163\164\x61\x74\165\x73\40" . $order; goto ctqeI; l7bC6: if ($sort == "\x73\164\141\x74\165\x73") { goto jaxVQ; } goto dU10N; ctqeI: MtR8Q: goto HmRq_; xtRRh: jaxVQ: goto XgMmM; GqJyQ: rgr6u: goto Lmfmi; PAJIq: return ["\x74\x6f\x74\141\x6c" => $totalCount, "\x72\157\x77\163" => $records]; goto s8nv9; Y9h5Z: if (emptyInArray($search, "\x73\x74\141\164\x75\x73")) { goto lEyt6; } goto rMxFO; zwLsU: piOGk: goto KcCW9; Lmfmi: $totalCount = Db::table("\x65\170\160\x65\162\164")->where($conditions)->count(); goto TNjL2; pLRlM: apdmz: goto rk0nw; vnAS5: lEyt6: goto TN04y; TNjL2: $records = Db::table("\145\x78\160\x65\162\164")->where($conditions)->page($page, $rows)->order($order)->field(true)->select(); goto VTQ7W; GWiqT: if ($sort == "\164\x6f\x74\x61\154\x5f\x61\x70\160\157\x69\x6e\x74\137\x71\x75\x61\156\164\151\x74\171") { goto piOGk; } goto l7bC6; tPqhu: $conditions["\x72\x65\141\x6c\x5f\156\141\x6d\x65"] = ["\154\x69\153\145", "\x25" . $search["\x72\x65\x61\154\137\156\141\x6d\145"] . "\x25"]; goto ZoqGw; dU10N: $order = "\151\x64\40\x61\x73\143"; goto EW53p; biGRZ: $conditions["\144\145\x6c\x65\x74\x65\137\146\154\x61\147"] = $search["\x64\x65\154\145\164\x65\x5f\146\154\141\x67"]; goto GqJyQ; FN6cA: if (emptyInArray($search, "\143\145\x6c\154\160\x68\x6f\156\x65")) { goto naGkE; } goto hbsZ7; EW53p: goto MtR8Q; goto xtRRh; KcCW9: $order = "\x74\157\x74\x61\x6c\x5f\x61\x70\x70\157\x69\156\x74\137\x71\165\141\x6e\x74\151\164\x79\40" . $order; goto CTDwr; wiSj0: $conditions["\151\144"] = $search["\x65\170\x70\145\x72\164\137\x69\144"]; goto pLRlM; ZIhgZ: XMNeg: goto PAJIq; hLQQU: $conditions = ["\x64\145\x6c\x65\x74\x65\x5f\x66\154\x61\147" => 0]; goto jhmnr; HmRq_: goto rAtJX; goto zwLsU; hbsZ7: $conditions["\143\145\x6c\x6c\160\x68\157\156\x65"] = ["\x6c\x69\153\x65", "\x25" . $search["\143\145\154\x6c\x70\150\157\x6e\x65"] . "\x25"]; goto FTwfQ; s8nv9: } public function add($infos) { goto M058p; gtwpE: $model->allowField(true)->save(); goto khHWq; BgnqD: if (!(isset($infos["\164\x61\162\147\x65\164"]) && $infos["\164\141\162\147\x65\x74"])) { goto gW2sr; } goto JShoL; b4ozf: kikgg: goto RY4tW; u_wwY: foreach ($targetIds as $targetId) { Db::table("\x65\170\160\145\162\x74\x5f\164\x61\x72\x67\145\164\x5f\x72\145\x6c\141\164\145")->insert(["\x65\x78\160\145\x72\x74\137\x69\x64" => $expertId, "\164\x61\x72\x67\x65\164\x5f\151\144" => $targetId]); YRj1k: } goto MmLfq; M058p: $model = model("\x45\x78\x70\x65\162\164"); goto FZ0u5; A5j8P: $fields = []; goto APEab; khHWq: $expertId = $model->id; goto qCBBi; JShoL: $targetIds = $infos["\x74\x61\162\147\145\164"]; goto iX24g; FZ0u5: $infos["\146\151\162\163\x74\137\x6a\x6f\142\137\164\x69\x6d\x65"] = !emptyInArray($infos, "\x66\151\162\x73\x74\137\152\157\x62\x5f\164\x69\x6d\145") ? $infos["\x66\151\x72\163\164\x5f\152\157\142\137\164\151\155\x65"] : null; goto N28Pb; N28Pb: $model->data($infos); goto gtwpE; Y1Rte: return true; goto JXv1G; FQqO1: foreach ($categoryIds as $categoryId) { Db::table("\x65\x78\160\145\x72\164\137\143\x61\164\145\147\x6f\x72\x79\137\x72\145\154\x61\164\x65")->insert(["\x65\x78\x70\145\162\164\137\x69\x64" => $expertId, "\x63\141\164\x65\x67\x6f\162\x79\137\x69\144" => $categoryId]); eGYJs: } goto T1dvm; zv5K8: GAI_h: goto zZAvM; eWHi_: $categoryIds = $infos["\143\141\164\x65\x67\157\x72\x79"]; goto aiAVm; aiAVm: FlCGo: goto FQqO1; APEab: if (!(isset($infos["\146\151\145\154\x64"]) && $infos["\146\x69\x65\x6c\x64"])) { goto kikgg; } goto g1qhg; MmLfq: lE9DE: goto A5j8P; RY4tW: foreach ($fields as $fieldId => $fieldItems) { goto WyIeX; TH8Wy: YR28S: goto eHDUL; WyIeX: foreach ($fieldItems as $fieldItemId) { Db::table("\145\170\x70\x65\162\164\137\x66\x69\x65\x6c\144\x5f\x72\145\154\141\x74\145")->insert(["\x65\170\160\x65\162\x74\137\151\144" => $expertId, "\x66\x69\145\x6c\x64\137\x69\x64" => $fieldId, "\146\151\x65\154\x64\137\151\164\x65\x6d\137\x69\x64" => $fieldItemId]); kdrPZ: } goto GgzY8; GgzY8: gq8Ve: goto TH8Wy; eHDUL: } goto zv5K8; iX24g: gW2sr: goto u_wwY; rvnAg: if (!(isset($infos["\143\x61\164\x65\147\x6f\162\171"]) && $infos["\143\x61\164\145\x67\x6f\x72\x79"])) { goto FlCGo; } goto eWHi_; T1dvm: h2U3P: goto kbWTO; g1qhg: $fields = $infos["\x66\x69\145\x6c\x64"]; goto b4ozf; zZAvM: OperationLogs::I()->expertLog("\xe6\226\260\xe5\242\x9e\344\xb8\223\xe5\256\266\40\55\x20{$model->real_name}", beautifyLogArray($infos, [], "\145\x78\160\145\162\x74"), OperationLogs::OPT_ADD_TYPE, $expertId); goto Y1Rte; qCBBi: $categoryIds = []; goto rvnAg; kbWTO: $targetIds = []; goto BgnqD; JXv1G: } public function edit($expertId, $infos) { goto Dcz_J; pzFes: VWRy0: goto fsuEm; PPqx6: $originals = Db::table("\x65\x78\160\145\162\x74")->where(["\151\144" => $expertId])->field(true)->find(); goto SeEqy; nu3PK: wNbAa: goto nfzFf; a5S_A: $categoryIds = $infos["\x63\141\x74\x65\x67\157\x72\x79"]; goto nu3PK; emAnJ: return; goto MihcH; pLhbP: Db::table("\145\x78\160\x65\x72\164\x5f\146\x69\145\x6c\144\x5f\x72\x65\x6c\x61\x74\145")->where(["\145\x78\x70\x65\162\x74\137\x69\x64" => $expertId])->delete(); goto XqGiF; J4Bq6: CYfgn: goto vht0v; wDLwR: $model->allowField(true)->save(); goto zZ8_8; IMSry: $targetIds = $infos["\164\141\x72\147\x65\x74"]; goto pzFes; C1AjJ: $targetIds = []; goto Q2DzK; tGWvZ: $fields = $infos["\146\x69\145\154\x64"]; goto ECzId; SeEqy: $infos["\x66\151\162\163\164\137\x6a\x6f\x62\x5f\x74\151\x6d\x65"] = !emptyInArray($infos, "\146\151\x72\x73\x74\x5f\152\x6f\142\137\164\x69\155\145") ? $infos["\x66\151\x72\163\164\x5f\x6a\157\x62\137\x74\151\x6d\x65"] : null; goto qQ3Pg; qQ3Pg: $infos["\155\x6f\x64\151\146\171\137\164\x69\x6d\x65"] = date("\x59\x2d\x6d\x2d\x64\40\110\72\x69\x3a\163"); goto PHkcO; Tfson: OperationLogs::I()->expertLog("\344\277\xae\346\224\271\344\xb8\x93\xe5\256\266\40\55\40{$model->real_name}", beautifyLogArray($infos, $originals, "\145\170\x70\145\x72\164"), OperationLogs::OPT_UPDATE_TYPE, $expertId); goto s2AXT; Dcz_J: $model = ExpertModel::get($expertId); goto akLSI; MihcH: kz_Ta: goto PPqx6; akLSI: if ($model) { goto kz_Ta; } goto GAWSl; SFMG5: foreach ($targetIds as $targetId) { Db::table("\x65\170\160\145\x72\164\x5f\x74\x61\x72\x67\x65\x74\137\162\x65\154\141\164\x65")->insert(["\145\x78\x70\x65\x72\164\x5f\151\x64" => $expertId, "\164\141\x72\147\145\164\137\x69\144" => $targetId]); ShRzm: } goto J4Bq6; Q2DzK: if (!(isset($infos["\x74\x61\162\147\x65\x74"]) && $infos["\x74\x61\x72\147\x65\x74"])) { goto VWRy0; } goto IMSry; nfzFf: Db::table("\145\170\x70\145\162\164\x5f\x63\x61\164\x65\x67\x6f\162\x79\137\x72\145\154\141\x74\x65")->where(["\145\x78\x70\x65\162\164\137\151\x64" => $expertId])->delete(); goto JfhTt; jz1TA: Mvrsv: goto Tfson; zZ8_8: $categoryIds = []; goto h1nQ3; OwOhl: y3QDN: goto C1AjJ; tv7Mh: if (!(isset($infos["\x66\151\145\x6c\x64"]) && $infos["\146\x69\x65\x6c\144"])) { goto j1bYB; } goto tGWvZ; ECzId: j1bYB: goto pLhbP; JfhTt: foreach ($categoryIds as $categoryId) { Db::table("\145\170\160\145\x72\x74\x5f\143\141\x74\145\x67\157\162\x79\x5f\x72\x65\154\141\164\x65")->insert(["\x65\x78\160\145\162\164\x5f\151\144" => $expertId, "\143\x61\164\145\147\157\x72\x79\137\x69\x64" => $categoryId]); yj_w8: } goto OwOhl; GAWSl: exception("\346\x97\240\xe6\xb3\x95\xe6\x89\276\xe5\210\260\xe8\xaf\245\xe4\xb8\x93\345\xae\266"); goto emAnJ; vht0v: $fields = []; goto tv7Mh; h1nQ3: if (!(isset($infos["\x63\141\x74\145\x67\x6f\162\x79"]) && $infos["\143\x61\164\x65\x67\x6f\x72\x79"])) { goto wNbAa; } goto a5S_A; XqGiF: foreach ($fields as $fieldId => $fieldItems) { goto LzAHG; IBeb0: UlOOt: goto AzKS5; lXvrT: c6Qv3: goto IBeb0; LzAHG: foreach ($fieldItems as $fieldItemId) { Db::table("\145\x78\160\145\x72\x74\137\x66\151\145\154\144\137\x72\x65\154\x61\x74\x65")->insert(["\145\x78\x70\x65\162\x74\137\151\144" => $expertId, "\x66\151\145\x6c\x64\137\x69\x64" => $fieldId, "\x66\151\145\x6c\x64\x5f\x69\164\145\155\x5f\151\144" => $fieldItemId]); tlkah: } goto lXvrT; AzKS5: } goto jz1TA; fsuEm: Db::table("\145\170\x70\x65\162\164\x5f\x74\x61\162\147\145\164\137\x72\x65\154\x61\x74\x65")->where(["\145\170\x70\145\162\x74\137\x69\144" => $expertId])->delete(); goto SFMG5; PHkcO: $model->data($infos); goto wDLwR; s2AXT: } public function delete($expertId) { goto J6scx; Vr7Rh: goto hpxt4; goto yvh_2; EmgtP: hpxt4: goto vJm3E; J6scx: $model = ExpertModel::get($expertId); goto wO_Ub; O1Ze8: $model->save(["\144\145\x6c\x65\x74\145\x5f\146\154\x61\147" => 1]); goto LEH5k; LEH5k: OperationLogs::I()->expertLog("\xe5\x88\240\xe9\x99\xa4\xe4\xb8\223\xe5\256\266", $model->real_name, OperationLogs::OPT_DELETE_TYPE, $expertId); goto EmgtP; AT2k0: exception("\346\x97\xa0\xe6\263\225\xe6\x89\xbe\345\210\260\350\257\xa5\xe4\270\x93\345\xae\xb6"); goto Vr7Rh; wO_Ub: if ($model) { goto U43on; } goto AT2k0; yvh_2: U43on: goto O1Ze8; vJm3E: } public function restore($expertId) { goto W0Mot; W8UZq: goto Ttg2h; goto UefY0; qshv6: if ($model) { goto t5lB1; } goto jczzG; P5NhB: Ttg2h: goto aIAly; pZqUB: OperationLogs::I()->expertLog("\xe6\x81\242\xe5\244\215\xe4\xb8\223\xe5\256\xb6", $model->real_name, OperationLogs::OPT_RESTORE_TYPE, $expertId); goto P5NhB; jczzG: exception("\346\x97\xa0\xe6\xb3\x95\xe6\x89\xbe\xe5\x88\260\xe8\257\xa5\xe4\270\223\xe5\256\xb6"); goto W8UZq; UefY0: t5lB1: goto tLoeH; tLoeH: $model->save(["\x64\145\154\145\164\x65\x5f\146\x6c\x61\147" => 0]); goto pZqUB; W0Mot: $model = ExpertModel::get($expertId); goto qshv6; aIAly: } public function deleteForce($expertId) { goto Aj2_1; OD2OC: Db::table("\x65\170\x70\145\x72\164")->where("\151\x64", $expertId)->delete(); goto VdazW; VTDHt: Db::table("\x65\x78\x70\145\x72\164\x5f\x61\x70\160\x6f\x69\156\x74\137\164\x69\x6d\x65")->where(["\145\x78\x70\145\162\164\137\x69\144" => $expertId])->delete(); goto t4gDn; pfODl: Db::table("\145\x78\160\x65\x72\164\137\164\141\x72\147\x65\164\137\162\x65\154\x61\164\x65")->where(["\145\x78\x70\x65\162\x74\137\151\x64" => $expertId])->delete(); goto GyjNU; GyjNU: Db::table("\x65\x78\160\x65\x72\164\137\x66\151\145\154\144\137\x72\145\154\x61\164\x65")->where(["\x65\x78\x70\145\x72\164\137\x69\x64" => $expertId])->delete(); goto VTDHt; t4gDn: Db::table("\145\170\160\x65\162\164\x5f\x6f\x72\x64\x65\162")->where(["\x65\170\x70\x65\162\x74\x5f\151\x64" => $expertId])->delete(); goto OD2OC; Aj2_1: Db::table("\145\170\x70\145\162\164\x5f\143\x61\164\145\x67\157\162\x79\x5f\162\145\154\141\164\145")->where(["\x65\170\160\x65\162\x74\x5f\151\144" => $expertId])->delete(); goto pfODl; VdazW: } public function getInfos($expertId) { goto IjlJa; uJJLB: PL1iD: goto zB54d; PIOmw: return $infos; goto wJew9; zNs1T: $infos["\x66\151\x65\x6c\x64\x49\x74\145\155\111\x64\x73"] = Db::table("\145\170\x70\145\x72\164\x5f\x66\x69\x65\x6c\144\x5f\162\145\154\x61\x74\145")->where(["\145\x78\x70\x65\x72\164\137\x69\144" => $expertId])->column("\x66\x69\145\x6c\x64\137\x69\164\145\x6d\x5f\x69\x64"); goto xoviN; FSy36: if ($infos) { goto PL1iD; } goto A_oZD; gyMPz: $infos["\164\x61\162\x67\145\164\x49\144\163"] = Db::table("\145\x78\x70\145\x72\164\137\164\x61\162\x67\x65\x74\137\162\x65\x6c\141\164\x65")->where(["\145\x78\x70\145\x72\164\x5f\151\x64" => $expertId])->column("\164\141\x72\147\145\x74\137\151\x64"); goto zNs1T; IjlJa: $infos = Db::table("\145\170\x70\145\x72\x74")->where("\151\144", $expertId)->field(true)->find(); goto FSy36; A_oZD: return false; goto uJJLB; xoviN: $infos["\x61\x70\x70\x6f\151\156\164\x5f\144\141\171\x5f\164\x69\155\x65\x73"] = Db::table("\145\x78\x70\x65\162\x74\x5f\x61\x70\x70\x6f\x69\156\x74\137\x74\151\x6d\145")->where(["\x65\x78\x70\145\162\x74\137\x69\144" => $expertId])->field("\167\145\145\153\137\144\x61\171\54\x20\141\x70\x70\x6f\151\156\164\137\x74\151\x6d\x65")->select(); goto PIOmw; zB54d: $infos["\143\x61\x74\x65\147\157\x72\x79\x49\x64\x73"] = Db::table("\145\x78\x70\145\x72\x74\137\143\x61\164\145\147\x6f\162\x79\137\x72\x65\154\141\x74\145")->where(["\145\170\160\x65\x72\x74\137\151\144" => $expertId])->column("\143\x61\x74\x65\147\157\x72\x79\x5f\151\144"); goto gyMPz; wJew9: } public function getDefaultInfos() { return ["\x72\145\141\x6c\x5f\156\141\x6d\x65" => '', "\167\157\x72\153\x69\x6d\x67\137\165\x72\154" => '', "\143\x61\x74\x65\x67\157\x72\x79\x49\144\163" => [], "\143\145\154\x6c\x70\150\x6f\x6e\145" => null, "\x66\x69\162\x73\x74\x5f\x6a\157\x62\x5f\164\151\155\x65" => null, "\167\x6f\x72\x6b\160\x6c\141\143\145" => null, "\x65\170\160\x65\x72\x74\x5f\160\x72\157\x66\151\x6c\145" => '', "\145\x78\x70\x65\x72\164\x5f\x71\x75\141\x6c\x69\164\x79" => null, "\x63\157\x6e\x73\165\x6c\x74\x5f\x71\165\141\156\164\151\164\x79" => 500, "\x66\151\x65\154\144\x49\x74\x65\155\111\144\x73" => [], "\x74\x61\x72\x67\x65\164\111\144\163" => [], "\141\160\160\x6f\151\156\x74\137\146\145\145" => 0.0, "\x61\160\160\157\x69\x6e\164\x5f\x72\145\166\151\145\167\x5f\x66\x65\145" => 0.0, "\162\x65\155\141\162\x6b" => null, "\141\160\x70\157\151\x6e\x74\x5f\144\x61\171\137\164\x69\x6d\145\x73" => [], "\163\x74\141\x74\165\x73" => IndexDefs::ENTITY_DRAFT_STATUS]; } public function qrcode($id) { goto NMXX2; J0MLL: wexception("\xe6\x97\xa0\346\263\x95\xe6\211\xbe\345\210\260\xe8\xaf\245\xe4\xb8\223\345\xae\xb6"); goto mZ3Vz; h4FC4: if ($result) { goto J2i1Y; } goto vMCZ9; nrpVb: if ($expert) { goto k7Wp1; } goto J0MLL; LfOD2: $result = file_put_contents(SITE_DIR . $path, file_get_contents($url)); goto h4FC4; Lii6Q: Db::table("\x65\170\160\x65\162\x74")->where(["\x69\x64" => $id])->setField("\161\x72\x63\157\144\145", $path); goto THCQO; pDuxM: $app = \EasyWeChat\Factory::officialAccount(config("\167\170\56\x6f\x66\x66\151\143\151\141\154\137\x61\143\143\157\x75\156\164")); goto qwYex; qwYex: $scene_id = "\x65\170\x70\x65\x72\164\x5f\151\x64\x5f" . $id; goto Nfdkl; THCQO: return $path; goto HXGub; Yg4_x: if (systemSetting("\127\130\137\x4f\x46\106\111\x43\x45\x5f\101\x43\x43\x4f\125\116\124\137\101\x50\x50\x5f\x49\104")) { goto rA9L6; } goto dLil1; vMCZ9: wexception("\345\206\x99\xe5\x85\245\345\x9b\xbe\345\203\x8f\346\x96\x87\xe4\273\266\xe5\xa4\261\350\xb4\xa5"); goto mfN7U; pJm5t: rA9L6: goto wdhT3; dLil1: wexception("\347\x94\x9f\346\x88\x90\xe5\xa4\xb1\xe8\xb4\245\357\274\232\xe6\234\xaa\xe9\x85\x8d\347\275\256\345\x85\254\xe4\274\x97\xe5\217\267\345\217\202\346\x95\xb0"); goto pJm5t; wdhT3: wxPaySetting(); goto pDuxM; mfN7U: J2i1Y: goto Lii6Q; NMXX2: $expert = $this->getInfos($id); goto nrpVb; mZ3Vz: k7Wp1: goto Yg4_x; Nfdkl: try { goto PWHfa; f3Sik: exception("\xe6\x8e\xa5\345\217\243\xe8\277\x94\xe5\x9b\x9e\345\244\261\350\264\xa5\x2c\40" . var_export($res, true)); goto cXPb6; a7QlN: Log::notice("\x65\x78\160\x65\162\x74\x20\161\x72\143\x6f\144\x65\x20\162\145\164\x75\x72\x6e\x20" . var_export($res, true)); goto jW545; cAgj_: if (!$res) { goto MnUPB; } goto a7QlN; jW545: MnUPB: goto at6HI; cXPb6: OPo9O: goto EPISK; EPISK: $url = $app->qrcode->url($res["\164\151\143\x6b\145\164"]); goto uKZiB; at6HI: if (!(!$res || !isset($res["\x74\151\x63\153\145\x74"]))) { goto OPo9O; } goto f3Sik; PWHfa: $res = $app->qrcode->forever($scene_id); goto cAgj_; uKZiB: } catch (\Exception $e) { wexception("\xe7\224\x9f\xe6\x88\220\345\244\xb1\xe8\264\245\xef\274\232" . $e->getMessage()); } goto shdXa; shdXa: $path = "\x2f\161\162\x63\x6f\x64\x65\57" . $scene_id . "\x2e\152\x70\x67"; goto LfOD2; HXGub: } public function set45AppointTime($expertId, $weekDay, $intervals) { goto VHcJk; f1CSC: $sections0 = explode("\x2d", $intervals[0]); goto mVDE5; Pl7WC: $sections2 = explode("\55", $intervals[2]); goto fndQo; zj1Z3: foreach ($intervals as $interval) { goto lPzEx; I0ggv: Rbr2p: goto wyfqk; VYMkY: $bConflict = true; goto RmFSS; RmFSS: goto yh7Ew; goto I0ggv; wyfqk: tMSG9: goto j13q3; lPzEx: if (!in_array($interval, $existAppointTimes)) { goto Rbr2p; } goto VYMkY; j13q3: } goto TjYCP; cbYJI: zGgW9: goto lrjAV; H7Isz: $existAppointTimes = []; goto D_dqh; VHcJk: sort($intervals, SORT_STRING); goto U7Hcm; A0a1l: NLZ45: goto cbYJI; pn34E: if ($infos) { goto uJczB; } goto mTK4q; D_dqh: $appointTimes = Db::table("\x65\170\x70\145\x72\164\137\141\x70\160\x6f\151\x6e\164\x5f\164\151\x6d\x65")->where(["\145\x78\160\x65\x72\164\137\x69\144" => $expertId, "\167\x65\145\x6b\x5f\x64\x61\x79" => $weekDay])->column("\x61\x70\160\157\x69\x6e\164\137\164\x69\155\x65"); goto fbo2g; ePcqI: uJczB: goto H7Isz; S10ff: Cvtae: goto UmOIR; lrjAV: $infos = $this->getInfos($expertId); goto pn34E; miIBZ: wexception("\350\xaf\xb7\xe9\200\x89\346\x8b\251\63\xe4\xb8\xaa\350\xbf\236\347\xbb\xad\xe6\227\266\351\x97\264\345\x9d\227"); goto lsENr; CErUp: OTnTz: goto TFm_D; fbo2g: foreach ($appointTimes as $appointTime) { $existAppointTimes = array_merge($existAppointTimes, explode("\x2c", $appointTime)); CJs3w: } goto CErUp; U7Hcm: if (!(count($intervals) != 3)) { goto GetA8; } goto wxI4z; lsENr: goto zGgW9; goto A0a1l; wxI4z: wexception("\xe8\xaf\xb7\351\x80\211\xe6\213\251\x33\xe4\270\252\350\277\236\xe7\xbb\xad\346\227\266\xe9\x97\264\xe5\235\x97"); goto DYc0n; DYc0n: GetA8: goto f1CSC; mTK4q: wexception("\346\x97\240\xe6\263\x95\346\211\276\345\x88\xb0\xe8\xaf\245\344\xb8\x93\xe5\xae\266"); goto ePcqI; UmOIR: Db::table("\x65\170\x70\145\x72\x74\x5f\141\x70\x70\157\151\156\x74\x5f\164\151\x6d\x65")->insert(["\x65\x78\160\x65\x72\x74\x5f\x69\144" => $expertId, "\x77\145\145\153\x5f\144\141\x79" => $weekDay, "\141\160\x70\x6f\151\156\x74\x5f\x74\151\x6d\x65" => implode("\54", $intervals)]); goto w1F2h; q3q0_: if (!$bConflict) { goto Cvtae; } goto z5HKg; z5HKg: wexception("\346\x89\200\xe9\200\x89\347\x9a\204\xe6\x97\xb6\xe9\227\264\345\235\227\xe8\xa2\xab\345\215\xa0\347\224\250"); goto S10ff; TjYCP: yh7Ew: goto q3q0_; TFm_D: $bConflict = false; goto zj1Z3; fndQo: if ($sections0[1] == $sections1[0] && $sections1[1] == $sections2[0]) { goto NLZ45; } goto miIBZ; mVDE5: $sections1 = explode("\55", $intervals[1]); goto Pl7WC; w1F2h: } public function set15AppointTime($expertId, $weekDay, $intervals) { goto bzhxl; bzhxl: if (!(count($intervals) != 1)) { goto g1y6D; } goto JDXLY; inkyy: if (!$bConflict) { goto DKCnR; } goto Yp6M_; vBzM6: Db::table("\145\170\x70\145\162\164\137\x61\160\x70\157\151\156\x74\x5f\x74\151\x6d\145")->insert(["\145\x78\x70\x65\162\164\x5f\151\x64" => $expertId, "\167\145\x65\153\137\144\x61\171" => $weekDay, "\141\x70\160\x6f\151\x6e\x74\x5f\x74\x69\x6d\145" => implode("\54", $intervals)]); goto j_ZBC; JDXLY: wexception("\350\xaf\xb7\xe9\200\x89\xe6\213\xa9\x31\xe4\270\xaa\xe6\227\266\xe9\227\264\xe5\235\x97"); goto IF9NO; Diysw: DKCnR: goto vBzM6; QWKZQ: foreach ($appointTimes as $appointTime) { $existAppointTimes = array_merge($existAppointTimes, explode("\x2c", $appointTime)); siSJM: } goto yZCnW; Yp6M_: wexception("\346\211\x80\351\200\x89\xe7\x9a\204\346\x97\266\351\227\264\xe5\x9d\227\350\xa2\253\345\215\240\xe7\224\xa8"); goto Diysw; GSqxG: $appointTimes = Db::table("\x65\170\160\x65\x72\x74\x5f\141\160\x70\157\151\x6e\164\x5f\164\x69\x6d\x65")->where(["\x65\x78\x70\145\x72\x74\x5f\x69\x64" => $expertId, "\x77\145\145\x6b\x5f\144\141\x79" => $weekDay])->column("\141\160\160\x6f\151\x6e\x74\x5f\164\x69\155\x65"); goto QWKZQ; EW3ji: $bConflict = false; goto CUZO6; Yk0_F: wexception("\xe6\227\xa0\xe6\xb3\225\xe6\211\xbe\xe5\210\260\350\257\245\344\xb8\x93\xe5\xae\xb6"); goto qWrfr; CUZO6: foreach ($intervals as $interval) { goto XJCJq; oEJBb: eugSE: goto Vk26g; Jhrs0: goto MfDNZ; goto dqunH; XJCJq: if (!in_array($interval, $existAppointTimes)) { goto YJabs; } goto lja7l; dqunH: YJabs: goto oEJBb; lja7l: $bConflict = true; goto Jhrs0; Vk26g: } goto ud1df; aGdfQ: $existAppointTimes = []; goto GSqxG; qWrfr: NYKys: goto aGdfQ; yZCnW: NzJif: goto EW3ji; ud1df: MfDNZ: goto inkyy; PQpiq: $infos = $this->getInfos($expertId); goto OhUks; IF9NO: g1y6D: goto PQpiq; OhUks: if ($infos) { goto NYKys; } goto Yk0_F; j_ZBC: } public function cancelAppointTime($expertId, $weekDay, $intervals) { goto njbYU; njbYU: sort($intervals, SORT_STRING); goto EGYY8; mN9HP: Db::table("\145\170\x70\x65\162\164\x5f\x61\160\160\x6f\151\x6e\164\x5f\x74\x69\x6d\145")->where(["\x65\x78\160\145\162\164\137\x69\144" => $expertId, "\x77\145\x65\153\137\144\x61\x79" => $weekDay, "\141\x70\160\x6f\151\156\x74\137\x74\151\155\x65" => implode("\x2c", $intervals)])->delete(); goto Ty0CF; xKgEl: $existAppointTime = Db::table("\145\x78\160\145\x72\164\137\141\x70\160\x6f\x69\x6e\x74\x5f\x74\x69\155\145")->where(["\145\170\x70\x65\162\164\137\x69\144" => $expertId, "\x77\145\145\153\137\144\141\x79" => $weekDay, "\x61\x70\160\157\151\x6e\164\x5f\x74\151\155\145" => implode("\54", $intervals)])->find(); goto EorCx; EGYY8: if (!(count($intervals) != 1 && count($intervals) != 3)) { goto RYA4l; } goto VNvMS; Ge0bK: wexception("\xe6\211\200\xe9\x80\211\346\x8b\251\xe5\217\x96\xe6\266\x88\xe7\x9a\204\346\x97\266\351\x97\264\xe6\256\265\344\xb8\215\345\xad\x98\345\234\xa8"); goto StmPp; VNvMS: wexception("\xe8\257\xb7\345\256\x8c\346\x95\264\351\x80\x89\346\213\xa9\x34\x35\xe5\x88\206\351\222\x9f\63\344\270\252\xe8\277\x9e\xe7\273\255\346\x97\266\xe9\227\xb4\xe5\235\227\x2f\x31\65\xe5\210\206\351\x92\237\61\xe4\270\252\xe6\x97\266\xe9\x97\264\345\235\x97"); goto yNPkZ; StmPp: lKbJy: goto mN9HP; yNPkZ: RYA4l: goto xKgEl; EorCx: if ($existAppointTime) { goto lKbJy; } goto Ge0bK; Ty0CF: } public function defaultSchedule($expertId, $weekDay) { goto XUzio; jSH2z: Db::table("\145\x78\x70\x65\162\x74\137\141\160\x70\157\151\x6e\x74\x5f\x74\151\x6d\145")->insert(["\x65\170\x70\145\x72\164\x5f\x69\144" => $expertId, "\167\145\x65\153\x5f\x64\141\171" => $weekDay, "\141\160\160\157\x69\x6e\x74\x5f\164\x69\155\145" => $appointInterval]); goto qLQO0; Z_IiY: array_splice($appoint45s, 0, count($appoint45s)); goto jSH2z; iT4vb: IFOJT: goto atvhm; l6CH4: goto IFOJT; goto WUehH; XOO_P: $appoint45s[] = $appointInterval; goto FRfYA; yRxG7: $startHour = IndexDefs::APPOINT_START_TIME; goto J44UY; WUehH: USD5D: goto bONZK; XUzio: Db::table("\145\170\160\145\x72\164\x5f\x61\x70\x70\x6f\x69\x6e\x74\x5f\164\x69\155\145")->where(["\x65\x78\160\145\162\164\x5f\x69\x64" => $expertId, "\167\x65\145\153\x5f\x64\x61\171" => $weekDay])->delete(); goto yRxG7; Dv_GM: $nowDate = date("\131\x2d\155\x2d\x64"); goto PDwM0; qfr2E: Db::table("\x65\x78\x70\145\x72\164\137\141\160\x70\x6f\151\x6e\164\137\164\x69\x6d\x65")->insert(["\145\170\x70\145\x72\164\137\151\x64" => $expertId, "\x77\x65\x65\x6b\137\144\x61\x79" => $weekDay, "\141\x70\x70\157\x69\156\x74\x5f\x74\x69\155\x65" => implode("\54", $appoint45s)]); goto Z_IiY; Kwpdy: gylne: goto XOO_P; t7LD2: if (count($appoint45s) < 3) { goto gylne; } goto qfr2E; CmxiR: $nextHour = date("\x48\72\x69", strtotime($nowDate . "\x20" . $startHour . "\x3a\60\60" . "\40\53\61\65\x20\x6d\151\x6e\x75\x74\x65\x73")); goto DAvZy; eP9Hk: $startHour = $nextHour; goto EqoZn; DAvZy: $appointInterval = $startHour . "\x2d" . $nextHour; goto jpHfy; EqoZn: goto IFOJT; goto MEZq6; MEZq6: YBiXt: goto t7LD2; atvhm: if (!($startHour < $endHour)) { goto USD5D; } goto CmxiR; jpHfy: if (!in_array($appointInterval, ["\61\x32\72\60\x30\55\x31\x32\x3a\61\x35", "\61\x32\x3a\x31\x35\55\61\x32\72\63\x30", "\x31\x32\x3a\63\x30\55\x31\x32\x3a\64\x35", "\x31\62\72\64\65\55\61\x33\x3a\x30\60", "\61\63\72\x30\x30\x2d\x31\63\x3a\61\65", "\x31\x33\x3a\61\x35\x2d\61\63\x3a\63\x30", "\61\x33\x3a\63\x30\55\61\x33\72\x34\x35", "\x31\x33\x3a\x34\x35\x2d\61\x34\72\x30\x30"])) { goto YBiXt; } goto eP9Hk; PDwM0: $appoint45s = []; goto iT4vb; FRfYA: OftWn: goto MvWBe; MvWBe: $startHour = $nextHour; goto l6CH4; qLQO0: goto OftWn; goto Kwpdy; J44UY: $endHour = IndexDefs::APPOINT_END_TIME; goto Dv_GM; bONZK: } }
