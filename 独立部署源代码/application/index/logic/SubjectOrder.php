<?php
 namespace app\index\logic; use think\Log; use think\Db; use app\index\logic\Subject as SubjectLogic; use app\index\logic\SurveyOrganization as SurveyOrganizationLogic; class SubjectOrder extends Base { public function loadOrders($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '', $customer_id = 0, $subject_id = 0, $combination_id = 0, $survey_id = 0, $survey_organization_id = 0) { goto DyBqH; Ow12X: $order .= "\117\x2e\x63\142\x5f\157\x72\144\x65\162\137\x69\144\40\144\x65\x73\x63"; goto umNH7; XPDxj: if (!(isset($search["\x6f\162\144\x65\x72\137\x6e\157"]) && $search["\157\162\x64\x65\162\x5f\156\157"])) { goto e1k5F; } goto inaER; P7v0d: XyZ8f: goto GzBhl; s26hQ: if (!$order) { goto QBv0u; } goto A9VUz; gTvBs: goto s9dgj; goto ufBR6; dtfrI: IBZAC: goto wgLMn; JY2bf: return json([]); goto LHCys; OmuE2: $where["\117\56\x73\165\142\x6a\145\x63\x74\137\151\x64"] = $subject_id; goto ueuYb; lXsqg: return json([]); goto B0qap; TmNIr: oJLQH: goto MoQr5; DbxUx: pU04G: goto Vx0jj; eo5r7: return json([]); goto DbxUx; vQzIK: if ($orderIds) { goto KJ8XX; } goto lXsqg; PO3VD: LnFPu: goto VkfOE; MF5FA: JCAmG: goto EsLug; n2EcP: $where["\117\x2e\143\x62\137\157\162\144\145\162\x5f\151\x64"] = ["\x69\156", $orderIds]; goto C3ZrG; EsLug: foreach ($items as $k => $v) { goto ZC096; GRe4z: $items[$k]["\142\145\x6c\x6f\156\147\x73\137\164\x6f"] = $combinations[$items[$k]["\143\157\x6d\142\x69\x6e\x61\x74\151\157\156\137\x69\x64"]] ?? ''; goto k13fW; I0LV3: if ($items[$k]["\143\157\155\x62\151\x6e\141\x74\151\x6f\156\x5f\x69\144"]) { goto I00fe; } goto WlJvW; aJbvq: $items[$k]["\x74\151\x6d\145\137\x63\x6f\x73\164"] = $v["\157\162\x64\145\162\137\x74\151\155\x65"] . "\x20\57\40\74\163\x74\x72\157\x6e\147\x3e\xe6\x9c\xaa\345\xae\214\xe6\x88\x90\x3c\x2f\163\x74\162\x6f\x6e\x67\76"; goto sjeUO; vWQ5H: $items[$k]["\x73\165\x72\166\145\171\137\x70\145\162\163\x6f\156\141\x6c\137\x64\141\164\x61"] = implode("\x3c\142\162\57\x3e", array_values($personalData)); goto PaZcv; hnKCZ: $items[$k]["\x74\x69\155\145\x5f\x63\x6f\x73\x74"] = $v["\x6f\162\144\145\x72\137\x74\151\x6d\145"] . "\x20\x2f\40\74\x73\x74\162\157\156\147\x3e" . round((strtotime($v["\x66\151\x6e\151\163\150\137\164\x69\x6d\145"]) - strtotime($v["\157\162\x64\145\x72\137\164\151\155\145"])) / 60, 2) . "\74\57\x73\x74\x72\x6f\x6e\x67\x3e"; goto wNYIG; fTp1h: $items[$k]["\142\x65\x6c\157\x6e\x67\163\137\164\x6f"] = $surveies[$items[$k]["\163\165\x72\166\145\171\137\x69\144"]] ?? ''; goto NM1IY; NM1IY: YOKuu: goto EaAve; GDS1b: Rftix: goto wUkY2; PaZcv: goto iUFQ_; goto L4XD4; k13fW: p6Add: goto FFqtp; MKltG: $items[$k]["\x73\165\162\x76\x65\171\x5f\x70\145\162\x73\157\x6e\141\x6c\x5f\144\x61\x74\141"] = $items[$k]["\x6e\151\143\153\x6e\x61\x6d\x65"]; goto rxAtE; uX6qk: $personalData["\x73\x65\170"] = $personalData["\163\145\x78"] == 1 ? "\xe7\x94\267" : "\345\245\xb3"; goto dLK_b; AUmlv: if ($v["\146\151\156\151\x73\150\137\164\x69\155\x65"]) { goto r9kR8; } goto aJbvq; dLK_b: MQuyK: goto mcsyf; wNYIG: j9zzB: goto xylhg; sjeUO: goto j9zzB; goto jCAuV; s8akB: EjjZg: goto vWQ5H; WlJvW: if (!$items[$k]["\x73\165\162\166\145\x79\137\x69\144"]) { goto YOKuu; } goto fTp1h; ZC096: $items[$k]["\x63\x61\164\x65\147\x6f\162\171\x5f\x6e\x61\x6d\145"] = SubjectLogic::I()->getCategoryNameStr($v["\x73\x75\142\x6a\145\143\x74\137\151\144"]); goto AUmlv; pnMtd: tgZet: goto DGshy; rxAtE: iUFQ_: goto pnMtd; HHG63: $personalData["\x6f\x72\x67\x61\156\x69\x7a\x61\164\x69\x6f\x6e"] = SurveyOrganizationLogic::I()->loadFullText($personalData["\x6f\x72\x67\x61\156\x69\172\141\x74\151\157\x6e"], ''); goto s8akB; xRqh8: if (empty($v["\163\165\162\x76\x65\x79\x5f\160\145\162\x73\157\156\x61\x6c\137\144\x61\x74\x61"])) { goto yRItG; } goto RTmGJ; Z0Cbw: I00fe: goto GRe4z; jCAuV: r9kR8: goto hnKCZ; RTmGJ: $personalData = json_decode($items[$k]["\x73\x75\162\x76\x65\171\137\x70\145\x72\163\x6f\156\141\154\x5f\x64\x61\x74\141"], true); goto Z2ar1; Z2ar1: if (!isset($personalData["\163\x65\x78"])) { goto MQuyK; } goto uX6qk; L4XD4: yRItG: goto MKltG; DGshy: $items[$k]["\142\145\x6c\x6f\156\147\x73\x5f\x74\157"] = ''; goto I0LV3; FFqtp: $items[$k]["\x63\x6f\155\160\154\145\164\151\157\156"] = floor($v["\164\x65\x73\x74\x5f\151\164\x65\155\163"] / $v["\164\x6f\164\141\x6c\x5f\x69\x74\x65\155\x73"] * 100) . "\45"; goto GDS1b; xylhg: if (!$survey_id) { goto tgZet; } goto xRqh8; mcsyf: if (!isset($personalData["\x6f\x72\147\141\x6e\151\x7a\141\164\151\157\156"])) { goto EjjZg; } goto HHG63; EaAve: goto p6Add; goto Z0Cbw; wUkY2: } goto e58tN; DyBqH: $where = []; goto XPDxj; LFmGr: $combinations = []; goto PO3VD; WrdCR: if (!(isset($search["\x70\141\171\137\x73\164\141\x74\x75\x73"]) && $search["\160\141\171\x5f\x73\164\x61\x74\165\163"])) { goto c6g4L; } goto tMPZT; eDi1R: if (!($survey_id && $survey_organization_id)) { goto Dmg_Z; } goto vBHAV; qdLDQ: e1k5F: goto vSebo; GzBhl: if (!(isset($search["\x77\x61\162\x6e\x69\156\147\137\x6c\x65\166\145\x6c"]) && $search["\167\x61\162\156\151\x6e\147\137\x6c\x65\x76\145\154"] !== '')) { goto IBZAC; } goto NYGxb; OoMaY: if (!(isset($search["\162\145\141\154\137\156\141\x6d\x65"]) && $search["\162\x65\x61\154\x5f\156\141\x6d\x65"])) { goto VgrLy; } goto m9aJ8; TTcYc: if (!$combination_id) { goto r7p2E; } goto VZE6X; Di2wR: VgrLy: goto NvlLa; owzT3: return json([]); goto V0sXj; DEEHE: if ($orderIds) { goto pU04G; } goto eo5r7; tnNkR: uDw93: goto dA_WX; FvWmI: $orderIds = Db::table("\163\165\162\166\x65\x79\137\x6f\162\144\145\x72")->where("\x73\165\162\166\145\171\x5f\151\x64", $survey_id)->column("\x69\144"); goto GA5ZY; sP5vJ: if ($survey_id && empty($survey_organization_id)) { goto yBdsk; } goto eDi1R; gcsG3: $combinations = Db::table("\163\165\x62\x6a\x65\x63\x74\x5f\x63\157\x6d\x62\x69\156\141\x74\151\157\156")->column("\x6e\x61\155\145", "\x69\x64"); goto fSrDZ; wgLMn: if ($customer_id) { goto rdxdS; } goto A3Zm5; vBHAV: $orderIds = Db::table("\x73\x75\162\x76\x65\x79\x5f\157\x72\144\x65\x72")->where(["\163\x75\x72\166\145\x79\137\151\144" => $survey_id, "\x73\x75\x72\166\x65\x79\137\157\162\x67\141\x6e\151\172\x61\164\x69\x6f\x6e\137\151\x64" => $survey_organization_id])->column("\x69\x64"); goto DEEHE; GA5ZY: if ($orderIds) { goto r1XZs; } goto JY2bf; FGKqV: c6g4L: goto TTcYc; VkfOE: $surveies = Db::table("\163\165\x72\x76\x65\171")->column("\156\141\155\145", "\151\x64"); goto pdGLW; rqg4e: lil9U: goto NP22W; XAnSX: yBdsk: goto FvWmI; i_gsX: CoFHY: goto htjDa; LHCys: r1XZs: goto WK0VN; ttlHi: return json([]); goto TmNIr; m9aJ8: $customerIds = Db::table("\x63\x75\x73\164\x6f\155\145\x72")->where("\162\145\x61\154\137\156\141\155\145", "\x6c\x69\x6b\145", "\45{$search["\x72\145\x61\154\x5f\156\141\155\x65"]}\x25")->column("\151\x64"); goto KLpZp; xQj2L: $where["\117\x2e\x63\x68\141\156\x6e\x65\x6c\137\x69\x64"] = $search["\x63\x68\x61\x6e\156\x65\154\137\x69\x64"]; goto P7v0d; pdGLW: if (!empty($surveies)) { goto JCAmG; } goto GkVYi; cghWr: if (!(isset($search["\163\165\x62\152\145\x63\164\137\151\x64"]) && $search["\x73\x75\142\152\145\143\x74\137\x69\x64"])) { goto zzTMg; } goto LXBlw; KLpZp: if (!empty($customerIds)) { goto nsTYP; } goto owzT3; AdBmY: if (!empty($customerIds)) { goto cTrqe; } goto puq_W; A3Zm5: if (!(isset($search["\156\151\143\153\156\141\x6d\x65"]) && $search["\x6e\x69\143\153\156\141\155\145"])) { goto J8XMr; } goto JFCFg; NvlLa: goto CoFHY; goto Q7Cqx; Vx0jj: $where["\117\x2e\163\165\162\x76\145\x79\x5f\157\162\x64\145\x72\x5f\x69\x64"] = ["\151\156", $orderIds]; goto gXHv0; GkVYi: $surveies = []; goto MF5FA; XiPFd: if (!$combination_id) { goto QiQpx; } goto s26hQ; Q7Cqx: rdxdS: goto vZsM6; oY4ax: if (!$order) { goto SlgTE; } goto NNu1Q; vSebo: if ($subject_id) { goto twNas; } goto cghWr; gXHv0: Dmg_Z: goto G8RX9; tMPZT: $where["\117\56\x70\141\x79\x5f\x73\164\141\164\165\x73"] = $search["\160\x61\171\137\x73\164\141\164\165\163"]; goto FGKqV; NP22W: $order .= "\117\56\x6f\x72\x64\145\162\x5f\164\151\x6d\x65\40\144\145\163\x63"; goto t4ILL; umNH7: QiQpx: goto UBHVg; qdWcQ: J8XMr: goto OoMaY; V0sXj: nsTYP: goto uS_9K; G8RX9: goto uDw93; goto XAnSX; M0VXQ: $order .= "\117\x2e\x73\165\x72\166\x65\x79\137\x6f\x72\144\145\x72\x5f\151\x64\40\x64\145\x73\143"; goto iTxFn; I48ED: if (!(isset($search["\143\150\x61\x6e\x6e\145\x6c\x5f\151\144"]) && $search["\143\x68\x61\156\x6e\145\x6c\x5f\151\x64"])) { goto XyZ8f; } goto xQj2L; NNu1Q: $order .= "\x2c"; goto Jd07d; MoQr5: $items = Db::table("\163\165\142\152\145\143\164\137\x6f\x72\x64\145\162")->alias("\x4f")->join("\x73\x75\142\152\x65\x63\164\x20\x53", "\x4f\56\163\x75\142\152\145\143\164\137\151\x64\x3d\123\56\151\144", "\114\x45\106\x54")->join("\143\165\x73\164\157\x6d\145\x72\x20\x43", "\x4f\x2e\x63\x75\x73\164\x6f\x6d\145\x72\137\x69\144\x3d\103\56\151\x64", "\x4c\105\x46\x54")->join("\x63\x6f\x6d\142\x69\x6e\141\x74\151\157\x6e\x5f\157\162\x64\x65\x72\x20\103\x4f", "\117\56\x63\x62\137\157\x72\x64\145\x72\x5f\151\144\x3d\x43\x4f\x2e\x69\x64", "\x4c\105\x46\x54")->join("\x73\165\162\166\145\171\137\x6f\162\144\145\x72\40\x53\117", "\117\x2e\163\165\x72\166\145\x79\x5f\x6f\162\144\x65\x72\x5f\x69\144\75\123\117\x2e\x69\x64", "\114\x45\x46\124")->where($where)->field("\x4f\x2e\x6f\162\144\145\162\137\156\157\54\40\x4f\x2e\x63\165\x73\x74\x6f\155\x65\162\x5f\x69\x64\54\40\x4f\x2e\163\165\x62\152\x65\143\164\137\151\x64\x2c\x20\117\56\157\162\144\145\162\137\x61\155\157\x75\x6e\164\54\40\x4f\56\x6f\x72\144\x65\162\x5f\x74\x69\x6d\x65\54\40\117\x2e\x66\x69\156\x69\163\x68\137\164\x69\155\145\54\x20\xd\xa\40\x20\40\x20\x20\40\40\40\40\40\40\40\x20\40\x20\40\x4f\56\164\x65\163\164\x5f\151\x74\x65\x6d\163\x2c\40\x4f\x2e\164\x6f\164\141\154\137\151\164\x65\x6d\163\x2c\x20\117\56\x66\151\x6e\151\x73\x68\x65\x64\x2c\x20\117\x2e\160\141\171\x5f\163\164\x61\164\165\163\x2c\x20\117\x2e\x63\x68\141\156\156\145\x6c\x5f\x69\x64\x2c\x20\x4f\56\x77\141\162\156\151\156\x67\x5f\154\145\166\x65\154\x2c\xd\12\x20\x20\40\x20\x20\x20\40\40\x20\40\40\x20\x20\x20\x20\x20\x4f\x2e\143\142\137\157\x72\144\x65\162\137\x69\x64\x2c\40\x4f\x2e\x73\x75\x72\166\145\x79\137\x6f\x72\144\x65\162\137\x69\x64\x2c\xd\xa\x20\40\40\x20\x20\x20\x20\40\40\40\x20\x20\40\40\x20\40\x53\x2e\x6e\141\155\145\40\141\163\40\163\x75\x62\x6a\145\143\164\x5f\x6e\x61\x6d\x65\x2c\x20\xd\xa\40\40\x20\40\x20\40\40\40\x20\40\40\x20\40\40\x20\40\x43\56\156\x69\143\153\156\141\x6d\x65\54\x20\103\56\162\145\x61\x6c\x5f\156\141\155\x65\54\40\x43\x2e\143\x6f\155\160\141\156\171\54\xd\xa\x20\x20\x20\40\40\x20\40\x20\x20\40\x20\x20\x20\40\40\40\103\x4f\56\x63\157\155\142\151\156\x61\164\151\157\x6e\x5f\x69\144\54\15\12\x20\40\40\x20\40\x20\40\40\x20\40\x20\40\x20\x20\x20\40\x43\x4f\56\x66\x69\156\151\163\x68\145\x64\x20\x61\x73\40\143\x6f\155\x62\151\156\141\x74\x69\157\156\x5f\157\162\144\x65\x72\x5f\x66\x69\x6e\x69\163\x68\x65\x64\x2c\xd\12\x20\40\40\40\x20\x20\x20\x20\40\x20\x20\40\x20\x20\40\x20\x53\117\56\x73\165\162\166\145\x79\x5f\x69\144\x2c\15\12\x20\x20\40\40\40\x20\x20\x20\40\40\40\x20\40\40\x20\40\123\x4f\x2e\146\151\x6e\x69\x73\x68\145\144\x20\x61\163\x20\163\x75\x72\x76\145\x79\x5f\x6f\x72\x64\145\x72\x5f\x66\151\156\151\x73\x68\x65\144\x2c\40\x53\117\x2e\160\x65\162\x73\x6f\x6e\141\x6c\x5f\x64\141\x74\x61\x20\141\x73\40\163\165\x72\x76\145\171\x5f\160\145\162\x73\157\156\x61\154\137\144\x61\x74\141")->page($page, $rows)->order($order)->select(); goto gcsG3; e58tN: cAlgY: goto CMdoP; VZE6X: $orderIds = Db::table("\143\157\155\142\151\x6e\141\164\151\x6f\x6e\x5f\157\x72\x64\x65\x72")->where("\x63\157\x6d\x62\x69\x6e\141\164\151\x6f\x6e\x5f\x69\144", $combination_id)->column("\151\x64"); goto vQzIK; inaER: $where["\117\x2e\x6f\x72\144\x65\162\x5f\156\x6f"] = $search["\157\162\144\x65\x72\x5f\156\x6f"]; goto qdLDQ; vZsM6: $where["\x4f\56\x63\x75\x73\164\157\x6d\145\162\137\x69\x64"] = $customer_id; goto i_gsX; yygpz: $order .= "\x2c"; goto rqg4e; puq_W: return json([]); goto MZEGy; ueuYb: s9dgj: goto I48ED; htjDa: if (!(isset($search["\163\x74\141\x74\x75\x73"]) && $search["\x73\164\x61\x74\x75\163"] !== '')) { goto kZ7M8; } goto n7By4; reYB_: if (!$order) { goto lil9U; } goto yygpz; wPJJ6: kZ7M8: goto WrdCR; C3ZrG: r7p2E: goto sP5vJ; Jd07d: SlgTE: goto M0VXQ; iTxFn: vY437: goto reYB_; B0qap: KJ8XX: goto n2EcP; NYGxb: $where["\x4f\56\167\x61\162\156\151\x6e\147\x5f\154\x65\166\x65\x6c"] = $search["\167\x61\x72\156\x69\x6e\x67\x5f\154\145\x76\145\x6c"]; goto dtfrI; WK0VN: $where["\117\56\x73\165\162\x76\145\171\137\x6f\162\x64\x65\162\x5f\151\144"] = ["\151\x6e", $orderIds]; goto tnNkR; rYglg: QBv0u: goto Ow12X; CMdoP: return ["\164\x6f\164\141\154" => $total, "\x72\x6f\x77\x73" => $items]; goto M4mgy; NNu4F: zzTMg: goto gTvBs; uS_9K: $where["\x4f\56\143\x75\163\164\x6f\x6d\145\162\x5f\x69\x64"] = ["\151\x6e", $customerIds]; goto Di2wR; t4ILL: $total = Db::table("\x73\x75\142\x6a\145\x63\x74\x5f\x6f\162\144\x65\162")->alias("\117")->where($where)->count(); goto vMaN0; fSrDZ: if (!empty($combinations)) { goto LnFPu; } goto LFmGr; A9VUz: $order .= "\x2c"; goto rYglg; vMaN0: if (!empty($total)) { goto oJLQH; } goto ttlHi; ufBR6: twNas: goto OmuE2; MZEGy: cTrqe: goto hlAGR; UBHVg: if (!$survey_id) { goto vY437; } goto oY4ax; dA_WX: $order = ''; goto XiPFd; n7By4: $where["\117\56\x66\x69\x6e\151\x73\150\x65\x64"] = $search["\x73\164\x61\164\165\163"]; goto wPJJ6; JFCFg: $customerIds = Db::table("\143\165\163\164\157\155\x65\162")->where("\156\151\x63\153\x6e\x61\155\x65", "\x6c\151\153\x65", "\x25{$search["\x6e\x69\143\x6b\x6e\141\155\x65"]}\45")->column("\x69\x64"); goto AdBmY; hlAGR: $where["\x4f\x2e\143\x75\163\164\157\x6d\x65\x72\x5f\151\144"] = ["\x69\156", $customerIds]; goto qdWcQ; LXBlw: $where["\117\x2e\163\x75\142\152\145\x63\164\x5f\151\144"] = $search["\163\x75\142\152\145\x63\164\x5f\151\144"]; goto NNu4F; M4mgy: } }
