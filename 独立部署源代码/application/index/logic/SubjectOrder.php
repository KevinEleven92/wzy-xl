<?php
 namespace app\index\logic; use think\Log; use think\Db; use app\index\logic\Subject as SubjectLogic; use app\index\logic\SurveyOrganization as SurveyOrganizationLogic; class SubjectOrder extends Base { public function loadOrders($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '', $customer_id = 0, $subject_id = 0, $combination_id = 0, $survey_id = 0, $survey_organization_id = 0) { goto heecL; pGMV5: $orderIds = Db::table("\143\157\x6d\142\151\x6e\141\164\151\157\x6e\x5f\x6f\162\144\145\162")->where("\143\157\x6d\x62\151\156\x61\x74\151\157\x6e\x5f\x69\x64", $combination_id)->column("\x69\x64"); goto HnA0v; Zkbhw: cwnCU: goto Fd5WB; v3Yja: if (!(isset($search["\x77\x61\x72\156\151\x6e\147\x5f\154\145\x76\x65\x6c"]) && $search["\167\x61\162\156\x69\x6e\x67\137\x6c\145\x76\x65\x6c"] !== '')) { goto pb01F; } goto jqyBF; BKfBh: $where["\x4f\x2e\146\x69\156\x69\x73\x68\x65\x64"] = $search["\163\x74\x61\x74\165\x73"]; goto V4Ri7; QQS8K: return json([]); goto LJusK; heecL: $where = []; goto l3TV3; s1GEf: BoQYk: goto RtjXh; w1iSx: dwxBb: goto nqAbm; UeH8M: o7Gxf: goto n505z; rsU79: if ($survey_id && empty($survey_organization_id)) { goto P1vs2; } goto g6U51; w1Lj7: $customerIds = Db::table("\x63\165\163\x74\157\x6d\x65\162")->where("\x72\x65\141\x6c\x5f\156\x61\155\x65", "\154\x69\153\145", "\x25{$search["\x72\x65\x61\154\x5f\x6e\141\155\x65"]}\45")->column("\x69\144"); goto tepj4; I3kMF: JnUdm: goto qQnU4; oTIen: AXrDv: goto xbkKb; VhhKv: if (!(isset($search["\x70\141\171\x5f\x73\x74\141\x74\x75\163"]) && $search["\160\x61\x79\137\163\x74\x61\164\x75\x73"])) { goto Km2Bt; } goto g_y1k; g_y1k: $where["\x4f\x2e\160\141\x79\x5f\x73\164\141\x74\165\163"] = $search["\x70\x61\x79\x5f\x73\164\x61\164\165\x73"]; goto iuWOe; nba3t: if (!$order) { goto BoQYk; } goto o9Iya; P05GQ: jiCNR: goto zeWOS; hg38v: nl1R8: goto v3Yja; r3MEM: pb01F: goto MYWEF; LRwVz: $order .= "\x4f\56\x6f\162\x64\x65\x72\137\x74\x69\x6d\x65\40\144\x65\x73\143"; goto JvN4M; Yue5u: E_zMc: goto w_jan; qVw49: if (!(isset($search["\156\x69\x63\x6b\156\141\155\145"]) && $search["\x6e\x69\143\153\156\x61\x6d\x65"])) { goto o7Gxf; } goto zr8L3; pHd38: yGQ7Z: goto EfZQR; fLAl_: ms1_8: goto rsU79; tepj4: if (!empty($customerIds)) { goto P4Ds_; } goto QQS8K; Wi13p: if (!$combination_id) { goto v3ED1; } goto nba3t; mvdn7: $combinations = Db::table("\x73\165\142\152\145\x63\164\x5f\x63\x6f\155\142\x69\x6e\141\164\x69\157\156")->column("\156\x61\x6d\x65", "\151\144"); goto rk_v8; VAab7: v3ED1: goto YesNY; zfvU8: $combinations = []; goto goDO8; Uc48Z: UQNlu: goto iBdsv; l3TV3: if (!(isset($search["\157\x72\x64\x65\x72\137\156\157"]) && $search["\x6f\162\144\x65\162\137\156\x6f"])) { goto jiCNR; } goto wBYUE; Ri2za: lcDze: goto pOLsv; RnYpt: $orderIds = Db::table("\163\165\162\x76\145\171\x5f\157\162\x64\145\x72")->where(["\163\x75\x72\166\x65\x79\x5f\x69\x64" => $survey_id, "\163\x75\162\166\145\171\x5f\x6f\162\147\141\x6e\x69\172\141\x74\x69\157\x6e\137\x69\x64" => $survey_organization_id])->column("\151\x64"); goto lEXfx; ezuRm: $where["\x4f\x2e\x73\165\142\152\145\x63\x74\x5f\151\144"] = $subject_id; goto oTIen; iBdsv: $order .= "\117\x2e\x73\x75\x72\x76\145\171\137\x6f\162\144\x65\162\137\151\x64\x20\x64\x65\163\x63"; goto w1iSx; jDpIJ: if (!$order) { goto UQNlu; } goto e8tuh; goDO8: F6eWY: goto m8542; gejyD: $surveies = []; goto Yue5u; jXnFl: $where["\117\56\x73\165\142\152\145\x63\164\x5f\151\144"] = $search["\x73\165\x62\152\x65\143\x74\x5f\x69\144"]; goto A9siT; qxIyF: xy24r: goto VAsMs; fUWWP: $order .= "\x2c"; goto wz7nh; TSPrH: if (!(isset($search["\x73\165\142\x6a\145\x63\164\x5f\151\144"]) && $search["\x73\x75\142\152\145\143\x74\x5f\151\x64"])) { goto lzwDm; } goto jXnFl; qQnU4: if (!(isset($search["\x73\164\x61\x74\165\163"]) && $search["\x73\164\141\x74\165\163"] !== '')) { goto Tlnzp; } goto BKfBh; SyMqR: $where["\117\56\x63\165\163\164\157\x6d\x65\162\x5f\151\144"] = $customer_id; goto I3kMF; Ds9F3: if (!empty($total)) { goto lFD3u; } goto MUXzw; e8tuh: $order .= "\x2c"; goto Uc48Z; EfZQR: $where["\x4f\x2e\163\x75\x72\x76\x65\171\x5f\x6f\162\144\145\x72\137\151\x64"] = ["\151\156", $orderIds]; goto Zkbhw; A9siT: lzwDm: goto XP_eP; kVQnY: $where["\117\56\x63\x62\x5f\157\x72\144\145\162\x5f\x69\144"] = ["\151\x6e", $orderIds]; goto fLAl_; LJusK: P4Ds_: goto VxnQ3; W5bWQ: $items = Db::table("\163\x75\x62\x6a\145\143\x74\137\157\x72\x64\x65\162")->alias("\x4f")->join("\163\x75\142\152\x65\143\x74\40\123", "\117\56\163\165\x62\152\145\143\164\x5f\x69\144\x3d\x53\x2e\x69\144", "\x4c\105\x46\124")->join("\143\165\163\164\x6f\x6d\145\x72\x20\x43", "\x4f\x2e\x63\165\x73\x74\157\155\145\x72\137\151\x64\x3d\103\56\x69\x64", "\114\x45\106\124")->join("\143\x6f\155\142\x69\x6e\x61\x74\151\x6f\156\137\157\162\x64\x65\162\40\103\x4f", "\x4f\56\143\x62\x5f\x6f\162\x64\x65\x72\137\x69\x64\x3d\103\117\x2e\x69\144", "\x4c\x45\x46\124")->join("\x73\165\162\x76\145\x79\x5f\157\162\144\145\x72\x20\123\x4f", "\x4f\x2e\x73\165\x72\166\145\x79\137\x6f\162\x64\145\162\137\x69\x64\75\x53\117\56\151\x64", "\114\105\106\124")->where($where)->field("\117\56\x6f\162\144\x65\162\137\156\x6f\54\x20\117\56\143\165\x73\164\x6f\x6d\x65\x72\x5f\151\x64\x2c\x20\117\x2e\163\x75\x62\152\145\143\x74\x5f\151\x64\54\x20\117\x2e\157\x72\x64\x65\x72\137\x61\x6d\x6f\165\x6e\164\x2c\x20\117\56\x6f\x72\x64\x65\162\x5f\164\x69\x6d\145\x2c\x20\117\56\146\151\156\151\x73\150\137\164\151\155\x65\x2c\40\xd\12\40\x20\40\40\40\40\40\x20\40\x20\x20\x20\x20\40\x20\40\117\x2e\164\145\x73\x74\137\151\x74\x65\155\163\54\40\x4f\56\164\x6f\164\x61\x6c\x5f\x69\164\145\155\x73\54\x20\x4f\56\146\x69\x6e\151\x73\x68\145\144\54\x20\x4f\x2e\160\x61\171\x5f\163\x74\x61\164\165\x73\54\x20\x4f\x2e\143\x68\x61\x6e\x6e\x65\154\137\151\x64\x2c\40\117\56\x77\141\162\x6e\151\x6e\x67\137\154\145\166\145\x6c\x2c\15\12\40\40\x20\x20\x20\x20\40\40\x20\x20\40\x20\40\x20\40\x20\117\x2e\143\142\137\157\162\x64\x65\162\137\151\144\54\40\x4f\56\x73\165\x72\166\145\x79\137\157\x72\x64\145\162\x5f\x69\x64\54\15\xa\40\40\x20\40\x20\40\x20\40\x20\40\x20\40\x20\x20\x20\x20\x53\56\156\141\155\x65\x20\141\163\40\x73\x75\142\x6a\145\x63\x74\x5f\156\x61\155\145\54\40\xd\xa\x20\40\x20\40\40\x20\40\x20\40\40\40\40\x20\x20\40\40\103\x2e\156\151\x63\153\156\x61\155\x65\x2c\x20\103\x2e\162\x65\x61\x6c\x5f\x6e\141\x6d\x65\54\x20\103\x2e\143\x6f\x6d\160\x61\156\x79\x2c\xd\xa\40\40\40\40\40\40\x20\x20\x20\40\40\x20\x20\x20\x20\x20\x43\117\x2e\x63\x6f\155\x62\x69\x6e\141\x74\x69\x6f\156\137\151\x64\54\xd\12\40\40\x20\x20\x20\40\40\x20\40\40\x20\x20\x20\x20\40\x20\x43\117\x2e\146\151\x6e\151\x73\x68\145\144\40\x61\163\x20\x63\x6f\155\x62\x69\156\141\x74\151\x6f\156\137\157\x72\144\145\x72\x5f\146\x69\x6e\x69\163\150\145\144\x2c\xd\xa\40\40\x20\x20\40\40\x20\x20\40\x20\x20\x20\x20\40\40\x20\x53\x4f\56\163\165\x72\x76\145\x79\137\x69\x64\54\15\xa\40\40\x20\x20\x20\x20\x20\40\40\40\40\40\x20\40\x20\x20\x53\x4f\x2e\146\x69\x6e\151\163\x68\x65\x64\40\141\163\x20\163\165\x72\x76\x65\171\x5f\157\x72\144\x65\x72\x5f\146\151\x6e\151\x73\x68\x65\144\54\40\123\117\56\x70\x65\162\163\x6f\x6e\x61\154\x5f\x64\141\164\x61\40\x61\163\40\x73\x75\162\166\x65\x79\137\x70\145\x72\x73\157\x6e\141\154\x5f\x64\x61\164\x61")->page($page, $rows)->order($order)->select(); goto mvdn7; Ec1FX: lFD3u: goto W5bWQ; V4Ri7: Tlnzp: goto VhhKv; XP_eP: goto AXrDv; goto voOcz; A2l_1: $orderIds = Db::table("\x73\165\x72\x76\x65\171\137\x6f\162\x64\145\162")->where("\163\165\162\166\145\171\137\151\144", $survey_id)->column("\x69\144"); goto A13O1; zeWOS: if ($subject_id) { goto POjx_; } goto TSPrH; Q4Jbb: if (!$combination_id) { goto ms1_8; } goto pGMV5; o9Iya: $order .= "\54"; goto s1GEf; hq4HJ: return json([]); goto VvBRf; m8542: $surveies = Db::table("\163\x75\162\166\145\171")->column("\156\141\155\145", "\151\144"); goto R6uoy; szeMj: $where["\x4f\56\163\165\x72\x76\x65\171\137\x6f\x72\144\x65\162\x5f\x69\144"] = ["\151\156", $orderIds]; goto qxIyF; YesNY: if (!$survey_id) { goto dwxBb; } goto jDpIJ; Fd5WB: $order = ''; goto Wi13p; atQFS: if (!empty($customerIds)) { goto lcDze; } goto pe1V3; wBYUE: $where["\x4f\56\x6f\162\x64\145\x72\137\156\x6f"] = $search["\x6f\162\x64\145\x72\137\x6e\x6f"]; goto P05GQ; jqyBF: $where["\117\56\x77\141\162\x6e\151\156\147\x5f\x6c\x65\166\145\x6c"] = $search["\x77\141\x72\x6e\x69\x6e\x67\x5f\154\145\x76\x65\154"]; goto r3MEM; VvBRf: g221p: goto kVQnY; iuWOe: Km2Bt: goto Q4Jbb; x7aNK: P1vs2: goto A2l_1; A13O1: if ($orderIds) { goto yGQ7Z; } goto UXvxj; pOLsv: $where["\x4f\x2e\x63\x75\163\164\157\x6d\x65\162\137\x69\144"] = ["\151\156", $customerIds]; goto UeH8M; rk_v8: if (!empty($combinations)) { goto F6eWY; } goto zfvU8; VAsMs: goto cwnCU; goto x7aNK; lEXfx: if ($orderIds) { goto oxPte; } goto AcYFQ; pe1V3: return json([]); goto Ri2za; lChCH: TAeTd: goto MqcZV; Soc63: rHWh0: goto Q2RgW; xbkKb: if (!(isset($search["\143\x68\x61\156\x6e\145\x6c\x5f\x69\x64"]) && $search["\143\x68\x61\x6e\156\145\154\137\x69\x64"])) { goto nl1R8; } goto REAcS; AcYFQ: return json([]); goto KpEQx; R6uoy: if (!empty($surveies)) { goto E_zMc; } goto gejyD; MYWEF: if ($customer_id) { goto VM0Ib; } goto qVw49; MqcZV: goto JnUdm; goto yFQOz; voOcz: POjx_: goto ezuRm; VxnQ3: $where["\117\56\x63\165\163\x74\x6f\x6d\x65\x72\137\151\144"] = ["\151\156", $customerIds]; goto lChCH; w_jan: foreach ($items as $k => $v) { goto LZRwG; KIs0f: $personalData["\x6f\x72\x67\141\x6e\151\172\141\x74\x69\x6f\x6e"] = SurveyOrganizationLogic::I()->loadFullText($personalData["\x6f\x72\147\141\156\151\x7a\141\164\151\x6f\156"], ''); goto nMhGo; DNsB9: $items[$k]["\x74\151\155\145\137\143\157\163\164"] = $v["\157\162\x64\145\162\137\164\x69\x6d\145"] . "\x20\57\x20\74\163\x74\162\x6f\x6e\x67\76\xe6\234\xaa\xe5\xae\214\346\x88\x90\x3c\x2f\x73\164\x72\x6f\156\x67\x3e"; goto WjroR; WjroR: goto s7UP3; goto EQo8s; xnUB_: MhbXs: goto Uiyxd; QHdRM: $personalData["\x73\x65\x78"] = $personalData["\163\145\170"] == 1 ? "\xe7\224\267" : "\345\245\xb3"; goto t6HOw; K9gIU: liVL7: goto H6zru; s9kB5: $items[$k]["\x73\x75\x72\x76\145\x79\137\160\145\162\163\157\x6e\141\x6c\x5f\144\x61\164\x61"] = implode("\74\142\162\57\76", array_values($personalData)); goto wX441; nMhGo: k7Ihv: goto s9kB5; wX441: goto edvNN; goto xnUB_; KC2N9: grFkm: goto yM7Yd; y7xBz: if (!$v["\x74\157\x74\x61\154\137\151\164\x65\155\x73"]) { goto QuoXt; } goto rajAt; H6zru: goto fZxKo; goto wNIiC; KURzo: if (empty($v["\163\x75\162\x76\145\171\137\160\x65\x72\x73\157\x6e\x61\x6c\137\144\x61\164\141"])) { goto MhbXs; } goto jOpPv; OzK_y: if (!$items[$k]["\163\165\x72\166\x65\x79\x5f\x69\144"]) { goto liVL7; } goto hXqBB; WjrEa: $items[$k]["\x62\145\154\157\x6e\x67\x73\137\164\157"] = ''; goto bH4rQ; rajAt: $items[$k]["\x63\157\x6d\x70\154\x65\164\151\x6f\156"] = floor($v["\x74\145\163\x74\x5f\151\164\x65\x6d\163"] / $v["\164\157\164\141\x6c\137\151\x74\145\x6d\163"] * 100) . "\45"; goto vk_BE; br5Af: s05ZF: goto WjrEa; t6HOw: aZLGc: goto FNPxH; pO_K9: $items[$k]["\142\x65\154\x6f\x6e\x67\163\x5f\164\x6f"] = $combinations[$items[$k]["\143\157\x6d\142\x69\x6e\x61\164\x69\157\x6e\x5f\x69\x64"]] ?? ''; goto HYu2E; k7hCB: s7UP3: goto pHOzs; hXqBB: $items[$k]["\142\x65\154\x6f\156\x67\163\137\x74\157"] = $surveies[$items[$k]["\x73\x75\162\x76\x65\171\x5f\x69\144"]] ?? ''; goto K9gIU; pHOzs: if (!$survey_id) { goto s05ZF; } goto KURzo; tU11M: $items[$k]["\164\151\x6d\x65\x5f\143\157\163\x74"] = $v["\x6f\162\144\x65\162\137\x74\151\x6d\145"] . "\x20\x2f\40\74\163\x74\x72\x6f\x6e\147\x3e" . round((strtotime($v["\146\x69\156\151\163\x68\x5f\x74\151\155\145"]) - strtotime($v["\157\x72\x64\145\x72\137\164\151\155\x65"])) / 60, 2) . "\74\57\163\164\162\x6f\x6e\147\x3e"; goto k7hCB; vk_BE: QuoXt: goto KC2N9; pQTvv: $items[$k]["\143\157\x6d\160\x6c\x65\164\x69\x6f\x6e"] = ''; goto y7xBz; LZRwG: $items[$k]["\x63\141\164\x65\x67\157\x72\x79\x5f\156\141\155\x65"] = SubjectLogic::I()->getCategoryNameStr($v["\x73\165\142\x6a\x65\x63\x74\x5f\151\x64"]); goto SPK0H; HYu2E: fZxKo: goto pQTvv; Uiyxd: $items[$k]["\x73\x75\162\x76\x65\171\x5f\x70\145\x72\163\157\156\141\x6c\137\144\141\164\x61"] = $items[$k]["\156\x69\143\153\156\x61\155\x65"]; goto EZWh4; EZWh4: edvNN: goto br5Af; jOpPv: $personalData = json_decode($items[$k]["\163\x75\x72\x76\x65\171\137\160\x65\162\x73\157\156\141\154\x5f\x64\141\x74\x61"], true); goto YpdZS; FNPxH: if (!isset($personalData["\x6f\162\x67\141\x6e\x69\172\141\164\151\157\156"])) { goto k7Ihv; } goto KIs0f; wNIiC: eEOjl: goto pO_K9; SPK0H: if ($v["\x66\151\156\151\x73\150\137\164\151\155\145"]) { goto w9smX; } goto DNsB9; bH4rQ: if ($items[$k]["\x63\157\x6d\142\x69\156\x61\x74\151\157\x6e\x5f\x69\144"]) { goto eEOjl; } goto OzK_y; YpdZS: if (!isset($personalData["\x73\x65\170"])) { goto aZLGc; } goto QHdRM; EQo8s: w9smX: goto tU11M; yM7Yd: } goto Soc63; yFQOz: VM0Ib: goto SyMqR; g6U51: if (!($survey_id && $survey_organization_id)) { goto xy24r; } goto RnYpt; KpEQx: oxPte: goto szeMj; RtjXh: $order .= "\x4f\x2e\x63\x62\x5f\x6f\x72\x64\145\x72\137\151\144\40\x64\x65\x73\x63"; goto VAab7; nqAbm: if (!$order) { goto LgWb1; } goto fUWWP; UXvxj: return json([]); goto pHd38; JvN4M: $total = Db::table("\163\x75\142\152\145\143\x74\137\157\x72\144\145\x72")->alias("\117")->where($where)->count(); goto Ds9F3; MUXzw: return json([]); goto Ec1FX; zr8L3: $customerIds = Db::table("\143\165\x73\164\x6f\155\x65\x72")->where("\156\x69\x63\153\156\141\x6d\x65", "\x6c\x69\x6b\145", "\x25{$search["\156\x69\143\153\156\141\155\145"]}\x25")->column("\151\144"); goto atQFS; Q2RgW: return ["\x74\157\x74\x61\x6c" => $total, "\162\x6f\x77\x73" => $items]; goto ImZ08; REAcS: $where["\117\56\x63\150\x61\x6e\156\x65\154\137\x69\144"] = $search["\x63\x68\141\x6e\156\145\x6c\137\151\x64"]; goto hg38v; n505z: if (!(isset($search["\x72\145\141\154\x5f\156\141\x6d\x65"]) && $search["\x72\x65\141\x6c\x5f\156\x61\x6d\x65"])) { goto TAeTd; } goto w1Lj7; HnA0v: if ($orderIds) { goto g221p; } goto hq4HJ; wz7nh: LgWb1: goto LRwVz; ImZ08: } }
