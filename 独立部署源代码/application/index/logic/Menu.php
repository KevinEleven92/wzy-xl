<?php
 namespace app\index\logic; use think\Db; use think\Log; use app\index\service\RequestContext; class Menu extends Base { public function getRow($id) { $row = Db::table("\155\x65\156\165")->where("\151\144", $id)->field(true)->find(); return $row; } public function getDefaultRow() { return ["\156\x61\155\145" => '', "\x6c\145\166\145\154" => 1, "\160\151\x64" => 0, "\143" => '', "\141" => '', "\160\x61\162\141\x6d\163" => '', "\151\x63\x6f\156\x5f\143\x6c\163" => '', "\157\162\x64\145\x72\137\151\x64" => 0]; } public function save($id, $data) { goto rjpLy; rjpLy: $data["\160\x69\144"] = intval($data["\x70\x69\144"]); goto Fi_mc; b38Q2: goto QGSC9; goto aUUTb; VouSK: $id = Db::table("\155\145\x6e\x75")->insert($data, false, true); goto hMVds; Tew5_: if (!(isset($data["\x6e\x61\x6d\x65"]) && empty($data["\156\x61\x6d\145"]))) { goto IvLKG; } goto fHTEz; Fi_mc: if (empty($id)) { goto BK8BP; } goto Tew5_; BK5XF: if (!empty($data["\156\x61\155\x65"])) { goto MBiUO; } goto ms2Ah; niOHC: $data["\156\141\x6d\x65"] = trim($data["\x6e\x61\x6d\145"]); goto BK5XF; hMVds: QGSC9: goto FKN9v; FKN9v: return $id; goto Z07cK; aUUTb: BK8BP: goto niOHC; ms2Ah: exception("\xe5\220\x8d\347\247\260\344\xb8\x8d\350\x83\xbd\xe4\xb8\xba\347\251\xba"); goto BpxZy; KrRL_: Db::table("\155\x65\156\x75")->where("\151\x64", $id)->update($data); goto b38Q2; BpxZy: MBiUO: goto VouSK; fHTEz: exception("\xe5\220\215\347\xa7\xb0\xe4\270\215\xe8\x83\xbd\xe4\270\272\347\xa9\xba"); goto XLmM1; XLmM1: IvLKG: goto KrRL_; Z07cK: } public function delete($id) { goto Cl1V5; bv6UC: $result = Db::table("\155\x65\x6e\165")->where("\x69\x64", $id)->delete(); goto iilK8; jwx_t: return $result; goto cqacB; iilK8: Db::table("\x61\144\x6d\151\x6e\x5f\162\x6f\154\145\137\155\145\x6e\165")->where("\x6d\x65\156\165\137\151\144", $id)->delete(); goto jwx_t; PHRsu: mlacu: goto bv6UC; zYVCu: if (empty($child)) { goto mlacu; } goto kQfdR; Cl1V5: $child = Db::table("\155\x65\156\165")->where("\160\151\x64", $id)->limit(1)->find(); goto zYVCu; kQfdR: exception("\350\xaf\xa5\350\217\x9c\xe5\215\225\xe5\xad\230\xe5\234\xa8\345\255\220\350\217\x9c\xe5\x8d\225\357\274\214\346\x97\240\346\263\225\347\233\264\xe6\216\xa5\345\x88\xa0\351\231\244"); goto PHRsu; cqacB: } public function loadLeftMenuRecursively($pid, $ptext, &$nodes, $loadAll = false, $roleId = null) { goto Xq8NT; WLqzd: if (!empty($rows)) { goto xEqAB; } goto spU9w; blVTJ: return; goto tGImK; Xq8NT: $conditions = ["\x70\x69\144" => $pid]; goto HRKnr; QEHyZ: xEqAB: goto LNaYY; tHNBp: lA_6q: goto blVTJ; HRKnr: $rows = Db::table("\x6d\145\156\165")->where($conditions)->field("\151\144\x2c\x70\151\x64\x2c\x6c\x65\166\145\154\x2c\x6e\x61\x6d\145\54\x69\143\157\156\x5f\x63\x6c\x73\54\143\x2c\x61\x2c\x70\x61\162\x61\x6d\x73\x2c\157\x72\144\145\162\x5f\151\x64")->order("\157\162\x64\x65\162\137\x69\144\x20\x41\x53\103")->select(); goto WLqzd; spU9w: return; goto QEHyZ; LNaYY: foreach ($rows as $key => $value) { goto bSBfk; MUHQb: $node["\164\145\x78\164"] = $value["\x6e\x61\155\145"]; goto TrOLd; Luo4q: $params .= "\46"; goto lboh3; EVYS3: $node["\x63\150\151\154\x64\162\145\156"] = $subNodes; goto kJwcd; lboh3: $params .= $value["\x70\x61\162\x61\155\163"]; goto McGtp; ea2Jj: $this->loadLeftMenuRecursively($id, $breadcrumb, $subNodes, $loadAll, $roleId); goto J0Wpv; jvh0w: sEEpD: goto MEI_2; bSBfk: $id = $value["\x69\x64"]; goto k44R3; McGtp: bIceE: goto rHgyt; JzKaR: if (!$value["\x70\141\162\x61\155\x73"]) { goto bIceE; } goto Luo4q; V_HrM: BwRAz: goto K3U8n; TrOLd: $node["\143"] = $value["\x63"]; goto IrSaH; MkDAM: $node["\x69\x64"] = $id; goto lo84n; IrSaH: $node["\x61"] = $value["\141"]; goto vm_hj; NGnwP: $params = "\x6c\145\x66\164\115\x65\x6e\x75\x49\144\75{$id}"; goto JzKaR; s_qc5: $nodes[] = $node; goto jvh0w; WFsqF: $node["\x6f\162\144\145\x72\x5f\x69\144"] = $value["\x6f\162\x64\x65\162\137\x69\x64"]; goto LVi76; Sblxa: if (!(!empty($value["\x63"]) && !empty($value["\x61"]))) { goto BwRAz; } goto NGnwP; HcKhu: $subNodes = array(); goto ea2Jj; s9T88: $node = array(); goto MkDAM; t0kY4: $node["\141\164\x74\162\151\142\x75\x74\145\163"] = ["\142\162\145\141\x64\x63\x72\165\x6d\142" => $breadcrumb]; goto Sblxa; J0Wpv: if (empty($subNodes)) { goto TgxTK; } goto EVYS3; lo84n: $node["\156\x61\155\x65"] = $value["\x6e\x61\155\x65"]; goto MUHQb; LVi76: $breadcrumb = empty($ptext) ? $value["\x6e\x61\x6d\145"] : $ptext . "\40\x26\147\x74\73\x20" . $value["\156\x61\155\x65"]; goto t0kY4; vm_hj: $node["\160\x61\x72\x61\155\x73"] = $value["\160\x61\162\x61\x6d\x73"]; goto WFsqF; K3U8n: $node["\151\143\x6f\x6e\103\x6c\163"] = $value["\151\143\157\156\137\x63\x6c\163"]; goto HcKhu; tItVu: goto sEEpD; goto O13LT; rHgyt: $node["\165\x72\154"] = url($value["\143"] . "\57" . $value["\x61"], $params); goto V_HrM; O13LT: mnvRP: goto s9T88; k44R3: if (!(!$loadAll && !$this->checkIfSelectedRecursively($id, $roleId))) { goto mnvRP; } goto tItVu; kJwcd: TgxTK: goto s_qc5; MEI_2: } goto tHNBp; tGImK: } protected function checkIfSelectedRecursively($id, $roleId) { goto AJXvA; AJXvA: $roleMenu = Db::table("\x61\x64\x6d\x69\156\x5f\162\157\154\145\137\x6d\145\x6e\x75")->where(array("\x72\157\x6c\x65\x5f\x69\144" => $roleId, "\x6d\145\156\x75\x5f\151\x64" => $id))->find(); goto cT_Ve; rUw0V: if (!empty($subIds)) { goto V9wlw; } goto aHBPb; oFCoS: $subIds = Db::table("\x6d\145\x6e\165")->where(array("\x70\151\144" => $id))->field("\x69\144")->select(); goto rUw0V; jv7et: V9wlw: goto sD78S; vz3dq: return false; goto P247G; b3EdX: return true; goto RfxY_; RfxY_: NtDm7: goto oFCoS; sD78S: foreach ($subIds as $key => $value) { goto QZ7pJ; ErMeq: if (!$result) { goto YI2HU; } goto c_rA7; QZ7pJ: $subId = $value["\x69\x64"]; goto BQ7pR; VumjW: YI2HU: goto rDvBo; c_rA7: return true; goto VumjW; rDvBo: AUvRE: goto QvOgC; BQ7pR: $result = $this->checkIfSelectedRecursively($subId, $roleId); goto ErMeq; QvOgC: } goto JC4LP; aHBPb: return false; goto jv7et; JC4LP: eo0qS: goto vz3dq; cT_Ve: if (!$roleMenu) { goto NtDm7; } goto b3EdX; P247G: } public function wxLoadMenus() { goto QbhIh; rbFyT: foreach ($rows as $id => $v) { goto zAJLx; qnO_n: unset($rows[$id]); goto JGJp9; OEa3g: if (!empty($rows[$id]["\x70\x69\144"])) { goto PwS_n; } goto MMbIg; d0eVV: PwS_n: goto LT5jh; MMbIg: goto aZxNW; goto d0eVV; JGJp9: aZxNW: goto KH_GO; zAJLx: $rows[$id]["\151\x63\157\x6e\103\154\163"] = "\146\141\x20\x66\x61\x20\146\x61\x2d\x63\x69\x72\143\x6c\x65"; goto OEa3g; LT5jh: $rows[$v["\x70\151\x64"]]["\143\x68\151\154\x64\x72\145\156"][] = $rows[$id]; goto qnO_n; KH_GO: } goto RAH6i; TAhI1: return array_values($rows); goto Zn6oh; QbhIh: $rows = Db::table("\x77\x78\x5f\155\145\x6e\165\163")->order("\x70\151\144\40\x64\145\x73\143\54\x73\x6f\x72\x74\x20\x61\x73\x63\54\151\144\40\141\163\x63")->column("\x69\x64\54\160\151\x64\x2c\x73\157\162\164\54\x6e\141\x6d\145\54\x74\x79\160\x65\x2c\x6b\x65\x79\54\x75\162\154\x2c\x61\160\160\151\x64\54\160\x61\x67\145\x70\141\x74\150"); goto bRFjx; k9GBU: ZvxCG: goto rbFyT; bRFjx: if (!empty($rows)) { goto ZvxCG; } goto CSgkJ; CSgkJ: $rows = []; goto k9GBU; RAH6i: E8Xqv: goto TAhI1; Zn6oh: } public function wxMenuSave($id, $pid, $formData) { goto UKMnj; Ft2vP: wexception("\xe6\234\x80\xe5\244\232\346\xb7\273\xe5\x8a\xa0{$max}\344\xb8\252{$type}"); goto NsAes; byfhI: UAMMP: goto KXkGy; HoA19: goto XRLRl; goto byfhI; TomXV: if (!($count == $max)) { goto kExov; } goto Ft2vP; YLbk7: XRLRl: goto BSzle; WLg9b: goto fdeLs; goto Beuot; Bffgm: $type = "\xe4\272\214\347\272\xa7\xe8\x8f\234\xe5\215\x95"; goto XM7D1; r32dJ: $type = "\344\270\200\xe7\xba\xa7\xe8\x8f\x9c\345\215\225"; goto frAyL; XM7D1: $count = Db::table("\167\170\137\155\145\156\x75\x73")->where(["\160\151\144" => ["\147\164", 0]])->count(); goto WLg9b; wwIpf: $id = Db::table("\x77\x78\x5f\155\x65\156\x75\x73")->insertGetId($formData); goto HoA19; l7tfI: $max = 5; goto Bffgm; QcvBr: $max = 3; goto r32dJ; frAyL: $count = Db::table("\x77\170\137\155\x65\156\165\x73")->where(["\x70\151\x64" => 0])->count(); goto JM4qd; KXkGy: Db::table("\x77\170\x5f\x6d\145\x6e\165\x73")->where(["\151\144" => $id])->update($formData); goto YLbk7; I_Qg7: if (empty($data["\160\x69\x64"])) { goto L0I6O; } goto l7tfI; JM4qd: fdeLs: goto TomXV; NsAes: kExov: goto wwIpf; UKMnj: if ($id) { goto UAMMP; } goto I_Qg7; Beuot: L0I6O: goto QcvBr; BSzle: } public function wxMenuSync() { goto UmC6f; xnsVn: ciwHd: goto cXAq4; BO6Cf: wexception("\xe6\x97\xa0\xe8\xa6\201\345\x90\214\346\255\245\347\x9a\x84\xe8\217\x9c\xe5\215\x95\346\225\xb0\xe6\215\xae"); goto pl9QZ; pl9QZ: CWYh1: goto rAMnq; cXAq4: $rows = array_values($rows); goto SLTNN; Wio0T: wexception("\xe5\x90\x8c\xe6\255\xa5\345\xa4\261\350\xb4\245\xef\xbc\x9a\346\x9c\xaa\351\x85\215\347\xbd\256\xe5\205\254\344\274\227\xe5\x8f\xb7\xe5\x8f\x82\xe6\x95\xb0"); goto PZqpa; UnfoR: if (!empty($rows)) { goto CWYh1; } goto BO6Cf; SLTNN: wxPaySetting(); goto SMj9E; rAMnq: foreach ($rows as $id => $v) { goto b4xog; tNHwc: if ($pid) { goto fL0zQ; } goto O0ZXy; xGv4o: if (isset($rows[$pid]["\163\165\142\137\x62\x75\164\164\157\156"])) { goto mXHZS; } goto Xd1nO; rMkkO: mXHZS: goto IqbNn; UjXj4: unset($rows[$id]); goto wJr3B; IqbNn: $rows[$pid]["\x73\165\x62\x5f\x62\165\164\x74\157\x6e"][] = $menu; goto UjXj4; dHC3p: $pid = $v["\160\x69\144"]; goto tNHwc; tf1DJ: switch ($v["\x74\171\160\x65"]) { case "\166\151\x65\x77": goto UlRpp; K50hk: $menu["\165\162\x6c"] = $v["\x75\x72\154"]; goto C1cwz; C1cwz: goto GijKE; goto n3R8E; UlRpp: $menu["\x74\171\160\145"] = $v["\x74\171\160\x65"]; goto K50hk; n3R8E: case "\x6d\x69\x6e\151\x70\162\157\147\162\x61\155": goto hTVXB; G64sk: goto GijKE; goto Q_QKG; jaxA0: $menu["\x70\x61\x67\x65\160\x61\x74\150"] = $v["\x70\x61\x67\x65\x70\x61\164\150"]; goto G64sk; IjnPt: $menu["\x75\162\x6c"] = $v["\165\162\x6c"]; goto p358b; hTVXB: $menu["\x74\x79\x70\x65"] = $v["\x74\171\x70\x65"]; goto IjnPt; p358b: $menu["\141\x70\160\151\144"] = $v["\x61\x70\160\151\144"]; goto jaxA0; Q_QKG: case "\x63\x6c\151\x63\x6b": goto U2ukS; sqDwu: goto GijKE; goto vR2zS; OG9tQ: $menu["\x6b\x65\171"] = $v["\x6b\x65\171"]; goto sqDwu; U2ukS: $menu["\x74\171\160\x65"] = $v["\164\171\x70\145"]; goto OG9tQ; vR2zS: } goto N8nQk; wJr3B: Ytc2p: goto R9YvI; AwTYP: eIBDb: goto xOl0N; QKmFm: goto Ytc2p; goto j4y7O; j4y7O: fL0zQ: goto xGv4o; O0ZXy: if (!(isset($rows[$id]["\163\x75\142\137\x62\165\164\164\x6f\156"]) && $rows[$id]["\x73\x75\x62\x5f\142\x75\164\164\x6f\x6e"])) { goto eIBDb; } goto NprzX; NprzX: $menu["\163\x75\x62\137\x62\x75\x74\x74\157\x6e"] = $rows[$id]["\163\x75\142\137\x62\165\x74\164\x6f\x6e"]; goto AwTYP; Xd1nO: $rows[$pid]["\163\165\x62\137\x62\165\x74\x74\157\x6e"] = []; goto rMkkO; b4xog: $menu = ["\156\141\x6d\x65" => $v["\x6e\x61\x6d\145"]]; goto tf1DJ; R9YvI: BbYJx: goto p3ITv; pbNSY: GijKE: goto dHC3p; N8nQk: gyp0x: goto pbNSY; xOl0N: $rows[$id] = $menu; goto QKmFm; p3ITv: } goto xnsVn; X2qAl: $rows = Db::table("\167\x78\x5f\x6d\145\156\x75\x73")->order("\x70\x69\144\x20\104\x45\x53\103\x2c\163\x6f\x72\x74\x20\101\x53\103\54\x69\144\x20\x41\123\x43")->column("\151\x64\54\160\151\x64\54\156\x61\155\145\x2c\x74\x79\160\x65\x2c\153\145\171\54\165\162\154\x2c\x61\160\160\x69\x64\x2c\160\x61\147\145\160\x61\x74\x68"); goto UnfoR; PZqpa: iKPMD: goto X2qAl; SMj9E: try { goto w7FVb; w7FVb: $app = \EasyWeChat\Factory::officialAccount(config("\167\170\x2e\157\146\x66\151\x63\x69\x61\x6c\137\x61\143\143\157\x75\156\164")); goto uCR4X; uCR4X: $res = $app->menu->create($rows); goto iO4NZ; iO4NZ: return $res; goto IN1WY; IN1WY: } catch (\Exception $e) { wexception("\xe5\x90\214\346\xad\xa5\345\244\261\xe8\264\245\357\xbc\232" . $e->getMessage()); } goto V_ulS; UmC6f: if (systemSetting("\x57\130\137\117\x46\106\x49\103\x45\137\101\x43\x43\117\125\x4e\124\x5f\x41\120\120\137\111\x44")) { goto iKPMD; } goto Wio0T; V_ulS: } }
