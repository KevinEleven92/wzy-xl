<?php
 namespace app\index\logic; use think\Db; use think\Log; use app\index\service\RequestContext; class Menu extends Base { public function getRow($id) { $row = Db::table("\155\x65\x6e\x75")->where("\151\x64", $id)->field(true)->find(); return $row; } public function getDefaultRow() { return ["\156\141\155\x65" => '', "\154\x65\166\x65\x6c" => 1, "\x70\151\144" => 0, "\143" => '', "\x61" => '', "\160\x61\162\x61\155\x73" => '', "\x69\x63\x6f\156\x5f\143\x6c\x73" => '', "\x6f\x72\x64\x65\x72\x5f\151\144" => 0]; } public function save($id, $data) { goto G7pjf; cXLCw: RA7AK: goto Df1O9; Z1AHZ: RKBKM: goto iS2MF; a32mF: return $id; goto qzcR4; NGOTb: if (!(isset($data["\156\x61\x6d\x65"]) && empty($data["\156\x61\155\145"]))) { goto RA7AK; } goto xU1ql; G03zR: yS4eE: goto a32mF; xU1ql: exception("\xe5\x90\x8d\347\xa7\xb0\xe4\xb8\x8d\xe8\x83\xbd\344\xb8\272\xe7\xa9\xba"); goto cXLCw; iS2MF: $data["\x6e\x61\x6d\145"] = trim($data["\x6e\141\155\x65"]); goto QuCew; EWOag: $id = Db::table("\155\145\156\165")->insert($data, false, true); goto G03zR; QuCew: if (!empty($data["\x6e\x61\155\145"])) { goto n0qQ1; } goto pvluw; nXPnb: goto yS4eE; goto Z1AHZ; pvluw: exception("\xe5\220\215\347\xa7\260\344\xb8\215\xe8\x83\xbd\xe4\270\272\xe7\251\xba"); goto rYmtG; rYmtG: n0qQ1: goto EWOag; G7pjf: $data["\x70\151\x64"] = intval($data["\160\x69\x64"]); goto QNvIb; QNvIb: if (empty($id)) { goto RKBKM; } goto NGOTb; Df1O9: Db::table("\155\145\x6e\165")->where("\x69\x64", $id)->update($data); goto nXPnb; qzcR4: } public function delete($id) { goto dpyG3; TzAbt: if (empty($child)) { goto d0KiJ; } goto Fft3x; Ob6C_: d0KiJ: goto D_5FZ; D_5FZ: $result = Db::table("\x6d\145\x6e\165")->where("\x69\x64", $id)->delete(); goto N5xYK; Fft3x: exception("\350\xaf\245\xe8\217\x9c\345\x8d\225\345\255\x98\345\x9c\250\345\xad\x90\350\x8f\234\345\215\x95\357\xbc\214\346\x97\240\346\263\x95\xe7\233\xb4\346\216\xa5\xe5\210\240\351\231\244"); goto Ob6C_; N5xYK: Db::table("\141\x64\155\x69\156\x5f\x72\157\154\x65\x5f\x6d\145\x6e\165")->where("\155\x65\156\x75\137\x69\x64", $id)->delete(); goto lCCv1; dpyG3: $child = Db::table("\155\145\156\165")->where("\x70\x69\x64", $id)->limit(1)->find(); goto TzAbt; lCCv1: return $result; goto JaKmJ; JaKmJ: } public function loadLeftMenuRecursively($pid, $ptext, &$nodes, $loadAll = false, $roleId = null) { goto aGJNA; CscDh: return; goto PoDgI; kXbCX: foreach ($rows as $key => $value) { goto hD4we; dbtaV: $node["\141"] = $value["\141"]; goto W30XR; Gseix: efNdX: goto bTdz4; Pqlye: $node["\164\145\x78\x74"] = $value["\156\141\155\x65"]; goto xzbva; YQfLS: goto efNdX; goto Yxhot; TEFt7: $node["\x6e\x61\155\x65"] = $value["\156\141\x6d\145"]; goto Pqlye; vFd4E: $node["\x69\x63\x6f\x6e\x43\x6c\x73"] = $value["\x69\x63\157\156\x5f\x63\x6c\163"]; goto GJecD; fV1LY: IHE1o: goto vFd4E; CPFiG: $breadcrumb = empty($ptext) ? $value["\x6e\141\155\x65"] : $ptext . "\40\46\147\x74\73\40" . $value["\156\x61\x6d\145"]; goto NxNlf; gUIdH: $node["\143\150\x69\x6c\144\162\145\x6e"] = $subNodes; goto hoGAG; IttMA: $node["\x75\x72\154"] = url($value["\143"] . "\57" . $value["\141"], $params); goto fV1LY; lxjaB: $nodes[] = $node; goto Gseix; GO_Ui: $params = "\x6c\x65\146\x74\115\145\156\165\x49\x64\x3d{$id}"; goto C8tE3; EmKfI: $node = array(); goto xsWUR; hxudv: if (!(!empty($value["\143"]) && !empty($value["\141"]))) { goto IHE1o; } goto GO_Ui; NxNlf: $node["\x61\164\x74\162\x69\x62\165\164\145\x73"] = ["\142\162\x65\141\x64\143\162\x75\x6d\x62" => $breadcrumb]; goto hxudv; pAhSX: $params .= $value["\160\141\x72\x61\x6d\x73"]; goto iyzL_; nwF_N: if (!(!$loadAll && !$this->checkIfSelectedRecursively($id, $roleId))) { goto n4tYF; } goto YQfLS; iyzL_: Mm6v1: goto IttMA; C8tE3: if (!$value["\160\141\162\x61\155\163"]) { goto Mm6v1; } goto GxB9o; GJecD: $subNodes = array(); goto OmztX; hD4we: $id = $value["\151\x64"]; goto nwF_N; Yxhot: n4tYF: goto EmKfI; V0MrQ: $node["\157\162\x64\145\x72\137\151\144"] = $value["\157\x72\144\x65\162\137\x69\x64"]; goto CPFiG; OmztX: $this->loadLeftMenuRecursively($id, $breadcrumb, $subNodes, $loadAll, $roleId); goto gFr5X; hoGAG: spXFq: goto lxjaB; gFr5X: if (empty($subNodes)) { goto spXFq; } goto gUIdH; W30XR: $node["\160\x61\x72\x61\155\163"] = $value["\x70\141\162\141\x6d\163"]; goto V0MrQ; xsWUR: $node["\x69\x64"] = $id; goto TEFt7; GxB9o: $params .= "\x26"; goto pAhSX; xzbva: $node["\x63"] = $value["\143"]; goto dbtaV; bTdz4: } goto TNZWN; TNZWN: hl968: goto CscDh; Ss9Ag: if (!empty($rows)) { goto wl7Id; } goto OaSVB; VHezA: $rows = Db::table("\155\145\x6e\x75")->where($conditions)->field("\151\x64\54\160\151\x64\54\x6c\145\166\x65\x6c\x2c\x6e\x61\155\x65\x2c\x69\x63\x6f\156\x5f\143\154\x73\54\143\x2c\x61\x2c\x70\141\x72\141\155\163\x2c\157\162\144\x65\x72\137\151\144")->order("\157\x72\x64\145\x72\137\151\144\x20\x41\x53\x43")->select(); goto Ss9Ag; aGJNA: $conditions = ["\160\x69\x64" => $pid]; goto VHezA; OaSVB: return; goto Xbe6g; Xbe6g: wl7Id: goto kXbCX; PoDgI: } protected function checkIfSelectedRecursively($id, $roleId) { goto O77EN; grZNi: return true; goto Ch8xF; ZbLx4: $subIds = Db::table("\x6d\x65\x6e\165")->where(array("\160\151\144" => $id))->field("\151\x64")->select(); goto MQ6c8; ZqWtq: y2kN3: goto ZkgjU; Ch8xF: CgadR: goto ZbLx4; O77EN: $roleMenu = Db::table("\x61\144\155\x69\156\137\x72\157\154\145\x5f\x6d\145\x6e\165")->where(array("\x72\x6f\x6c\x65\x5f\x69\x64" => $roleId, "\155\x65\156\x75\x5f\x69\144" => $id))->find(); goto nlaCa; uwKuk: return false; goto nuNew; nlaCa: if (!$roleMenu) { goto CgadR; } goto grZNi; MQ6c8: if (!empty($subIds)) { goto ZxKxu; } goto uwKuk; YuJAR: foreach ($subIds as $key => $value) { goto nUDqi; pxnJj: NfcO3: goto tbP_h; EIXSD: if (!$result) { goto NfcO3; } goto S32Yl; nUDqi: $subId = $value["\x69\x64"]; goto GthD4; tbP_h: CeY55: goto cQcHK; GthD4: $result = $this->checkIfSelectedRecursively($subId, $roleId); goto EIXSD; S32Yl: return true; goto pxnJj; cQcHK: } goto ZqWtq; nuNew: ZxKxu: goto YuJAR; ZkgjU: return false; goto EbRzh; EbRzh: } public function wxLoadMenus() { goto QhXrA; rwUxm: F3_1t: goto SwMy2; QxYmY: foreach ($rows as $id => $v) { goto l9TgB; l9TgB: $rows[$id]["\151\143\x6f\156\x43\154\163"] = "\x66\141\x20\x66\x61\x20\x66\141\x2d\143\151\162\143\154\145"; goto f4j2c; BPFet: $rows[$v["\x70\x69\x64"]]["\143\x68\x69\x6c\144\162\x65\x6e"][] = $rows[$id]; goto GQOxM; CnBEp: lerLm: goto SfM6Z; mZ09k: goto lerLm; goto mfbfs; GQOxM: unset($rows[$id]); goto CnBEp; f4j2c: if (!empty($rows[$id]["\160\151\x64"])) { goto k1w19; } goto mZ09k; mfbfs: k1w19: goto BPFet; SfM6Z: } goto rwUxm; vuptQ: $rows = []; goto zqpN5; Ss_hd: if (!empty($rows)) { goto sQLod; } goto vuptQ; QhXrA: $rows = Db::table("\x77\x78\x5f\x6d\x65\156\x75\163")->order("\160\x69\x64\x20\144\x65\x73\143\54\163\x6f\x72\164\40\x61\163\x63\x2c\x69\x64\x20\x61\x73\x63")->column("\151\x64\54\160\151\x64\x2c\x73\157\x72\x74\54\x6e\141\155\x65\54\164\x79\x70\x65\54\x6b\x65\171\54\x75\x72\x6c\54\141\160\160\151\144\54\x70\x61\x67\x65\160\x61\x74\x68"); goto Ss_hd; SwMy2: return array_values($rows); goto zkcEm; zqpN5: sQLod: goto QxYmY; zkcEm: } public function wxMenuSave($id, $pid, $formData) { goto jBJ5E; oFhiS: $max = 5; goto qTwh2; t4aHJ: $type = "\xe4\270\200\xe7\272\247\350\217\x9c\xe5\215\x95"; goto er877; RHjVk: $max = 3; goto t4aHJ; HeF0y: $id = Db::table("\x77\170\x5f\155\x65\x6e\165\x73")->insertGetId($formData); goto Jrd14; hZWlg: uUg_a: goto HeF0y; jBJ5E: if ($id) { goto OgcZ0; } goto YZrbe; bRKrM: OgcZ0: goto xV_nd; s08UN: $count = Db::table("\167\170\x5f\155\x65\156\x75\x73")->where(["\160\151\x64" => ["\147\x74", 0]])->count(); goto JzUOH; er877: $count = Db::table("\167\x78\x5f\x6d\145\156\165\163")->where(["\x70\x69\x64" => 0])->count(); goto Y5MzG; gh5Hp: QK_oF: goto eYO4n; Jrd14: goto QK_oF; goto bRKrM; Uxg7p: if (!($count == $max)) { goto uUg_a; } goto kgEj4; JzUOH: goto DaWdn; goto LlKKF; Y5MzG: DaWdn: goto Uxg7p; kgEj4: wexception("\346\x9c\x80\xe5\244\232\346\267\xbb\xe5\212\240{$max}\xe4\xb8\xaa{$type}"); goto hZWlg; LlKKF: haftR: goto RHjVk; YZrbe: if (empty($data["\x70\x69\144"])) { goto haftR; } goto oFhiS; xV_nd: Db::table("\167\x78\x5f\155\145\156\x75\x73")->where(["\151\x64" => $id])->update($formData); goto gh5Hp; qTwh2: $type = "\xe4\xba\214\347\272\xa7\xe8\217\x9c\xe5\x8d\x95"; goto s08UN; eYO4n: } public function wxMenuSync() { goto W9qKF; ACvn2: wexception("\xe5\x90\x8c\xe6\xad\245\xe5\244\xb1\xe8\264\245\357\xbc\232\346\x9c\xaa\xe9\205\215\xe7\275\xae\xe5\x85\xac\344\274\x97\xe5\x8f\xb7\xe5\217\202\xe6\x95\xb0"); goto klHRm; IXtgL: foreach ($rows as $id => $v) { goto YJMck; joRCy: $pid = $v["\x70\151\144"]; goto QTqh9; afKOt: WAaFL: goto PvE0W; Z1IwL: unset($rows[$id]); goto HmJOh; Pe9nz: ulFd2: goto FXk77; QTqh9: if ($pid) { goto qFVZy; } goto zuGvt; YJMck: $menu = ["\x6e\141\155\x65" => $v["\156\x61\155\x65"]]; goto uoF2j; zuGvt: if (!(isset($rows[$id]["\x73\165\142\x5f\x62\165\x74\164\157\156"]) && $rows[$id]["\x73\165\x62\137\x62\165\x74\x74\x6f\156"])) { goto WAaFL; } goto FTU6I; LChca: AsNJA: goto UpwSn; o7WSj: nbu4m: goto BEB1e; yA9_A: if (isset($rows[$pid]["\163\x75\x62\137\142\x75\x74\164\x6f\x6e"])) { goto nbu4m; } goto zQINY; HmJOh: R4IEk: goto Pe9nz; FTU6I: $menu["\x73\165\142\137\142\x75\x74\164\157\x6e"] = $rows[$id]["\x73\165\142\x5f\x62\165\164\164\157\156"]; goto afKOt; zQINY: $rows[$pid]["\x73\x75\142\137\142\x75\x74\164\157\x6e"] = []; goto o7WSj; BEB1e: $rows[$pid]["\163\165\x62\137\142\x75\x74\164\157\x6e"][] = $menu; goto Z1IwL; Qrqu4: goto R4IEk; goto x6ik0; uoF2j: switch ($v["\x74\x79\160\145"]) { case "\166\151\145\167": goto LiW6S; ge83u: $menu["\165\162\x6c"] = $v["\x75\162\154"]; goto JMERS; LiW6S: $menu["\x74\x79\x70\x65"] = $v["\x74\171\x70\x65"]; goto ge83u; JMERS: goto xoMv4; goto iSc_j; iSc_j: case "\155\x69\156\x69\160\x72\x6f\147\x72\x61\x6d": goto e3L5w; AwIz0: $menu["\141\160\x70\x69\x64"] = $v["\x61\160\x70\151\144"]; goto C5Mrt; nRUXR: goto xoMv4; goto Moaqb; e3L5w: $menu["\x74\x79\x70\x65"] = $v["\164\x79\x70\x65"]; goto Ke6T1; C5Mrt: $menu["\x70\141\x67\145\x70\x61\164\150"] = $v["\160\141\x67\145\160\141\x74\150"]; goto nRUXR; Ke6T1: $menu["\x75\162\154"] = $v["\165\x72\154"]; goto AwIz0; Moaqb: case "\143\x6c\151\143\153": goto gWhD0; n6yHw: goto xoMv4; goto WVhio; CYjJY: $menu["\x6b\x65\x79"] = $v["\153\145\171"]; goto n6yHw; gWhD0: $menu["\164\171\x70\145"] = $v["\x74\x79\160\145"]; goto CYjJY; WVhio: } goto LChca; x6ik0: qFVZy: goto yA9_A; UpwSn: xoMv4: goto joRCy; PvE0W: $rows[$id] = $menu; goto Qrqu4; FXk77: } goto DpdUR; rFXvY: try { goto fxGkt; XsTq1: $res = $app->menu->create($rows); goto Th3VD; fxGkt: $app = \EasyWeChat\Factory::officialAccount(config("\x77\170\x2e\x6f\x66\x66\151\x63\x69\x61\x6c\x5f\x61\143\x63\x6f\x75\156\x74")); goto XsTq1; Th3VD: return $res; goto hlcQy; hlcQy: } catch (\Exception $e) { wexception("\345\220\x8c\346\255\xa5\345\xa4\xb1\350\xb4\xa5\xef\274\232" . $e->getMessage()); } goto qeOKW; NU2RH: wexception("\xe6\x97\240\350\246\x81\xe5\x90\x8c\xe6\xad\245\347\x9a\204\350\217\234\xe5\215\225\346\x95\260\xe6\215\256"); goto UzU7t; UzU7t: l8Pf5: goto IXtgL; NB0Ik: $rows = Db::table("\167\x78\137\x6d\x65\156\x75\x73")->order("\x70\x69\x64\x20\104\105\x53\x43\54\x73\x6f\x72\164\x20\101\x53\103\x2c\151\x64\40\x41\x53\103")->column("\151\x64\x2c\160\151\144\54\x6e\141\155\145\x2c\164\171\x70\145\54\x6b\145\171\54\x75\162\154\54\x61\x70\160\x69\144\54\160\x61\147\x65\x70\141\164\x68"); goto hkawU; klHRm: SBhX7: goto NB0Ik; W9qKF: if (systemSetting("\127\130\x5f\117\106\106\111\103\105\x5f\x41\103\103\117\x55\116\x54\x5f\x41\x50\120\137\x49\x44")) { goto SBhX7; } goto ACvn2; fkcxE: $rows = array_values($rows); goto ePbSZ; DpdUR: DEl8R: goto fkcxE; hkawU: if (!empty($rows)) { goto l8Pf5; } goto NU2RH; ePbSZ: wxPaySetting(); goto rFXvY; qeOKW: } }
