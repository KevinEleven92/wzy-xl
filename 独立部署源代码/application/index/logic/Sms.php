<?php
 namespace app\index\logic; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs as IndexDefs; class Sms extends Base { public function sendCaptcha($tel, $len = 6, $id = '') { goto K0Vmq; x2yrF: Session::set("\103\x41\120\x54\103\x48\x41\137" . $id, $code); goto zcDHk; KmSJG: if ($result) { goto ujqdd; } goto J6Em8; lesu1: $TemplateCode = systemSetting("\101\x4c\111\x59\125\116\137\x53\x4d\x53\137\103\101\x50\124\103\110\101\x5f\124\105\115\x50\114\x41\x54\105"); goto EETPU; qetjy: $code = ''; goto aDFAd; A8idB: LXd1A: goto x9Yco; tbxLg: if (!($sessionTimestamp && $now >= $sessionTimestamp && $now - $sessionTimestamp < 30)) { goto HOR7o; } goto kX_rw; OtCzi: if ($tel == "\61\63\x35\x31\60\x31\60\65\70\x35\70") { goto N53MA; } goto lS6dW; Ppy9L: eahag: goto NzwNU; Mb9iP: nGUz0: goto Si9fI; x9Yco: $TemplateParam = json_encode(["\x6e\x75\x6d\142\x65\x72" => $code], JSON_UNESCAPED_UNICODE); goto lesu1; xR7_7: HOR7o: goto OtCzi; NsaZQ: Session::set("\103\101\x50\124\103\110\101\137\x4d\117\102\111\x4c\x45\x5f" . $id, $tel); goto x2yrF; tIAnt: ujqdd: goto GUYvZ; ngndQ: $code .= $chars[rand(0, $len - 1)]; goto D82uT; XbNvr: exception("\xe7\237\xad\xe4\xbf\xa1\xe6\250\241\346\235\277\346\234\252\xe9\x85\215\347\275\xae"); goto Mb9iP; g2iAp: $i = 0; goto qetjy; Si9fI: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto KmSJG; zcDHk: return true; goto ZiOuc; EETPU: if (!empty($TemplateCode)) { goto nGUz0; } goto XbNvr; dXgP2: goto F_mJ1; goto A8idB; lvYJr: $code = "\x31\61\x31\x31\61\61"; goto LTN98; D82uT: $i++; goto dXgP2; K0Vmq: if (validateMobile($tel)) { goto eahag; } goto MuXGD; J6Em8: exception("\347\x9f\xad\344\xbf\241\345\x8f\221\351\x80\x81\350\xb0\203\347\224\xa8\xe5\xa4\261\xe8\264\xa5"); goto tIAnt; HD2SS: Session::set("\x43\x41\120\124\x43\x48\x41\137\x54\x49\115\x45\x53\124\101\x4d\120\x5f" . $id, time()); goto NsaZQ; NzwNU: $now = time(); goto Km4Bq; aDFAd: F_mJ1: goto ej3rN; GUYvZ: goto lnckf; goto v22N2; v22N2: N53MA: goto lvYJr; lS6dW: $chars = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]; goto g2iAp; LTN98: lnckf: goto HD2SS; ej3rN: if (!($i < $len)) { goto LXd1A; } goto ngndQ; Km4Bq: $sessionTimestamp = Session::get("\x43\x41\x50\124\x43\110\101\x5f\124\111\x4d\105\123\124\x41\x4d\x50\x5f" . $id); goto tbxLg; MuXGD: exception("\346\x89\x8b\xe6\234\272\xe5\x8f\267\347\xa0\x81\346\x97\240\346\225\x88"); goto Ppy9L; kX_rw: exception("\xe5\x8f\221\xe9\x80\x81\350\xbf\207\344\272\x8e\351\242\221\347\xb9\x81\xef\274\x8c\xe8\257\xb7\347\250\215\xe5\x80\231\xe5\206\x8d\xe8\xaf\225"); goto xR7_7; ZiOuc: } public function verifyCaptcha($mobile, $code, $id = '') { goto kMNT0; I99cp: vzHZB: goto ftde2; ygyEu: if (!(empty($sessionCode) || empty($sessionMobile) || empty($sessionTimestamp))) { goto wLRkd; } goto c1sfR; pysRt: wLRkd: goto lD9vj; X3Vy5: return false; goto i9wdc; wDcKC: Session::delete("\103\x41\x50\124\103\110\x41\x5f\124\111\x4d\x45\123\124\101\115\x50\x5f" . $id); goto wabws; T5UTy: Session::delete("\x43\101\120\124\103\x48\x41\x5f" . $id); goto Cc1H4; Cc1H4: Session::delete("\x43\101\x50\124\x43\110\101\x5f\x4d\117\x42\111\x4c\105\137" . $id); goto wDcKC; ftde2: if (!($sessionCode == $code && $sessionMobile == $mobile)) { goto n0Gn8; } goto T5UTy; ovHl6: return false; goto I99cp; XPDzH: Session::delete("\x43\x41\120\x54\103\110\x41\137" . $id); goto JdWcN; OwejO: $sessionTimestamp = Session::get("\x43\101\x50\x54\103\x48\101\137\124\111\x4d\x45\123\124\x41\x4d\x50\x5f" . $id); goto ygyEu; lD9vj: $now = time(); goto xV3Ua; wabws: return true; goto o66mN; kMNT0: $sessionCode = Session::get("\x43\x41\x50\124\103\110\101\137" . $id); goto c5NV2; JdWcN: Session::delete("\x43\x41\120\124\103\x48\101\137\115\117\102\x49\x4c\x45\x5f" . $id); goto vg_aO; xV3Ua: if (!($now >= $sessionTimestamp && $now - $sessionTimestamp > 120)) { goto vzHZB; } goto XPDzH; c1sfR: return false; goto pysRt; c5NV2: $sessionMobile = Session::get("\x43\101\x50\124\x43\x48\101\x5f\115\x4f\x42\x49\x4c\x45\x5f" . $id); goto OwejO; vg_aO: Session::delete("\x43\x41\120\124\103\x48\101\x5f\x54\x49\115\x45\x53\124\x41\x4d\x50\x5f" . $id); goto ovHl6; o66mN: n0Gn8: goto X3Vy5; i9wdc: } public function sendAppoitOrderToExpert($tel, $time) { goto cuYOK; oMHgQ: $TemplateCode = systemSetting("\x41\114\111\x59\125\x4e\x5f\x53\x4d\123\x5f\101\x50\120\x4f\x49\116\124\137\124\x4f\x5f\x45\130\120\105\122\124\x5f\x54\x45\x4d\x50\114\101\x54\x45"); goto Bbthq; s_ZkD: QNyWa: goto g5KVG; t7kaY: return false; goto s_ZkD; Uq54u: Log::notice("\x73\x65\x6e\144\x20\x61\160\160\157\151\x6e\164\40\157\162\x64\145\x72\x20\x73\155\x73\40\164\x6f\40\x65\x78\160\x65\162\x74\72\40" . $tel); goto cIwmK; cuYOK: if (validateMobile($tel)) { goto QNyWa; } goto t7kaY; hYATf: return false; goto pPoAW; q6hrG: ujez5: goto Uq54u; Bbthq: if (!empty($TemplateCode)) { goto ujez5; } goto m1YEK; vd6dP: return true; goto UdhBB; cIwmK: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto ui8sJ; pPoAW: Wk5Ri: goto vd6dP; g5KVG: $TemplateParam = json_encode(["\164\x69\x6d\x65" => $time], JSON_UNESCAPED_UNICODE); goto oMHgQ; ui8sJ: if ($result) { goto Wk5Ri; } goto hYATf; m1YEK: return false; goto q6hrG; UdhBB: } public function sendAppoitOrderToSupport($tel, $time) { goto wptEf; AaJCj: A90jL: goto FFoNr; ARImy: if (!empty($TemplateCode)) { goto A90jL; } goto MKYa7; w40ke: $TemplateParam = json_encode(["\x74\151\155\x65" => $time], JSON_UNESCAPED_UNICODE); goto cvTaB; cvTaB: $TemplateCode = systemSetting("\101\x4c\111\x59\x55\x4e\137\x53\x4d\123\x5f\x41\x50\x50\117\111\x4e\124\x5f\x54\117\x5f\x53\x55\120\x50\x4f\x52\x54\x5f\x54\x45\x4d\120\x4c\x41\124\105"); goto ARImy; lmr6E: g2HZH: goto stBib; FFoNr: Log::notice("\163\145\x6e\144\x20\x61\160\x70\157\151\156\164\40\x6f\x72\x64\145\x72\40\163\x6d\x73\x20\164\x6f\x20\x73\165\160\x70\157\162\164\72\40" . $tel); goto O5jo7; ZhINW: return false; goto lmr6E; D8Xho: jVA0W: goto w40ke; MKYa7: return false; goto AaJCj; O5jo7: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto o82hh; o82hh: if ($result) { goto g2HZH; } goto ZhINW; stBib: return true; goto G4GEt; VsDB3: return false; goto D8Xho; wptEf: if (validateMobile($tel)) { goto jVA0W; } goto VsDB3; G4GEt: } public function sendAppoitOrderToCustomer($tel, $time, $addr) { goto sM_yO; Xi4W7: $TemplateParam = json_encode(["\164\151\155\145" => $time, "\x61\x64\144\162\x65\x73\x73" => $addr], JSON_UNESCAPED_UNICODE); goto PTc2v; wawSE: return true; goto ylutW; LncxH: if (!empty($TemplateCode)) { goto XhH9M; } goto H3Jd8; Blggq: return false; goto E3e2Q; upica: HMPYv: goto wawSE; fPKBA: Log::notice("\x73\x65\156\144\x20\141\x70\160\x6f\x69\156\x74\x20\157\162\x64\145\x72\40\163\155\x73\x20\x74\x6f\x20\x63\x75\163\164\157\x6d\x65\162\x3a\x20" . $tel); goto V2Yh1; V2Yh1: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto AYP8s; PTc2v: $TemplateCode = systemSetting("\101\114\x49\x59\x55\x4e\137\x53\115\x53\x5f\101\120\120\x4f\x49\116\124\137\124\117\137\x43\125\x53\x54\117\115\x45\122\x5f\124\105\x4d\x50\114\x41\x54\x45"); goto LncxH; H3Jd8: return false; goto Y6Caw; qSQmt: return false; goto upica; E3e2Q: Q7V8N: goto Xi4W7; Y6Caw: XhH9M: goto fPKBA; AYP8s: if ($result) { goto HMPYv; } goto qSQmt; sM_yO: if (validateMobile($tel)) { goto Q7V8N; } goto Blggq; ylutW: } private function send($TemplateCode, $TemplateParam, $phoneNumber) { goto I_5Bn; jrL3g: $SignatureMethod = "\x48\115\x41\103\55\x53\x48\x41\61"; goto ngKFv; ftv4P: foreach ($params as $key => $value) { $sortedQueryStringTmp .= "\46" . $this->encode($key) . "\75" . $this->encode($value); d1_9n: } goto Og0uM; sZqv4: $AccessKeyId = systemSetting("\101\114\111\131\x55\x4e\x5f\x53\x4d\x53\x5f\101\x43\103\105\x53\123\113\105\131\137\x49\x44"); goto IqWgJ; IqWgJ: $AccessKeySecret = systemSetting("\x41\114\x49\x59\x55\x4e\x5f\123\115\123\137\x41\x43\103\105\123\x53\x4b\x45\x59\x5f\x53\105\103\x52\x45\x54"); goto jrL3g; QMSWW: if ($responseContent) { goto amLs5; } goto xNBTX; e6Cij: $sign = base64_encode(hash_hmac("\x73\x68\x61\61", $stringToSign, $AccessKeySecret . "\x26", true)); goto QKpob; ngKFv: $SignatureVersion = "\61\x2e\60"; goto mEXYv; JZJmw: $Action = "\123\145\x6e\144\x53\155\x73"; goto zJxLG; nSRvF: if ($responseObj) { goto RxrRU; } goto gCh43; j97K_: amLs5: goto DJY26; N53St: $stringToSign = "\x47\105\124\x26" . $this->encode("\x2f") . "\46" . $this->encode(substr($sortedQueryStringTmp, 1)); goto e6Cij; pQyJX: return false; goto DoIvx; cjogf: return false; goto vMEVQ; xNBTX: Log::error("\x66\141\x69\154\145\x64\x20\164\x6f\x20\147\x65\x74\x20\x72\x65\163\160\157\156\163\x65\x20\x66\162\x6f\155\x20\141\154\151\x20\x73\155\x73\54\40\164\x65\154\x3a{$phoneNumber}"); goto M0HhG; M0HhG: return false; goto j97K_; mEXYv: $SignatureNonce = uniqid(mt_rand(0, 0xffff), true); goto vgJq8; ZzPdz: $sortedQueryStringTmp = ''; goto ftv4P; Og0uM: Q3E8T: goto N53St; DoIvx: RxrRU: goto QhuL1; x1tmP: $url = "\150\x74\x74\160\x73\72\x2f\57\x64\171\x73\x6d\163\141\160\151\x2e\x61\154\x69\171\165\x6e\143\x73\56\x63\157\x6d\x2f\x3f\x53\151\147\156\x61\x74\165\162\x65\75{$Signature}{$sortedQueryStringTmp}"; goto r73a2; xygLh: $Version = "\x32\60\61\67\55\x30\65\55\x32\x35"; goto fVVWL; r73a2: $responseContent = file_get_contents($url); goto QMSWW; PYR9_: Log::error("\x66\x61\151\x6c\x65\144\x20\x74\x6f\x20\x73\145\x6e\144\x20\163\155\x73\40\x76\151\x61\40\141\154\151\54\40\x74\145\154\x3a{$phoneNumber}\x2c\x20" . $responseContent); goto cjogf; QhuL1: if (!(isset($responseObj["\103\157\x64\145"]) && $responseObj["\x43\x6f\x64\x65"] == "\x4f\x4b")) { goto MwvRV; } goto pP6Az; DJY26: $responseObj = json_decode($responseContent, true); goto nSRvF; pP6Az: Log::notice("\x73\165\x63\143\x65\x73\163\40\x74\x6f\40\x73\145\x6e\144\x20\155\x65\x73\163\141\147\x65\40\164\157\x20\x74\x65\x6c\72{$phoneNumber}\x2c\x20\164\x65\155\160\x6c\141\x74\145\x3a\x20{$TemplateCode}"); goto UBr6E; gCh43: Log::error("\146\x61\151\154\x65\x64\x20\x74\157\x20\x64\145\143\157\144\145\x20\141\x6c\x69\40\163\155\163\x20\162\145\163\160\x6f\x6e\x73\x65\54\x20\164\145\x6c\x3a{$phoneNumber}\54\40" . $responseContent); goto pQyJX; vgJq8: $Timestamp = gmdate("\x59\55\155\x2d\x64\x5c\124\110\x3a\x69\72\x73\134\132"); goto s8BKO; Xls_2: ksort($params); goto ZzPdz; fVVWL: $params = ["\120\150\157\x6e\x65\x4e\165\x6d\x62\145\162\x73" => $phoneNumber, "\x53\151\x67\x6e\x4e\x61\155\145" => $SignName, "\124\145\x6d\x70\154\141\164\145\x43\x6f\144\145" => $TemplateCode, "\x41\143\x63\x65\163\x73\113\145\x79\x49\144" => $AccessKeyId, "\101\143\164\151\157\156" => $Action, "\x46\x6f\162\x6d\141\164" => $Format, "\x54\x65\x6d\160\154\141\164\x65\x50\x61\x72\141\x6d" => $TemplateParam, "\x53\151\147\156\141\x74\x75\x72\x65\x4d\145\164\150\x6f\x64" => $SignatureMethod, "\x53\151\147\x6e\x61\x74\165\x72\x65\116\x6f\156\x63\x65" => $SignatureNonce, "\x53\151\x67\x6e\x61\164\165\x72\x65\x56\x65\162\163\151\157\x6e" => $SignatureVersion, "\x54\x69\x6d\145\x73\x74\141\x6d\160" => $Timestamp, "\x56\x65\x72\163\151\x6f\x6e" => $Version]; goto Xls_2; RvrI6: return false; goto RoGzm; iDXmE: MwvRV: goto PYR9_; UbcWh: $params["\x53\x69\147\156\x61\x74\165\x72\x65"] = $Signature; goto x1tmP; UBr6E: return true; goto iDXmE; I_5Bn: if (validateMobile($phoneNumber)) { goto vWunk; } goto RvrI6; QKpob: $Signature = $this->encode($sign); goto UbcWh; zJxLG: $SignName = systemSetting("\x41\114\111\x59\x55\x4e\x5f\x53\x4d\123\x5f\x53\111\x47\x4e\116\x41\x4d\105"); goto sZqv4; s8BKO: $Format = "\152\163\x6f\156"; goto xygLh; RoGzm: vWunk: goto JZJmw; vMEVQ: } private function encode($str) { goto C7jFE; C7jFE: $res = urlencode($str); goto ouHir; uhDQf: return $res; goto Khe0N; WmdlF: $res = preg_replace("\x2f\x25\67\105\x2f", "\176", $res); goto uhDQf; ouHir: $res = preg_replace("\57\x5c\x2b\x2f", "\45\x32\x30", $res); goto tAO9H; tAO9H: $res = preg_replace("\x2f\x5c\52\57", "\x25\x32\101", $res); goto WmdlF; Khe0N: } }
