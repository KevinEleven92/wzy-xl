<?php
 namespace app\index\logic; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs as IndexDefs; class Sms extends Base { public function sendCaptcha($tel, $len = 6, $id = '') { goto J5LHW; e4vb_: $i = 0; goto UIIYS; TBa18: if (!empty($TemplateCode)) { goto CCsK3; } goto pMXIP; aTqr_: CCsK3: goto cYYuY; uAtGe: $TemplateParam = json_encode(["\x6e\165\x6d\x62\x65\162" => $code], JSON_UNESCAPED_UNICODE); goto i_Gpz; jrr2G: if (!($sessionTimestamp && $now >= $sessionTimestamp && $now - $sessionTimestamp < 30)) { goto plbhQ; } goto O9NLp; Rd7WZ: plbhQ: goto XMKIj; nhE39: $code = "\61\x31\61\61\x31\61"; goto EHV6O; UIIYS: $code = ''; goto Qf0LL; ve1FV: Session::set("\x43\101\120\124\103\110\101\x5f\124\111\x4d\105\123\124\101\115\120\137" . $id, time()); goto pQFbZ; UPfW3: if ($result) { goto FdI38; } goto b4hU_; Etyft: $chars = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]; goto e4vb_; tLx4N: goto i1L3p; goto s1ATG; shUGS: Session::set("\103\x41\120\x54\x43\110\x41\137" . $id, $code); goto IYmLs; CBxxx: $i++; goto Cs6Ev; EHV6O: i1L3p: goto ve1FV; O9NLp: exception("\345\x8f\221\351\x80\201\xe8\277\x87\344\272\216\351\242\221\xe7\xb9\x81\xef\274\x8c\350\xaf\xb7\347\xa8\215\xe5\x80\231\345\x86\215\xe8\xaf\225"); goto Rd7WZ; s1ATG: iZOoP: goto nhE39; ERKQO: $now = time(); goto oha1K; Z85HI: if (!($i < $len)) { goto qqgmY; } goto Q2F_M; Cs6Ev: goto Uxhn3; goto qYzi3; b4hU_: exception("\xe7\x9f\xad\344\277\241\xe5\x8f\221\xe9\200\201\350\260\203\xe7\x94\250\xe5\244\261\xe8\264\245"); goto Ggkga; qYzi3: qqgmY: goto uAtGe; i_Gpz: $TemplateCode = systemSetting("\x41\114\111\x59\125\x4e\137\x53\x4d\123\137\x43\x41\120\x54\x43\110\101\x5f\x54\105\x4d\120\x4c\x41\124\x45"); goto TBa18; pMXIP: exception("\xe7\x9f\255\344\277\241\346\250\xa1\xe6\235\xbf\xe6\234\xaa\xe9\x85\x8d\347\xbd\256"); goto aTqr_; Qf0LL: Uxhn3: goto Z85HI; TxhB_: Qks52: goto ERKQO; J5LHW: if (validateMobile($tel)) { goto Qks52; } goto qoi60; XMKIj: if ($tel == "\61\x33\65\61\60\61\60\x35\70\x35\70") { goto iZOoP; } goto Etyft; oha1K: $sessionTimestamp = Session::get("\x43\x41\120\x54\x43\110\x41\x5f\x54\111\x4d\x45\x53\124\101\x4d\x50\x5f" . $id); goto jrr2G; qoi60: exception("\xe6\x89\x8b\xe6\x9c\xba\xe5\x8f\xb7\xe7\240\201\xe6\x97\240\346\225\210"); goto TxhB_; pQFbZ: Session::set("\x43\101\120\124\x43\110\101\x5f\x4d\x4f\x42\111\x4c\x45\x5f" . $id, $tel); goto shUGS; cYYuY: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto UPfW3; Ggkga: FdI38: goto tLx4N; IYmLs: return true; goto eWn9G; Q2F_M: $code .= $chars[rand(0, $len - 1)]; goto CBxxx; eWn9G: } public function verifyCaptcha($mobile, $code, $id = '') { goto CDXij; VW_qe: return false; goto JUEOZ; hJMv5: Session::delete("\x43\x41\120\x54\103\110\101\137\x54\x49\115\x45\123\x54\101\x4d\120\137" . $id); goto OBC1O; opq_2: if (!($now >= $sessionTimestamp && $now - $sessionTimestamp > 120)) { goto FPfUt; } goto f6uAb; iVKmX: if (!($sessionCode == $code && $sessionMobile == $mobile)) { goto aW8vh; } goto Jbrtr; gKsx3: if (!(empty($sessionCode) || empty($sessionMobile) || empty($sessionTimestamp))) { goto cfXHR; } goto VW_qe; OBC1O: return false; goto nexhJ; CDXij: $sessionCode = Session::get("\103\x41\120\x54\x43\110\101\x5f" . $id); goto hC9EN; nexhJ: FPfUt: goto iVKmX; hC9EN: $sessionMobile = Session::get("\x43\x41\120\x54\x43\x48\101\x5f\115\x4f\102\x49\114\x45\137" . $id); goto Hrx1l; gpcB0: aW8vh: goto n3sdK; i6ZJL: Session::delete("\x43\x41\x50\124\x43\110\101\137\x4d\117\102\111\x4c\x45\x5f" . $id); goto hJMv5; qgfzW: Session::delete("\103\101\x50\124\103\110\x41\137\115\x4f\102\x49\114\x45\137" . $id); goto YLPue; Hrx1l: $sessionTimestamp = Session::get("\103\x41\120\124\103\110\x41\x5f\x54\111\115\105\x53\124\101\x4d\x50\137" . $id); goto gKsx3; sa96z: return true; goto gpcB0; f6uAb: Session::delete("\103\x41\x50\x54\103\110\101\x5f" . $id); goto i6ZJL; DGrbH: $now = time(); goto opq_2; YLPue: Session::delete("\x43\x41\120\x54\103\x48\101\137\x54\111\x4d\105\123\124\x41\115\x50\x5f" . $id); goto sa96z; JUEOZ: cfXHR: goto DGrbH; n3sdK: return false; goto OJjFN; Jbrtr: Session::delete("\103\101\120\x54\x43\x48\101\137" . $id); goto qgfzW; OJjFN: } public function sendAppoitOrderToExpert($tel, $time) { goto MqLNm; SKVy4: $TemplateCode = systemSetting("\x41\x4c\x49\x59\x55\x4e\137\x53\115\123\x5f\x41\120\x50\x4f\111\x4e\124\x5f\124\117\137\x45\x58\120\105\x52\x54\137\x54\x45\x4d\x50\114\101\124\105"); goto IiUQb; xI2lZ: D2Vgx: goto caEVl; IiUQb: if (!empty($TemplateCode)) { goto RxkMz; } goto TCwJo; MqLNm: if (validateMobile($tel)) { goto NfxxK; } goto XYx_5; TCwJo: return false; goto qDiCW; qDiCW: RxkMz: goto pxNQH; zJXZR: return false; goto xI2lZ; hIZim: NfxxK: goto QTXNg; XYx_5: return false; goto hIZim; i0PBs: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto IiAOl; caEVl: return true; goto k81V3; QTXNg: $TemplateParam = json_encode(["\x74\151\x6d\x65" => $time], JSON_UNESCAPED_UNICODE); goto SKVy4; IiAOl: if ($result) { goto D2Vgx; } goto zJXZR; pxNQH: Log::notice("\x73\145\x6e\144\40\141\x70\160\157\151\x6e\x74\x20\x6f\x72\x64\x65\162\40\163\155\163\40\164\x6f\40\145\170\x70\x65\162\x74\x3a\40" . $tel); goto i0PBs; k81V3: } public function sendAppoitOrderToSupport($tel, $time) { goto O1WnV; Xtekf: return false; goto c5uJu; vsg5a: $TemplateCode = systemSetting("\101\114\111\x59\125\116\137\123\x4d\123\x5f\101\120\x50\x4f\x49\x4e\x54\137\124\117\x5f\x53\125\x50\x50\117\122\124\x5f\124\105\x4d\x50\114\101\124\105"); goto Venm6; Venm6: if (!empty($TemplateCode)) { goto fzs_7; } goto tZhMY; jHeaq: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto hUuJ1; P3y4d: return true; goto cISQ1; tZhMY: return false; goto gSRCh; FRBo0: f2c_9: goto P3y4d; lPG1W: Log::notice("\x73\145\156\x64\40\x61\x70\x70\157\151\x6e\164\x20\157\x72\x64\x65\x72\x20\163\155\163\x20\164\157\x20\x73\165\160\160\x6f\162\x74\72\x20" . $tel); goto jHeaq; gSRCh: fzs_7: goto lPG1W; c5uJu: F8gOs: goto C3tbv; O1WnV: if (validateMobile($tel)) { goto F8gOs; } goto Xtekf; hUuJ1: if ($result) { goto f2c_9; } goto qvXDZ; qvXDZ: return false; goto FRBo0; C3tbv: $TemplateParam = json_encode(["\x74\x69\155\145" => $time], JSON_UNESCAPED_UNICODE); goto vsg5a; cISQ1: } public function sendAppoitOrderToCustomer($tel, $time, $addr) { goto AUQp4; i129A: return false; goto gadzc; D1biZ: if ($result) { goto lInhg; } goto jeCQI; jeCQI: return false; goto XO1g9; fM1i4: return true; goto ARdvE; nHD43: if (!empty($TemplateCode)) { goto la03Y; } goto i129A; x9wIa: return false; goto bC1bD; XO1g9: lInhg: goto fM1i4; bC1bD: YJGDK: goto XbTJO; Dandg: $TemplateCode = systemSetting("\101\x4c\x49\x59\x55\x4e\x5f\123\x4d\x53\137\x41\x50\120\117\x49\116\124\137\x54\117\137\x43\125\x53\x54\117\x4d\x45\x52\x5f\x54\105\115\120\114\x41\124\x45"); goto nHD43; LHxmg: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto D1biZ; XbTJO: $TemplateParam = json_encode(["\x74\x69\155\145" => $time, "\141\144\x64\x72\x65\163\x73" => $addr], JSON_UNESCAPED_UNICODE); goto Dandg; gadzc: la03Y: goto h3PlM; h3PlM: Log::notice("\163\145\x6e\x64\40\141\x70\x70\x6f\x69\x6e\x74\x20\157\162\144\145\x72\40\x73\x6d\x73\40\164\x6f\x20\143\165\163\164\x6f\x6d\x65\x72\x3a\x20" . $tel); goto LHxmg; AUQp4: if (validateMobile($tel)) { goto YJGDK; } goto x9wIa; ARdvE: } private function send($TemplateCode, $TemplateParam, $phoneNumber) { goto zAk2z; nTpa_: Log::error("\146\x61\151\154\145\x64\40\x74\x6f\40\x67\x65\x74\x20\162\145\163\160\x6f\x6e\163\x65\40\x66\x72\157\x6d\40\x61\x6c\x69\x20\163\x6d\x73\x2c\40\x74\145\154\72{$phoneNumber}"); goto qFFcM; qFFcM: return false; goto ChG2B; Vlr26: return false; goto zCHMC; khSp7: Log::error("\146\x61\x69\154\x65\144\40\x74\157\40\144\x65\x63\x6f\x64\145\x20\141\x6c\151\x20\x73\155\163\40\x72\145\x73\160\x6f\156\163\145\x2c\x20\164\x65\x6c\x3a{$phoneNumber}\54\x20" . $responseContent); goto Vlr26; Eba81: $responseContent = file_get_contents($url); goto rc1h7; SndkU: $SignName = systemSetting("\101\x4c\111\x59\x55\116\x5f\123\x4d\x53\x5f\123\111\x47\x4e\116\x41\x4d\105"); goto lnE81; u8e6Y: return false; goto rJUrl; iDq0L: return true; goto xq6t2; Cw3rO: $sign = base64_encode(hash_hmac("\163\150\x61\61", $stringToSign, $AccessKeySecret . "\46", true)); goto MhHO0; e8DfK: WoSX4: goto MP9ER; VdHP3: $AccessKeySecret = systemSetting("\x41\x4c\111\x59\x55\x4e\x5f\x53\x4d\123\137\x41\x43\103\105\x53\x53\113\105\x59\137\123\105\x43\122\105\x54"); goto NIKNs; NIKNs: $SignatureMethod = "\x48\x4d\x41\103\x2d\x53\x48\x41\x31"; goto PHwiB; LITDR: Log::notice("\x73\165\x63\x63\x65\x73\163\x20\x74\157\x20\x73\145\x6e\x64\x20\x6d\x65\163\163\141\147\x65\40\x74\x6f\40\164\145\x6c\72{$phoneNumber}\54\x20\x74\145\x6d\x70\x6c\x61\164\145\72\x20{$TemplateCode}"); goto iDq0L; zAk2z: if (validateMobile($phoneNumber)) { goto HZbpU; } goto u8e6Y; FLyM5: $url = "\150\x74\164\160\163\x3a\x2f\57\144\171\x73\155\x73\x61\160\x69\56\x61\x6c\151\x79\165\156\x63\163\56\143\x6f\x6d\57\x3f\x53\151\x67\156\x61\164\x75\x72\x65\x3d{$Signature}{$sortedQueryStringTmp}"; goto Eba81; PHwiB: $SignatureVersion = "\61\56\60"; goto mnizT; b9fxY: foreach ($params as $key => $value) { $sortedQueryStringTmp .= "\x26" . $this->encode($key) . "\x3d" . $this->encode($value); pVuwG: } goto e8DfK; l5A3w: if (!(isset($responseObj["\103\x6f\144\x65"]) && $responseObj["\x43\x6f\144\145"] == "\x4f\x4b")) { goto tc1RB; } goto LITDR; BORYa: ksort($params); goto V9lf5; MhHO0: $Signature = $this->encode($sign); goto HGOU5; qmEe5: $Format = "\152\163\157\x6e"; goto v8KwN; wx6Kg: $responseObj = json_decode($responseContent, true); goto a1rJ8; rJUrl: HZbpU: goto E4Pux; v8KwN: $Version = "\x32\60\61\x37\x2d\60\65\x2d\x32\x35"; goto f8tvT; ChG2B: RWiSk: goto wx6Kg; a1rJ8: if ($responseObj) { goto CRfLa; } goto khSp7; xq6t2: tc1RB: goto sHsfS; s9ZFM: $Timestamp = gmdate("\x59\55\155\x2d\x64\134\124\110\72\x69\x3a\x73\134\x5a"); goto qmEe5; mnizT: $SignatureNonce = uniqid(mt_rand(0, 0xffff), true); goto s9ZFM; V9lf5: $sortedQueryStringTmp = ''; goto b9fxY; sHsfS: Log::error("\x66\141\151\154\x65\x64\x20\164\157\40\x73\145\x6e\x64\40\163\155\x73\x20\166\151\x61\x20\141\154\x69\54\x20\x74\x65\154\72{$phoneNumber}\x2c\40" . $responseContent); goto pArbN; f8tvT: $params = ["\x50\150\x6f\156\145\x4e\165\x6d\142\x65\x72\x73" => $phoneNumber, "\123\151\147\156\x4e\141\x6d\x65" => $SignName, "\124\x65\x6d\x70\x6c\141\164\145\103\x6f\x64\x65" => $TemplateCode, "\101\x63\x63\145\x73\x73\x4b\145\171\x49\x64" => $AccessKeyId, "\x41\143\164\151\157\156" => $Action, "\x46\x6f\x72\x6d\141\x74" => $Format, "\x54\145\x6d\160\x6c\x61\164\x65\120\x61\x72\x61\x6d" => $TemplateParam, "\123\x69\x67\x6e\x61\x74\165\x72\145\x4d\x65\164\x68\157\x64" => $SignatureMethod, "\x53\151\147\x6e\x61\164\x75\x72\x65\x4e\157\156\x63\x65" => $SignatureNonce, "\123\x69\147\x6e\141\164\165\162\x65\x56\x65\162\x73\x69\x6f\156" => $SignatureVersion, "\124\151\155\145\163\164\x61\155\x70" => $Timestamp, "\126\145\x72\x73\x69\157\x6e" => $Version]; goto BORYa; rc1h7: if ($responseContent) { goto RWiSk; } goto nTpa_; lnE81: $AccessKeyId = systemSetting("\101\114\x49\131\x55\x4e\x5f\123\x4d\123\x5f\101\103\103\105\x53\123\113\x45\131\x5f\111\x44"); goto VdHP3; E4Pux: $Action = "\x53\x65\156\x64\123\x6d\163"; goto SndkU; pArbN: return false; goto GrhUl; zCHMC: CRfLa: goto l5A3w; MP9ER: $stringToSign = "\107\x45\124\x26" . $this->encode("\57") . "\x26" . $this->encode(substr($sortedQueryStringTmp, 1)); goto Cw3rO; HGOU5: $params["\x53\151\147\x6e\x61\164\165\x72\x65"] = $Signature; goto FLyM5; GrhUl: } private function encode($str) { goto oX1wy; oX1wy: $res = urlencode($str); goto azQdC; bud5b: $res = preg_replace("\57\x25\67\105\x2f", "\176", $res); goto yB4IP; yB4IP: return $res; goto pgYdS; azQdC: $res = preg_replace("\x2f\134\53\57", "\45\x32\60", $res); goto Wkufa; Wkufa: $res = preg_replace("\57\134\x2a\x2f", "\x25\x32\101", $res); goto bud5b; pgYdS: } }
