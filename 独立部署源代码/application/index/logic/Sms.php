<?php
 namespace app\index\logic; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs as IndexDefs; class Sms extends Base { public function sendCaptcha($tel, $len = 6, $id = '') { goto h3fke; xoQHI: $i = 0; goto C3v8e; qnQPu: JkX1N: goto YJbGa; jTlQG: $chars = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]; goto xoQHI; YJbGa: if (!($i < $len)) { goto hOrWH; } goto YhwCS; XFyMo: j5c0x: goto NOH9S; UBm56: $i++; goto RRV22; MJITq: nYyn0: goto KqON2; b7EXg: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto TPpzK; C3v8e: $code = ''; goto qnQPu; ovn7h: sICyv: goto ixoIs; thHtv: exception("\346\x89\213\346\234\272\xe5\x8f\xb7\xe7\240\201\xe6\227\240\346\x95\x88"); goto XFyMo; K7P4w: $TemplateCode = systemSetting("\101\x4c\111\x59\125\x4e\x5f\x53\x4d\123\137\x43\101\x50\x54\103\110\x41\137\124\x45\x4d\x50\x4c\x41\124\105"); goto omc4U; RRV22: goto JkX1N; goto MLLOf; KqON2: goto eYpYE; goto e1KnC; e1KnC: fBKFj: goto Jm7YY; TPpzK: if ($result) { goto nYyn0; } goto KSX00; Jm7YY: $code = "\61\x31\61\61\x31\x31"; goto b5EnH; TMGOS: $sessionTimestamp = Session::get("\x43\x41\120\124\103\110\101\137\x54\111\115\105\x53\124\x41\x4d\120\x5f" . $id); goto tJC_h; XVRjq: exception("\xe5\x8f\221\351\200\x81\xe8\277\207\344\xba\216\xe9\xa2\221\xe7\xb9\x81\xef\274\x8c\350\257\267\347\xa8\215\345\x80\231\345\x86\x8d\350\257\x95"); goto ovn7h; h3fke: if (validateMobile($tel)) { goto j5c0x; } goto thHtv; hHscX: Session::set("\x43\101\120\124\x43\110\x41\137\x54\111\x4d\105\x53\x54\101\x4d\x50\137" . $id, time()); goto APu73; PIlKJ: return true; goto fLtdZ; YhwCS: $code .= $chars[rand(0, $len - 1)]; goto UBm56; NOH9S: $now = time(); goto TMGOS; HpzhQ: GX8DZ: goto b7EXg; fbgtC: Session::set("\x43\101\120\124\103\110\101\137" . $id, $code); goto PIlKJ; tJC_h: if (!($sessionTimestamp && $now >= $sessionTimestamp && $now - $sessionTimestamp < 30)) { goto sICyv; } goto XVRjq; KSX00: exception("\347\237\xad\xe4\xbf\241\345\x8f\221\351\200\x81\xe8\xb0\203\347\224\250\xe5\244\xb1\350\xb4\xa5"); goto MJITq; omc4U: if (!empty($TemplateCode)) { goto GX8DZ; } goto w0q43; b5EnH: eYpYE: goto hHscX; APu73: Session::set("\x43\101\x50\124\103\x48\101\x5f\x4d\x4f\x42\111\114\x45\x5f" . $id, $tel); goto fbgtC; MLLOf: hOrWH: goto N0SJ6; w0q43: exception("\xe7\x9f\255\344\277\xa1\xe6\250\xa1\346\235\277\346\x9c\252\351\x85\215\xe7\xbd\xae"); goto HpzhQ; ixoIs: if ($tel == "\61\63\65\x31\x30\x31\x30\x35\x38\x35\70") { goto fBKFj; } goto jTlQG; N0SJ6: $TemplateParam = json_encode(["\x6e\165\155\x62\145\x72" => $code], JSON_UNESCAPED_UNICODE); goto K7P4w; fLtdZ: } public function verifyCaptcha($mobile, $code, $id = '') { goto XRsSt; BriIQ: if (!($sessionCode == $code && $sessionMobile == $mobile)) { goto mP6Lt; } goto ePnMf; M96nH: $now = time(); goto elg2Q; cSB34: return false; goto OhXtm; AZ191: mP6Lt: goto AH9sp; AH9sp: return false; goto j6CvN; esGGX: if (!(empty($sessionCode) || empty($sessionMobile) || empty($sessionTimestamp))) { goto pLaYL; } goto cSB34; xXxZL: Session::delete("\103\101\x50\124\103\110\101\x5f" . $id); goto WvhT_; Ka2uX: pS3BU: goto BriIQ; me1DQ: $sessionTimestamp = Session::get("\x43\x41\120\124\x43\x48\101\137\x54\x49\115\x45\x53\124\x41\115\120\137" . $id); goto esGGX; CSXJ1: Session::delete("\103\101\x50\124\103\110\101\137\x54\x49\x4d\x45\123\124\x41\115\x50\137" . $id); goto iCQoT; OhXtm: pLaYL: goto M96nH; elg2Q: if (!($now >= $sessionTimestamp && $now - $sessionTimestamp > 120)) { goto pS3BU; } goto xXxZL; iCQoT: return false; goto Ka2uX; BhWtk: $sessionMobile = Session::get("\x43\101\x50\124\103\x48\x41\137\115\x4f\102\x49\114\x45\x5f" . $id); goto me1DQ; ePnMf: Session::delete("\x43\101\x50\x54\103\110\101\137" . $id); goto BoqrA; YQ89P: return true; goto AZ191; BoqrA: Session::delete("\x43\101\x50\124\x43\110\x41\x5f\x4d\x4f\x42\x49\114\x45\137" . $id); goto uwbqp; WvhT_: Session::delete("\x43\x41\x50\x54\103\110\101\137\115\117\102\x49\x4c\x45\x5f" . $id); goto CSXJ1; uwbqp: Session::delete("\103\101\120\x54\103\110\x41\137\x54\111\x4d\x45\123\124\101\115\x50\137" . $id); goto YQ89P; XRsSt: $sessionCode = Session::get("\x43\x41\x50\x54\x43\110\101\137" . $id); goto BhWtk; j6CvN: } public function sendAppoitOrderToExpert($tel, $time) { goto D0fdd; dXApy: return false; goto jmhRA; rcNNq: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto PX2qX; ZFtHw: return false; goto mWoaV; D0fdd: if (validateMobile($tel)) { goto lhKs7; } goto ql1Ts; MfKkC: return true; goto i869U; eHUXp: lhKs7: goto gW_X0; mWoaV: UZpE2: goto MfKkC; fklyS: Log::notice("\163\x65\x6e\x64\40\x61\x70\160\157\151\156\x74\x20\x6f\x72\144\145\162\40\x73\x6d\163\x20\164\157\x20\145\170\160\145\162\164\x3a\40" . $tel); goto rcNNq; ql1Ts: return false; goto eHUXp; gW_X0: $TemplateParam = json_encode(["\164\151\155\x65" => $time], JSON_UNESCAPED_UNICODE); goto c4xXK; jmhRA: qgZzS: goto fklyS; c4xXK: $TemplateCode = systemSetting("\x41\x4c\111\131\125\x4e\x5f\x53\115\x53\x5f\101\x50\x50\x4f\111\116\x54\x5f\124\117\137\105\130\120\x45\x52\x54\137\x54\105\115\120\114\x41\124\105"); goto zvEzq; zvEzq: if (!empty($TemplateCode)) { goto qgZzS; } goto dXApy; PX2qX: if ($result) { goto UZpE2; } goto ZFtHw; i869U: } public function sendAppoitOrderToSupport($tel, $time) { goto R5A_D; HieB0: Log::notice("\x73\145\156\x64\x20\141\160\x70\x6f\151\x6e\x74\40\157\x72\x64\x65\x72\x20\163\x6d\163\x20\164\157\40\x73\165\x70\160\157\162\164\72\40" . $tel); goto W6wZ_; RI6iH: return true; goto g4Ueb; dKv6N: qMJeM: goto RI6iH; R5A_D: if (validateMobile($tel)) { goto URAVF; } goto v_eiA; RqY7u: $TemplateParam = json_encode(["\164\151\x6d\x65" => $time], JSON_UNESCAPED_UNICODE); goto QIr0g; npeZj: return false; goto dKv6N; u1xmK: return false; goto hBwxs; QIr0g: $TemplateCode = systemSetting("\101\x4c\x49\x59\x55\116\137\123\115\123\x5f\101\120\x50\117\111\116\124\137\124\x4f\137\123\x55\x50\x50\117\x52\124\x5f\124\x45\115\120\x4c\101\x54\105"); goto s0qXH; v_eiA: return false; goto f_wqn; hBwxs: Lcj7k: goto HieB0; s0qXH: if (!empty($TemplateCode)) { goto Lcj7k; } goto u1xmK; W6wZ_: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto WsqwD; WsqwD: if ($result) { goto qMJeM; } goto npeZj; f_wqn: URAVF: goto RqY7u; g4Ueb: } public function sendAppoitOrderToCustomer($tel, $time, $addr) { goto jHOFW; OAtw5: return false; goto V4Wlm; SaIV0: $TemplateCode = systemSetting("\101\x4c\111\131\125\116\137\123\115\x53\137\x41\120\x50\117\x49\116\x54\137\x54\117\x5f\x43\125\x53\124\x4f\x4d\x45\x52\x5f\124\x45\x4d\120\x4c\101\124\x45"); goto QtwJZ; jHOFW: if (validateMobile($tel)) { goto ogNsu; } goto OAtw5; QtwJZ: if (!empty($TemplateCode)) { goto lcYmZ; } goto Hkdqd; fVOyl: Log::notice("\x73\145\x6e\x64\40\141\160\160\x6f\x69\x6e\164\x20\x6f\162\144\145\162\40\163\x6d\x73\40\x74\157\40\x63\165\163\164\x6f\x6d\145\x72\x3a\40" . $tel); goto PqhDF; KGhPE: lcYmZ: goto fVOyl; Q8Wv9: $TemplateParam = json_encode(["\x74\151\155\145" => $time, "\x61\144\x64\162\145\163\163" => $addr], JSON_UNESCAPED_UNICODE); goto SaIV0; PqhDF: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto s4oFD; THXdH: return false; goto cIHZE; cIHZE: gg1CU: goto ZpWDE; V4Wlm: ogNsu: goto Q8Wv9; s4oFD: if ($result) { goto gg1CU; } goto THXdH; ZpWDE: return true; goto NX0bi; Hkdqd: return false; goto KGhPE; NX0bi: } private function send($TemplateCode, $TemplateParam, $phoneNumber) { goto lFkGI; KQYMy: $responseContent = file_get_contents($url); goto QvXS1; eJQSQ: Log::error("\146\x61\x69\154\x65\144\x20\x74\157\x20\144\145\143\157\144\145\x20\x61\154\151\40\163\x6d\163\40\x72\x65\x73\160\x6f\156\163\x65\x2c\40\164\x65\154\x3a{$phoneNumber}\54\x20" . $responseContent); goto V4N1j; LCqmn: mgDR5: goto EQovI; lFkGI: if (validateMobile($phoneNumber)) { goto gFjPl; } goto HpHJn; aRL1J: return true; goto LCqmn; q2mZK: return false; goto Sqs3F; v9w7T: $stringToSign = "\107\x45\124\x26" . $this->encode("\57") . "\x26" . $this->encode(substr($sortedQueryStringTmp, 1)); goto uu82O; ASbFZ: R0gbB: goto v9w7T; addRZ: ksort($params); goto pSoxK; X51z1: $SignatureMethod = "\x48\115\101\103\x2d\x53\x48\101\x31"; goto E8djo; pSoxK: $sortedQueryStringTmp = ''; goto VTWHS; rgHkn: Log::error("\146\141\151\154\145\144\40\164\157\40\147\x65\164\40\x72\145\x73\x70\157\x6e\163\x65\40\x66\162\x6f\x6d\40\x61\154\x69\40\x73\x6d\x73\x2c\x20\x74\x65\154\72{$phoneNumber}"); goto q2mZK; QF8qH: $Signature = $this->encode($sign); goto p2NQm; lR7wd: $url = "\150\164\164\x70\163\72\x2f\57\x64\x79\163\155\x73\141\x70\151\56\x61\x6c\x69\x79\x75\156\x63\163\x2e\x63\x6f\x6d\x2f\77\123\x69\147\x6e\x61\164\x75\162\145\x3d{$Signature}{$sortedQueryStringTmp}"; goto KQYMy; eZ0tJ: $Version = "\62\x30\61\67\x2d\x30\x35\55\x32\x35"; goto Vp1iz; GmXZk: $Action = "\x53\x65\x6e\144\x53\155\x73"; goto ud42J; Z2ytb: Log::notice("\163\x75\143\143\x65\163\x73\x20\164\157\40\163\145\156\x64\40\155\x65\163\x73\x61\x67\145\x20\164\x6f\40\x74\145\x6c\x3a{$phoneNumber}\x2c\x20\164\x65\x6d\x70\x6c\141\x74\145\x3a\40{$TemplateCode}"); goto aRL1J; E8djo: $SignatureVersion = "\x31\x2e\60"; goto ASc1j; V4N1j: return false; goto nhrzl; VTWHS: foreach ($params as $key => $value) { $sortedQueryStringTmp .= "\46" . $this->encode($key) . "\75" . $this->encode($value); id_tS: } goto ASbFZ; HpHJn: return false; goto D6rIc; eDsyo: $responseObj = json_decode($responseContent, true); goto iIMCX; ASc1j: $SignatureNonce = uniqid(mt_rand(0, 0xffff), true); goto i1Bzi; QvXS1: if ($responseContent) { goto GjoVk; } goto rgHkn; Sqs3F: GjoVk: goto eDsyo; Vp1iz: $params = ["\120\x68\157\156\x65\116\x75\x6d\x62\145\x72\163" => $phoneNumber, "\123\151\147\x6e\116\141\x6d\145" => $SignName, "\x54\x65\x6d\160\x6c\141\x74\145\103\x6f\x64\145" => $TemplateCode, "\101\143\143\x65\163\x73\x4b\x65\x79\111\144" => $AccessKeyId, "\101\x63\x74\x69\x6f\156" => $Action, "\x46\x6f\x72\155\141\164" => $Format, "\x54\x65\x6d\x70\154\141\x74\145\120\141\162\141\x6d" => $TemplateParam, "\123\151\147\x6e\x61\164\165\x72\145\x4d\145\164\150\x6f\x64" => $SignatureMethod, "\123\x69\x67\x6e\x61\x74\x75\162\145\116\157\x6e\x63\x65" => $SignatureNonce, "\x53\151\x67\x6e\141\x74\165\162\x65\x56\x65\162\163\x69\x6f\156" => $SignatureVersion, "\x54\151\155\145\x73\164\141\155\x70" => $Timestamp, "\126\145\x72\x73\151\x6f\156" => $Version]; goto addRZ; EQovI: Log::error("\x66\141\151\x6c\x65\144\40\164\x6f\40\163\x65\156\x64\x20\163\x6d\163\x20\166\x69\141\x20\x61\x6c\x69\x2c\x20\164\x65\154\x3a{$phoneNumber}\54\40" . $responseContent); goto SK0St; uu82O: $sign = base64_encode(hash_hmac("\x73\x68\x61\61", $stringToSign, $AccessKeySecret . "\x26", true)); goto QF8qH; nhrzl: miMit: goto B6tdv; B6tdv: if (!(isset($responseObj["\x43\x6f\144\145"]) && $responseObj["\103\157\144\x65"] == "\x4f\x4b")) { goto mgDR5; } goto Z2ytb; ud42J: $SignName = systemSetting("\x41\x4c\111\x59\125\116\x5f\x53\x4d\123\137\x53\111\107\x4e\x4e\101\x4d\x45"); goto SczC9; iIMCX: if ($responseObj) { goto miMit; } goto eJQSQ; SK0St: return false; goto HQgbm; aaE9X: $AccessKeySecret = systemSetting("\x41\114\x49\131\125\x4e\x5f\x53\115\x53\x5f\101\x43\x43\105\123\x53\113\x45\131\x5f\x53\105\x43\x52\105\124"); goto X51z1; p2NQm: $params["\123\151\x67\156\141\164\x75\162\x65"] = $Signature; goto lR7wd; D6rIc: gFjPl: goto GmXZk; SczC9: $AccessKeyId = systemSetting("\x41\x4c\x49\x59\125\x4e\x5f\x53\115\x53\137\101\x43\103\x45\x53\123\x4b\105\131\x5f\111\104"); goto aaE9X; UjcPt: $Format = "\x6a\163\x6f\156"; goto eZ0tJ; i1Bzi: $Timestamp = gmdate("\131\55\155\55\144\134\x54\110\x3a\x69\72\163\x5c\x5a"); goto UjcPt; HQgbm: } private function encode($str) { goto nd2ta; nd2ta: $res = urlencode($str); goto On5hE; On5hE: $res = preg_replace("\x2f\x5c\53\x2f", "\x25\62\x30", $res); goto o0lfz; uG0eZ: return $res; goto I4jAt; o0lfz: $res = preg_replace("\57\134\52\57", "\x25\62\101", $res); goto WtOtg; WtOtg: $res = preg_replace("\x2f\x25\x37\105\x2f", "\x7e", $res); goto uG0eZ; I4jAt: } }
