<?php
 namespace app\index\logic; use think\Db; use think\Log; use app\Defs; use app\index\service\RequestContext; class Organization extends Base { public function loadTreeDatas() { goto GXo0d; O7C_U: $treeDatas[] = $this->loadTreeDataRecursively(0); goto trtSC; trtSC: return $treeDatas; goto nbcMf; GXo0d: $treeDatas = []; goto O7C_U; nbcMf: } protected function loadTreeDataRecursively($id = 0, $parentId = 0, $breadcrumbParent = '') { goto nVSFO; if8k_: $treeNodeDatas = ["\x69\x64" => $id, "\x70\x61\162\x65\x6e\164\137\151\x64" => $parentId, "\164\145\x78\164" => $text, "\151\143\x6f\x6e\x43\154\x73" => "\151\x63\157\x6e\x73\x2d\x70\x6f\x69\156\x74", "\163\164\141\x74\145" => "\x6f\x70\x65\x6e", "\x63\x68\x69\x6c\x64\162\x65\x6e" => [], "\x62\162\x65\141\144\143\x72\x75\155\x62" => $breadcrumb]; goto o4gJ8; WSLa1: J0dbH: goto GiYUS; NJ24U: $treeNodeDatas = ["\x69\144" => 0, "\x70\141\x72\x65\156\x74\137\x69\144" => 0, "\164\145\x78\x74" => $text, "\151\x63\157\156\x43\154\163" => "\146\x61\x20\146\141\55\143\151\162\x63\x6c\x65", "\x73\x74\x61\164\x65" => "\x6f\160\145\x6e", "\x63\x68\151\154\144\x72\145\x6e" => [], "\142\x72\x65\x61\x64\143\162\x75\155\x62" => $breadcrumb]; goto WSLa1; nVSFO: if ($id == 0) { goto a1LI3; } goto JckKs; qd78H: return null; goto wB_I6; TRroO: if (!($text === null)) { goto MxHsE; } goto qd78H; yp71F: $breadcrumb = empty($breadcrumbParent) ? $text : $breadcrumbParent . "\40\46\147\x74\73\40" . $text; goto if8k_; o4gJ8: goto J0dbH; goto xDoYh; xDoYh: a1LI3: goto mxEAH; WGRed: foreach ($childOrganizations as $childOrganization) { goto mG0eW; rsczh: B5t30: goto JDinl; mG0eW: $childNodeDatas = $this->loadTreeDataRecursively($childOrganization["\151\x64"], $id, $breadcrumb); goto emwFs; W_2f_: $treeNodeDatas["\143\x68\x69\154\x64\162\145\156"][] = $childNodeDatas; goto rsczh; JDinl: mOqeL: goto aw82L; emwFs: if (!$childNodeDatas) { goto B5t30; } goto W_2f_; aw82L: } goto M4Yxy; mxEAH: $text = "\xe6\x88\x91\xe7\x9a\204\347\273\204\347\273\x87"; goto AS3JK; hzw_Q: return $treeNodeDatas; goto WwO_w; wB_I6: MxHsE: goto yp71F; JckKs: $text = Db::table("\x6f\x72\x67\x61\x6e\x69\x7a\141\x74\151\x6f\156")->where(["\151\x64" => $id])->value("\156\x61\x6d\145"); goto TRroO; M4Yxy: bQSeG: goto hzw_Q; GiYUS: $childOrganizations = Db::table("\157\162\x67\x61\x6e\x69\172\x61\164\x69\157\x6e")->where(["\x70\141\x72\145\x6e\164\x5f\151\x64" => $id])->field("\x69\144\x2c\x6e\x61\155\x65\x2c\x70\x61\x72\145\x6e\x74\x5f\151\144")->order("\157\162\144\145\162\x20\141\163\x63\x2c\40\151\x64\40\141\163\x63")->select(); goto WGRed; AS3JK: $breadcrumb = empty($breadcrumbParent) ? $text : $breadcrumbParent . "\40\x26\147\164\73\40" . $text; goto NJ24U; WwO_w: } public function loadComboDatas($id = 0, $prefix = '', $datas = array()) { goto UfMpv; U_bhD: JENAc: goto RZSmZ; ZZKQo: return $datas; goto v4f9I; RZSmZ: $datas[$id] = $prefix . $text; goto ERYkK; ugvH7: goto QdC1y; goto ZNyzj; slfLr: $text = Db::table("\157\162\147\x61\156\x69\172\141\164\x69\157\x6e")->where(["\151\144" => $id])->value("\x6e\141\155\145"); goto l1L0d; cuPzN: foreach ($childOrganizations as $childOrganization) { $datas = $this->loadComboDatas($childOrganization["\151\144"], $nextPrefix, $datas); LLr6v: } goto ZfiO1; ERYkK: $nextPrefix = $prefix . $text; goto ugvH7; l1L0d: if (!$prefix) { goto JENAc; } goto HmuGW; ghSOu: QdC1y: goto afqxh; fjcW9: $datas[$id] = "\x2d\xe8\257\xb7\xe9\200\x89\xe6\213\xa9\55"; goto XanXi; HmuGW: $prefix .= "\76"; goto U_bhD; XanXi: $nextPrefix = ''; goto ghSOu; afqxh: $childOrganizations = Db::table("\x6f\x72\x67\x61\x6e\x69\x7a\x61\x74\151\157\x6e")->where(["\160\x61\x72\145\x6e\x74\137\x69\144" => $id])->field("\x69\144\54\x6e\141\x6d\x65\54\160\141\162\145\x6e\164\137\151\144")->order("\x6f\162\144\x65\162\x20\x61\163\x63\54\x20\151\x64\40\x61\x73\143")->select(); goto cuPzN; UfMpv: if ($id == 0) { goto zNIsG; } goto slfLr; ZfiO1: M8Fqi: goto ZZKQo; ZNyzj: zNIsG: goto fjcW9; v4f9I: } public function loadComboDatasLeaf($id = 0, $prefix = '', $datas = array()) { goto qCAMY; YWvPG: xOF18: goto gdmq8; Vthx8: if (!($childCount == 0)) { goto iDFod; } goto eQVIN; MbGom: $childOrganizations = Db::table("\157\x72\x67\141\x6e\x69\x7a\x61\164\151\157\x6e")->where(["\160\x61\162\x65\x6e\164\137\151\x64" => $id])->field("\x69\x64\54\x6e\141\x6d\x65\x2c\x70\141\x72\x65\x6e\164\137\x69\144")->order("\x6f\x72\x64\145\x72\40\141\163\x63\54\40\151\144\40\x61\163\143")->select(); goto Jhpds; vONS4: goto qEFz3; goto HQvFL; qCAMY: if ($id == 0) { goto ev1th; } goto yZbaj; gdmq8: $childCount = Db::table("\157\x72\147\141\156\151\x7a\141\x74\151\157\156")->where(["\x70\141\x72\x65\x6e\164\137\151\x64" => $id])->count(); goto Vthx8; MiC23: $prefix .= "\76"; goto YWvPG; eQVIN: $datas[$id] = $prefix . $text; goto C4aZ3; QZGl7: if (!$prefix) { goto xOF18; } goto MiC23; C4aZ3: iDFod: goto Jep0F; bwuS3: return $datas; goto acRaa; Jhpds: foreach ($childOrganizations as $childOrganization) { $datas = $this->loadComboDatasLeaf($childOrganization["\x69\144"], $nextPrefix, $datas); I9kvw: } goto VtUF3; ZixDb: qEFz3: goto MbGom; Jep0F: $nextPrefix = $prefix . $text; goto vONS4; IZVrX: $nextPrefix = ''; goto ZixDb; VtUF3: Y_lDX: goto bwuS3; yZbaj: $text = Db::table("\x6f\162\147\x61\x6e\x69\x7a\141\x74\151\x6f\x6e")->where(["\x69\144" => $id])->value("\x6e\141\x6d\x65"); goto QZGl7; QkWDe: $datas[$id] = "\55\350\257\267\351\x80\x89\346\213\251\x2d"; goto IZVrX; HQvFL: ev1th: goto QkWDe; acRaa: } public function loadFullText($id, $suffix = '') { goto ERvZZ; yGlQY: MtqBm: goto kWr9A; wFNXh: PgQJx: goto QNFtr; AElh1: $fullText = $this->loadFullText($organization["\160\141\x72\x65\x6e\164\137\151\144"], $fullText); goto TJ6Vi; QNFtr: $fullText = $organization["\x6e\x61\155\145"]; goto jSAwo; kWr9A: $organization = Db::table("\157\x72\147\141\156\151\172\141\164\x69\157\156")->where(["\151\144" => $id])->field("\156\x61\x6d\145\54\40\160\x61\x72\145\156\164\137\151\x64")->find(); goto BkF3k; BQV3v: wxjMV: goto AElh1; BkF3k: if (!empty($organization)) { goto PgQJx; } goto T5AQt; jSAwo: if (!$suffix) { goto wxjMV; } goto AAGax; T5AQt: return $suffix; goto wFNXh; TJ6Vi: return $fullText; goto pTA4C; ERvZZ: if (!($id == 0)) { goto MtqBm; } goto aE1iQ; aE1iQ: return $suffix; goto yGlQY; AAGax: $fullText .= "\x20\x26\x67\x74\x3b\40" . $suffix; goto BQV3v; pTA4C: } public function isEmpty() { $count = Db::table("\157\x72\x67\x61\156\x69\172\141\x74\x69\x6f\156")->where(["\160\141\x72\x65\x6e\164\137\x69\x64" => 0])->count(); return $count ? false : true; } public function add($name, $parentId) { goto g2K6S; CwwNC: Db::table("\157\162\x67\x61\156\151\x7a\x61\x74\151\157\156")->where(["\151\x64" => $id])->setField("\x6f\162\144\145\x72", $id); goto eNglL; eNglL: return true; goto x0Dl0; g2K6S: $data = array("\x6e\x61\x6d\x65" => $name, "\160\x61\x72\x65\x6e\x74\137\x69\x64" => $parentId); goto gD8oq; gD8oq: $id = Db::table("\157\162\x67\141\x6e\x69\x7a\141\164\x69\157\156")->insertGetId($data); goto CwwNC; x0Dl0: } public function update($id, $name) { goto avj0X; nvTv8: return true; goto Isg0W; avj0X: $data = array("\x6e\141\155\x65" => $name); goto aF6F5; aF6F5: Db::table("\x6f\162\147\x61\156\151\172\141\x74\x69\157\x6e")->where("\x69\144", $id)->update($data); goto nvTv8; Isg0W: } public function delete($id) { goto Oxya6; Oxya6: Db::table("\x63\x75\x73\164\x6f\x6d\145\x72")->where(["\x6f\x72\147\141\x6e\x69\x7a\141\164\x69\x6f\156\137\151\x64" => $id])->setField("\157\162\x67\141\156\151\172\x61\x74\x69\x6f\x6e\137\151\x64", 0); goto h6s8W; pupTK: return $result != 1 ? false : true; goto NB0gH; h6s8W: $result = Db::table("\x6f\x72\x67\141\x6e\x69\x7a\x61\x74\151\157\x6e")->where("\151\144", $id)->delete(); goto pupTK; NB0gH: } public function up($id) { goto ulcl1; wQguV: if (!($i == 0)) { goto TaYyV; } goto duRmh; jrS7Q: Db::table("\x6f\x72\147\141\x6e\151\172\x61\x74\x69\x6f\156")->where(["\151\144" => $siblingOrganizations[$i - 1]["\151\x64"]])->setField("\157\x72\x64\145\x72", $order); goto yshUp; i8EgB: if (!($siblingOrganizations[$i]["\x69\x64"] == $id)) { goto pIPwL; } goto wQguV; EEzWe: return; goto OEJYa; yshUp: pIPwL: goto TuTXS; OfR0E: TaYyV: goto wPMep; pBqmD: if (!empty($siblingOrganizations)) { goto GkFz3; } goto p0mnm; wPMep: $order = $siblingOrganizations[$i]["\x6f\x72\x64\145\162"]; goto XCu9u; jVGNa: $i = 0; goto eQCsr; p0mnm: return; goto o0_MG; p9tp9: Db::table("\x6f\x72\147\141\156\151\172\x61\164\151\157\156")->where(["\151\x64" => $id])->setField("\x6f\162\144\145\x72", $orderPre); goto jrS7Q; GFcpT: if ($i < count($siblingOrganizations)) { goto g4OZG; } goto wvN6p; Uv24C: if (!(count($siblingOrganizations) <= 1)) { goto nhpLG; } goto EEzWe; OEJYa: nhpLG: goto jVGNa; duRmh: goto uu0Gq; goto OfR0E; TuTXS: $i++; goto GFcpT; wvN6p: uu0Gq: goto WChui; XCu9u: $orderPre = $siblingOrganizations[$i - 1]["\157\x72\x64\x65\162"]; goto p9tp9; eQCsr: g4OZG: goto i8EgB; o0_MG: GkFz3: goto Uv24C; QKT4r: $siblingOrganizations = Db::table("\157\x72\147\x61\x6e\x69\x7a\x61\x74\x69\x6f\156")->where(["\x70\x61\x72\145\156\164\x5f\x69\144" => $parentId])->field("\x69\144\54\156\x61\155\145\x2c\160\141\162\145\156\164\x5f\151\144\54\x6f\162\x64\145\162")->order("\x6f\x72\144\145\162\x20\x61\163\143\x2c\x20\x69\144\x20\141\x73\143")->select(); goto pBqmD; ulcl1: $parentId = Db::table("\157\162\147\141\x6e\151\x7a\x61\x74\x69\x6f\156")->where(["\x69\x64" => $id])->value("\160\x61\162\x65\156\x74\x5f\x69\x64"); goto QKT4r; WChui: } public function down($id) { goto s9m1F; FsOQB: if (!empty($siblingOrganizations)) { goto XDpIS; } goto whj6C; qHmnz: wQ8Ih: goto TclNQ; IKjYV: $orderNext = $siblingOrganizations[$i + 1]["\157\x72\144\x65\x72"]; goto cRm0B; ziDLL: $order = $siblingOrganizations[$i]["\x6f\162\x64\x65\162"]; goto IKjYV; F1TbA: OlXUF: goto j57tm; nzYkW: goto XaIfq; goto a0lDX; s9m1F: $parentId = Db::table("\x6f\162\x67\141\156\151\172\x61\x74\x69\x6f\156")->where(["\x69\144" => $id])->value("\x70\x61\x72\x65\156\x74\137\x69\x64"); goto Z2985; cRm0B: Db::table("\x6f\x72\147\x61\x6e\x69\x7a\141\164\x69\157\x6e")->where(["\151\x64" => $id])->setField("\157\162\144\145\162", $orderNext); goto QUUqi; lm7c0: return; goto F0fj2; VfFNu: $i = 0; goto F1TbA; AuPXB: XDpIS: goto gLeTH; TclNQ: $i++; goto LjOxr; j57tm: if (!($siblingOrganizations[$i]["\151\144"] == $id)) { goto wQ8Ih; } goto UWUF_; F0fj2: B_D1b: goto VfFNu; gLeTH: if (!(count($siblingOrganizations) <= 1)) { goto B_D1b; } goto lm7c0; QUUqi: Db::table("\x6f\x72\x67\x61\156\x69\172\141\164\x69\157\x6e")->where(["\151\x64" => $siblingOrganizations[$i + 1]["\151\144"]])->setField("\157\x72\144\x65\x72", $order); goto qHmnz; whj6C: return; goto AuPXB; Z2985: $siblingOrganizations = Db::table("\157\x72\147\141\x6e\151\172\141\x74\151\x6f\156")->where(["\160\141\x72\145\156\164\137\151\x64" => $parentId])->field("\x69\144\54\156\x61\155\145\54\x70\x61\x72\145\156\x74\x5f\151\144\54\157\162\144\145\x72")->order("\157\x72\x64\x65\162\40\x61\x73\x63\54\x20\x69\144\40\x61\163\x63")->select(); goto FsOQB; a0lDX: Y3R7P: goto ziDLL; sfFIm: XaIfq: goto KqSwz; LjOxr: if ($i < count($siblingOrganizations)) { goto OlXUF; } goto sfFIm; UWUF_: if (!($i == count($siblingOrganizations) - 1)) { goto Y3R7P; } goto nzYkW; KqSwz: } public function changeLevel($id, $parentId) { Db::table("\x6f\162\147\141\x6e\151\172\x61\x74\151\157\156")->where("\151\x64", $id)->setField("\x70\x61\162\x65\156\164\137\151\x64", $parentId); return true; } }
