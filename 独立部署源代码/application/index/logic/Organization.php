<?php
 namespace app\index\logic; use think\Db; use think\Log; use app\Defs; use app\index\service\RequestContext; class Organization extends Base { public function loadTreeDatas() { goto r_OC3; BZmf4: return $treeDatas; goto HI6s4; IQu1j: $treeDatas[] = $this->loadTreeDataRecursively(0); goto BZmf4; r_OC3: $treeDatas = []; goto IQu1j; HI6s4: } protected function loadTreeDataRecursively($id = 0, $parentId = 0, $breadcrumbParent = '') { goto e6CxG; XlR5b: EZwWd: goto lxt2y; CF8mJ: $childOrganizations = Db::table("\x6f\x72\x67\141\x6e\151\x7a\141\164\151\x6f\x6e")->where(["\160\141\162\x65\156\x74\137\x69\x64" => $id])->field("\x69\144\54\x6e\141\x6d\x65\54\160\x61\x72\x65\x6e\164\x5f\x69\144")->order("\157\162\x64\145\x72\40\141\163\x63\54\x20\x69\144\40\141\163\143")->select(); goto Pw8Mk; lxt2y: $text = "\346\x88\x91\347\232\x84\347\xbb\204\347\273\x87"; goto KXq0l; NqDVg: WBE8P: goto CF8mJ; xrVHL: goto WBE8P; goto XlR5b; kJxco: $breadcrumb = empty($breadcrumbParent) ? $text : $breadcrumbParent . "\x20\x26\x67\x74\x3b\x20" . $text; goto L8r_D; DIl8g: $text = Db::table("\x6f\x72\x67\141\x6e\151\x7a\x61\164\x69\x6f\x6e")->where(["\x69\144" => $id])->value("\156\141\x6d\x65"); goto egnmB; Pw8Mk: foreach ($childOrganizations as $childOrganization) { goto sau8j; JFN7P: CD7Ic: goto dQJNf; F9EEN: $treeNodeDatas["\x63\x68\x69\154\144\162\145\156"][] = $childNodeDatas; goto JFN7P; sau8j: $childNodeDatas = $this->loadTreeDataRecursively($childOrganization["\151\144"], $id, $breadcrumb); goto tAjyh; dQJNf: bCl6w: goto GFaKD; tAjyh: if (!$childNodeDatas) { goto CD7Ic; } goto F9EEN; GFaKD: } goto kliBB; L8r_D: $treeNodeDatas = ["\x69\x64" => $id, "\160\141\162\145\156\x74\137\x69\x64" => $parentId, "\x74\145\170\x74" => $text, "\x69\x63\x6f\156\x43\x6c\163" => "\151\x63\x6f\x6e\x73\55\x70\157\x69\x6e\164", "\163\x74\x61\x74\x65" => "\157\160\145\x6e", "\143\150\151\154\144\162\145\156" => [], "\142\x72\145\x61\x64\x63\162\165\x6d\142" => $breadcrumb]; goto xrVHL; egnmB: if (!($text === null)) { goto bYp38; } goto DZBjt; prcpL: return $treeNodeDatas; goto HuyPD; YmYzY: $treeNodeDatas = ["\151\144" => 0, "\160\x61\x72\x65\x6e\x74\x5f\x69\x64" => 0, "\x74\145\x78\x74" => $text, "\x69\143\x6f\x6e\103\154\163" => "\x66\x61\40\x66\141\55\x63\151\x72\143\x6c\x65", "\163\x74\x61\x74\x65" => "\x6f\160\145\156", "\x63\x68\151\154\x64\x72\145\x6e" => [], "\142\162\145\141\144\143\162\x75\155\142" => $breadcrumb]; goto NqDVg; DZBjt: return null; goto oDLuR; e6CxG: if ($id == 0) { goto EZwWd; } goto DIl8g; oDLuR: bYp38: goto kJxco; KXq0l: $breadcrumb = empty($breadcrumbParent) ? $text : $breadcrumbParent . "\40\46\147\x74\x3b\40" . $text; goto YmYzY; kliBB: HWaUU: goto prcpL; HuyPD: } public function loadComboDatas($id = 0, $prefix = '', $datas = array()) { goto Y2HTg; fSmOr: goto r7WP8; goto xjBOu; xjBOu: D8SoV: goto uKimi; HAcAI: bW7w9: goto dOgsx; kIMd6: $nextPrefix = ''; goto DgNV_; k_f91: $childOrganizations = Db::table("\x6f\x72\x67\141\156\151\x7a\141\x74\151\157\156")->where(["\x70\x61\x72\145\x6e\164\137\151\x64" => $id])->field("\151\x64\54\156\141\155\x65\54\x70\x61\x72\x65\x6e\164\137\x69\144")->order("\157\x72\144\145\162\40\x61\163\x63\x2c\40\x69\144\40\x61\163\x63")->select(); goto PH4Ow; QOGq8: $text = Db::table("\x6f\162\147\x61\156\x69\172\141\164\151\x6f\x6e")->where(["\x69\x64" => $id])->value("\x6e\x61\155\145"); goto ng5Jk; Y2HTg: if ($id == 0) { goto D8SoV; } goto QOGq8; PH4Ow: foreach ($childOrganizations as $childOrganization) { $datas = $this->loadComboDatas($childOrganization["\x69\x64"], $nextPrefix, $datas); z92G_: } goto kC9ve; EP1DN: $prefix .= "\76"; goto HAcAI; kC9ve: RvvMg: goto kxOR_; kxOR_: return $datas; goto zXK8w; CB5RD: $nextPrefix = $prefix . $text; goto fSmOr; DgNV_: r7WP8: goto k_f91; ng5Jk: if (!$prefix) { goto bW7w9; } goto EP1DN; uKimi: $datas[$id] = "\x2d\xe8\257\267\351\200\x89\xe6\x8b\251\55"; goto kIMd6; dOgsx: $datas[$id] = $prefix . $text; goto CB5RD; zXK8w: } public function loadComboDatasLeaf($id = 0, $prefix = '', $datas = array()) { goto hnw8M; iCjQW: $prefix .= "\x3e"; goto SMp9t; b5OnN: foreach ($childOrganizations as $childOrganization) { $datas = $this->loadComboDatasLeaf($childOrganization["\151\144"], $nextPrefix, $datas); UiGx7: } goto CYxyB; zT0x9: return $datas; goto CTF0b; hnw8M: if ($id == 0) { goto VXhyB; } goto KoxhP; T9fZ6: if (!$prefix) { goto ywtVC; } goto iCjQW; SMp9t: ywtVC: goto rU5DG; ChTcp: $datas[$id] = "\x2d\xe8\xaf\xb7\xe9\x80\x89\346\x8b\251\55"; goto w4gIs; zG0dg: CeUAL: goto cd02t; l0Pbj: if (!($childCount == 0)) { goto wFi3x; } goto PdS6u; KoxhP: $text = Db::table("\157\162\x67\141\x6e\151\172\x61\x74\151\x6f\x6e")->where(["\x69\144" => $id])->value("\156\x61\x6d\x65"); goto T9fZ6; MHkb4: $nextPrefix = $prefix . $text; goto G5qyJ; qVpp0: VXhyB: goto ChTcp; w4gIs: $nextPrefix = ''; goto zG0dg; PdS6u: $datas[$id] = $prefix . $text; goto h3MgL; G5qyJ: goto CeUAL; goto qVpp0; CYxyB: g2S3i: goto zT0x9; rU5DG: $childCount = Db::table("\x6f\x72\147\141\x6e\x69\x7a\x61\164\151\157\156")->where(["\160\x61\x72\145\156\x74\137\x69\144" => $id])->count(); goto l0Pbj; h3MgL: wFi3x: goto MHkb4; cd02t: $childOrganizations = Db::table("\x6f\x72\147\x61\156\151\x7a\141\164\151\157\x6e")->where(["\160\141\x72\x65\x6e\x74\137\x69\x64" => $id])->field("\151\x64\54\156\x61\155\145\x2c\160\x61\x72\x65\x6e\164\x5f\151\x64")->order("\x6f\162\144\145\x72\x20\x61\x73\143\54\40\x69\144\x20\141\163\x63")->select(); goto b5OnN; CTF0b: } public function loadFullText($id, $suffix = '') { goto QZu1T; EzANv: GzmTE: goto PReWB; z0uBg: return $fullText; goto i0X5G; QZu1T: if (!($id == 0)) { goto GzmTE; } goto QP3rX; fuUTe: $fullText = $organization["\156\141\155\145"]; goto xCc_f; wOj2J: return $suffix; goto CkImB; xCc_f: if (!$suffix) { goto Uf7kD; } goto wMZuT; gjAai: Uf7kD: goto PThJD; PReWB: $organization = Db::table("\x6f\x72\x67\141\156\151\172\141\x74\151\x6f\156")->where(["\x69\144" => $id])->field("\x6e\x61\x6d\145\54\40\x70\x61\162\145\x6e\x74\x5f\x69\144")->find(); goto HMySo; HMySo: if (!empty($organization)) { goto RPJmk; } goto wOj2J; QP3rX: return $suffix; goto EzANv; PThJD: $fullText = $this->loadFullText($organization["\x70\x61\162\x65\x6e\x74\137\151\x64"], $fullText); goto z0uBg; wMZuT: $fullText .= "\x20\x26\x67\164\x3b\x20" . $suffix; goto gjAai; CkImB: RPJmk: goto fuUTe; i0X5G: } public function isEmpty() { $count = Db::table("\x6f\162\x67\x61\x6e\x69\172\141\164\151\157\156")->where(["\x70\x61\x72\145\156\x74\x5f\x69\x64" => 0])->count(); return $count ? false : true; } public function add($name, $parentId) { goto Lxn50; fQN2J: Db::table("\x6f\162\x67\141\156\x69\x7a\141\x74\151\157\x6e")->where(["\151\144" => $id])->setField("\157\162\144\x65\162", $id); goto QxXQF; GD7Lb: $id = Db::table("\x6f\x72\147\x61\x6e\x69\172\141\x74\151\157\x6e")->insertGetId($data); goto fQN2J; Lxn50: $data = array("\156\141\x6d\145" => $name, "\x70\x61\x72\145\x6e\x74\137\x69\144" => $parentId); goto GD7Lb; QxXQF: return true; goto l6FFo; l6FFo: } public function update($id, $name) { goto TfGeZ; TfGeZ: $data = array("\156\x61\155\145" => $name); goto YXyDq; tST_X: return true; goto lCyD9; YXyDq: Db::table("\157\x72\147\x61\156\x69\172\x61\x74\x69\x6f\156")->where("\151\x64", $id)->update($data); goto tST_X; lCyD9: } public function delete($id) { goto x0rVj; INbcS: $result = Db::table("\x6f\x72\147\141\156\x69\172\141\x74\151\x6f\x6e")->where("\151\x64", $id)->delete(); goto EmpW7; EmpW7: return $result != 1 ? false : true; goto O12MW; x0rVj: Db::table("\x63\165\x73\164\157\155\145\162")->where(["\x6f\x72\147\141\156\x69\172\x61\164\151\x6f\x6e\137\151\x64" => $id])->setField("\x6f\x72\147\x61\x6e\x69\172\x61\164\x69\157\x6e\137\151\144", 0); goto INbcS; O12MW: } public function up($id) { goto Rlecv; Fvxqf: N0otQ: goto qymTN; fs8qL: $siblingOrganizations = Db::table("\157\x72\147\x61\156\x69\172\141\164\151\157\x6e")->where(["\160\141\162\145\156\164\x5f\x69\x64" => $parentId])->field("\x69\x64\54\156\141\155\145\x2c\x70\x61\162\145\x6e\x74\137\x69\x64\54\157\162\x64\x65\x72")->order("\157\162\144\145\162\40\141\163\x63\x2c\40\x69\x64\40\141\x73\x63")->select(); goto HRjib; Et9fJ: if (!(count($siblingOrganizations) <= 1)) { goto jUHBQ; } goto FzprW; BcDq1: return; goto ROsfR; Rlecv: $parentId = Db::table("\x6f\162\x67\x61\156\x69\x7a\x61\x74\151\x6f\156")->where(["\x69\144" => $id])->value("\x70\x61\x72\145\156\164\137\x69\144"); goto fs8qL; i71Pf: $i++; goto Dodbl; Dodbl: if ($i < count($siblingOrganizations)) { goto N0otQ; } goto fzD5N; vpa3A: $orderPre = $siblingOrganizations[$i - 1]["\157\x72\144\145\162"]; goto UrA6j; SQfjj: $order = $siblingOrganizations[$i]["\157\x72\x64\x65\162"]; goto vpa3A; fzD5N: vmAJV: goto MF3YH; IzXA9: sWE5v: goto SQfjj; cnjFG: kR0ui: goto i71Pf; IkzlB: $i = 0; goto Fvxqf; kVw3E: jUHBQ: goto IkzlB; OxUfn: if (!($i == 0)) { goto sWE5v; } goto Mo1PN; FzprW: return; goto kVw3E; qymTN: if (!($siblingOrganizations[$i]["\151\x64"] == $id)) { goto kR0ui; } goto OxUfn; HRjib: if (!empty($siblingOrganizations)) { goto uwn63; } goto BcDq1; ROsfR: uwn63: goto Et9fJ; UrA6j: Db::table("\x6f\162\147\141\156\151\172\x61\x74\x69\157\156")->where(["\151\144" => $id])->setField("\x6f\x72\144\145\x72", $orderPre); goto lPjb8; Mo1PN: goto vmAJV; goto IzXA9; lPjb8: Db::table("\157\162\x67\141\156\x69\172\x61\x74\151\x6f\x6e")->where(["\151\144" => $siblingOrganizations[$i - 1]["\x69\x64"]])->setField("\x6f\162\x64\145\162", $order); goto cnjFG; MF3YH: } public function down($id) { goto fSX3H; WUBin: lX6TH: goto nGd_I; QNnqZ: jq_Dc: goto K6dx3; dZBYQ: if (!(count($siblingOrganizations) <= 1)) { goto lX6TH; } goto NhBoZ; I3QWk: Db::table("\157\x72\x67\141\156\x69\172\x61\164\151\157\x6e")->where(["\151\144" => $siblingOrganizations[$i + 1]["\151\144"]])->setField("\x6f\x72\x64\x65\x72", $order); goto MWOEV; xKuEg: if (!empty($siblingOrganizations)) { goto MqSyD; } goto nqPbt; HvCf3: $siblingOrganizations = Db::table("\x6f\162\147\141\156\x69\172\x61\x74\151\157\156")->where(["\x70\141\x72\x65\156\164\x5f\x69\x64" => $parentId])->field("\151\x64\54\x6e\141\155\x65\54\x70\x61\x72\145\156\164\137\x69\144\x2c\x6f\162\144\145\x72")->order("\x6f\162\144\145\x72\x20\141\163\143\x2c\x20\151\x64\x20\141\x73\143")->select(); goto xKuEg; ua8I3: MqSyD: goto dZBYQ; nGd_I: $i = 0; goto suUw_; zLr0u: MVkq_: goto LDKNO; H1K6O: Db::table("\157\162\x67\x61\x6e\151\172\141\164\151\157\x6e")->where(["\x69\x64" => $id])->setField("\x6f\x72\144\x65\x72", $orderNext); goto I3QWk; P3_Sa: $orderNext = $siblingOrganizations[$i + 1]["\157\162\144\145\x72"]; goto H1K6O; LDKNO: $order = $siblingOrganizations[$i]["\x6f\x72\144\x65\x72"]; goto P3_Sa; fSX3H: $parentId = Db::table("\157\x72\147\x61\x6e\151\x7a\141\x74\151\x6f\x6e")->where(["\x69\x64" => $id])->value("\x70\x61\x72\x65\x6e\164\137\x69\144"); goto HvCf3; Xv0V1: if ($i < count($siblingOrganizations)) { goto FWDNe; } goto QNnqZ; gOyTM: goto jq_Dc; goto zLr0u; MWOEV: PXeP1: goto lvwHv; nqPbt: return; goto ua8I3; NhBoZ: return; goto WUBin; JePBY: if (!($siblingOrganizations[$i]["\151\144"] == $id)) { goto PXeP1; } goto enXSm; suUw_: FWDNe: goto JePBY; enXSm: if (!($i == count($siblingOrganizations) - 1)) { goto MVkq_; } goto gOyTM; lvwHv: $i++; goto Xv0V1; K6dx3: } public function changeLevel($id, $parentId) { Db::table("\157\162\147\x61\x6e\x69\x7a\141\x74\x69\157\156")->where("\151\144", $id)->setField("\x70\x61\x72\145\x6e\x74\x5f\151\144", $parentId); return true; } }
