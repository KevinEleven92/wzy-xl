<?php
 namespace app\index\logic; use think\Db; use think\Log; use app\Defs; use app\index\service\RequestContext; class Organization extends Base { public function loadTreeDatas() { goto fIEWC; BBw_A: $treeDatas[] = $this->loadTreeDataRecursively(0); goto bgXGT; fIEWC: $treeDatas = []; goto BBw_A; bgXGT: return $treeDatas; goto BdPBU; BdPBU: } protected function loadTreeDataRecursively($id = 0, $parentId = 0, $breadcrumbParent = '') { goto Sv11B; FbDSv: PSUqC: goto JVmIr; mkMc1: $breadcrumb = empty($breadcrumbParent) ? $text : $breadcrumbParent . "\x20\x26\x67\x74\x3b\40" . $text; goto vF9kO; PgwTJ: $text = Db::table("\x6f\162\x67\141\x6e\151\172\141\164\151\157\x6e")->where(["\x69\144" => $id])->value("\x6e\x61\x6d\x65"); goto x7DkN; j3PPi: foreach ($childOrganizations as $childOrganization) { goto lM5LF; VC4So: $treeNodeDatas["\143\x68\151\154\x64\x72\x65\x6e"][] = $childNodeDatas; goto CIMmu; lM5LF: $childNodeDatas = $this->loadTreeDataRecursively($childOrganization["\x69\x64"], $id, $breadcrumb); goto aqfmB; CIMmu: cC0C5: goto CzeAj; CzeAj: OLn4F: goto zgzzz; aqfmB: if (!$childNodeDatas) { goto cC0C5; } goto VC4So; zgzzz: } goto FbDSv; IZDG4: pOLr5: goto WIWtZ; bHMuK: KH0re: goto mkMc1; gC8Tm: $childOrganizations = Db::table("\x6f\x72\147\x61\x6e\x69\x7a\141\x74\151\x6f\156")->where(["\160\141\162\145\156\164\x5f\151\144" => $id])->field("\x69\144\x2c\x6e\x61\x6d\x65\x2c\x70\141\x72\x65\x6e\x74\x5f\x69\144")->order("\x6f\x72\x64\145\x72\40\141\x73\x63\x2c\40\151\x64\40\x61\x73\x63")->select(); goto j3PPi; Sv11B: if ($id == 0) { goto pOLr5; } goto PgwTJ; RFO_c: goto dDj8q; goto IZDG4; x7DkN: if (!($text === null)) { goto KH0re; } goto rN2Kz; rN2Kz: return null; goto bHMuK; dc5Cg: $breadcrumb = empty($breadcrumbParent) ? $text : $breadcrumbParent . "\40\x26\x67\x74\x3b\x20" . $text; goto q84Tp; vF9kO: $treeNodeDatas = ["\x69\144" => $id, "\x70\x61\x72\x65\x6e\x74\137\151\x64" => $parentId, "\x74\145\170\164" => $text, "\x69\143\x6f\156\103\x6c\x73" => "\x69\x63\x6f\156\163\x2d\160\x6f\x69\x6e\x74", "\163\x74\x61\x74\x65" => "\x6f\160\145\x6e", "\x63\x68\151\x6c\144\x72\145\156" => [], "\142\162\x65\141\x64\x63\x72\x75\x6d\142" => $breadcrumb]; goto RFO_c; WIWtZ: $text = "\346\x88\221\xe7\232\204\347\xbb\204\347\xbb\x87"; goto dc5Cg; JVmIr: return $treeNodeDatas; goto Zv66h; vmogs: dDj8q: goto gC8Tm; q84Tp: $treeNodeDatas = ["\x69\x64" => 0, "\160\x61\x72\145\x6e\164\137\151\x64" => 0, "\164\x65\x78\164" => $text, "\x69\143\x6f\156\x43\x6c\x73" => "\x66\141\x20\x66\141\55\143\x69\162\143\154\145", "\x73\164\x61\x74\145" => "\157\x70\x65\156", "\x63\150\151\x6c\x64\x72\145\x6e" => [], "\142\162\145\x61\144\x63\162\x75\155\x62" => $breadcrumb]; goto vmogs; Zv66h: } public function loadComboDatas($id = 0, $prefix = '', $datas = array()) { goto XsB_k; iluew: $datas[$id] = $prefix . $text; goto DfDXa; DfDXa: $nextPrefix = $prefix . $text; goto fa1hd; jUXXk: Ycysm: goto lY6WV; M8WBU: return $datas; goto J1DQg; bXARJ: $datas[$id] = "\55\350\xaf\267\351\200\211\346\x8b\251\x2d"; goto tBTEY; S1vTx: if (!$prefix) { goto uTmw6; } goto IqYJr; tBTEY: $nextPrefix = ''; goto jUXXk; VEPRX: foreach ($childOrganizations as $childOrganization) { $datas = $this->loadComboDatas($childOrganization["\151\144"], $nextPrefix, $datas); Tsdfl: } goto I8SDo; fa1hd: goto Ycysm; goto TIIOS; d6fuI: uTmw6: goto iluew; TIIOS: Rid5c: goto bXARJ; IqYJr: $prefix .= "\x3e"; goto d6fuI; I8SDo: J4vgx: goto M8WBU; Q98ug: $text = Db::table("\157\162\147\141\156\151\x7a\141\164\x69\x6f\156")->where(["\151\144" => $id])->value("\x6e\x61\155\145"); goto S1vTx; lY6WV: $childOrganizations = Db::table("\157\162\x67\141\156\x69\172\x61\x74\151\157\156")->where(["\160\141\x72\145\156\164\x5f\151\144" => $id])->field("\x69\x64\x2c\x6e\141\x6d\145\x2c\x70\141\x72\x65\x6e\x74\137\151\144")->order("\x6f\162\x64\145\x72\x20\x61\x73\x63\54\40\151\144\40\141\x73\143")->select(); goto VEPRX; XsB_k: if ($id == 0) { goto Rid5c; } goto Q98ug; J1DQg: } public function loadComboDatasLeaf($id = 0, $prefix = '', $datas = array()) { goto MDy0k; MDy0k: if ($id == 0) { goto yNapB; } goto Ea8k3; a5WGj: if (!$prefix) { goto yHKaB; } goto q2GYU; luIz1: $datas[$id] = $prefix . $text; goto NWIBp; uyHP4: foreach ($childOrganizations as $childOrganization) { $datas = $this->loadComboDatasLeaf($childOrganization["\151\144"], $nextPrefix, $datas); yz2UP: } goto REUj1; q2GYU: $prefix .= "\x3e"; goto pN0gZ; WXqgp: if (!($childCount == 0)) { goto AsBt2; } goto luIz1; Ea8k3: $text = Db::table("\157\x72\x67\141\x6e\x69\x7a\141\x74\x69\x6f\156")->where(["\151\144" => $id])->value("\156\x61\x6d\145"); goto a5WGj; REUj1: FA4RH: goto r0WoW; fy2nr: $datas[$id] = "\x2d\xe8\xaf\267\xe9\x80\x89\xe6\x8b\251\x2d"; goto bRrwv; pN0gZ: yHKaB: goto DroE7; NWIBp: AsBt2: goto LugYu; eeDE6: $childOrganizations = Db::table("\157\x72\x67\141\156\x69\x7a\x61\x74\x69\x6f\156")->where(["\x70\141\162\145\156\x74\x5f\x69\x64" => $id])->field("\x69\144\x2c\156\x61\155\145\54\x70\141\x72\x65\x6e\164\x5f\x69\144")->order("\x6f\x72\x64\145\162\x20\141\163\x63\x2c\x20\x69\x64\40\141\163\x63")->select(); goto uyHP4; iEqAh: goto BB6Tf; goto gO3Gp; DroE7: $childCount = Db::table("\x6f\162\147\141\x6e\x69\172\141\x74\x69\x6f\x6e")->where(["\160\x61\162\x65\x6e\164\x5f\151\x64" => $id])->count(); goto WXqgp; LugYu: $nextPrefix = $prefix . $text; goto iEqAh; ytaBA: BB6Tf: goto eeDE6; gO3Gp: yNapB: goto fy2nr; r0WoW: return $datas; goto VzTs3; bRrwv: $nextPrefix = ''; goto ytaBA; VzTs3: } public function loadFullText($id, $suffix = '') { goto JFp6H; rT0kF: $fullText = $organization["\156\x61\x6d\145"]; goto mW3PB; mW3PB: if (!$suffix) { goto O14dA; } goto T94_M; o2ALL: return $suffix; goto fQqhg; fQqhg: hZlQM: goto R4fYb; T94_M: $fullText .= "\40\x26\x67\x74\73\40" . $suffix; goto NfUH9; R4fYb: $organization = Db::table("\157\162\147\x61\156\x69\172\x61\164\151\x6f\x6e")->where(["\x69\x64" => $id])->field("\156\x61\x6d\145\x2c\x20\160\x61\x72\145\156\164\137\151\x64")->find(); goto or96h; nM9ht: return $fullText; goto J17uR; ZLJOc: V9PE3: goto rT0kF; JFp6H: if (!($id == 0)) { goto hZlQM; } goto o2ALL; EDDah: $fullText = $this->loadFullText($organization["\160\x61\162\x65\156\x74\137\x69\x64"], $fullText); goto nM9ht; NfUH9: O14dA: goto EDDah; uXK3Z: return $suffix; goto ZLJOc; or96h: if (!empty($organization)) { goto V9PE3; } goto uXK3Z; J17uR: } public function isEmpty() { $count = Db::table("\157\162\147\x61\156\151\172\x61\164\x69\157\156")->where(["\160\x61\x72\x65\x6e\x74\137\151\x64" => 0])->count(); return $count ? false : true; } public function add($name, $parentId) { goto Xs6YB; pYI6n: return true; goto SqZLM; Xs6YB: $data = array("\156\x61\155\x65" => $name, "\160\141\x72\x65\156\164\x5f\151\x64" => $parentId); goto Yaiet; t4E8g: Db::table("\157\162\x67\141\156\x69\172\x61\164\x69\x6f\x6e")->where(["\151\144" => $id])->setField("\x6f\162\x64\x65\x72", $id); goto pYI6n; Yaiet: $id = Db::table("\157\162\x67\x61\156\151\172\141\164\151\x6f\x6e")->insertGetId($data); goto t4E8g; SqZLM: } public function update($id, $name) { goto uOnvb; uOnvb: $data = array("\156\x61\155\145" => $name); goto AKfyH; AKfyH: Db::table("\157\162\x67\x61\156\151\172\x61\x74\x69\x6f\156")->where("\151\144", $id)->update($data); goto HGyn6; HGyn6: return true; goto D25r8; D25r8: } public function delete($id) { goto u0Gyo; ppdpJ: $result = Db::table("\x6f\x72\x67\x61\x6e\x69\x7a\x61\x74\x69\157\156")->where("\x69\144", $id)->delete(); goto Cd_xs; u0Gyo: Db::table("\143\165\x73\164\157\155\x65\x72")->where(["\x6f\162\x67\x61\156\151\x7a\141\x74\151\157\156\137\151\x64" => $id])->setField("\157\x72\147\x61\x6e\151\x7a\141\x74\151\x6f\156\x5f\x69\144", 0); goto ppdpJ; Cd_xs: return $result != 1 ? false : true; goto NRjdN; NRjdN: } public function up($id) { goto AXRno; CDUuD: Vomxv: goto v74K3; xnPRA: oQqzl: goto WPOOv; IRPwU: $siblingOrganizations = Db::table("\157\162\x67\141\156\x69\172\141\x74\151\x6f\156")->where(["\160\x61\162\x65\156\164\x5f\x69\x64" => $parentId])->field("\151\x64\x2c\156\141\155\145\x2c\x70\141\x72\x65\x6e\x74\137\151\x64\x2c\157\162\144\145\162")->order("\x6f\162\x64\x65\162\40\141\x73\x63\54\x20\x69\x64\x20\141\163\143")->select(); goto GAKMf; dD2cf: yKW_K: goto RUIPT; PLS0R: $orderPre = $siblingOrganizations[$i - 1]["\x6f\x72\144\x65\x72"]; goto k7td7; M6wv1: goto oQqzl; goto CDUuD; ANoX3: UbHXW: goto OB2Ff; v74K3: $order = $siblingOrganizations[$i]["\157\x72\x64\145\162"]; goto PLS0R; k7td7: Db::table("\x6f\x72\147\x61\x6e\151\172\x61\164\151\x6f\156")->where(["\151\144" => $id])->setField("\x6f\162\144\x65\162", $orderPre); goto acLGE; W9gcR: return; goto dD2cf; GAKMf: if (!empty($siblingOrganizations)) { goto wv6IG; } goto nt04e; OB2Ff: $i++; goto gZ4yM; JrbOl: if (!($siblingOrganizations[$i]["\x69\144"] == $id)) { goto UbHXW; } goto FgfSx; FgfSx: if (!($i == 0)) { goto Vomxv; } goto M6wv1; RUIPT: $i = 0; goto Hn3DB; acLGE: Db::table("\x6f\x72\147\141\156\151\172\x61\x74\151\x6f\156")->where(["\x69\144" => $siblingOrganizations[$i - 1]["\151\144"]])->setField("\x6f\162\x64\145\162", $order); goto ANoX3; rgEhG: if (!(count($siblingOrganizations) <= 1)) { goto yKW_K; } goto W9gcR; AXRno: $parentId = Db::table("\x6f\x72\x67\141\156\151\172\141\x74\151\157\x6e")->where(["\x69\144" => $id])->value("\x70\141\162\x65\156\164\x5f\x69\x64"); goto IRPwU; gZ4yM: if ($i < count($siblingOrganizations)) { goto kmd1K; } goto xnPRA; nt04e: return; goto JcZrQ; JcZrQ: wv6IG: goto rgEhG; Hn3DB: kmd1K: goto JrbOl; WPOOv: } public function down($id) { goto T7U7H; nYBx6: Rh17W: goto lIdBl; huACq: n5RLI: goto a_lXP; lIdBl: if (!(count($siblingOrganizations) <= 1)) { goto n5RLI; } goto yhGSc; YjDcB: $order = $siblingOrganizations[$i]["\x6f\162\x64\145\x72"]; goto BsE4v; Z5E5K: if (!empty($siblingOrganizations)) { goto Rh17W; } goto JumRM; a_lXP: $i = 0; goto XNUZj; T7U7H: $parentId = Db::table("\x6f\x72\147\x61\x6e\x69\172\141\x74\151\157\156")->where(["\x69\144" => $id])->value("\x70\141\162\145\x6e\164\x5f\x69\144"); goto YVzBb; FV5Pl: $i++; goto QWiF_; Gk71Y: NdYPx: goto acwkK; Dus83: Db::table("\157\162\147\x61\156\151\x7a\141\x74\151\157\156")->where(["\151\x64" => $siblingOrganizations[$i + 1]["\151\x64"]])->setField("\157\x72\144\145\x72", $order); goto Bd9Wh; s5tBH: if (!($i == count($siblingOrganizations) - 1)) { goto NT4Uv; } goto vd2ZV; yhGSc: return; goto huACq; nZa16: NT4Uv: goto YjDcB; JumRM: return; goto nYBx6; XNUZj: fJVPD: goto dY_xG; V3Vz9: Db::table("\157\x72\x67\x61\x6e\151\x7a\141\164\x69\157\x6e")->where(["\x69\144" => $id])->setField("\157\162\144\145\x72", $orderNext); goto Dus83; YVzBb: $siblingOrganizations = Db::table("\157\162\x67\x61\156\x69\x7a\141\x74\x69\157\156")->where(["\160\141\162\145\x6e\x74\x5f\x69\x64" => $parentId])->field("\151\x64\54\x6e\x61\x6d\x65\54\x70\x61\162\145\156\164\137\x69\x64\x2c\x6f\x72\144\x65\162")->order("\x6f\x72\144\145\162\40\x61\x73\143\54\x20\x69\144\x20\x61\x73\143")->select(); goto Z5E5K; QWiF_: if ($i < count($siblingOrganizations)) { goto fJVPD; } goto Gk71Y; dY_xG: if (!($siblingOrganizations[$i]["\151\144"] == $id)) { goto p3oNi; } goto s5tBH; BsE4v: $orderNext = $siblingOrganizations[$i + 1]["\x6f\x72\144\145\x72"]; goto V3Vz9; vd2ZV: goto NdYPx; goto nZa16; Bd9Wh: p3oNi: goto FV5Pl; acwkK: } public function changeLevel($id, $parentId) { Db::table("\157\x72\147\x61\156\151\x7a\x61\x74\151\157\x6e")->where("\x69\144", $id)->setField("\x70\x61\x72\x65\x6e\x74\x5f\x69\x64", $parentId); return true; } }
