<?php
 namespace app\index\logic; use think\Db; use think\Config; use think\Log; class Install extends Base { protected $_serverResult = array("\x73\x65\x72\x76\145\162" => array(null, null), "\x70\x68\x70\x76\145\162" => array(null, null), "\160\141\164\x68" => array(null, null)); protected $_extensionResult = array("\x63\165\162\x6c" => array(null, null), "\147\x64\x32" => array(null, null), "\x6f\x70\145\156\163\163\154" => array(null, null), "\160\x64\157\137\x6d\x79\163\x71\x6c" => array(null, null), "\x70\x64\157\137\163\161\x6c\x69\164\x65" => array(null, null), "\x7a\x69\160" => array(null, null), "\155\x62\163\x74\x72\x69\x6e\x67" => array(null, null), "\x66\x69\x6c\145\151\156\146\x6f" => array(null, null)); protected $_privilegeResult = array("\x6c\x6f\143\x61\x6c" => array(null, null), "\162\x65\160\157\162\x74" => array(null, null), "\x74\145\x6d\160" => array(null, null), "\162\165\156\x74\151\x6d\x65" => array(null, null), "\x70\x75\142\x6c\151\x63\57\x75\160\154\x6f\x61\144" => array(null, null), "\x70\165\x62\x6c\151\x63\x2f\x65\170\x70\x6f\162\164" => array(null, null), "\160\x75\x62\x6c\x69\143\x2f\161\x72\x63\157\144\145" => array(null, null), "\160\x75\x62\x6c\x69\143\x2f\x69\155\x70\157\162\164" => array(null, null)); public function checkServer() { goto PC7cC; s3e1c: return $this->_serverResult; goto O5Vpi; PC7cC: global $_SERVER; goto FAEFa; FAEFa: $this->_serverResult["\163\x65\x72\x76\x65\162"][0] = $_SERVER["\x53\x45\x52\x56\105\x52\137\x53\117\x46\124\x57\x41\x52\105"]; goto O73hO; ODmbR: if (version_compare(PHP_VERSION, "\x37\56\x34\56\x30") >= 0) { goto IuUtU; } goto yTskP; UUnqm: goto QeiBT; goto bJp2n; nxr7x: $this->_serverResult["\x70\150\160\x76\145\162"][0] = PHP_VERSION; goto ODmbR; yTskP: $this->_serverResult["\x70\150\160\166\x65\x72"][1] = false; goto UUnqm; bJp2n: IuUtU: goto Cm5Y9; TyEUa: $this->_serverResult["\x70\141\164\150"][0] = ROOT_PATH; goto CjSxF; CjSxF: $this->_serverResult["\x70\x61\x74\150"][1] = true; goto s3e1c; Cm5Y9: $this->_serverResult["\160\x68\x70\x76\145\x72"][1] = true; goto ySlxK; O73hO: $this->_serverResult["\163\x65\x72\166\145\162"][1] = true; goto nxr7x; ySlxK: QeiBT: goto TyEUa; O5Vpi: } public function checkExtension() { goto sD8iQ; nUwje: if (!extension_loaded("\x66\x69\154\145\x69\156\x66\157")) { goto i3F4I; } goto TWMFc; jXndT: if (!function_exists("\147\144\x5f\151\156\x66\157")) { goto SrCzR; } goto EtwBa; JgAdQ: Iey9s: goto qJT8q; sD8iQ: if (!function_exists("\143\x75\x72\x6c\137\166\145\x72\163\151\x6f\x6e")) { goto Iey9s; } goto RAlHR; hw_vU: if (!defined("\117\x50\105\116\x53\x53\x4c\x5f\x56\x45\122\x53\x49\x4f\x4e\137\124\105\130\124")) { goto np8nX; } goto K39ty; jZjrN: $this->_extensionResult["\x70\144\157\137\155\x79\x73\161\x6c"][0] = "\x20"; goto Kh4qg; Pbqf2: $this->_extensionResult["\157\160\x65\x6e\163\163\x6c"][1] = true; goto ScUNC; ApCNA: crLJD: goto nUwje; NgR_i: $a = \PDO::getAvailableDrivers(); goto tIDFI; E0WSZ: Stmpi: goto FJDGi; V_30U: i3F4I: goto jXndT; tIDFI: $v = ''; goto Ujs5O; qDHI6: $this->_extensionResult["\143\165\x72\154"][1] = true; goto JgAdQ; lS6ug: $v .= "\x20\x73\161\x6c\x69\164\145\62"; goto WO6_4; EO3Yq: $this->_extensionResult["\x6d\142\x73\164\162\151\156\147"][0] = mb_language(); goto osnVg; qJT8q: if (!class_exists("\x5a\151\x70\101\x72\143\x68\151\x76\145")) { goto crLJD; } goto ROQYj; xHFA3: SrCzR: goto BBd_Q; CKH9H: $this->_extensionResult["\x63\165\x72\x6c"][0] = $info["\166\x65\162\x73\151\x6f\x6e"]; goto qDHI6; ROQYj: $this->_extensionResult["\172\x69\160"][0] = "\40"; goto DxiLh; niNB_: $this->_extensionResult["\147\x64\62"][0] = $info["\107\104\40\x56\x65\162\x73\x69\157\x6e"]; goto b2Clj; HlGkB: if (!in_array("\x73\161\x6c\151\164\145\x32", $a)) { goto Oqopk; } goto lS6ug; Ie3EZ: dOSmH: goto S5bvz; Kh4qg: $this->_extensionResult["\160\144\157\x5f\x6d\x79\x73\161\154"][1] = true; goto E0WSZ; l48wh: return $this->_extensionResult; goto C06kO; JWAAC: $this->_extensionResult["\146\151\x6c\145\151\156\x66\x6f"][1] = true; goto V_30U; WO6_4: Oqopk: goto Y_bAr; RAlHR: $info = curl_version(); goto CKH9H; oP5O8: $v .= "\x73\x71\x6c\x69\164\145\x33"; goto JDxbK; K39ty: $this->_extensionResult["\157\x70\145\x6e\163\163\x6c"][0] = OPENSSL_VERSION_TEXT; goto Pbqf2; b2Clj: $this->_extensionResult["\x67\144\x32"][1] = true; goto xHFA3; Y_bAr: $this->_extensionResult["\x70\x64\x6f\x5f\163\x71\154\151\164\x65"][0] = $v; goto Mbd_8; JDxbK: teUgY: goto HlGkB; FJDGi: if (!extension_loaded("\x70\144\157\137\163\161\154\151\164\145")) { goto dOSmH; } goto NgR_i; Ujs5O: if (!in_array("\163\x71\154\x69\x74\x65", $a)) { goto teUgY; } goto oP5O8; BBd_Q: if (!function_exists("\155\142\137\154\141\156\147\x75\x61\147\145")) { goto WnYHk; } goto EO3Yq; DxiLh: $this->_extensionResult["\172\151\160"][1] = true; goto ApCNA; TWMFc: $this->_extensionResult["\x66\x69\154\145\151\156\x66\157"][0] = "\x20"; goto JWAAC; dePdC: WnYHk: goto yGahN; Mbd_8: $this->_extensionResult["\160\x64\157\137\x73\161\154\x69\164\145"][1] = true; goto Ie3EZ; osnVg: $this->_extensionResult["\155\142\163\x74\162\x69\x6e\x67"][1] = true; goto dePdC; EtwBa: $info = gd_info(); goto niNB_; ScUNC: np8nX: goto l48wh; yGahN: if (!class_exists("\120\104\117", false)) { goto nxk5d; } goto bSSBc; bSSBc: if (!extension_loaded("\160\x64\x6f\137\155\171\163\x71\x6c")) { goto Stmpi; } goto jZjrN; S5bvz: nxk5d: goto hw_vU; C06kO: } public function checkPrivilege() { goto ufNSY; V3xYX: nxAUY: goto C1shh; C1shh: return $this->_privilegeResult; goto de5tv; ufNSY: foreach ($this->_privilegeResult as $path => &$result) { goto E_Riv; UqyGs: gLsk8: goto Dry54; E_Riv: $s = $this->GetFilePerms(ROOT_PATH . $path); goto ZBpWJ; JBmle: goto WIX6m; goto WLPzS; ZBpWJ: $o = $this->GetFilePermsOct(ROOT_PATH . $path); goto ZyN07; VtfpH: if (substr($s, 0, 1) == "\x2d") { goto OEeDh; } goto F0JLN; ZyN07: $isWritable = is_writable(ROOT_PATH . $path); goto YxPcY; F0JLN: $result[1] = $isWritable && (substr($s, 1, 1) == "\162" && substr($s, 2, 1) == "\167" && substr($s, 3, 1) == "\x78" && substr($s, 4, 1) == "\162" && substr($s, 7, 1) == "\162" && substr($s, 6, 1) == "\x78" && substr($s, 9, 1) == "\170") ? true : false; goto JBmle; gDIdi: WIX6m: goto UqyGs; m7z29: $result[1] = $isWritable && (substr($s, 1, 1) == "\162" && substr($s, 2, 1) == "\x77" && substr($s, 4, 1) == "\162" && substr($s, 7, 1) == "\x72") ? true : false; goto gDIdi; YxPcY: $result[0] = $s . "\x20\174\x20" . $o; goto VtfpH; WLPzS: OEeDh: goto m7z29; Dry54: } goto V3xYX; de5tv: } private function GetFilePermsOct($f) { goto VNGzs; uvplT: SaZ14: goto WWZA6; jK8ou: return ''; goto uvplT; VNGzs: if (file_exists($f)) { goto SaZ14; } goto jK8ou; WWZA6: return substr(sprintf("\x25\x6f", fileperms($f)), -4); goto FOnV7; FOnV7: } private function GetFilePerms($f) { goto ogn0O; HXtLB: $info .= $perms & 0x4 ? "\x72" : "\55"; goto QlQmH; Xsg9N: $info .= $perms & 0x8 ? $perms & 0x400 ? "\x73" : "\170" : ($perms & 0x400 ? "\123" : "\55"); goto HXtLB; DUpTF: switch ($perms & 0xf000) { case 0xc000: $info = "\163"; goto iYadc; case 0xa000: $info = "\x6c"; goto iYadc; case 0x8000: $info = "\55"; goto iYadc; case 0x6000: $info = "\x62"; goto iYadc; case 0x4000: $info = "\144"; goto iYadc; case 0x2000: $info = "\x63"; goto iYadc; case 0x1000: $info = "\160"; goto iYadc; default: $info = "\165"; } goto yNN4q; ogn0O: if (file_exists($f)) { goto YzyZB; } goto eVXGu; hYBz8: $info .= $perms & 0x1 ? $perms & 0x200 ? "\x74" : "\x78" : ($perms & 0x200 ? "\x54" : "\x2d"); goto aXZ7l; aXZ7l: return $info; goto l9gtW; CdMmK: $info .= $perms & 0x100 ? "\x72" : "\x2d"; goto qbuIU; eVXGu: return ''; goto rt5I_; rt5I_: YzyZB: goto GYNak; GYNak: $perms = fileperms($f); goto DUpTF; Shwow: $info .= $perms & 0x10 ? "\x77" : "\55"; goto Xsg9N; YbruZ: iYadc: goto CdMmK; qbuIU: $info .= $perms & 0x80 ? "\167" : "\55"; goto B0D2z; yNN4q: TvhsD: goto YbruZ; lwfDf: $info .= $perms & 0x20 ? "\x72" : "\x2d"; goto Shwow; B0D2z: $info .= $perms & 0x40 ? $perms & 0x800 ? "\163" : "\170" : ($perms & 0x800 ? "\x53" : "\55"); goto lwfDf; QlQmH: $info .= $perms & 0x2 ? "\x77" : "\x2d"; goto hYBz8; l9gtW: } public function importDb($formData) { goto JwDJG; kLKkH: if (file_exists($sqlFile)) { goto kdQRm; } goto XmZHT; rNRkO: if ($result) { goto RQWXv; } goto L43W2; DqD6m: $config = ["\x68\157\x73\164\x6e\x61\155\145" => $formData["\x68\x6f\163\164\x6e\x61\x6d\145"], "\144\x61\x74\141\x62\141\x73\x65" => $formData["\x64\x61\164\141\x62\141\x73\x65"], "\x75\x73\x65\162\x6e\141\x6d\x65" => $formData["\x75\163\x65\162\156\x61\155\x65"], "\x70\141\x73\163\x77\157\x72\x64" => $formData["\x70\141\x73\x73\x77\x6f\162\144"], "\x68\157\163\164\x70\157\x72\164" => $formData["\150\x6f\x73\164\x70\157\x72\164"]]; goto DqG31; f3YPS: $templine = ''; goto Xfe7d; JwDJG: Config::set("\144\141\x74\141\142\x61\x73\x65", array_merge(Config::get("\x64\x61\164\141\142\x61\163\145"), ["\150\x6f\x73\164\x6e\141\x6d\x65" => $formData["\150\157\x73\x74\x6e\x61\155\x65"], "\x64\x61\x74\141\142\x61\163\x65" => $formData["\144\141\164\x61\142\141\x73\145"], "\x75\163\x65\162\x6e\141\155\x65" => $formData["\x75\x73\x65\x72\156\x61\155\145"], "\160\x61\163\x73\167\157\162\144" => $formData["\160\x61\163\x73\167\x6f\162\x64"], "\x68\157\163\x74\x70\x6f\x72\x74" => $formData["\x68\157\163\x74\160\157\x72\x74"]])); goto fGeW9; Xfe7d: $lines = file($sqlFile); goto M15ww; DqG31: $configContent = "\74\x3f\160\x68\160\15\xa\x72\x65\164\165\162\156\x20"; goto nSCBO; crZVS: $configContent .= "\73"; goto ooLYv; fGeW9: Db::connect(); goto Q8Hlg; xDtxk: RQWXv: goto Oim9x; LjzZS: oQguf: goto DqD6m; M15ww: foreach ($lines as $line) { goto Hus7W; DHF45: CkU2B: goto lhU0e; IOXob: MpIEo: goto oIsUE; bSl9s: if (!(substr(trim($line), -1, 1) == "\73")) { goto F0AcE; } goto Ddhu7; Ddhu7: Db::execute($templine); goto gfsND; gfsND: $templine = ''; goto zx5t1; UQ8fN: goto CkU2B; goto IOXob; zx5t1: F0AcE: goto DHF45; Hus7W: if (!(substr($line, 0, 2) == "\x2d\x2d" || $line == '')) { goto MpIEo; } goto UQ8fN; oIsUE: $templine .= $line; goto bSl9s; lhU0e: } goto LjzZS; nn3O9: kdQRm: goto f3YPS; Q8Hlg: $sqlFile = ROOT_PATH . "\144\142" . DS . "\144\x62\x2e\163\161\154"; goto kLKkH; XmZHT: exception("\xe5\x88\x9d\345\xa7\213\xe5\x8c\226\163\x71\154\346\x96\207\xe4\273\xb6\344\xb8\x8d\345\255\230\345\234\250"); goto nn3O9; L43W2: exception("\346\x95\260\346\215\256\xe5\xba\223\351\205\x8d\347\xbd\xae\xe6\226\207\xe4\273\266\xe5\206\x99\xe5\x85\xa5\345\xa4\xb1\xe8\264\xa5"); goto xDtxk; ooLYv: $result = file_put_contents(ROOT_PATH . "\154\157\143\x61\x6c" . DS . "\x64\141\x74\141\x62\141\x73\x65\x2e\x70\x68\160", $configContent); goto rNRkO; nSCBO: $configContent .= var_export($config, true); goto crZVS; Oim9x: } }
