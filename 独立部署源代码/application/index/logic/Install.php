<?php
 namespace app\index\logic; use think\Db; use think\Config; use think\Log; class Install extends Base { protected $_serverResult = array("\x73\x65\162\x76\145\162" => array(null, null), "\x70\x68\160\166\145\162" => array(null, null), "\x70\141\x74\150" => array(null, null)); protected $_extensionResult = array("\143\x75\x72\x6c" => array(null, null), "\147\x64\x32" => array(null, null), "\x6f\160\x65\156\x73\163\154" => array(null, null), "\160\144\157\137\155\171\x73\161\154" => array(null, null), "\160\x64\157\137\163\x71\x6c\151\x74\145" => array(null, null), "\x7a\x69\x70" => array(null, null), "\x6d\x62\x73\164\162\x69\x6e\x67" => array(null, null), "\x66\151\x6c\x65\151\156\x66\157" => array(null, null)); protected $_privilegeResult = array("\x6c\157\x63\141\154" => array(null, null), "\x72\x65\x70\157\x72\x74" => array(null, null), "\x74\x65\155\160" => array(null, null), "\x72\x75\x6e\164\x69\x6d\x65" => array(null, null), "\x70\165\x62\x6c\x69\x63\57\165\160\154\157\141\x64" => array(null, null), "\160\165\142\x6c\151\143\57\145\170\x70\157\162\x74" => array(null, null), "\x70\x75\x62\154\151\143\x2f\x71\162\143\157\x64\145" => array(null, null), "\x70\x75\142\154\151\x63\x2f\x69\155\x70\x6f\162\x74" => array(null, null)); public function checkServer() { goto smPD6; hKneu: $this->_serverResult["\160\x61\x74\x68"][1] = true; goto q7dHo; ej7mF: $this->_serverResult["\x73\x65\162\166\x65\x72"][1] = true; goto ddxQ9; Zsa1l: qOb21: goto vgEdv; lCeNA: muntQ: goto Sa2cR; Qk2em: if (version_compare(PHP_VERSION, "\x37\56\64\x2e\x30") >= 0) { goto qOb21; } goto DpVFn; EOh4K: $this->_serverResult["\163\145\162\166\145\x72"][0] = $_SERVER["\x53\105\122\126\105\122\x5f\x53\x4f\106\x54\127\101\122\105"]; goto ej7mF; ddxQ9: $this->_serverResult["\160\150\x70\166\145\x72"][0] = PHP_VERSION; goto Qk2em; Sa2cR: $this->_serverResult["\x70\141\x74\150"][0] = ROOT_PATH; goto hKneu; q7dHo: return $this->_serverResult; goto VPjNe; DpVFn: $this->_serverResult["\x70\x68\160\x76\x65\162"][1] = false; goto MmW1N; vgEdv: $this->_serverResult["\160\x68\x70\166\x65\x72"][1] = true; goto lCeNA; smPD6: global $_SERVER; goto EOh4K; MmW1N: goto muntQ; goto Zsa1l; VPjNe: } public function checkExtension() { goto CeVBr; ey2A2: g_W3_: goto BnvoM; N7tmF: $this->_extensionResult["\147\x64\x32"][0] = $info["\x47\104\x20\126\x65\162\x73\x69\157\156"]; goto MWAWB; UFJe5: fT9Md: goto FZouJ; ZyOi9: $this->_extensionResult["\x63\165\162\x6c"][0] = $info["\x76\145\162\x73\x69\x6f\156"]; goto PVTdO; qS2wg: if (!class_exists("\x5a\x69\x70\101\x72\x63\150\151\166\x65")) { goto fT9Md; } goto qsfkQ; BnvoM: return $this->_extensionResult; goto clqCc; p6_6c: $this->_extensionResult["\x70\x64\x6f\x5f\155\171\x73\x71\x6c"][0] = "\40"; goto fmD0X; KtjKT: if (!defined("\117\x50\105\116\x53\x53\114\x5f\x56\105\x52\x53\111\117\x4e\137\x54\x45\x58\124")) { goto g_W3_; } goto rnf6p; FZouJ: if (!extension_loaded("\146\151\x6c\x65\151\x6e\x66\157")) { goto SAVve; } goto HacMJ; cSLD_: $v = ''; goto DSa1a; Wvrpq: DAvC2: goto XvmCv; PVTdO: $this->_extensionResult["\143\x75\162\154"][1] = true; goto XG4ag; z3BM0: NB6RA: goto KtjKT; oOy4N: if (!function_exists("\x6d\x62\x5f\154\x61\156\x67\165\x61\147\145")) { goto As7gj; } goto wQvv5; oUWTa: sfjBa: goto z3BM0; W7vzn: $this->_extensionResult["\x7a\x69\x70"][1] = true; goto UFJe5; DCiRG: GFAWB: goto hZivV; wQvv5: $this->_extensionResult["\x6d\142\163\x74\x72\x69\x6e\147"][0] = mb_language(); goto JQzU8; p4Dt1: $a = \PDO::getAvailableDrivers(); goto cSLD_; MWAWB: $this->_extensionResult["\147\x64\62"][1] = true; goto b0JV6; XvmCv: $this->_extensionResult["\x70\x64\157\x5f\x73\x71\154\x69\164\145"][0] = $v; goto cZoTc; MeUdz: $v .= "\40\x73\x71\154\151\x74\145\62"; goto Wvrpq; CeVBr: if (!function_exists("\x63\x75\162\x6c\x5f\166\145\162\163\x69\157\156")) { goto omMTo; } goto vdvyY; ZnppP: $this->_extensionResult["\x66\151\x6c\x65\x69\x6e\146\x6f"][1] = true; goto ev2N8; b0JV6: q4t6W: goto oOy4N; CEHF4: t4QHM: goto Ov1xU; oYat3: if (!class_exists("\120\x44\117", false)) { goto NB6RA; } goto OrZF3; OrZF3: if (!extension_loaded("\x70\x64\x6f\x5f\x6d\171\163\161\x6c")) { goto t4QHM; } goto p6_6c; Ov1xU: if (!extension_loaded("\x70\x64\157\137\x73\161\x6c\151\164\145")) { goto sfjBa; } goto p4Dt1; tP3SR: if (!function_exists("\147\144\137\x69\156\146\x6f")) { goto q4t6W; } goto dhWaL; JQzU8: $this->_extensionResult["\155\142\x73\164\x72\151\156\x67"][1] = true; goto HZprz; ev2N8: SAVve: goto tP3SR; fmD0X: $this->_extensionResult["\160\144\x6f\137\155\x79\163\x71\x6c"][1] = true; goto CEHF4; hZivV: if (!in_array("\x73\161\x6c\151\x74\x65\x32", $a)) { goto DAvC2; } goto MeUdz; GgDvZ: $v .= "\163\x71\x6c\x69\164\x65\63"; goto DCiRG; XG4ag: omMTo: goto qS2wg; HacMJ: $this->_extensionResult["\146\x69\x6c\x65\151\156\x66\x6f"][0] = "\40"; goto ZnppP; vdvyY: $info = curl_version(); goto ZyOi9; DSa1a: if (!in_array("\x73\x71\154\x69\x74\x65", $a)) { goto GFAWB; } goto GgDvZ; qsfkQ: $this->_extensionResult["\x7a\x69\160"][0] = "\x20"; goto W7vzn; HZprz: As7gj: goto oYat3; cZoTc: $this->_extensionResult["\x70\x64\x6f\137\x73\161\154\x69\164\145"][1] = true; goto oUWTa; mynxH: $this->_extensionResult["\x6f\160\x65\156\x73\x73\x6c"][1] = true; goto ey2A2; dhWaL: $info = gd_info(); goto N7tmF; rnf6p: $this->_extensionResult["\157\x70\x65\x6e\163\163\x6c"][0] = OPENSSL_VERSION_TEXT; goto mynxH; clqCc: } public function checkPrivilege() { goto nZPVS; nZPVS: foreach ($this->_privilegeResult as $path => &$result) { goto qS7KF; ov4kw: if (substr($s, 0, 1) == "\x2d") { goto wlOeE; } goto Dgj9Q; qS7KF: $s = $this->GetFilePerms(ROOT_PATH . $path); goto c_qJ0; V5cE0: $result[1] = $isWritable && (substr($s, 1, 1) == "\x72" && substr($s, 2, 1) == "\167" && substr($s, 4, 1) == "\162" && substr($s, 7, 1) == "\162") ? true : false; goto Y03FW; Y03FW: EipPh: goto B9aYl; BF46A: goto EipPh; goto T3LLu; B9aYl: uyCUW: goto QWmtj; sYQct: $isWritable = is_writable(ROOT_PATH . $path); goto Pq77b; Dgj9Q: $result[1] = $isWritable && (substr($s, 1, 1) == "\162" && substr($s, 2, 1) == "\167" && substr($s, 3, 1) == "\170" && substr($s, 4, 1) == "\162" && substr($s, 7, 1) == "\162" && substr($s, 6, 1) == "\170" && substr($s, 9, 1) == "\x78") ? true : false; goto BF46A; Pq77b: $result[0] = $s . "\x20\174\x20" . $o; goto ov4kw; c_qJ0: $o = $this->GetFilePermsOct(ROOT_PATH . $path); goto sYQct; T3LLu: wlOeE: goto V5cE0; QWmtj: } goto LTcNF; LTcNF: Hu9kU: goto rTe1l; rTe1l: return $this->_privilegeResult; goto MOQFR; MOQFR: } private function GetFilePermsOct($f) { goto m4p4M; m4p4M: if (file_exists($f)) { goto ZVl93; } goto a1buW; zegWN: return substr(sprintf("\45\x6f", fileperms($f)), -4); goto tdRN_; iAB1v: ZVl93: goto zegWN; a1buW: return ''; goto iAB1v; tdRN_: } private function GetFilePerms($f) { goto oQEQq; xoQiU: $info .= $perms & 0x80 ? "\167" : "\x2d"; goto kAFPM; TTgBs: $perms = fileperms($f); goto lF1qY; Ii73i: PEdaW: goto NPA1o; oQEQq: if (file_exists($f)) { goto dWmtT; } goto UEqLQ; hoaCN: return $info; goto d0xAr; lF1qY: switch ($perms & 0xf000) { case 0xc000: $info = "\163"; goto PEdaW; case 0xa000: $info = "\x6c"; goto PEdaW; case 0x8000: $info = "\x2d"; goto PEdaW; case 0x6000: $info = "\x62"; goto PEdaW; case 0x4000: $info = "\x64"; goto PEdaW; case 0x2000: $info = "\x63"; goto PEdaW; case 0x1000: $info = "\160"; goto PEdaW; default: $info = "\165"; } goto TDy8q; K8XZu: $info .= $perms & 0x10 ? "\x77" : "\x2d"; goto vuAB5; nxJqu: $info .= $perms & 0x1 ? $perms & 0x200 ? "\x74" : "\170" : ($perms & 0x200 ? "\124" : "\55"); goto hoaCN; NPA1o: $info .= $perms & 0x100 ? "\x72" : "\x2d"; goto xoQiU; osHCO: dWmtT: goto TTgBs; ZRPmk: $info .= $perms & 0x20 ? "\x72" : "\55"; goto K8XZu; TDy8q: wr05b: goto Ii73i; kAFPM: $info .= $perms & 0x40 ? $perms & 0x800 ? "\x73" : "\170" : ($perms & 0x800 ? "\x53" : "\55"); goto ZRPmk; UEqLQ: return ''; goto osHCO; lyfQE: $info .= $perms & 0x4 ? "\162" : "\x2d"; goto pp12W; pp12W: $info .= $perms & 0x2 ? "\x77" : "\x2d"; goto nxJqu; vuAB5: $info .= $perms & 0x8 ? $perms & 0x400 ? "\x73" : "\x78" : ($perms & 0x400 ? "\123" : "\x2d"); goto lyfQE; d0xAr: } public function importDb($formData) { goto fyg30; d1D3h: $templine = ''; goto cUTnb; uCDYY: exception("\346\x95\260\xe6\x8d\256\xe5\xba\x93\351\x85\215\347\275\xae\346\x96\207\xe4\xbb\xb6\345\x86\x99\345\205\245\xe5\xa4\261\xe8\264\245"); goto gDYM9; F_fuh: xcSRX: goto d1D3h; Na2qa: if (file_exists($sqlFile)) { goto xcSRX; } goto HuN2D; jl9ev: $sqlFile = ROOT_PATH . "\x64\x62" . DS . "\x64\x62\56\x73\x71\154"; goto Na2qa; fyg30: Config::set("\x64\141\164\x61\142\141\x73\145", array_merge(Config::get("\144\x61\164\141\x62\x61\163\x65"), ["\x68\x6f\x73\164\x6e\141\155\x65" => $formData["\x68\157\x73\164\x6e\141\155\x65"], "\x64\141\164\141\x62\x61\x73\145" => $formData["\x64\x61\x74\x61\142\141\x73\x65"], "\165\x73\145\x72\x6e\141\x6d\145" => $formData["\165\163\x65\162\x6e\141\155\145"], "\x70\x61\163\163\x77\x6f\162\x64" => $formData["\x70\x61\163\163\167\157\162\x64"], "\x68\157\163\164\x70\157\162\164" => $formData["\x68\x6f\x73\164\160\x6f\162\164"]])); goto xKFni; O0lU8: CLDC2: goto vzx8w; P9QH0: if ($result) { goto zy5AJ; } goto uCDYY; m0bze: foreach ($lines as $line) { goto X7IHu; FcRwq: goto AjRR7; goto CF0In; X7IHu: if (!(substr($line, 0, 2) == "\55\x2d" || $line == '')) { goto Dzafl; } goto FcRwq; zP6Py: AjRR7: goto qlJz2; CF0In: Dzafl: goto gXy8S; gXy8S: $templine .= $line; goto MD2Gc; dTXGi: Db::execute($templine); goto s254S; XULNH: a3IJf: goto zP6Py; MD2Gc: if (!(substr(trim($line), -1, 1) == "\73")) { goto a3IJf; } goto dTXGi; s254S: $templine = ''; goto XULNH; qlJz2: } goto O0lU8; vzx8w: $config = ["\x68\157\x73\164\x6e\x61\155\x65" => $formData["\x68\x6f\163\x74\x6e\141\x6d\x65"], "\144\x61\164\141\142\141\163\x65" => $formData["\x64\x61\x74\x61\x62\x61\163\145"], "\x75\163\145\162\x6e\x61\155\145" => $formData["\165\x73\x65\x72\156\x61\155\x65"], "\160\141\163\163\x77\x6f\x72\x64" => $formData["\160\x61\163\163\167\157\x72\x64"], "\x68\157\163\164\160\157\162\164" => $formData["\x68\x6f\163\x74\x70\x6f\162\164"]]; goto EAtGk; RiE8Z: $configContent .= var_export($config, true); goto tRTn2; xKFni: Db::connect(); goto jl9ev; tRTn2: $configContent .= "\73"; goto qjP2E; gDYM9: zy5AJ: goto ZD1ki; qjP2E: $result = file_put_contents(ROOT_PATH . "\154\x6f\143\x61\x6c" . DS . "\144\141\164\x61\142\x61\163\145\56\160\x68\160", $configContent); goto P9QH0; EAtGk: $configContent = "\x3c\77\160\x68\160\15\12\x72\x65\x74\165\162\156\40"; goto RiE8Z; HuN2D: exception("\345\210\235\xe5\247\213\345\x8c\226\x73\x71\x6c\xe6\x96\x87\344\xbb\xb6\xe4\270\x8d\xe5\255\230\xe5\x9c\250"); goto F_fuh; cUTnb: $lines = file($sqlFile); goto m0bze; ZD1ki: } }
