<?php
 namespace app\index\logic; use think\Db; use think\Config; use think\Log; class Install extends Base { protected $_serverResult = array("\163\x65\162\x76\x65\x72" => array(null, null), "\160\x68\160\166\145\162" => array(null, null), "\160\x61\164\x68" => array(null, null)); protected $_extensionResult = array("\143\x75\162\154" => array(null, null), "\x67\x64\62" => array(null, null), "\x6f\x70\x65\x6e\x73\163\x6c" => array(null, null), "\x70\x64\x6f\x5f\155\171\x73\161\x6c" => array(null, null), "\160\x64\x6f\x5f\x73\161\x6c\151\164\145" => array(null, null), "\x7a\151\x70" => array(null, null), "\x6d\142\163\164\x72\151\x6e\147" => array(null, null), "\146\151\154\145\151\156\146\157" => array(null, null)); protected $_privilegeResult = array("\154\157\143\x61\154" => array(null, null), "\x72\145\x70\157\162\x74" => array(null, null), "\x74\145\x6d\160" => array(null, null), "\162\x75\156\x74\151\155\x65" => array(null, null), "\160\x75\x62\x6c\151\143\57\165\x70\154\157\141\144" => array(null, null), "\x70\x75\142\x6c\151\x63\57\x65\170\160\x6f\162\x74" => array(null, null), "\x70\165\142\154\x69\143\57\161\x72\x63\x6f\144\x65" => array(null, null), "\x70\x75\x62\x6c\151\x63\57\x69\155\160\x6f\162\x74" => array(null, null)); public function checkServer() { goto Xbkiq; HkDB5: $this->_serverResult["\x70\x61\x74\150"][0] = ROOT_PATH; goto k1KdS; O_3d6: gICB8: goto e4Uni; YaOyP: if (version_compare(PHP_VERSION, "\x37\56\64\56\60") >= 0) { goto gICB8; } goto ooKk4; Sms8n: hQgW2: goto HkDB5; OwOIU: $this->_serverResult["\x73\145\162\x76\x65\x72"][0] = $_SERVER["\123\105\x52\126\x45\x52\137\123\117\106\x54\127\x41\122\x45"]; goto Kd6Io; qaf6K: return $this->_serverResult; goto CpRm7; e4Uni: $this->_serverResult["\160\150\160\x76\145\x72"][1] = true; goto Sms8n; onY1_: goto hQgW2; goto O_3d6; k1KdS: $this->_serverResult["\x70\141\x74\x68"][1] = true; goto qaf6K; Kd6Io: $this->_serverResult["\x73\x65\162\x76\145\162"][1] = true; goto vHB__; vHB__: $this->_serverResult["\x70\x68\x70\x76\x65\x72"][0] = PHP_VERSION; goto YaOyP; ooKk4: $this->_serverResult["\160\150\x70\166\x65\x72"][1] = false; goto onY1_; Xbkiq: global $_SERVER; goto OwOIU; CpRm7: } public function checkExtension() { goto RmvCO; bTfFC: if (!extension_loaded("\x70\x64\x6f\137\x73\x71\154\151\x74\145")) { goto z5j3H; } goto IAFaa; ud4eK: $v = ''; goto ibozf; NYE_N: $info = gd_info(); goto KJsCt; cqhmO: $this->_extensionResult["\160\x64\x6f\137\155\x79\x73\x71\154"][1] = true; goto Ns309; y9iyO: $this->_extensionResult["\x63\165\x72\154"][1] = true; goto QXGGo; KJsCt: $this->_extensionResult["\147\144\x32"][0] = $info["\107\104\40\126\x65\x72\163\x69\157\x6e"]; goto rt5yG; dEPf6: if (!function_exists("\x6d\142\137\154\x61\156\x67\165\141\147\145")) { goto G2g5O; } goto PUCdF; qI8lP: G2g5O: goto GkxgR; j3vf3: $this->_extensionResult["\x6f\160\x65\156\x73\x73\x6c"][0] = OPENSSL_VERSION_TEXT; goto uQyN8; sx3X7: $v .= "\40\163\161\x6c\151\x74\145\62"; goto H2YnB; mNEpN: return $this->_extensionResult; goto lEgvD; uQyN8: $this->_extensionResult["\157\x70\145\x6e\163\163\x6c"][1] = true; goto gOVOg; eOBZp: $this->_extensionResult["\172\x69\160"][1] = true; goto MGjBE; VbwR2: c2Kuv: goto mUTMF; veVTX: $this->_extensionResult["\160\144\157\137\155\x79\163\161\x6c"][0] = "\40"; goto cqhmO; rt5yG: $this->_extensionResult["\x67\x64\x32"][1] = true; goto hHCll; pM73w: $this->_extensionResult["\x7a\151\160"][0] = "\40"; goto eOBZp; AekBT: z5j3H: goto Bd034; InAtA: $info = curl_version(); goto mTHOF; hFVv1: $v .= "\163\x71\154\x69\x74\145\x33"; goto VbwR2; gOVOg: hwlSx: goto mNEpN; hHCll: lYc_X: goto dEPf6; Bd034: Z7_F1: goto TXLke; ickA6: $this->_extensionResult["\x70\144\x6f\x5f\163\161\x6c\x69\164\145"][1] = true; goto AekBT; K9hNm: $this->_extensionResult["\x70\144\157\137\163\x71\x6c\151\x74\x65"][0] = $v; goto ickA6; PUCdF: $this->_extensionResult["\155\x62\x73\x74\x72\151\x6e\147"][0] = mb_language(); goto xe1mA; TXLke: if (!defined("\x4f\120\x45\x4e\123\123\114\x5f\x56\x45\122\123\111\117\x4e\x5f\124\x45\x58\x54")) { goto hwlSx; } goto j3vf3; mUTMF: if (!in_array("\x73\161\x6c\151\164\145\62", $a)) { goto N354h; } goto sx3X7; mTHOF: $this->_extensionResult["\x63\165\x72\154"][0] = $info["\x76\145\x72\x73\x69\x6f\156"]; goto y9iyO; xe1mA: $this->_extensionResult["\x6d\142\163\x74\x72\151\x6e\x67"][1] = true; goto qI8lP; kzL1o: if (!function_exists("\x67\144\137\151\x6e\146\x6f")) { goto lYc_X; } goto NYE_N; tv0mP: if (!extension_loaded("\x70\144\x6f\x5f\x6d\x79\x73\x71\154")) { goto H4SNo; } goto veVTX; ibozf: if (!in_array("\163\x71\x6c\151\164\145", $a)) { goto c2Kuv; } goto hFVv1; Ns309: H4SNo: goto bTfFC; GrlzW: if (!extension_loaded("\x66\151\x6c\145\x69\x6e\146\x6f")) { goto Ht26h; } goto azT8P; RmvCO: if (!function_exists("\x63\165\162\154\137\166\145\162\163\151\x6f\156")) { goto ze1Ik; } goto InAtA; QXGGo: ze1Ik: goto PcMGU; eTapA: $this->_extensionResult["\146\x69\154\145\151\156\x66\157"][1] = true; goto N_v_n; IAFaa: $a = \PDO::getAvailableDrivers(); goto ud4eK; GkxgR: if (!class_exists("\x50\104\x4f", false)) { goto Z7_F1; } goto tv0mP; H2YnB: N354h: goto K9hNm; N_v_n: Ht26h: goto kzL1o; PcMGU: if (!class_exists("\x5a\151\160\101\162\x63\x68\151\166\x65")) { goto K0qSd; } goto pM73w; MGjBE: K0qSd: goto GrlzW; azT8P: $this->_extensionResult["\146\x69\154\145\151\x6e\146\157"][0] = "\40"; goto eTapA; lEgvD: } public function checkPrivilege() { goto PEho9; mwRQj: return $this->_privilegeResult; goto avhqC; PEho9: foreach ($this->_privilegeResult as $path => &$result) { goto kEGGG; VqInB: gcrqf: goto gwYty; Lgh8j: $result[1] = $isWritable && (substr($s, 1, 1) == "\x72" && substr($s, 2, 1) == "\x77" && substr($s, 3, 1) == "\x78" && substr($s, 4, 1) == "\162" && substr($s, 7, 1) == "\162" && substr($s, 6, 1) == "\x78" && substr($s, 9, 1) == "\x78") ? true : false; goto U41pc; Qisk4: $o = $this->GetFilePermsOct(ROOT_PATH . $path); goto rajup; MEO2q: GS3cM: goto rsHxN; U41pc: goto KdPEm; goto MEO2q; rajup: $isWritable = is_writable(ROOT_PATH . $path); goto SzaCR; MijOA: if (substr($s, 0, 1) == "\x2d") { goto GS3cM; } goto Lgh8j; SzaCR: $result[0] = $s . "\x20\174\x20" . $o; goto MijOA; kEGGG: $s = $this->GetFilePerms(ROOT_PATH . $path); goto Qisk4; rsHxN: $result[1] = $isWritable && (substr($s, 1, 1) == "\162" && substr($s, 2, 1) == "\167" && substr($s, 4, 1) == "\x72" && substr($s, 7, 1) == "\162") ? true : false; goto nYiej; nYiej: KdPEm: goto VqInB; gwYty: } goto bEA7I; bEA7I: gmCl1: goto mwRQj; avhqC: } private function GetFilePermsOct($f) { goto q8T3_; tD2hY: return ''; goto uHP3T; m2XpY: return substr(sprintf("\45\157", fileperms($f)), -4); goto ysL2K; uHP3T: Yxzac: goto m2XpY; q8T3_: if (file_exists($f)) { goto Yxzac; } goto tD2hY; ysL2K: } private function GetFilePerms($f) { goto kb8aT; CQdQb: XlfMD: goto zfgVY; kb8aT: if (file_exists($f)) { goto K0zkB; } goto oZPHO; SdUMU: $info .= $perms & 0x2 ? "\167" : "\x2d"; goto AxvR9; rORDf: $info .= $perms & 0x80 ? "\167" : "\x2d"; goto gOX9a; w21RE: $info .= $perms & 0x100 ? "\162" : "\55"; goto rORDf; awae6: $info .= $perms & 0x4 ? "\162" : "\55"; goto SdUMU; AxvR9: $info .= $perms & 0x1 ? $perms & 0x200 ? "\164" : "\x78" : ($perms & 0x200 ? "\x54" : "\55"); goto Ady1n; Nbluv: K0zkB: goto NTyLe; kNNKC: $info .= $perms & 0x10 ? "\x77" : "\55"; goto l4Nky; N8UgS: $info .= $perms & 0x20 ? "\162" : "\55"; goto kNNKC; gOX9a: $info .= $perms & 0x40 ? $perms & 0x800 ? "\163" : "\x78" : ($perms & 0x800 ? "\x53" : "\x2d"); goto N8UgS; oZPHO: return ''; goto Nbluv; zfgVY: Br0Zd: goto w21RE; NTyLe: $perms = fileperms($f); goto txMWJ; Ady1n: return $info; goto YrcP2; l4Nky: $info .= $perms & 0x8 ? $perms & 0x400 ? "\163" : "\170" : ($perms & 0x400 ? "\123" : "\55"); goto awae6; txMWJ: switch ($perms & 0xf000) { case 0xc000: $info = "\x73"; goto Br0Zd; case 0xa000: $info = "\x6c"; goto Br0Zd; case 0x8000: $info = "\x2d"; goto Br0Zd; case 0x6000: $info = "\x62"; goto Br0Zd; case 0x4000: $info = "\144"; goto Br0Zd; case 0x2000: $info = "\x63"; goto Br0Zd; case 0x1000: $info = "\x70"; goto Br0Zd; default: $info = "\x75"; } goto CQdQb; YrcP2: } public function importDb($formData) { goto T3f2R; vf_pJ: exception("\xe5\210\x9d\xe5\247\x8b\345\x8c\226\163\x71\154\346\226\x87\344\273\266\344\270\215\xe5\255\x98\345\x9c\xa8"); goto xUGUO; REbtQ: $sqlFile = ROOT_PATH . "\144\x62" . DS . "\144\142\56\163\161\154"; goto rkMfK; msyAl: $configContent .= "\73"; goto JNZWH; qMlgw: $templine = ''; goto euYxN; rkMfK: if (file_exists($sqlFile)) { goto HJD2i; } goto vf_pJ; iJzw1: $config = ["\x68\x6f\x73\164\156\141\x6d\145" => $formData["\x68\157\x73\164\156\141\155\x65"], "\x64\141\164\141\142\x61\163\145" => $formData["\144\x61\x74\x61\x62\x61\163\145"], "\x75\x73\x65\x72\x6e\x61\155\x65" => $formData["\165\163\145\x72\156\x61\x6d\145"], "\x70\141\x73\163\x77\x6f\162\x64" => $formData["\x70\x61\163\163\x77\157\x72\144"], "\150\157\x73\x74\160\157\162\x74" => $formData["\x68\157\163\164\x70\x6f\x72\164"]]; goto p4b89; p4b89: $configContent = "\x3c\x3f\x70\x68\160\xd\xa\162\145\x74\165\x72\x6e\x20"; goto cmeMl; euYxN: $lines = file($sqlFile); goto MMNqI; xUGUO: HJD2i: goto qMlgw; fqQa2: if ($result) { goto cOH3M; } goto Oq_J_; cmeMl: $configContent .= var_export($config, true); goto msyAl; Oq_J_: exception("\346\225\xb0\346\215\xae\345\272\x93\xe9\x85\215\347\275\256\346\x96\x87\344\xbb\266\xe5\206\x99\xe5\x85\245\345\xa4\261\350\xb4\xa5"); goto jhpmG; JNZWH: $result = file_put_contents(ROOT_PATH . "\154\157\x63\x61\154" . DS . "\x64\x61\164\141\x62\141\x73\145\x2e\160\x68\160", $configContent); goto fqQa2; jhpmG: cOH3M: goto r_ICk; x7n1Q: TMBYN: goto iJzw1; MMNqI: foreach ($lines as $line) { goto u8hM7; b0WwM: $templine = ''; goto e_t_l; e_t_l: PwJdp: goto pB7tR; qlGSa: Db::execute($templine); goto b0WwM; CLSzm: MbV17: goto XRK0m; pB7tR: rQpX1: goto ldl4p; iwM0Y: goto rQpX1; goto CLSzm; u8hM7: if (!(substr($line, 0, 2) == "\x2d\x2d" || $line == '')) { goto MbV17; } goto iwM0Y; XRK0m: $templine .= $line; goto CoHi9; CoHi9: if (!(substr(trim($line), -1, 1) == "\73")) { goto PwJdp; } goto qlGSa; ldl4p: } goto x7n1Q; T3f2R: Config::set("\x64\x61\164\141\142\x61\x73\x65", array_merge(Config::get("\x64\141\164\141\x62\141\x73\145"), ["\x68\x6f\163\x74\x6e\141\155\145" => $formData["\x68\x6f\163\164\156\141\155\x65"], "\144\x61\x74\x61\142\141\163\145" => $formData["\x64\x61\164\x61\142\141\163\x65"], "\x75\163\x65\x72\156\141\155\x65" => $formData["\165\163\145\162\x6e\141\155\145"], "\160\141\163\163\x77\157\162\x64" => $formData["\160\x61\163\163\x77\x6f\162\x64"], "\150\x6f\x73\x74\x70\157\162\164" => $formData["\x68\x6f\163\x74\160\157\x72\164"]])); goto y9E6l; y9E6l: Db::connect(); goto REbtQ; r_ICk: } }
