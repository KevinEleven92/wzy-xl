<?php
 namespace app\index\service; use think\Log; use think\Db; use think\Debug; use app\index\service\RequestContext; use app\common\service\WException; use app\common\service\Storage as StorageService; use app\Defs; use app\index\logic\License as LicenseLogic; class Wzyer extends Base { protected function __construct() { } const API_URL_PREFIX = "\x68\x74\x74\x70\163\72\57\x2f\167\x77\167\x2e\167\172\171\145\162\x2e\143\157\155\x2f\x69\156\x64\145\170\57\x4f\x70\145\x6e\137\x41\x70\151"; protected function buildHeader() { goto yIxsO; yIxsO: $licenseData = LicenseLogic::I()->fetch(); goto JelRa; JelRa: $headers = ["\x41\x50\120\55\111\x44\72" . $licenseData["\151\144"], "\x41\125\x54\110\55\x4b\x45\131\72" . $licenseData["\x61\x75\x74\150\137\x6b\145\171"], "\x43\157\x6e\164\145\156\x74\55\124\x79\x70\x65\x3a\x20\x61\160\160\x6c\151\x63\x61\x74\151\157\156\57\170\55\167\167\167\55\x66\x6f\162\x6d\55\x75\162\154\145\x6e\x63\x6f\144\145\x64"]; goto zbXJG; zbXJG: return $headers; goto SX4pD; SX4pD: } public function bindAuthKey($authKey, $ip = '') { goto EtZcI; Q_ZIU: F0F5T: goto NaKgR; ItHpZ: Log::error("\x62\151\x6e\144\101\165\x74\150\x4b\x65\171\x20\x65\162\x72\x6f\162\72\40" . $jsonObj["\155\x73\147"]); goto OKoIY; NaKgR: return $jsonObj["\x64\141\164\141"]; goto v2mQh; RH3SL: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\142\151\x6e\144\101\x75\164\150\x4b\x65\171\x2e\150\x74\155\154", $headers, $postFields); goto ZV5DB; wN9j4: $postFields = http_build_query(["\x61\x75\x74\150\113\145\171" => $authKey, "\151\160" => $ip]); goto RH3SL; OKoIY: wexception($jsonObj["\x6d\x73\x67"]); goto Q_ZIU; ZV5DB: if (!($jsonObj["\143\157\x64\x65"] != 1)) { goto F0F5T; } goto ItHpZ; EtZcI: $headers = $this->buildHeader(); goto wN9j4; v2mQh: } public function refreshAuthKey() { goto OUnNt; OUnNt: $headers = $this->buildHeader(); goto Il_Rc; NAiDf: if (!($jsonObj["\x63\x6f\144\145"] != 1)) { goto Jtt6W; } goto dBv5b; MlHsc: return $jsonObj["\x64\141\164\x61"]; goto P6Mcy; Il_Rc: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\162\145\x66\x72\145\x73\x68\101\x75\164\150\x4b\145\x79\x2e\150\x74\x6d\x6c", $headers); goto NAiDf; ADYVg: Jtt6W: goto MlHsc; WbwnP: wexception($jsonObj["\155\x73\x67"]); goto ADYVg; dBv5b: Log::error("\162\145\146\162\145\163\x68\x41\x75\x74\x68\113\145\x79\40\145\162\x72\x6f\162\x3a\x20" . $jsonObj["\x6d\163\147"]); goto WbwnP; P6Mcy: } public function unbindAuthKey() { goto W269H; H8fJq: wexception($jsonObj["\155\x73\x67"]); goto Krqcc; xAnrM: Log::error("\x75\156\x62\x69\156\144\101\165\164\150\113\145\171\x20\145\162\x72\x6f\x72\x3a\40" . $jsonObj["\x6d\163\x67"]); goto H8fJq; Krqcc: d1seR: goto fWbJW; HOj90: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\x75\x6e\142\151\x6e\x64\101\x75\164\x68\113\x65\x79\x2e\x68\164\155\x6c", $headers); goto WGVa1; W269H: $headers = $this->buildHeader(); goto HOj90; fWbJW: return; goto iH8pm; WGVa1: if (!($jsonObj["\143\x6f\144\145"] != 1)) { goto d1seR; } goto xAnrM; iH8pm: } public function apiSubjectList($type = Defs::SUBJECT_TYPE_PSYCHOLOGY, $search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto YvImc; RZt_2: if (!($jsonObj["\143\157\x64\145"] != 1)) { goto a6wcT; } goto wHjXq; FoMNG: return $jsonObj["\144\x61\x74\141"]; goto YhLMw; YvImc: $headers = $this->buildHeader(); goto kTzI4; wHjXq: Log::error("\x61\x70\x69\x53\165\x62\x6a\145\x63\x74\114\151\163\x74\x20\x65\162\162\157\162\72\40" . $jsonObj["\155\x73\x67"]); goto TBlJZ; kTzI4: $postFields = http_build_query(["\164\171\160\145" => $type, "\163\145\141\162\143\x68" => $search, "\x70\x61\x67\x65" => $page, "\162\157\167\163" => $rows, "\163\157\x72\164" => $sort, "\x6f\162\x64\145\x72" => $order]); goto TAlk0; TAlk0: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\163\165\142\152\x65\143\164\114\151\163\x74\56\150\164\155\x6c", $headers, $postFields); goto RZt_2; TBlJZ: wexception($jsonObj["\x6d\163\147"]); goto Lemov; Lemov: a6wcT: goto FoMNG; YhLMw: } public function apiSubject($subjectId) { goto p6Qqe; MHGIo: if (!($jsonObj["\x63\157\x64\145"] != 1)) { goto VRbFu; } goto nIA0W; Nd_e0: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\163\x75\x62\152\145\143\x74\56\x68\164\x6d\154\77\163\165\x62\152\x65\143\x74\x49\x64\75" . $subjectId, $headers); goto MHGIo; n7Vaz: VRbFu: goto oUZzj; oUZzj: return $jsonObj["\144\141\164\x61"]; goto jOtJr; p6Qqe: $headers = $this->buildHeader(); goto Nd_e0; nIA0W: Log::error("\x61\160\x69\x53\165\142\152\145\x63\164\x20\145\162\162\x6f\162\x3a\x20" . $jsonObj["\155\x73\x67"]); goto Ld2F6; Ld2F6: wexception($jsonObj["\x6d\163\x67"]); goto n7Vaz; jOtJr: } public function apiSubjectReport($sn, $itemOptions) { goto fgj5r; nQz7n: p5v24: goto BValy; Ij31X: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\x73\165\142\152\x65\x63\164\x52\145\x70\x6f\162\x74\x2e\x68\164\x6d\x6c", $headers, $postFields); goto INCEC; YUVsN: $postFields = http_build_query(["\163\156" => $sn, "\x69\x74\145\x6d\x4f\160\164\x69\x6f\x6e\x73" => json_encode($itemOptions)]); goto Ij31X; hQsZj: Log::error("\141\160\x69\x53\165\x62\152\x65\x63\164\x52\x65\x70\157\x72\164\x20\145\162\162\x6f\162\72\40" . $jsonObj["\155\163\147"]); goto jhq3u; fgj5r: $headers = $this->buildHeader(); goto YUVsN; jhq3u: wexception($jsonObj["\155\x73\x67"]); goto nQz7n; BValy: return $jsonObj["\x64\x61\x74\x61"]; goto B9Jij; INCEC: if (!($jsonObj["\x63\157\x64\145"] != 1)) { goto p5v24; } goto hQsZj; B9Jij: } public function apiFetchReportAlgo($number) { goto tHwht; bXIE8: wexception($jsonObj["\x6d\163\147"]); goto hG8No; rbzTy: $postFields = http_build_query(["\x6e\165\x6d\x62\x65\x72" => $number]); goto zsJfX; mKfbG: Log::error("\x61\160\151\x46\145\164\143\150\x52\x65\x70\157\162\164\101\154\147\157\x20\145\x72\x72\x6f\162\72\40" . $jsonObj["\155\163\x67"]); goto bXIE8; g8zvi: return $jsonObj["\x64\x61\164\141"]; goto yUQyr; tHwht: $headers = $this->buildHeader(); goto rbzTy; WBvBj: if (!($jsonObj["\143\x6f\x64\145"] != 1)) { goto RSDn4; } goto mKfbG; zsJfX: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\146\x65\164\143\150\122\x65\x70\157\x72\164\101\154\147\x6f\x2e\x68\x74\x6d\x6c", $headers, $postFields); goto WBvBj; hG8No: RSDn4: goto g8zvi; yUQyr: } protected function _get($url, $headers = array()) { goto gfU7J; qDa7t: Log::notice("\x5f\147\x65\164\40\165\x72\x6c\72\40" . $url . "\x2c\x20\x72\145\163\160\x6f\x6e\x73\x65\x20\162\x65\x73\x75\x6c\x74\x3a\40" . $result); goto Gc4Mx; zFpxp: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto tlMSi; yLRFh: return $jsonObj; goto L4mIS; pHpCp: wexception("\x5f\x67\x65\164\54\x20\146\141\151\154\145\144\40\x74\157\40\152\x73\157\156\x5f\x64\x65\x63\x6f\x64\145\72\40" . $result . "\x2c\40\x75\162\154\72\40" . $url); goto VEwkC; S1pVk: if ($result) { goto d6Ksd; } goto NIxoN; Z3Vp5: curl_setopt($ch, CURLOPT_URL, $url); goto pBose; U8GFY: curl_setopt($ch, CURLOPT_TIMEOUT, 120); goto cNWBw; UH_7u: if ($jsonObj) { goto R6xer; } goto n_bTC; VEwkC: R6xer: goto yLRFh; tlMSi: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto VrxGv; Gc4Mx: $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto mU0ME; VrxGv: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 120); goto U8GFY; v53mV: Log::notice("\x5f\x67\145\164\x20\165\x72\x6c\x3a\40" . $url . "\54\40\150\x74\164\160\40\150\145\x61\144\x65\x72\72\40" . json_encode($headers, JSON_UNESCAPED_UNICODE)); goto dsgQm; n_bTC: Log::error("\137\147\145\164\x2c\x20\146\141\x69\154\x65\x64\40\164\157\x20\x6a\x73\x6f\156\x5f\x64\x65\x63\x6f\144\x65\x3a\40" . $result . "\54\40\x75\x72\x6c\72\x20" . $url); goto pHpCp; DBI3S: k8CkK: goto LwASW; NIxoN: $errCode = curl_errno($ch); goto cDne6; rqnJz: if (!($httpCode != "\x32\x30\60")) { goto k8CkK; } goto e2q_G; e2q_G: Log::error("\x5f\x67\145\164\x2c\40\150\164\164\x70\x20\143\157\144\x65\x20{$httpCode}\54\x20{$result}\x2c\x20\165\162\x6c\72\x20" . $url); goto bM6K5; cDne6: $errMsg = curl_error($ch); goto YXP0g; LwASW: $jsonObj = json_decode($result, true); goto UH_7u; Orzl_: wexception("\137\147\x65\164\x2c\x20\146\141\x69\x6c\145\144\x20\164\157\40\143\165\162\154\137\145\170\x65\143\54\x20{$errCode}\x2c\x20{$errMsg}\54\40\x75\162\x6c\x3a\40" . $url); goto uG3NC; dsgQm: $result = curl_exec($ch); goto S1pVk; kHRxB: curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); goto y6k2N; VIhi9: Log::error("\x5f\x67\x65\x74\54\x20\x66\x61\x69\154\x65\144\40\164\x6f\x20\x63\x75\x72\x6c\137\145\x78\x65\x63\x2c\40{$errCode}\54\x20{$errMsg}\54\40\165\162\154\x3a\x20" . $url); goto Orzl_; gfU7J: $ch = curl_init(); goto Z3Vp5; bM6K5: wexception("\x5f\147\145\x74\54\x20\x68\x74\164\x70\x20\x63\x6f\144\x65\40{$httpCode}\54\40{$result}\x2c\x20\x75\x72\154\72\40" . $url); goto DBI3S; pBose: curl_setopt($ch, CURLOPT_VERBOSE, TRUE); goto zFpxp; cNWBw: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto CnGoF; YXP0g: curl_close($ch); goto VIhi9; CnGoF: curl_setopt($ch, CURLOPT_FORBID_REUSE, FALSE); goto mwtL0; uG3NC: d6Ksd: goto qDa7t; mU0ME: curl_close($ch); goto rqnJz; y6k2N: n5iER: goto v53mV; mwtL0: if (!$headers) { goto n5iER; } goto kHRxB; L4mIS: } protected function _post($url, $headers = array(), $postFields = '') { goto sP4S3; sbo3n: curl_close($ch); goto VaYSI; GfuGB: curl_setopt($ch, CURLOPT_VERBOSE, TRUE); goto c1pWL; c1pWL: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto oL91w; tyXlu: wexception("\137\160\157\163\x74\x2c\x20\x66\x61\151\154\145\x64\40\164\x6f\40\143\x75\x72\x6c\137\x65\170\145\143\x2c\40{$errCode}\54\40{$errMsg}\54\40\x75\x72\x6c\72\x20" . $url); goto W3Wo1; apmwX: RctTR: goto ajCxB; URvyF: $jsonObj = json_decode($result, true); goto JR3dL; ajCxB: if (!$postFields) { goto JvoMp; } goto zjl3Z; zjl3Z: curl_setopt($ch, CURLOPT_POSTFIELDS, $postFields); goto DamcH; NgOTj: return $jsonObj; goto YuoaB; DDOp5: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto x6l_0; rOtqn: Log::notice("\137\x70\157\163\164\x20\165\x72\154\x3a\40" . $url . "\x2c\x20\150\164\164\160\40\150\145\x61\144\145\x72\x3a\40" . json_encode($headers, JSON_UNESCAPED_UNICODE)); goto mVZ_u; XXSBT: curl_setopt($ch, CURLOPT_POST, TRUE); goto i0l44; sP4S3: $ch = curl_init(); goto yA4vY; zQ5nc: $errMsg = curl_error($ch); goto sbo3n; NDDkl: Log::error("\x5f\160\x6f\x73\164\x2c\40\x68\164\x74\160\x20\143\157\x64\145\x20{$httpCode}\54\x20{$result}\x2c\x20\x75\162\154\x3a\40" . $url); goto rw3FV; rUDuI: $errCode = curl_errno($ch); goto zQ5nc; PLCKv: curl_close($ch); goto D8NF3; W3Wo1: pVhOA: goto dsMso; dsMso: Log::notice("\137\x70\157\x73\164\40\165\162\154\x3a\x20" . $url . "\54\x20\x72\x65\x73\x70\157\x6e\163\145\x20\162\x65\163\x75\x6c\x74\72\40" . $result); goto XkAvh; mVZ_u: curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); goto apmwX; nzEzv: wexception("\x5f\x70\x6f\x73\x74\54\40\146\141\x69\154\x65\144\x20\164\157\40\x6a\163\x6f\x6e\137\144\x65\x63\x6f\144\x65\x3a\40" . $result . "\x2c\40\165\x72\x6c\x3a\x20" . $url); goto fb6XU; mSwyC: if ($result) { goto pVhOA; } goto rUDuI; DamcH: JvoMp: goto fgk4z; KIsS8: curl_setopt($ch, CURLOPT_TIMEOUT, 120); goto DDOp5; yA4vY: curl_setopt($ch, CURLOPT_URL, $url); goto GfuGB; x6l_0: curl_setopt($ch, CURLOPT_FORBID_REUSE, FALSE); goto XXSBT; fgk4z: Log::notice("\x5f\160\157\x73\x74\40\x75\162\154\72\40" . $url . "\x2c\x20\x68\x74\164\160\40\x68\145\x61\x64\145\162\x3a\x20" . json_encode($headers, JSON_UNESCAPED_UNICODE) . "\54\40\160\157\x73\x74\40\143\157\x6e\x74\145\x6e\x74\x3a\40" . is_array($postFields) ? json_encode($postFields, JSON_UNESCAPED_UNICODE) : $postFields); goto umPft; PUXbw: P6Cj1: goto URvyF; rw3FV: wexception("\x5f\160\x6f\163\164\54\x20\150\164\164\x70\40\x63\x6f\x64\x65\40{$httpCode}\x2c\x20{$result}\54\x20\165\162\154\72\x20" . $url); goto PUXbw; Xiutf: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 120); goto KIsS8; VaYSI: Log::error("\137\160\157\x73\x74\x2c\40\146\141\151\154\x65\144\40\x74\157\40\143\165\162\x6c\x5f\x65\x78\x65\x63\x2c\40{$errCode}\54\x20{$errMsg}\54\40\165\162\x6c\x3a\x20" . $url); goto tyXlu; D8NF3: if (!($httpCode != "\62\60\60")) { goto P6Cj1; } goto NDDkl; XkAvh: $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto PLCKv; oL91w: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto Xiutf; JR3dL: if ($jsonObj) { goto DeKWx; } goto HhQf5; umPft: $result = curl_exec($ch); goto mSwyC; i0l44: if (!$headers) { goto RctTR; } goto rOtqn; fb6XU: DeKWx: goto NgOTj; HhQf5: Log::error("\x5f\160\x6f\x73\164\x2c\x20\146\141\x69\x6c\145\x64\40\x74\x6f\40\x6a\x73\x6f\x6e\x5f\x64\145\x63\x6f\144\145\72\40" . $result . "\x2c\x20\x75\162\x6c\x3a\x20" . $url); goto nzEzv; YuoaB: } }
