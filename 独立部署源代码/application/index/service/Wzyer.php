<?php
 namespace app\index\service; use think\Log; use think\Db; use think\Debug; use app\index\service\RequestContext; use app\common\service\WException; use app\common\service\Storage as StorageService; use app\Defs; use app\index\logic\License as LicenseLogic; class Wzyer extends Base { protected function __construct() { } const API_URL_PREFIX = "\x68\x74\x74\160\x73\72\57\x2f\x77\167\167\x2e\x77\172\x79\x65\x72\x2e\x63\x6f\x6d\57\151\x6e\144\145\x78\57\x4f\x70\x65\x6e\x5f\101\160\151"; protected function buildHeader() { goto R99hg; I1Edr: return $headers; goto Z_qus; R99hg: $licenseData = LicenseLogic::I()->fetch(); goto VaF7G; VaF7G: $headers = ["\x41\x50\x50\55\111\104\72" . $licenseData["\151\x64"], "\101\125\x54\110\55\x4b\x45\131\x3a" . $licenseData["\141\165\x74\x68\x5f\x6b\x65\171"], "\x43\x6f\x6e\164\145\156\164\55\124\x79\160\145\72\40\141\160\160\x6c\151\143\141\x74\x69\157\156\x2f\170\55\x77\167\x77\55\x66\x6f\162\x6d\55\x75\x72\x6c\x65\x6e\x63\157\x64\145\144"]; goto I1Edr; Z_qus: } public function bindAuthKey($authKey, $ip = '') { goto s2veV; W82kb: if (!($jsonObj["\x63\x6f\x64\145"] != 1)) { goto FwIqA; } goto zltzD; p9cOO: $postFields = http_build_query(["\141\x75\x74\150\113\145\171" => $authKey, "\151\160" => $ip]); goto n6O4k; biDpE: wexception($jsonObj["\155\163\x67"]); goto pYYRu; pYYRu: FwIqA: goto wvhAn; wvhAn: return $jsonObj["\x64\x61\x74\141"]; goto x1TT7; s2veV: $headers = $this->buildHeader(); goto p9cOO; n6O4k: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\142\x69\156\144\x41\165\164\x68\x4b\145\x79\56\x68\x74\155\154", $headers, $postFields); goto W82kb; zltzD: Log::error("\x62\x69\156\144\x41\165\x74\150\x4b\145\171\x20\145\x72\162\x6f\x72\72\40" . $jsonObj["\155\x73\147"]); goto biDpE; x1TT7: } public function refreshAuthKey() { goto OAVSj; N76Aq: if (!($jsonObj["\x63\157\x64\145"] != 1)) { goto ezTfr; } goto p6qwY; cFpz6: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\162\x65\146\162\x65\163\150\x41\x75\164\150\113\x65\x79\56\150\164\155\x6c", $headers); goto N76Aq; A6SqV: wexception($jsonObj["\x6d\163\x67"]); goto aSXz6; fU6U3: return $jsonObj["\x64\x61\x74\141"]; goto GG6zn; OAVSj: $headers = $this->buildHeader(); goto cFpz6; p6qwY: Log::error("\162\x65\x66\x72\145\x73\150\101\x75\164\x68\113\145\171\40\x65\x72\162\x6f\162\72\x20" . $jsonObj["\x6d\163\147"]); goto A6SqV; aSXz6: ezTfr: goto fU6U3; GG6zn: } public function unbindAuthKey() { goto jsUfK; E0wmW: wexception($jsonObj["\x6d\163\147"]); goto TXeng; jsUfK: $headers = $this->buildHeader(); goto l2C4X; iTkb9: if (!($jsonObj["\x63\x6f\144\145"] != 1)) { goto O5bek; } goto UjZri; UjZri: Log::error("\x75\x6e\x62\x69\156\x64\x41\x75\164\x68\x4b\145\171\x20\x65\162\x72\x6f\x72\x3a\x20" . $jsonObj["\155\163\x67"]); goto E0wmW; TXeng: O5bek: goto h7lTS; l2C4X: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\x75\x6e\142\x69\156\144\x41\x75\164\150\x4b\x65\171\56\x68\164\x6d\154", $headers); goto iTkb9; h7lTS: return; goto QfyL6; QfyL6: } public function apiSubjectList($type = Defs::SUBJECT_TYPE_PSYCHOLOGY, $search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto F50sN; qpviw: return $jsonObj["\x64\x61\164\141"]; goto Pkeci; RxRFD: VzPjR: goto qpviw; BEpbn: wexception($jsonObj["\x6d\x73\147"]); goto RxRFD; xCZBJ: $postFields = http_build_query(["\164\171\x70\145" => $type, "\x73\145\x61\162\x63\150" => $search, "\160\x61\x67\x65" => $page, "\x72\x6f\x77\163" => $rows, "\x73\x6f\x72\x74" => $sort, "\157\x72\x64\145\x72" => $order]); goto R6eR_; Lvs9X: if (!($jsonObj["\143\x6f\x64\145"] != 1)) { goto VzPjR; } goto bNekS; R6eR_: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\x73\165\142\152\145\x63\164\x4c\x69\x73\164\56\x68\164\x6d\x6c", $headers, $postFields); goto Lvs9X; F50sN: $headers = $this->buildHeader(); goto xCZBJ; bNekS: Log::error("\141\x70\x69\123\165\x62\x6a\145\143\164\x4c\151\163\164\40\145\x72\x72\x6f\162\x3a\x20" . $jsonObj["\x6d\x73\147"]); goto BEpbn; Pkeci: } public function apiSubject($subjectId) { goto IC9Ae; IC9Ae: $headers = $this->buildHeader(); goto pX63x; WBe9R: Log::error("\x61\160\x69\x53\165\x62\x6a\145\143\x74\x20\x65\x72\162\x6f\x72\72\x20" . $jsonObj["\155\x73\147"]); goto xznk_; pX63x: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\x73\x75\x62\152\x65\143\x74\x2e\x68\x74\155\x6c\x3f\x73\x75\x62\152\145\143\164\x49\144\75" . $subjectId, $headers); goto NJPEN; B5qEH: return $jsonObj["\x64\141\164\x61"]; goto umEt1; xznk_: wexception($jsonObj["\155\x73\147"]); goto dEwHg; dEwHg: KvwkQ: goto B5qEH; NJPEN: if (!($jsonObj["\143\x6f\144\145"] != 1)) { goto KvwkQ; } goto WBe9R; umEt1: } public function apiSubjectReport($sn, $itemOptions) { goto PS8U4; yQUBa: wexception($jsonObj["\x6d\163\x67"]); goto hKZxn; UW7QU: return $jsonObj["\x64\x61\x74\141"]; goto SYe6q; hKZxn: HageI: goto UW7QU; cLVhi: $postFields = http_build_query(["\163\x6e" => $sn, "\x69\164\145\x6d\117\x70\164\151\157\x6e\163" => json_encode($itemOptions)]); goto FUAdS; FUAdS: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\x73\x75\142\x6a\x65\x63\x74\x52\x65\x70\x6f\x72\164\x2e\150\x74\155\154", $headers, $postFields); goto lgM_M; PS8U4: $headers = $this->buildHeader(); goto cLVhi; Yz8Po: Log::error("\x61\x70\x69\123\x75\142\152\145\x63\x74\122\x65\x70\x6f\162\x74\x20\x65\x72\x72\x6f\162\x3a\40" . $jsonObj["\x6d\x73\x67"]); goto yQUBa; lgM_M: if (!($jsonObj["\x63\157\144\145"] != 1)) { goto HageI; } goto Yz8Po; SYe6q: } public function apiFetchReportAlgo($number) { goto O8_6f; t0VU7: if (!($jsonObj["\x63\157\144\145"] != 1)) { goto Uluat; } goto mpFE8; BNoc2: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\146\145\164\x63\150\122\x65\x70\157\162\164\101\154\x67\x6f\x2e\x68\x74\155\x6c", $headers, $postFields); goto t0VU7; TvWbh: $postFields = http_build_query(["\156\165\x6d\142\x65\x72" => $number]); goto BNoc2; B5j04: Uluat: goto WwqFL; aHwXK: wexception($jsonObj["\155\x73\147"]); goto B5j04; WwqFL: return $jsonObj["\x64\x61\164\x61"]; goto JvL4N; mpFE8: Log::error("\141\x70\x69\106\x65\164\x63\150\122\145\160\x6f\x72\164\x41\x6c\147\157\40\145\x72\162\157\x72\72\40" . $jsonObj["\155\x73\147"]); goto aHwXK; O8_6f: $headers = $this->buildHeader(); goto TvWbh; JvL4N: } protected function _get($url, $headers = array()) { goto NaKGp; VUHND: $result = curl_exec($ch); goto zeS1j; iUexE: if ($jsonObj) { goto VhRcN; } goto fnGGO; oabmK: curl_setopt($ch, CURLOPT_URL, $url); goto jzKXA; By0HD: $errMsg = curl_error($ch); goto O2ZEi; NaKGp: $ch = curl_init(); goto oabmK; IUZOe: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 120); goto Im67V; zeS1j: if ($result) { goto sWQnr; } goto edbk3; Dg4rx: kQ2rq: goto JcKv5; dxrxc: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto T6AVW; edbk3: $errCode = curl_errno($ch); goto By0HD; Fh8wC: $jsonObj = json_decode($result, true); goto iUexE; T6AVW: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto IUZOe; I4GuF: Log::error("\x5f\147\x65\x74\x2c\40\x68\x74\x74\x70\x20\x63\157\x64\145\x20{$httpCode}\54\x20{$result}\x2c\x20\x75\162\154\x3a\40" . $url); goto DqI_F; ABfV1: Log::notice("\137\x67\145\x74\40\x75\x72\x6c\72\x20" . $url . "\54\x20\162\x65\x73\x70\x6f\156\163\145\x20\162\145\x73\x75\x6c\164\x3a\x20" . $result); goto vPKpE; wTGa9: Log::error("\137\147\x65\x74\x2c\40\146\x61\151\x6c\x65\144\x20\x74\x6f\40\x63\x75\162\154\137\x65\x78\145\x63\x2c\40{$errCode}\54\40{$errMsg}\x2c\40\x75\x72\x6c\72\40" . $url); goto jmb_M; fnGGO: Log::error("\137\x67\x65\164\54\x20\146\x61\151\x6c\x65\x64\x20\x74\157\40\x6a\x73\157\156\x5f\x64\145\143\x6f\x64\145\72\x20" . $result . "\x2c\40\165\162\154\72\40" . $url); goto eU4h2; VmY5A: curl_setopt($ch, CURLOPT_FORBID_REUSE, FALSE); goto eBvXN; NgalP: curl_close($ch); goto wr7AV; eBvXN: if (!$headers) { goto kQ2rq; } goto qKYB2; PlC7j: hs7zL: goto Fh8wC; jzKXA: curl_setopt($ch, CURLOPT_VERBOSE, TRUE); goto dxrxc; bhTB2: return $jsonObj; goto hUprH; Im67V: curl_setopt($ch, CURLOPT_TIMEOUT, 120); goto acut0; O2ZEi: curl_close($ch); goto wTGa9; jmb_M: wexception("\x5f\147\x65\164\x2c\40\146\141\151\x6c\145\x64\x20\x74\157\40\x63\x75\162\154\137\145\x78\x65\x63\54\x20{$errCode}\54\x20{$errMsg}\x2c\x20\165\162\154\x3a\40" . $url); goto mHNSL; JcKv5: Log::notice("\x5f\147\x65\164\40\x75\x72\154\x3a\x20" . $url . "\x2c\x20\150\x74\x74\x70\40\150\145\141\144\145\x72\x3a\40" . json_encode($headers, JSON_UNESCAPED_UNICODE)); goto VUHND; vPKpE: $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto NgalP; mHNSL: sWQnr: goto ABfV1; acut0: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto VmY5A; wr7AV: if (!($httpCode != "\62\x30\60")) { goto hs7zL; } goto I4GuF; yqgA8: VhRcN: goto bhTB2; eU4h2: wexception("\x5f\147\145\x74\x2c\40\x66\141\x69\x6c\x65\144\x20\164\x6f\x20\x6a\163\157\156\137\x64\x65\143\157\x64\x65\72\x20" . $result . "\x2c\x20\165\162\x6c\x3a\x20" . $url); goto yqgA8; DqI_F: wexception("\137\x67\145\x74\54\x20\x68\164\164\x70\40\x63\x6f\144\x65\40{$httpCode}\54\40{$result}\54\40\165\x72\x6c\x3a\40" . $url); goto PlC7j; qKYB2: curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); goto Dg4rx; hUprH: } protected function _post($url, $headers = array(), $postFields = '') { goto jKsjj; FDxKy: wexception("\137\x70\x6f\163\x74\x2c\40\x68\164\164\x70\40\x63\x6f\144\x65\40{$httpCode}\x2c\40{$result}\x2c\40\x75\x72\x6c\72\40" . $url); goto mntzh; mntzh: Fk8gY: goto AeobN; QQXsb: curl_close($ch); goto FEMA9; gN8x9: Log::notice("\137\160\x6f\163\164\40\x75\162\154\x3a\x20" . $url . "\x2c\x20\150\164\164\x70\40\x68\145\x61\144\x65\x72\72\x20" . json_encode($headers, JSON_UNESCAPED_UNICODE)); goto Yt4oZ; Yy3QQ: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto U40DS; GMT_1: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto RX4vI; MGm6L: T52aS: goto s2YJ_; BaEBp: Log::error("\137\x70\x6f\x73\x74\x2c\x20\x66\x61\151\x6c\145\x64\x20\164\157\40\143\165\x72\154\x5f\145\x78\x65\x63\x2c\x20{$errCode}\54\40{$errMsg}\54\40\165\x72\154\72\x20" . $url); goto KT7YZ; s2YJ_: if (!$postFields) { goto SxxTg; } goto VzSiw; jKsjj: $ch = curl_init(); goto ZOWiO; DTkAf: Log::notice("\x5f\160\x6f\x73\164\40\165\x72\x6c\72\40" . $url . "\x2c\x20\162\145\x73\160\157\x6e\163\145\x20\x72\145\x73\165\154\164\x3a\x20" . $result); goto SfQqJ; ZOWiO: curl_setopt($ch, CURLOPT_URL, $url); goto hGH7c; bAqRl: if (!$headers) { goto T52aS; } goto gN8x9; fvpQB: curl_setopt($ch, CURLOPT_POST, TRUE); goto bAqRl; XR3dq: GqPUD: goto eIuoT; Yt4oZ: curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); goto MGm6L; yeke0: curl_setopt($ch, CURLOPT_TIMEOUT, 120); goto GMT_1; QgxfH: Log::error("\137\x70\x6f\x73\x74\54\40\150\164\x74\x70\40\143\x6f\144\145\x20{$httpCode}\54\x20{$result}\54\40\165\x72\154\72\x20" . $url); goto FDxKy; FHIuM: Log::notice("\137\160\157\163\x74\x20\x75\162\154\x3a\x20" . $url . "\54\x20\x68\x74\164\160\x20\150\x65\x61\144\145\162\x3a\x20" . json_encode($headers, JSON_UNESCAPED_UNICODE) . "\x2c\40\x70\157\x73\x74\40\143\x6f\x6e\164\x65\x6e\x74\72\x20" . is_array($postFields) ? json_encode($postFields, JSON_UNESCAPED_UNICODE) : $postFields); goto g9Tx0; KT7YZ: wexception("\x5f\160\x6f\163\164\x2c\40\x66\141\151\x6c\145\x64\40\164\157\40\143\165\162\154\x5f\x65\x78\x65\x63\54\x20{$errCode}\x2c\40{$errMsg}\54\x20\165\x72\154\x3a\x20" . $url); goto qhrMv; uXbDy: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 120); goto yeke0; hGH7c: curl_setopt($ch, CURLOPT_VERBOSE, TRUE); goto Yy3QQ; fzs9N: if ($jsonObj) { goto GqPUD; } goto F1j34; BjDpc: SxxTg: goto FHIuM; SfQqJ: $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto QQXsb; U40DS: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto uXbDy; ZFWpM: $errCode = curl_errno($ch); goto bp5bO; AeobN: $jsonObj = json_decode($result, true); goto fzs9N; F1j34: Log::error("\137\160\157\x73\x74\54\x20\x66\141\x69\x6c\145\x64\x20\164\157\40\x6a\163\157\156\137\x64\145\x63\157\144\x65\72\40" . $result . "\x2c\40\x75\x72\x6c\72\x20" . $url); goto tY2Du; VzSiw: curl_setopt($ch, CURLOPT_POSTFIELDS, $postFields); goto BjDpc; g9Tx0: $result = curl_exec($ch); goto vSgXk; bp5bO: $errMsg = curl_error($ch); goto heNnw; RX4vI: curl_setopt($ch, CURLOPT_FORBID_REUSE, FALSE); goto fvpQB; eIuoT: return $jsonObj; goto Cu6v7; tY2Du: wexception("\137\160\157\163\x74\x2c\x20\146\x61\x69\x6c\145\144\40\x74\157\x20\x6a\x73\x6f\x6e\137\144\145\x63\157\144\x65\72\40" . $result . "\54\x20\x75\x72\154\x3a\40" . $url); goto XR3dq; heNnw: curl_close($ch); goto BaEBp; vSgXk: if ($result) { goto XC3hl; } goto ZFWpM; FEMA9: if (!($httpCode != "\x32\60\60")) { goto Fk8gY; } goto QgxfH; qhrMv: XC3hl: goto DTkAf; Cu6v7: } }
