<?php
 namespace app\index\service; use think\Log; use think\Db; use think\Debug; use app\index\service\RequestContext; use app\common\service\WException; use app\common\service\Storage as StorageService; use app\Defs; use app\index\logic\License as LicenseLogic; class Wzyer extends Base { protected function __construct() { } const API_URL_PREFIX = "\x68\x74\164\160\163\72\57\x2f\167\x77\167\56\167\172\171\x65\x72\x2e\x63\x6f\x6d\57\x69\156\144\145\x78\x2f\117\160\x65\156\x5f\x41\x70\x69"; protected function buildHeader() { goto N_vg4; N_vg4: $licenseData = LicenseLogic::I()->fetch(); goto f7IOR; f7IOR: $headers = ["\x41\120\x50\55\x49\104\72" . $licenseData["\x69\144"], "\101\x55\x54\x48\x2d\x4b\105\x59\x3a" . $licenseData["\141\x75\x74\150\137\x6b\145\x79"], "\103\x6f\156\164\x65\156\x74\x2d\x54\x79\x70\145\72\x20\141\x70\x70\154\151\143\x61\x74\x69\x6f\156\57\x78\55\x77\x77\x77\55\146\157\x72\155\x2d\165\x72\154\145\156\143\157\144\145\144"]; goto viN9N; viN9N: return $headers; goto skI4B; skI4B: } public function bindAuthKey($authKey, $ip = '') { goto VROSp; VROSp: $headers = $this->buildHeader(); goto NBwdt; xnKJu: return $jsonObj["\x64\x61\x74\x61"]; goto Pd5ff; NBwdt: $postFields = http_build_query(["\141\165\x74\x68\113\x65\x79" => $authKey, "\x69\160" => $ip]); goto fbtyp; fbtyp: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\x62\x69\x6e\x64\x41\x75\164\x68\x4b\x65\171\x2e\x68\164\x6d\154", $headers, $postFields); goto Uy1ku; Yhj2J: Log::error("\x62\151\x6e\x64\101\165\x74\x68\113\145\x79\x20\x65\x72\x72\x6f\x72\72\x20" . $jsonObj["\155\x73\147"]); goto dlVPm; Uy1ku: if (!($jsonObj["\x63\157\144\145"] != 1)) { goto AA8rZ; } goto Yhj2J; dlVPm: wexception($jsonObj["\x6d\163\147"]); goto x5VyC; x5VyC: AA8rZ: goto xnKJu; Pd5ff: } public function refreshAuthKey() { goto laDzY; v7rvP: b_I_4: goto vrlq9; laDzY: $headers = $this->buildHeader(); goto kqeXd; kqeXd: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\x72\x65\146\x72\x65\x73\x68\x41\165\164\x68\x4b\145\x79\x2e\x68\x74\x6d\x6c", $headers); goto nId86; vrlq9: return $jsonObj["\x64\141\164\x61"]; goto Bqufs; nId86: if (!($jsonObj["\x63\x6f\x64\x65"] != 1)) { goto b_I_4; } goto MWnrv; TkrIK: wexception($jsonObj["\155\163\x67"]); goto v7rvP; MWnrv: Log::error("\x72\x65\146\162\x65\163\x68\x41\x75\x74\150\x4b\x65\171\40\x65\162\162\157\x72\72\x20" . $jsonObj["\x6d\x73\x67"]); goto TkrIK; Bqufs: } public function unbindAuthKey() { goto xS4Iz; xS4Iz: $headers = $this->buildHeader(); goto J1gWj; CJBOI: Log::error("\165\156\x62\151\x6e\144\x41\165\x74\x68\113\x65\x79\40\145\162\x72\x6f\162\72\40" . $jsonObj["\x6d\163\x67"]); goto rpkJ0; U7jA0: if (!($jsonObj["\x63\157\144\x65"] != 1)) { goto GquqR; } goto CJBOI; rpkJ0: wexception($jsonObj["\155\x73\x67"]); goto QIZ8L; VOCL_: return; goto gI63H; QIZ8L: GquqR: goto VOCL_; J1gWj: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\x75\x6e\142\151\156\x64\x41\165\x74\x68\x4b\x65\171\56\150\x74\x6d\x6c", $headers); goto U7jA0; gI63H: } public function apiSubjectList($type = Defs::SUBJECT_TYPE_PSYCHOLOGY, $search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto rcQbS; ZiIvp: return $jsonObj["\x64\141\164\141"]; goto Izmr_; vcf0p: $postFields = http_build_query(["\x74\x79\x70\145" => $type, "\163\145\141\x72\x63\x68" => $search, "\x70\x61\x67\145" => $page, "\162\x6f\x77\x73" => $rows, "\x73\x6f\162\x74" => $sort, "\x6f\x72\144\x65\x72" => $order]); goto lqXV5; gmS1R: wexception($jsonObj["\x6d\163\147"]); goto oX4a3; rcQbS: $headers = $this->buildHeader(); goto vcf0p; Of4Kb: Log::error("\141\160\x69\x53\x75\142\x6a\145\x63\x74\x4c\x69\163\164\x20\145\162\162\x6f\162\x3a\x20" . $jsonObj["\155\163\x67"]); goto gmS1R; v1n38: if (!($jsonObj["\143\157\144\x65"] != 1)) { goto jJaI9; } goto Of4Kb; lqXV5: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\163\165\142\x6a\145\x63\164\114\x69\x73\x74\x2e\150\x74\x6d\x6c", $headers, $postFields); goto v1n38; oX4a3: jJaI9: goto ZiIvp; Izmr_: } public function apiSubject($subjectId) { goto JGtVC; Gce5i: if (!($jsonObj["\143\x6f\144\145"] != 1)) { goto l717I; } goto Q1JZH; Vxi7_: return $jsonObj["\144\141\164\141"]; goto Z0c6c; pji1T: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\x73\165\142\x6a\x65\143\x74\56\x68\x74\x6d\x6c\77\163\165\142\x6a\145\x63\164\x49\144\x3d" . $subjectId, $headers); goto Gce5i; JGtVC: $headers = $this->buildHeader(); goto pji1T; Q1JZH: Log::error("\141\160\x69\x53\165\x62\152\145\143\x74\x20\145\162\162\157\162\x3a\40" . $jsonObj["\x6d\163\x67"]); goto ZsQZW; ZsQZW: wexception($jsonObj["\155\163\147"]); goto uiQNY; uiQNY: l717I: goto Vxi7_; Z0c6c: } public function apiSubjectReport($sn, $itemOptions) { goto nKIKH; P8_du: Log::error("\x61\x70\x69\123\x75\142\x6a\x65\x63\x74\x52\145\160\157\162\164\x20\145\x72\162\157\162\x3a\x20" . $jsonObj["\x6d\x73\147"]); goto jm20O; jm20O: wexception($jsonObj["\x6d\x73\x67"]); goto UYRgg; VUe3M: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\163\165\142\x6a\x65\x63\x74\122\x65\x70\x6f\x72\164\x2e\x68\164\155\154", $headers, $postFields); goto iiRDV; akdvW: $postFields = http_build_query(["\x73\156" => $sn, "\x69\x74\145\x6d\117\160\x74\x69\157\156\x73" => json_encode($itemOptions)]); goto VUe3M; UYRgg: SWOuO: goto mM7Ek; mM7Ek: return $jsonObj["\x64\141\164\x61"]; goto tW3u8; iiRDV: if (!($jsonObj["\143\x6f\x64\145"] != 1)) { goto SWOuO; } goto P8_du; nKIKH: $headers = $this->buildHeader(); goto akdvW; tW3u8: } public function apiFetchReportAlgo($number) { goto KeoX3; mMX3m: $postFields = http_build_query(["\156\165\x6d\142\145\162" => $number]); goto WRGfM; cGOXA: return $jsonObj["\x64\x61\x74\141"]; goto idCa9; WRGfM: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\x66\145\x74\143\x68\122\x65\160\157\x72\164\x41\x6c\x67\x6f\x2e\150\164\x6d\154", $headers, $postFields); goto p3F5k; KeoX3: $headers = $this->buildHeader(); goto mMX3m; udVNT: wexception($jsonObj["\155\x73\x67"]); goto s931Y; p3F5k: if (!($jsonObj["\x63\157\144\145"] != 1)) { goto pYXHb; } goto jtAej; jtAej: Log::error("\x61\160\151\106\145\x74\x63\x68\x52\x65\160\157\162\164\101\x6c\147\157\x20\x65\162\x72\157\x72\72\40" . $jsonObj["\155\163\x67"]); goto udVNT; s931Y: pYXHb: goto cGOXA; idCa9: } protected function _get($url, $headers = array()) { goto Y8QKV; KY2v1: curl_setopt($ch, CURLOPT_TIMEOUT, 120); goto Ro_AY; u2Ohw: $errCode = curl_errno($ch); goto RF7Rk; Oq2dQ: FN87C: goto Uxysr; az80u: if ($result) { goto XVtES; } goto u2Ohw; Y8QKV: $ch = curl_init(); goto SX63M; JyU1l: curl_close($ch); goto nFMOM; nFMOM: Log::error("\x5f\147\145\x74\x2c\40\x66\141\151\x6c\x65\144\x20\164\157\x20\143\x75\162\x6c\x5f\x65\x78\145\143\54\x20{$errCode}\x2c\x20{$errMsg}\x2c\40\x75\162\x6c\72\40" . $url); goto tq_gc; tq_gc: wexception("\x5f\147\x65\x74\54\40\146\x61\151\154\145\x64\40\x74\157\x20\143\165\x72\154\137\x65\170\x65\x63\x2c\40{$errCode}\x2c\x20{$errMsg}\x2c\x20\165\x72\154\72\x20" . $url); goto NaIE2; VW9yw: XFQ00: goto bGOqq; KPS8u: curl_setopt($ch, CURLOPT_FORBID_REUSE, FALSE); goto tzYpZ; IjXJt: curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); goto MJjnX; hkRo0: if (!($httpCode != "\62\x30\x30")) { goto XFQ00; } goto IOLLV; F8cd5: curl_close($ch); goto hkRo0; Uxysr: return $jsonObj; goto EmKNY; ild0e: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto YQmQv; eq61Z: wexception("\x5f\x67\x65\x74\54\40\146\141\x69\154\x65\x64\40\164\x6f\40\152\x73\157\156\x5f\144\145\x63\x6f\144\145\72\x20" . $result . "\x2c\40\x75\162\154\72\x20" . $url); goto Oq2dQ; uMM1F: Log::notice("\x5f\x67\x65\x74\x20\x75\162\154\x3a\40" . $url . "\x2c\x20\162\145\x73\160\x6f\x6e\163\145\40\x72\145\x73\165\x6c\x74\72\40" . $result); goto lcuFT; SX63M: curl_setopt($ch, CURLOPT_URL, $url); goto Qa6B3; V3fnJ: Log::error("\x5f\x67\x65\164\54\40\146\141\x69\x6c\x65\x64\x20\164\157\x20\152\163\x6f\156\x5f\144\145\143\x6f\144\145\x3a\40" . $result . "\54\x20\165\162\154\72\40" . $url); goto eq61Z; rxya0: Log::notice("\137\x67\145\164\x20\165\x72\154\72\40" . $url . "\x2c\40\x68\164\x74\160\40\x68\145\141\144\x65\162\72\x20" . json_encode($headers, JSON_UNESCAPED_UNICODE)); goto Compo; IOLLV: Log::error("\137\x67\145\164\54\40\x68\164\164\160\40\x63\x6f\144\x65\x20{$httpCode}\x2c\40{$result}\x2c\x20\165\162\x6c\72\x20" . $url); goto KvcE4; tzYpZ: if (!$headers) { goto DQep7; } goto IjXJt; Qa6B3: curl_setopt($ch, CURLOPT_VERBOSE, TRUE); goto i314U; zcDwa: if ($jsonObj) { goto FN87C; } goto V3fnJ; RF7Rk: $errMsg = curl_error($ch); goto JyU1l; YQmQv: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 120); goto KY2v1; Compo: $result = curl_exec($ch); goto az80u; i314U: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto ild0e; bGOqq: $jsonObj = json_decode($result, true); goto zcDwa; MJjnX: DQep7: goto rxya0; Ro_AY: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto KPS8u; KvcE4: wexception("\137\x67\145\164\54\x20\150\x74\x74\x70\40\143\x6f\x64\x65\40{$httpCode}\x2c\x20{$result}\x2c\x20\165\162\x6c\x3a\x20" . $url); goto VW9yw; NaIE2: XVtES: goto uMM1F; lcuFT: $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto F8cd5; EmKNY: } protected function _post($url, $headers = array(), $postFields = '') { goto sDJlW; nacFs: So_9z: goto daMOz; daMOz: if (!$postFields) { goto trlrn; } goto MYsOb; Fc2yB: curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); goto nacFs; sDJlW: $ch = curl_init(); goto yAMkW; csouw: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto BaChk; rXMY3: $jsonObj = json_decode($result, true); goto cHMAf; mLS9T: return $jsonObj; goto hMh56; Yi2bN: wexception("\x5f\160\x6f\x73\164\x2c\x20\150\x74\164\160\40\x63\157\144\x65\x20{$httpCode}\54\x20{$result}\x2c\x20\x75\x72\x6c\x3a\40" . $url); goto f5tIL; K8tFJ: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto csouw; YpiHq: Log::error("\x5f\160\157\x73\x74\x2c\x20\146\x61\151\x6c\x65\144\x20\x74\157\40\x6a\163\157\156\x5f\x64\x65\x63\157\x64\145\x3a\x20" . $result . "\54\40\165\x72\x6c\72\x20" . $url); goto rx1Qp; Rstvk: curl_close($ch); goto FAqJf; AX6Pv: Log::error("\x5f\160\157\x73\x74\x2c\x20\x68\164\164\x70\40\143\x6f\x64\x65\40{$httpCode}\x2c\x20{$result}\54\x20\165\162\x6c\72\40" . $url); goto Yi2bN; MpBf1: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto PqSlU; FAqJf: if (!($httpCode != "\x32\60\60")) { goto YKjXa; } goto AX6Pv; ewwty: if ($result) { goto MUOZu; } goto EQu1S; ZwFEP: trlrn: goto U98Rd; P8SKr: $errMsg = curl_error($ch); goto RGV3H; nbTl7: Log::error("\x5f\x70\157\x73\164\54\40\146\141\x69\x6c\145\x64\x20\164\x6f\40\x63\x75\x72\x6c\x5f\x65\x78\x65\143\x2c\40{$errCode}\54\x20{$errMsg}\54\x20\x75\x72\x6c\72\x20" . $url); goto Pbaco; U98Rd: Log::notice("\x5f\x70\157\x73\x74\x20\165\162\154\72\x20" . $url . "\x2c\40\150\x74\x74\x70\40\x68\x65\141\144\x65\x72\72\x20" . json_encode($headers, JSON_UNESCAPED_UNICODE) . "\x2c\x20\160\157\x73\164\x20\x63\157\156\164\x65\156\164\x3a\40" . is_array($postFields) ? json_encode($postFields, JSON_UNESCAPED_UNICODE) : $postFields); goto jleXb; ysLdz: Log::notice("\x5f\x70\x6f\x73\x74\40\x75\162\x6c\x3a\40" . $url . "\x2c\40\150\x74\x74\160\40\x68\x65\x61\144\145\162\72\40" . json_encode($headers, JSON_UNESCAPED_UNICODE)); goto Fc2yB; RGV3H: curl_close($ch); goto nbTl7; MYsOb: curl_setopt($ch, CURLOPT_POSTFIELDS, $postFields); goto ZwFEP; Zcg6s: curl_setopt($ch, CURLOPT_POST, TRUE); goto ut1Ep; PqSlU: curl_setopt($ch, CURLOPT_FORBID_REUSE, FALSE); goto Zcg6s; cHMAf: if ($jsonObj) { goto JAP0P; } goto YpiHq; JIIrF: curl_setopt($ch, CURLOPT_VERBOSE, TRUE); goto K8tFJ; pUXmI: Log::notice("\x5f\160\x6f\x73\164\x20\165\x72\154\x3a\40" . $url . "\x2c\x20\162\x65\163\x70\x6f\156\x73\145\40\162\x65\x73\x75\x6c\x74\72\40" . $result); goto lQbQX; jleXb: $result = curl_exec($ch); goto ewwty; Pbaco: wexception("\137\160\x6f\163\x74\x2c\x20\x66\141\151\154\x65\x64\x20\164\157\x20\143\165\x72\154\137\x65\170\145\143\54\x20{$errCode}\x2c\40{$errMsg}\54\x20\165\162\154\72\40" . $url); goto wKfUn; BaChk: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 120); goto zR2Wh; ut1Ep: if (!$headers) { goto So_9z; } goto ysLdz; DJ78p: JAP0P: goto mLS9T; wKfUn: MUOZu: goto pUXmI; yAMkW: curl_setopt($ch, CURLOPT_URL, $url); goto JIIrF; lQbQX: $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto Rstvk; zR2Wh: curl_setopt($ch, CURLOPT_TIMEOUT, 120); goto MpBf1; f5tIL: YKjXa: goto rXMY3; rx1Qp: wexception("\137\160\157\163\x74\x2c\40\146\141\x69\154\145\144\40\x74\x6f\x20\152\163\157\156\x5f\x64\145\143\157\x64\x65\72\x20" . $result . "\x2c\x20\165\162\x6c\72\x20" . $url); goto DJ78p; EQu1S: $errCode = curl_errno($ch); goto P8SKr; hMh56: } }
