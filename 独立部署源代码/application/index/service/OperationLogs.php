<?php
 namespace app\index\service; use think\Log; use think\Db; use think\Debug; use think\Request; use app\index\service\RequestContext; use app\Defs; use app\index\logic\Defs as IndexDefs; class OperationLogs extends Base { protected function __construct() { parent::__construct(); } const CATEGORY_SYSTEM = 0; const CATEGORY_EXPERT = 1; const CATEGORY_SUBJECT = 2; const CATEGORY_SUBJECT_COMBINATION = 3; const CATEGORY_SURVEY = 4; const CATEGORY_ORDER = 5; const CATEGORY_DEFS = array(self::CATEGORY_SYSTEM => "\xe7\xb3\xbb\xe7\xbb\237", self::CATEGORY_EXPERT => "\344\270\223\345\xae\266", self::CATEGORY_SUBJECT => "\xe9\x87\x8f\xe8\xa1\xa8", self::CATEGORY_SUBJECT_COMBINATION => "\xe7\273\x84\xe5\220\x88\xe9\x87\217\xe8\241\250", self::CATEGORY_SURVEY => "\346\x99\xae\xe6\237\245", self::CATEGORY_ORDER => "\350\256\242\xe5\215\x95"); const OPT_ADD_TYPE = 1; const OPT_UPDATE_TYPE = 2; const OPT_DELETE_TYPE = 3; const OPT_RESTORE_TYPE = 4; const OPT_OTHER_TYPE = 5; const OPT_DEFS = array(self::OPT_ADD_TYPE => "\346\x96\260\345\xa2\x9e", self::OPT_UPDATE_TYPE => "\344\277\xae\xe6\224\xb9", self::OPT_DELETE_TYPE => "\345\210\xa0\xe9\231\244", self::OPT_RESTORE_TYPE => "\xe6\201\xa2\xe5\xa4\215", self::OPT_OTHER_TYPE => "\345\205\xb6\344\273\x96"); const CHANNEL_ADMIN = 1; const CHANNEL_CLI = 3; const CHANNEL_DEFS = array(self::CHANNEL_ADMIN => "\xe7\256\xa1\xe7\x90\206\xe7\xab\xaf", self::CHANNEL_CLI => "\346\216\xa7\345\x88\266\xe5\217\xb0"); public function systemLog($title = '', $content = '', $type = OperationLogs::OPT_ADD_TYPE, $entityId = 0) { return $this->log(self::CATEGORY_SYSTEM, $title, $content, $type, $entityId); } public function expertLog($title = '', $content = '', $type = OperationLogs::OPT_ADD_TYPE, $entityId = 0) { goto NQx3o; z1SYe: yllE6: goto Q5dRk; Q5dRk: return $this->log(self::CATEGORY_EXPERT, $title, $content, $type, $entityId); goto f_lt5; FfcYA: return; goto z1SYe; NQx3o: if (!($type == self::OPT_UPDATE_TYPE && $content == '')) { goto yllE6; } goto FfcYA; f_lt5: } public function subjectLog($title = '', $content = '', $type = OperationLogs::OPT_ADD_TYPE, $entityId = 0) { goto SNs2s; SNs2s: if (!($type == self::OPT_UPDATE_TYPE && $content == '')) { goto d_gUN; } goto ZRrUY; ZRrUY: return; goto DlDSY; DlDSY: d_gUN: goto Wc9e9; Wc9e9: return $this->log(self::CATEGORY_SUBJECT, $title, $content, $type, $entityId); goto kBRPE; kBRPE: } public function subjecCombinationtLog($title = '', $content = '', $type = OperationLogs::OPT_ADD_TYPE, $entityId = 0) { goto X5uo_; m1ljg: return; goto nc22t; S7bfC: return $this->log(self::CATEGORY_SUBJECT_COMBINATION, $title, $content, $type, $entityId); goto Nyzly; nc22t: g3CVb: goto S7bfC; X5uo_: if (!($type == self::OPT_UPDATE_TYPE && $content == '')) { goto g3CVb; } goto m1ljg; Nyzly: } public function surveyLog($title = '', $content = '', $type = OperationLogs::OPT_ADD_TYPE, $entityId = 0) { goto zcYnN; LNPVf: return; goto DjYxp; zcYnN: if (!($type == self::OPT_UPDATE_TYPE && $content == '')) { goto VoSHE; } goto LNPVf; DjYxp: VoSHE: goto A0K8d; A0K8d: return $this->log(self::CATEGORY_SURVEY, $title, $content, $type, $entityId); goto t2VsK; t2VsK: } public function orderLog($title = '', $content = '', $type = OperationLogs::OPT_ADD_TYPE, $entityId = 0) { return $this->log(self::CATEGORY_ORDER, $title, $content, $type, $entityId); } public function log($category = OperationLogs::CATEGORY_EXPERT, $title = '', $content = '', $type = OperationLogs::OPT_ADD_TYPE, $entityId = 0) { goto jUMbO; MUYC6: return $result == 1 ? true : false; goto sHa7Z; oqAd5: $changed_by = RequestContext::I()->loginUserName . "\50" . RequestContext::I()->loginRealName . "\x29"; goto J7Gw6; swo6U: goto xU3rh; goto hwQYe; yY2QS: $result = Db::table("\157\x70\145\x72\141\164\151\x6f\156\x5f\x6c\157\x67\x73")->insert(["\x63\141\x74\x65\x67\x6f\162\x79" => $category, "\164\151\164\x6c\x65" => truncateString($title, 128), "\143\157\156\x74\x65\156\x74" => truncateString($content, 4096), "\x74\x79\x70\x65" => $type, "\x72\145\143\x6f\162\144\137\151\x64" => $entityId, "\x69\160" => $ip, "\144\x65\166\151\x63\x65" => $device, "\x63\x68\x61\156\x67\145\x64\x5f\x62\x79" => $changed_by]); goto MUYC6; hwQYe: CUkHh: goto oqAd5; cPJU9: $channel = self::CHANNEL_ADMIN; goto RV8ja; RxcAa: $channel = self::CHANNEL_CLI; goto es1BZ; es1BZ: TRuqh: goto yY2QS; NDzL8: $ip = request()->ip(); goto gyk1w; J7Gw6: xU3rh: goto NDzL8; p1tg3: $device = Defs::DEVICE_DESKTOP; goto RxcAa; gyk1w: $device = Request::instance()->isMobile() ? Defs::DEVICE_MOBILE : Defs::DEVICE_DESKTOP; goto cPJU9; tOwQn: $ip = "\x31\x32\67\x2e\60\56\x30\56\61"; goto p1tg3; Sf8c8: PXAvA: goto CtQei; RV8ja: goto TRuqh; goto Sf8c8; inttb: $changed_by = ''; goto swo6U; OV7WY: if (RequestContext::I()->loginUserId) { goto CUkHh; } goto inttb; CtQei: $changed_by = "\346\216\xa7\xe5\210\266\345\217\260"; goto tOwQn; jUMbO: if (request()->isCli()) { goto PXAvA; } goto OV7WY; sHa7Z: } }
